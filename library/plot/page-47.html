<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>PLOT: Source Locations</title></head><body><banner><center><h1>Programming Language for Old Timers</h1><br>by David A. Moon<br>February 2006 .. September 2008<br></center><br>Comments and criticisms to dave underscore moon atsign alum dot mit dot edu.<br><hr><br><P align=center><A HREF="page-46.html">Previous page</A>&nbsp;&nbsp;&nbsp;<A HREF="index.html">Table of Contents</A>&nbsp;&nbsp;&nbsp;<A HREF="page-48.html">Next page</A></P><BR><h2>Source Locations</h2><P>As mentioned above, a token-stream keeps track of source locations.  Asource location is the file name and line number where a token appears.This is useful for error messages and debuggers.<P>Source location information is transferred from the token-stream to objects in theprogram model.  A function invocation holds a source location, as does anyother object that implements the source-locator protocol.<P>When the expression parser expands a macro, it remembers the source locationof the macro name in the macro call, in such a way that any dynamically nestedcall to <TT>source-location</TT> with no arguments will return that source location.Any <TT>compound-expression</TT> object created during macro expansion is given theremembered source location.<P>The defparser and defsyntax macros expand into a parse function.  These macrosgenerate code which remembers the source location of the first token parsed.Any <TT>compound-expression</TT> object created duringthe parsing is given the remembered source location.<P>The template macro generates code to transfer source locations fromthe input token-stream to the output token sequence, using asource-location-marker where necessary. Then parsing from a token-streamwrapping the token sequence will recover the source locationinformation.<P>The following macro and function provide the dynamic binding of the currentsource location:<P><PRE>;; Dynamically bind the current source location;; location is an expression that returns two values, file and linedefmacro with-source-location ?location ?:block =&gt; ...;; With no arguments, source-location returns the values stashed;; by the innermost with-source-locationdef source-location (result: file, line) ...</PRE><P><P><BR><P align=center><A HREF="page-46.html">Previous page</A>&nbsp;&nbsp;&nbsp;<A HREF="index.html">Table of Contents</A>&nbsp;&nbsp;&nbsp;<A HREF="page-48.html">Next page</A></P><BR><br></body></html>