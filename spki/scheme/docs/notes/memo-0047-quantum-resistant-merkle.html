<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0047: Quantum-Resistant Merkle Trees</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>Î»</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>Î»</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0047: Quantum-Resistant Merkle Trees</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>SHA-512 won't survive. Grover's algorithm halves the effective security - 256 bits becomes 128. For the wilderness of mirrors to endure the quantum winter, we need quantum-resistant Merkle trees. This Memo specifies the transition from flat SHA-512 hashes to tree-structured SHAKE256 hashes.</p>
</section>
<section>
<h2>The Problem</h2>
<p>Current cyberspace object identity:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 430 20" width="430" height="20" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">sha512(content)</text>
<text x="180" y="10">64</text>
<text x="210" y="10">bytes</text>
<text x="290" y="10">object</text>
<text x="360" y="10">address</text>
</svg>
</div>
<p>Against a quantum computer with Grover's algorithm: - Classical security: 256 bits - Quantum security: 128 bits (square root)</p>
<p>128 bits may be acceptable for some threat models, but cyberspace is built to last. The Library of Alexandria burned once. We won't let quantum computers burn it again.</p>
</section>
<section>
<h2>The Solution: Merkle Trees</h2>
<p>Instead of hashing content as a flat blob, structure it as a tree:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 580 340" width="580" height="340" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<line x1="205" y1="10" x2="210" y2="10"/>
<line x1="205" y1="10" x2="205" y2="21"/>
<line x1="210" y1="10" x2="220" y2="10"/>
<line x1="220" y1="10" x2="230" y2="10"/>
<line x1="230" y1="10" x2="240" y2="10"/>
<line x1="240" y1="10" x2="250" y2="10"/>
<line x1="250" y1="10" x2="260" y2="10"/>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="385" y2="10"/>
<line x1="385" y1="10" x2="385" y2="21"/>
<line x1="205" y1="19" x2="205" y2="41"/>
<text x="240" y="30">Merkle</text>
<text x="310" y="30">Root</text>
<line x1="385" y1="19" x2="385" y2="41"/>
<text x="430" y="30">Object</text>
<text x="500" y="30">identity</text>
<line x1="205" y1="39" x2="205" y2="61"/>
<text x="230" y="50">shake256(...)</text>
<line x1="385" y1="39" x2="385" y2="61"/>
<line x1="205" y1="70" x2="210" y2="70"/>
<line x1="205" y1="59" x2="205" y2="70"/>
<line x1="210" y1="70" x2="220" y2="70"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="295" y1="70" x2="295" y2="81"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="360" y2="70"/>
<line x1="360" y1="70" x2="370" y2="70"/>
<line x1="370" y1="70" x2="380" y2="70"/>
<line x1="380" y1="70" x2="385" y2="70"/>
<line x1="385" y1="59" x2="385" y2="70"/>
<line x1="385" y1="79" x2="385" y2="101"/>
<line x1="145" y1="110" x2="150" y2="110"/>
<line x1="145" y1="110" x2="145" y2="121"/>
<line x1="150" y1="110" x2="160" y2="110"/>
<line x1="160" y1="110" x2="170" y2="110"/>
<line x1="170" y1="110" x2="180" y2="110"/>
<line x1="180" y1="110" x2="190" y2="110"/>
<line x1="190" y1="110" x2="200" y2="110"/>
<line x1="200" y1="110" x2="210" y2="110"/>
<line x1="210" y1="110" x2="220" y2="110"/>
<line x1="220" y1="110" x2="230" y2="110"/>
<line x1="230" y1="110" x2="240" y2="110"/>
<line x1="240" y1="110" x2="250" y2="110"/>
<line x1="250" y1="110" x2="260" y2="110"/>
<line x1="260" y1="110" x2="270" y2="110"/>
<line x1="270" y1="110" x2="280" y2="110"/>
<line x1="280" y1="110" x2="290" y2="110"/>
<line x1="290" y1="110" x2="300" y2="110"/>
<line x1="295" y1="99" x2="295" y2="121"/>
<line x1="300" y1="110" x2="310" y2="110"/>
<line x1="310" y1="110" x2="320" y2="110"/>
<line x1="320" y1="110" x2="330" y2="110"/>
<line x1="330" y1="110" x2="340" y2="110"/>
<line x1="340" y1="110" x2="350" y2="110"/>
<line x1="350" y1="110" x2="360" y2="110"/>
<line x1="360" y1="110" x2="370" y2="110"/>
<line x1="370" y1="110" x2="380" y2="110"/>
<line x1="380" y1="110" x2="390" y2="110"/>
<line x1="390" y1="110" x2="400" y2="110"/>
<line x1="400" y1="110" x2="410" y2="110"/>
<line x1="410" y1="110" x2="420" y2="110"/>
<line x1="420" y1="110" x2="430" y2="110"/>
<line x1="430" y1="110" x2="440" y2="110"/>
<line x1="440" y1="110" x2="445" y2="110"/>
<line x1="445" y1="110" x2="445" y2="121"/>
<line x1="145" y1="119" x2="145" y2="141"/>
<line x1="295" y1="119" x2="295" y2="141"/>
<line x1="445" y1="119" x2="445" y2="141"/>
<line x1="95" y1="150" x2="100" y2="150"/>
<line x1="95" y1="150" x2="95" y2="161"/>
<line x1="100" y1="150" x2="110" y2="150"/>
<line x1="110" y1="150" x2="120" y2="150"/>
<line x1="120" y1="150" x2="130" y2="150"/>
<line x1="130" y1="150" x2="140" y2="150"/>
<line x1="150" y1="150" x2="160" y2="150"/>
<line x1="160" y1="150" x2="170" y2="150"/>
<line x1="170" y1="150" x2="180" y2="150"/>
<line x1="180" y1="150" x2="190" y2="150"/>
<line x1="190" y1="150" x2="195" y2="150"/>
<line x1="195" y1="150" x2="195" y2="161"/>
<line x1="245" y1="150" x2="250" y2="150"/>
<line x1="245" y1="150" x2="245" y2="161"/>
<line x1="250" y1="150" x2="260" y2="150"/>
<line x1="260" y1="150" x2="270" y2="150"/>
<line x1="270" y1="150" x2="280" y2="150"/>
<line x1="280" y1="150" x2="290" y2="150"/>
<line x1="300" y1="150" x2="310" y2="150"/>
<line x1="310" y1="150" x2="320" y2="150"/>
<line x1="320" y1="150" x2="330" y2="150"/>
<line x1="330" y1="150" x2="340" y2="150"/>
<line x1="340" y1="150" x2="345" y2="150"/>
<line x1="345" y1="150" x2="345" y2="161"/>
<line x1="395" y1="150" x2="400" y2="150"/>
<line x1="395" y1="150" x2="395" y2="161"/>
<line x1="400" y1="150" x2="410" y2="150"/>
<line x1="410" y1="150" x2="420" y2="150"/>
<line x1="420" y1="150" x2="430" y2="150"/>
<line x1="430" y1="150" x2="440" y2="150"/>
<line x1="450" y1="150" x2="460" y2="150"/>
<line x1="460" y1="150" x2="470" y2="150"/>
<line x1="470" y1="150" x2="480" y2="150"/>
<line x1="480" y1="150" x2="490" y2="150"/>
<line x1="490" y1="150" x2="495" y2="150"/>
<line x1="495" y1="150" x2="495" y2="161"/>
<line x1="95" y1="159" x2="95" y2="181"/>
<text x="110" y="170">Node</text>
<text x="160" y="170">0</text>
<line x1="195" y1="159" x2="195" y2="181"/>
<line x1="245" y1="159" x2="245" y2="181"/>
<text x="260" y="170">Node</text>
<text x="310" y="170">1</text>
<line x1="345" y1="159" x2="345" y2="181"/>
<line x1="395" y1="159" x2="395" y2="181"/>
<text x="410" y="170">Node</text>
<text x="460" y="170">2</text>
<line x1="495" y1="159" x2="495" y2="181"/>
<line x1="95" y1="190" x2="100" y2="190"/>
<line x1="95" y1="179" x2="95" y2="190"/>
<line x1="100" y1="190" x2="110" y2="190"/>
<line x1="110" y1="190" x2="120" y2="190"/>
<line x1="120" y1="190" x2="130" y2="190"/>
<line x1="130" y1="190" x2="140" y2="190"/>
<line x1="140" y1="190" x2="150" y2="190"/>
<line x1="145" y1="190" x2="145" y2="201"/>
<line x1="150" y1="190" x2="160" y2="190"/>
<line x1="160" y1="190" x2="170" y2="190"/>
<line x1="170" y1="190" x2="180" y2="190"/>
<line x1="180" y1="190" x2="190" y2="190"/>
<line x1="190" y1="190" x2="195" y2="190"/>
<line x1="195" y1="179" x2="195" y2="190"/>
<line x1="245" y1="190" x2="250" y2="190"/>
<line x1="245" y1="179" x2="245" y2="190"/>
<line x1="250" y1="190" x2="260" y2="190"/>
<line x1="260" y1="190" x2="270" y2="190"/>
<line x1="270" y1="190" x2="280" y2="190"/>
<line x1="280" y1="190" x2="290" y2="190"/>
<line x1="290" y1="190" x2="300" y2="190"/>
<line x1="295" y1="190" x2="295" y2="201"/>
<line x1="300" y1="190" x2="310" y2="190"/>
<line x1="310" y1="190" x2="320" y2="190"/>
<line x1="320" y1="190" x2="330" y2="190"/>
<line x1="330" y1="190" x2="340" y2="190"/>
<line x1="340" y1="190" x2="345" y2="190"/>
<line x1="345" y1="179" x2="345" y2="190"/>
<line x1="395" y1="190" x2="400" y2="190"/>
<line x1="395" y1="179" x2="395" y2="190"/>
<line x1="400" y1="190" x2="410" y2="190"/>
<line x1="410" y1="190" x2="420" y2="190"/>
<line x1="420" y1="190" x2="430" y2="190"/>
<line x1="430" y1="190" x2="440" y2="190"/>
<line x1="440" y1="190" x2="450" y2="190"/>
<line x1="445" y1="190" x2="445" y2="201"/>
<line x1="450" y1="190" x2="460" y2="190"/>
<line x1="460" y1="190" x2="470" y2="190"/>
<line x1="470" y1="190" x2="480" y2="190"/>
<line x1="480" y1="190" x2="490" y2="190"/>
<line x1="490" y1="190" x2="495" y2="190"/>
<line x1="495" y1="179" x2="495" y2="190"/>
<line x1="145" y1="199" x2="145" y2="221"/>
<line x1="295" y1="199" x2="295" y2="221"/>
<line x1="445" y1="199" x2="445" y2="221"/>
<line x1="85" y1="230" x2="90" y2="230"/>
<line x1="85" y1="230" x2="85" y2="241"/>
<line x1="90" y1="230" x2="100" y2="230"/>
<line x1="100" y1="230" x2="110" y2="230"/>
<line x1="110" y1="230" x2="120" y2="230"/>
<line x1="120" y1="230" x2="130" y2="230"/>
<line x1="130" y1="230" x2="140" y2="230"/>
<line x1="140" y1="230" x2="150" y2="230"/>
<line x1="145" y1="219" x2="145" y2="230"/>
<line x1="150" y1="230" x2="160" y2="230"/>
<line x1="160" y1="230" x2="170" y2="230"/>
<line x1="170" y1="230" x2="180" y2="230"/>
<line x1="180" y1="230" x2="190" y2="230"/>
<line x1="190" y1="230" x2="200" y2="230"/>
<line x1="200" y1="230" x2="205" y2="230"/>
<line x1="205" y1="230" x2="205" y2="241"/>
<line x1="235" y1="230" x2="240" y2="230"/>
<line x1="235" y1="230" x2="235" y2="241"/>
<line x1="240" y1="230" x2="250" y2="230"/>
<line x1="250" y1="230" x2="260" y2="230"/>
<line x1="260" y1="230" x2="270" y2="230"/>
<line x1="270" y1="230" x2="280" y2="230"/>
<line x1="280" y1="230" x2="290" y2="230"/>
<line x1="290" y1="230" x2="300" y2="230"/>
<line x1="295" y1="219" x2="295" y2="230"/>
<line x1="300" y1="230" x2="310" y2="230"/>
<line x1="310" y1="230" x2="320" y2="230"/>
<line x1="320" y1="230" x2="330" y2="230"/>
<line x1="330" y1="230" x2="340" y2="230"/>
<line x1="340" y1="230" x2="350" y2="230"/>
<line x1="350" y1="230" x2="355" y2="230"/>
<line x1="355" y1="230" x2="355" y2="241"/>
<line x1="385" y1="230" x2="390" y2="230"/>
<line x1="385" y1="230" x2="385" y2="241"/>
<line x1="390" y1="230" x2="400" y2="230"/>
<line x1="400" y1="230" x2="410" y2="230"/>
<line x1="410" y1="230" x2="420" y2="230"/>
<line x1="420" y1="230" x2="430" y2="230"/>
<line x1="430" y1="230" x2="440" y2="230"/>
<line x1="440" y1="230" x2="450" y2="230"/>
<line x1="445" y1="219" x2="445" y2="230"/>
<line x1="450" y1="230" x2="460" y2="230"/>
<line x1="460" y1="230" x2="470" y2="230"/>
<line x1="470" y1="230" x2="480" y2="230"/>
<line x1="480" y1="230" x2="490" y2="230"/>
<line x1="490" y1="230" x2="500" y2="230"/>
<line x1="500" y1="230" x2="505" y2="230"/>
<line x1="505" y1="230" x2="505" y2="241"/>
<line x1="85" y1="239" x2="85" y2="261"/>
<line x1="205" y1="239" x2="205" y2="261"/>
<line x1="235" y1="239" x2="235" y2="261"/>
<line x1="355" y1="239" x2="355" y2="261"/>
<line x1="385" y1="239" x2="385" y2="261"/>
<line x1="505" y1="239" x2="505" y2="261"/>
<line x1="45" y1="270" x2="50" y2="270"/>
<line x1="45" y1="270" x2="45" y2="281"/>
<line x1="50" y1="270" x2="60" y2="270"/>
<line x1="60" y1="270" x2="70" y2="270"/>
<line x1="70" y1="270" x2="80" y2="270"/>
<line x1="90" y1="270" x2="100" y2="270"/>
<line x1="100" y1="270" x2="110" y2="270"/>
<line x1="110" y1="270" x2="120" y2="270"/>
<line x1="120" y1="270" x2="125" y2="270"/>
<line x1="125" y1="270" x2="125" y2="281"/>
<line x1="145" y1="270" x2="150" y2="270"/>
<line x1="145" y1="270" x2="145" y2="281"/>
<line x1="150" y1="270" x2="160" y2="270"/>
<line x1="160" y1="270" x2="170" y2="270"/>
<line x1="170" y1="270" x2="180" y2="270"/>
<line x1="190" y1="270" x2="200" y2="270"/>
<line x1="200" y1="270" x2="210" y2="270"/>
<line x1="210" y1="270" x2="220" y2="270"/>
<line x1="220" y1="270" x2="225" y2="270"/>
<line x1="225" y1="270" x2="225" y2="281"/>
<line x1="245" y1="270" x2="250" y2="270"/>
<line x1="245" y1="270" x2="245" y2="281"/>
<line x1="250" y1="270" x2="260" y2="270"/>
<line x1="260" y1="270" x2="270" y2="270"/>
<line x1="270" y1="270" x2="280" y2="270"/>
<line x1="290" y1="270" x2="300" y2="270"/>
<line x1="300" y1="270" x2="310" y2="270"/>
<line x1="310" y1="270" x2="320" y2="270"/>
<line x1="320" y1="270" x2="325" y2="270"/>
<line x1="325" y1="270" x2="325" y2="281"/>
<line x1="345" y1="270" x2="350" y2="270"/>
<line x1="345" y1="270" x2="345" y2="281"/>
<line x1="350" y1="270" x2="360" y2="270"/>
<line x1="360" y1="270" x2="370" y2="270"/>
<line x1="370" y1="270" x2="380" y2="270"/>
<line x1="390" y1="270" x2="400" y2="270"/>
<line x1="400" y1="270" x2="410" y2="270"/>
<line x1="410" y1="270" x2="420" y2="270"/>
<line x1="420" y1="270" x2="425" y2="270"/>
<line x1="425" y1="270" x2="425" y2="281"/>
<line x1="445" y1="270" x2="450" y2="270"/>
<line x1="445" y1="270" x2="445" y2="281"/>
<line x1="450" y1="270" x2="460" y2="270"/>
<line x1="460" y1="270" x2="470" y2="270"/>
<line x1="470" y1="270" x2="480" y2="270"/>
<line x1="490" y1="270" x2="500" y2="270"/>
<line x1="500" y1="270" x2="510" y2="270"/>
<line x1="510" y1="270" x2="520" y2="270"/>
<line x1="520" y1="270" x2="525" y2="270"/>
<line x1="525" y1="270" x2="525" y2="281"/>
<text x="540" y="270">...</text>
<line x1="45" y1="279" x2="45" y2="301"/>
<text x="50" y="290">Chunk</text>
<text x="110" y="290">0</text>
<line x1="125" y1="279" x2="125" y2="301"/>
<line x1="145" y1="279" x2="145" y2="301"/>
<text x="150" y="290">Chunk</text>
<text x="210" y="290">1</text>
<line x1="225" y1="279" x2="225" y2="301"/>
<line x1="245" y1="279" x2="245" y2="301"/>
<text x="250" y="290">Chunk</text>
<text x="310" y="290">2</text>
<line x1="325" y1="279" x2="325" y2="301"/>
<line x1="345" y1="279" x2="345" y2="301"/>
<text x="350" y="290">Chunk</text>
<text x="410" y="290">3</text>
<line x1="425" y1="279" x2="425" y2="301"/>
<line x1="445" y1="279" x2="445" y2="301"/>
<text x="450" y="290">Chunk</text>
<text x="510" y="290">4</text>
<line x1="525" y1="279" x2="525" y2="301"/>
<line x1="45" y1="299" x2="45" y2="321"/>
<text x="60" y="310">4</text>
<text x="80" y="310">KB</text>
<line x1="125" y1="299" x2="125" y2="321"/>
<line x1="145" y1="299" x2="145" y2="321"/>
<text x="160" y="310">4</text>
<text x="180" y="310">KB</text>
<line x1="225" y1="299" x2="225" y2="321"/>
<line x1="245" y1="299" x2="245" y2="321"/>
<text x="260" y="310">4</text>
<text x="280" y="310">KB</text>
<line x1="325" y1="299" x2="325" y2="321"/>
<line x1="345" y1="299" x2="345" y2="321"/>
<text x="360" y="310">4</text>
<text x="380" y="310">KB</text>
<line x1="425" y1="299" x2="425" y2="321"/>
<line x1="445" y1="299" x2="445" y2="321"/>
<text x="460" y="310">4</text>
<text x="480" y="310">KB</text>
<line x1="525" y1="299" x2="525" y2="321"/>
<line x1="45" y1="330" x2="50" y2="330"/>
<line x1="45" y1="319" x2="45" y2="330"/>
<line x1="50" y1="330" x2="60" y2="330"/>
<line x1="60" y1="330" x2="70" y2="330"/>
<line x1="70" y1="330" x2="80" y2="330"/>
<line x1="80" y1="330" x2="90" y2="330"/>
<line x1="90" y1="330" x2="100" y2="330"/>
<line x1="100" y1="330" x2="110" y2="330"/>
<line x1="110" y1="330" x2="120" y2="330"/>
<line x1="120" y1="330" x2="125" y2="330"/>
<line x1="125" y1="319" x2="125" y2="330"/>
<line x1="145" y1="330" x2="150" y2="330"/>
<line x1="145" y1="319" x2="145" y2="330"/>
<line x1="150" y1="330" x2="160" y2="330"/>
<line x1="160" y1="330" x2="170" y2="330"/>
<line x1="170" y1="330" x2="180" y2="330"/>
<line x1="180" y1="330" x2="190" y2="330"/>
<line x1="190" y1="330" x2="200" y2="330"/>
<line x1="200" y1="330" x2="210" y2="330"/>
<line x1="210" y1="330" x2="220" y2="330"/>
<line x1="220" y1="330" x2="225" y2="330"/>
<line x1="225" y1="319" x2="225" y2="330"/>
<line x1="245" y1="330" x2="250" y2="330"/>
<line x1="245" y1="319" x2="245" y2="330"/>
<line x1="250" y1="330" x2="260" y2="330"/>
<line x1="260" y1="330" x2="270" y2="330"/>
<line x1="270" y1="330" x2="280" y2="330"/>
<line x1="280" y1="330" x2="290" y2="330"/>
<line x1="290" y1="330" x2="300" y2="330"/>
<line x1="300" y1="330" x2="310" y2="330"/>
<line x1="310" y1="330" x2="320" y2="330"/>
<line x1="320" y1="330" x2="325" y2="330"/>
<line x1="325" y1="319" x2="325" y2="330"/>
<line x1="345" y1="330" x2="350" y2="330"/>
<line x1="345" y1="319" x2="345" y2="330"/>
<line x1="350" y1="330" x2="360" y2="330"/>
<line x1="360" y1="330" x2="370" y2="330"/>
<line x1="370" y1="330" x2="380" y2="330"/>
<line x1="380" y1="330" x2="390" y2="330"/>
<line x1="390" y1="330" x2="400" y2="330"/>
<line x1="400" y1="330" x2="410" y2="330"/>
<line x1="410" y1="330" x2="420" y2="330"/>
<line x1="420" y1="330" x2="425" y2="330"/>
<line x1="425" y1="319" x2="425" y2="330"/>
<line x1="445" y1="330" x2="450" y2="330"/>
<line x1="445" y1="319" x2="445" y2="330"/>
<line x1="450" y1="330" x2="460" y2="330"/>
<line x1="460" y1="330" x2="470" y2="330"/>
<line x1="470" y1="330" x2="480" y2="330"/>
<line x1="480" y1="330" x2="490" y2="330"/>
<line x1="490" y1="330" x2="500" y2="330"/>
<line x1="500" y1="330" x2="510" y2="330"/>
<line x1="510" y1="330" x2="520" y2="330"/>
<line x1="520" y1="330" x2="525" y2="330"/>
<line x1="525" y1="319" x2="525" y2="330"/>
</svg>
</div>
<p>Benefits:</p>
<ul>
<li>Incremental updates - Change one chunk, rehash one branch</li>
<li>Selective disclosure - Prove a chunk exists without revealing siblings</li>
<li>Streaming verification - Verify chunks as they arrive</li>
<li>Parallelizable - Hash chunks concurrently</li>
<li>Quantum-resistant - SHAKE256 at every node</li>
</ul>
<p>Tree structure provides logarithmic verification costs and enables partial proofs. Combined with SHAKE256, the same structure that improves efficiency also provides quantum resistance.</p>
</section>
<section>
<h2>Hash Function: SHAKE256</h2>
<p>SHAKE256 is an extendable-output function (XOF) from the SHA-3 (Keccak) family.</p>
<p>Why SHAKE256:</p>
<table>
<tr><th>Property </th><th>Value </th></tr>
<tr><td>Security level </td><td>256-bit classical, 128-bit quantum </td></tr>
<tr><td>Output length </td><td>Variable (we use 256 bits) </td></tr>
<tr><td>Construction </td><td>Sponge (different from SHA-2's Merkle-DamgÃ¥rd) </td></tr>
<tr><td>Standard </td><td>NIST FIPS 202 </td></tr>
<tr><td>Used by </td><td>SPHINCS+ (post-quantum signatures) </td></tr>
<tr><td>In libsodium </td><td>No, but in OpenSSL, libgcrypt </td></tr>
</table>
<p>Alternative: BLAKE3</p>
<table>
<tr><th>Property </th><th>Value </th></tr>
<tr><td>Security level </td><td>256-bit classical, 128-bit quantum </td></tr>
<tr><td>Output length </td><td>Variable </td></tr>
<tr><td>Construction </td><td>Merkle tree internally </td></tr>
<tr><td>Speed </td><td>Very fast, SIMD optimized </td></tr>
<tr><td>Standard </td><td>Not NIST, but widely trusted </td></tr>
</table>
<p>BLAKE3 is faster and already tree-structured, but SHAKE256 has NIST blessing. We support both.</p>
</section>
<section>
<h2>Object Format</h2>
<h3>Current (Legacy)</h3>
<pre class="language-scheme">
(object
  (hash "sha512:3a7bd3e2c4f8...")
  (size 1048576)
  (content ...))
</pre>
<h3>Quantum-Resistant</h3>
<pre class="language-scheme">
(object
  (merkle-root "shake256:7f4a2b9c...")
  (hash-algorithm "shake256")          ; or "blake3"
  (tree-params
    (chunk-size 4096)                  ; 4 KB chunks
    (fanout 16)                        ; Children per node
    (depth 4))                         ; Tree depth
  (size 1048576)
  (content ...))
</pre>
<h3>Transition Period (Dual Hash)</h3>
<pre class="language-scheme">
(object
  (hash "sha512:3a7bd3e2c4f8...")           ; Legacy - for old clients
  (merkle-root "shake256:7f4a2b9c...")      ; Quantum-resistant
  (hash-algorithm "shake256")
  (tree-params
    (chunk-size 4096)
    (fanout 16)
    (depth 4))
  (size 1048576)
  (content ...))
</pre>
<p>Old clients use hash. New clients use merkle-root. Both verify the same content.</p>
</section>
<section>
<h2>Tree Construction</h2>
<h3>Algorithm</h3>
<pre class="language-scheme">
(define (merkle-hash content algorithm chunk-size fanout)
  "Build Merkle tree, return root hash"

  ;; 1. Split content into chunks
  (let* ((chunks (chunk-content content chunk-size))

         ;; 2. Hash each chunk (leaves)
         (leaves (map (lambda (chunk)
                        (hash algorithm chunk))
                      chunks))

         ;; 3. Build tree bottom-up
         (root (build-tree leaves fanout algorithm)))

    root))

(define (build-tree nodes fanout algorithm)
  "Combine nodes into parent nodes until one root remains"
  (if (&lt;= (length nodes) 1)
      (car nodes)
      (let ((parents (map (lambda (group)
                            (hash algorithm (apply append group)))
                          (partition nodes fanout))))
        (build-tree parents fanout algorithm))))
</pre>
<h3>Node Hashing</h3>
<p>Each internal node hashes the concatenation of its children:</p>
<pre>
nodehash = shake256(child0 || child1 || ... || childn)
</pre>
<p>For leaves:</p>
<pre>
leafhash = shake256(chunkdata)
</pre>
<h3>Canonical Parameters</h3>
<table>
<tr><th>Parameter </th><th>Default </th><th>Notes </th></tr>
<tr><td>chunk-size </td><td>4096 </td><td>4 KB, filesystem-friendly </td></tr>
<tr><td>fanout </td><td>16 </td><td>Balance between depth and width </td></tr>
<tr><td>algorithm </td><td>shake256 </td><td>NIST approved </td></tr>
<tr><td>output-length </td><td>32 </td><td>256 bits </td></tr>
</table>
</section>
<section>
<h2>Proofs</h2>
<h3>Inclusion Proof</h3>
<p>Prove a chunk is part of an object without revealing other chunks:</p>
<pre class="language-scheme">
(inclusion-proof
  (merkle-root "shake256:7f4a2b9c...")
  (chunk-index 42)
  (chunk-hash "shake256:abc123...")
  (path
    ((sibling "shake256:def456..." position left)
     (sibling "shake256:789abc..." position right)
     (sibling "shake256:012def..." position left))))
</pre>
<p>Verifier reconstructs path to root:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 640 20" width="640" height="20" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">chunk_hash</text>
<text x="130" y="10">combine</text>
<text x="210" y="10">with</text>
<text x="260" y="10">sibling</text>
<text x="360" y="10">...</text>
<text x="420" y="10">must</text>
<text x="470" y="10">equal</text>
<text x="530" y="10">merkle-root</text>
</svg>
</div>
<h3>Exclusion Proof</h3>
<p>Prove a chunk does NOT exist (for sparse objects):</p>
<pre class="language-scheme">
(exclusion-proof
  (merkle-root "shake256:7f4a2b9c...")
  (chunk-index 999)
  (boundary-left 998 "shake256:left...")
  (boundary-right 1000 "shake256:right...")
  (path ...))
</pre>
</section>
<section>
<h2>Streaming Verification</h2>
<p>Large objects can be verified chunk-by-chunk as they stream:</p>
<pre class="language-scheme">
(define (verify-stream merkle-root chunk-size)
  "Return a verifier that checks chunks as they arrive"
  (let ((received-chunks '())
        (verified-nodes (make-hash-table)))

    (lambda (chunk-index chunk-data proof)
      ;; Verify this chunk against the proof
      (let ((chunk-hash (shake256 chunk-data)))
        (if (verify-inclusion-proof merkle-root chunk-index chunk-hash proof)
            (begin
              (cache-verified-node! verified-nodes chunk-index chunk-hash)
              #t)
            #f)))))
</pre>
<p>You don't need the whole object to start verifying. Each chunk carries its own proof.</p>
</section>
<section>
<h2>The Forest</h2>
<p>The soup becomes a forest of Merkle trees:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 680 240" width="680" height="240" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<line x1="5" y1="10" x2="10" y2="10"/>
<line x1="5" y1="10" x2="5" y2="21"/>
<line x1="10" y1="10" x2="20" y2="10"/>
<line x1="20" y1="10" x2="30" y2="10"/>
<line x1="30" y1="10" x2="40" y2="10"/>
<line x1="40" y1="10" x2="50" y2="10"/>
<line x1="50" y1="10" x2="60" y2="10"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<line x1="110" y1="10" x2="120" y2="10"/>
<line x1="120" y1="10" x2="130" y2="10"/>
<line x1="130" y1="10" x2="140" y2="10"/>
<line x1="140" y1="10" x2="150" y2="10"/>
<line x1="150" y1="10" x2="160" y2="10"/>
<line x1="160" y1="10" x2="170" y2="10"/>
<line x1="170" y1="10" x2="180" y2="10"/>
<line x1="180" y1="10" x2="190" y2="10"/>
<line x1="190" y1="10" x2="200" y2="10"/>
<line x1="200" y1="10" x2="210" y2="10"/>
<line x1="210" y1="10" x2="220" y2="10"/>
<line x1="220" y1="10" x2="230" y2="10"/>
<line x1="230" y1="10" x2="240" y2="10"/>
<line x1="240" y1="10" x2="250" y2="10"/>
<line x1="250" y1="10" x2="260" y2="10"/>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="390" y2="10"/>
<line x1="390" y1="10" x2="400" y2="10"/>
<line x1="400" y1="10" x2="410" y2="10"/>
<line x1="410" y1="10" x2="420" y2="10"/>
<line x1="420" y1="10" x2="430" y2="10"/>
<line x1="430" y1="10" x2="440" y2="10"/>
<line x1="440" y1="10" x2="450" y2="10"/>
<line x1="450" y1="10" x2="460" y2="10"/>
<line x1="460" y1="10" x2="470" y2="10"/>
<line x1="470" y1="10" x2="480" y2="10"/>
<line x1="480" y1="10" x2="490" y2="10"/>
<line x1="490" y1="10" x2="500" y2="10"/>
<line x1="500" y1="10" x2="510" y2="10"/>
<line x1="510" y1="10" x2="520" y2="10"/>
<line x1="520" y1="10" x2="530" y2="10"/>
<line x1="530" y1="10" x2="540" y2="10"/>
<line x1="540" y1="10" x2="550" y2="10"/>
<line x1="550" y1="10" x2="560" y2="10"/>
<line x1="560" y1="10" x2="570" y2="10"/>
<line x1="570" y1="10" x2="580" y2="10"/>
<line x1="580" y1="10" x2="590" y2="10"/>
<line x1="590" y1="10" x2="600" y2="10"/>
<line x1="600" y1="10" x2="610" y2="10"/>
<line x1="610" y1="10" x2="620" y2="10"/>
<line x1="620" y1="10" x2="630" y2="10"/>
<line x1="630" y1="10" x2="640" y2="10"/>
<line x1="640" y1="10" x2="650" y2="10"/>
<line x1="650" y1="10" x2="660" y2="10"/>
<line x1="660" y1="10" x2="665" y2="10"/>
<line x1="665" y1="10" x2="665" y2="21"/>
<line x1="5" y1="19" x2="5" y2="41"/>
<text x="210" y="30">THE</text>
<text x="250" y="30">FOREST</text>
<text x="320" y="30">(formerly</text>
<text x="420" y="30">soup)</text>
<line x1="675" y1="19" x2="675" y2="41"/>
<line x1="5" y1="39" x2="5" y2="61"/>
<line x1="675" y1="39" x2="675" y2="61"/>
<line x1="5" y1="59" x2="5" y2="81"/>
<text x="60" y="70">ðŸŒ²</text>
<text x="80" y="70">obj</text>
<text x="150" y="70">ðŸŒ²</text>
<text x="170" y="70">obj</text>
<line x1="275" y1="70" x2="280" y2="70"/>
<line x1="275" y1="70" x2="275" y2="81"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="360" y2="70"/>
<line x1="360" y1="70" x2="370" y2="70"/>
<line x1="370" y1="70" x2="380" y2="70"/>
<line x1="380" y1="70" x2="390" y2="70"/>
<line x1="390" y1="70" x2="400" y2="70"/>
<line x1="400" y1="70" x2="410" y2="70"/>
<line x1="410" y1="70" x2="420" y2="70"/>
<line x1="420" y1="70" x2="430" y2="70"/>
<line x1="430" y1="70" x2="440" y2="70"/>
<line x1="440" y1="70" x2="450" y2="70"/>
<line x1="450" y1="70" x2="455" y2="70"/>
<line x1="455" y1="70" x2="455" y2="81"/>
<text x="520" y="70">ðŸŒ²</text>
<text x="540" y="70">obj</text>
<line x1="645" y1="59" x2="645" y2="81"/>
<line x1="5" y1="79" x2="5" y2="101"/>
<text x="110" y="90">ðŸŒ²</text>
<text x="130" y="90">obj</text>
<line x1="275" y1="79" x2="275" y2="101"/>
<line x1="455" y1="79" x2="455" y2="101"/>
<text x="570" y="90">ðŸŒ²</text>
<text x="590" y="90">obj</text>
<line x1="645" y1="79" x2="645" y2="101"/>
<line x1="5" y1="99" x2="5" y2="121"/>
<text x="50" y="110">ðŸŒ²</text>
<text x="70" y="110">obj</text>
<text x="200" y="110">ðŸŒ²</text>
<text x="220" y="110">obj</text>
<line x1="265" y1="99" x2="265" y2="121"/>
<text x="320" y="110">REALM</text>
<line x1="445" y1="99" x2="445" y2="121"/>
<text x="490" y="110">ðŸŒ²</text>
<text x="510" y="110">obj</text>
<line x1="645" y1="99" x2="645" y2="121"/>
<line x1="5" y1="119" x2="5" y2="141"/>
<text x="100" y="130">ðŸŒ²</text>
<text x="120" y="130">obj</text>
<line x1="275" y1="119" x2="275" y2="141"/>
<text x="320" y="130">(island)</text>
<line x1="455" y1="119" x2="455" y2="141"/>
<text x="550" y="130">ðŸŒ²</text>
<text x="570" y="130">obj</text>
<line x1="645" y1="119" x2="645" y2="141"/>
<line x1="5" y1="139" x2="5" y2="161"/>
<text x="40" y="150">ðŸŒ²</text>
<text x="60" y="150">obj</text>
<text x="160" y="150">ðŸŒ²</text>
<text x="180" y="150">obj</text>
<line x1="265" y1="139" x2="265" y2="161"/>
<line x1="445" y1="139" x2="445" y2="161"/>
<text x="470" y="150">ðŸŒ²</text>
<text x="490" y="150">obj</text>
<line x1="645" y1="139" x2="645" y2="161"/>
<line x1="5" y1="159" x2="5" y2="181"/>
<text x="90" y="170">ðŸŒ²</text>
<text x="110" y="170">obj</text>
<line x1="275" y1="170" x2="280" y2="170"/>
<line x1="275" y1="159" x2="275" y2="170"/>
<line x1="280" y1="170" x2="290" y2="170"/>
<line x1="290" y1="170" x2="300" y2="170"/>
<line x1="300" y1="170" x2="310" y2="170"/>
<line x1="310" y1="170" x2="320" y2="170"/>
<line x1="320" y1="170" x2="330" y2="170"/>
<line x1="330" y1="170" x2="340" y2="170"/>
<line x1="340" y1="170" x2="350" y2="170"/>
<line x1="350" y1="170" x2="360" y2="170"/>
<line x1="360" y1="170" x2="370" y2="170"/>
<line x1="370" y1="170" x2="380" y2="170"/>
<line x1="380" y1="170" x2="390" y2="170"/>
<line x1="390" y1="170" x2="400" y2="170"/>
<line x1="400" y1="170" x2="410" y2="170"/>
<line x1="410" y1="170" x2="420" y2="170"/>
<line x1="420" y1="170" x2="430" y2="170"/>
<line x1="430" y1="170" x2="440" y2="170"/>
<line x1="440" y1="170" x2="450" y2="170"/>
<line x1="450" y1="170" x2="455" y2="170"/>
<line x1="455" y1="159" x2="455" y2="170"/>
<text x="530" y="170">ðŸŒ²</text>
<text x="550" y="170">obj</text>
<line x1="645" y1="159" x2="645" y2="181"/>
<line x1="5" y1="179" x2="5" y2="201"/>
<line x1="675" y1="179" x2="675" y2="201"/>
<line x1="5" y1="199" x2="5" y2="221"/>
<text x="40" y="210">Each</text>
<text x="90" y="210">object</text>
<text x="160" y="210">a</text>
<text x="180" y="210">tree.</text>
<text x="240" y="210">Each</text>
<text x="290" y="210">tree</text>
<text x="340" y="210">quantum-hardened.</text>
<line x1="665" y1="199" x2="665" y2="221"/>
<line x1="5" y1="230" x2="10" y2="230"/>
<line x1="5" y1="219" x2="5" y2="230"/>
<line x1="10" y1="230" x2="20" y2="230"/>
<line x1="20" y1="230" x2="30" y2="230"/>
<line x1="30" y1="230" x2="40" y2="230"/>
<line x1="40" y1="230" x2="50" y2="230"/>
<line x1="50" y1="230" x2="60" y2="230"/>
<line x1="60" y1="230" x2="70" y2="230"/>
<line x1="70" y1="230" x2="80" y2="230"/>
<line x1="80" y1="230" x2="90" y2="230"/>
<line x1="90" y1="230" x2="100" y2="230"/>
<line x1="100" y1="230" x2="110" y2="230"/>
<line x1="110" y1="230" x2="120" y2="230"/>
<line x1="120" y1="230" x2="130" y2="230"/>
<line x1="130" y1="230" x2="140" y2="230"/>
<line x1="140" y1="230" x2="150" y2="230"/>
<line x1="150" y1="230" x2="160" y2="230"/>
<line x1="160" y1="230" x2="170" y2="230"/>
<line x1="170" y1="230" x2="180" y2="230"/>
<line x1="180" y1="230" x2="190" y2="230"/>
<line x1="190" y1="230" x2="200" y2="230"/>
<line x1="200" y1="230" x2="210" y2="230"/>
<line x1="210" y1="230" x2="220" y2="230"/>
<line x1="220" y1="230" x2="230" y2="230"/>
<line x1="230" y1="230" x2="240" y2="230"/>
<line x1="240" y1="230" x2="250" y2="230"/>
<line x1="250" y1="230" x2="260" y2="230"/>
<line x1="260" y1="230" x2="270" y2="230"/>
<line x1="270" y1="230" x2="280" y2="230"/>
<line x1="280" y1="230" x2="290" y2="230"/>
<line x1="290" y1="230" x2="300" y2="230"/>
<line x1="300" y1="230" x2="310" y2="230"/>
<line x1="310" y1="230" x2="320" y2="230"/>
<line x1="320" y1="230" x2="330" y2="230"/>
<line x1="330" y1="230" x2="340" y2="230"/>
<line x1="340" y1="230" x2="350" y2="230"/>
<line x1="350" y1="230" x2="360" y2="230"/>
<line x1="360" y1="230" x2="370" y2="230"/>
<line x1="370" y1="230" x2="380" y2="230"/>
<line x1="380" y1="230" x2="390" y2="230"/>
<line x1="390" y1="230" x2="400" y2="230"/>
<line x1="400" y1="230" x2="410" y2="230"/>
<line x1="410" y1="230" x2="420" y2="230"/>
<line x1="420" y1="230" x2="430" y2="230"/>
<line x1="430" y1="230" x2="440" y2="230"/>
<line x1="440" y1="230" x2="450" y2="230"/>
<line x1="450" y1="230" x2="460" y2="230"/>
<line x1="460" y1="230" x2="470" y2="230"/>
<line x1="470" y1="230" x2="480" y2="230"/>
<line x1="480" y1="230" x2="490" y2="230"/>
<line x1="490" y1="230" x2="500" y2="230"/>
<line x1="500" y1="230" x2="510" y2="230"/>
<line x1="510" y1="230" x2="520" y2="230"/>
<line x1="520" y1="230" x2="530" y2="230"/>
<line x1="530" y1="230" x2="540" y2="230"/>
<line x1="540" y1="230" x2="550" y2="230"/>
<line x1="550" y1="230" x2="560" y2="230"/>
<line x1="560" y1="230" x2="570" y2="230"/>
<line x1="570" y1="230" x2="580" y2="230"/>
<line x1="580" y1="230" x2="590" y2="230"/>
<line x1="590" y1="230" x2="600" y2="230"/>
<line x1="600" y1="230" x2="610" y2="230"/>
<line x1="610" y1="230" x2="620" y2="230"/>
<line x1="620" y1="230" x2="630" y2="230"/>
<line x1="630" y1="230" x2="640" y2="230"/>
<line x1="640" y1="230" x2="650" y2="230"/>
<line x1="650" y1="230" x2="660" y2="230"/>
<line x1="660" y1="230" x2="665" y2="230"/>
<line x1="665" y1="219" x2="665" y2="230"/>
</svg>
</div>
<p>Objects are trees. The wilderness of mirrors becomes a forest. Agents navigate between trees, climbing branches, verifying paths. The capability chain is still their thread - but now the mirrors are structured.</p>
</section>
<section>
<h2>Migration</h2>
<h3>Phase 1: Dual Hash (Now â†’ Q-Day - 5 years)</h3>
<p>All new objects get both hashes. Old objects rehashed on access.</p>
<pre class="language-scheme">
(define (store-object content)
  (let ((legacy-hash (sha512 content))
        (merkle-root (merkle-hash content 'shake256 4096 16)))
    (vault-store
      `(object
        (hash ,(string-append "sha512:" legacy-hash))
        (merkle-root ,(string-append "shake256:" merkle-root))
        ...))))
</pre>
<h3>Phase 2: Merkle Primary (Q-Day - 5 years â†’ Q-Day)</h3>
<p>Merkle root becomes the canonical address. SHA-512 kept for compatibility.</p>
<h3>Phase 3: Legacy Sunset (Q-Day â†’ Q-Day + 2 years)</h3>
<p>SHA-512 hashes deprecated. Only Merkle roots used for addressing.</p>
<h3>Phase 4: Pure Quantum-Resistant (Q-Day + 2 years â†’)</h3>
<p>SHA-512 hashes removed from new objects. Legacy objects retain both for historical verification.</p>
</section>
<section>
<h2>Performance</h2>
<table>
<tr><th>Operation </th><th>SHA-512 (flat) </th><th>SHAKE256 (Merkle) </th><th>Notes </th></tr>
<tr><td>Hash 1 MB </td><td>2 ms </td><td>3 ms </td><td>Slightly slower </td></tr>
<tr><td>Hash 1 GB </td><td>2000 ms </td><td>2500 ms </td><td>Tree overhead </td></tr>
<tr><td>Update 4 KB in 1 GB </td><td>2000 ms </td><td>15 ms </td><td>Merkle wins </td></tr>
<tr><td>Prove inclusion </td><td>N/A </td><td>0.1 ms </td><td>New capability </td></tr>
<tr><td>Streaming verify </td><td>N/A </td><td>Per-chunk </td><td>New capability </td></tr>
</table>
<p>The overhead is small. The benefits are large.</p>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Grover's Algorithm</h3>
<p>Grover's algorithm provides quadratic speedup for searching: - SHA-512: 2^256 â†’ 2^128 quantum operations - SHAKE256-256: 2^256 â†’ 2^128 quantum operations</p>
<p>128-bit quantum security is considered sufficient for the foreseeable future.</p>
<h3>Second Preimage Resistance</h3>
<p>Finding another input that hashes to the same tree requires: - Classical: 2^256 operations - Quantum: 2^128 operations (Grover)</p>
<h3>Tree Structure Attacks</h3>
<p>The Merkle tree structure must prevent: - Length extension: SHAKE256 immune (sponge construction) - Subtree collision: Domain separation in node hashing - Malleability: Canonical serialization required</p>
<h3>Implementation</h3>
<pre class="language-scheme">
;; Domain separation for nodes vs leaves
(define (hash-leaf algorithm chunk)
  (hash algorithm (bytevector-append #u8(0) chunk)))

(define (hash-node algorithm children)
  (hash algorithm (bytevector-append #u8(1) (apply bytevector-append children))))
</pre>
<p>The 0x00 prefix for leaves and 0x01 for nodes prevents a leaf from being interpreted as a node.</p>
</section>
<section>
<h2>Invariants</h2>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 620 200" width="620" height="200" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">M1.</text>
<text x="40" y="10">Object</text>
<text x="110" y="10">identity</text>
<text x="200" y="10">is</text>
<text x="230" y="10">Merkle</text>
<text x="300" y="10">root</text>
<text x="40" y="30">id(o)</text>
<text x="100" y="30">=</text>
<text x="120" y="30">merkle-root(shake256,</text>
<text x="340" y="30">chunks(o))</text>
<text x="0" y="50">M2.</text>
<text x="40" y="50">Any</text>
<text x="80" y="50">chunk</text>
<text x="140" y="50">is</text>
<text x="170" y="50">provable</text>
<text x="40" y="70">chunk(o,i)</text>
<text x="170" y="70">âˆƒproof:</text>
<text x="250" y="70">verify(root(o),</text>
<text x="410" y="70">i,</text>
<text x="440" y="70">chunk,</text>
<text x="510" y="70">proof)</text>
<text x="0" y="90">M3.</text>
<text x="40" y="90">Tree</text>
<text x="90" y="90">structure</text>
<text x="190" y="90">is</text>
<text x="220" y="90">canonical</text>
<text x="40" y="110">tree(content,</text>
<text x="180" y="110">params)</text>
<text x="260" y="110">is</text>
<text x="290" y="110">deterministic</text>
<text x="0" y="130">M4.</text>
<text x="40" y="130">Dual</text>
<text x="90" y="130">hashes</text>
<text x="160" y="130">are</text>
<text x="200" y="130">consistent</text>
<text x="40" y="150">sha512(content)</text>
<text x="200" y="150">â†”</text>
<text x="220" y="150">merkle-root(content)</text>
<text x="430" y="150">verify</text>
<text x="500" y="150">same</text>
<text x="550" y="150">content</text>
<text x="0" y="170">M5.</text>
<text x="40" y="170">Migration</text>
<text x="140" y="170">preserves</text>
<text x="240" y="170">identity</text>
<text x="40" y="190">old-objects</text>
<text x="160" y="190">retain</text>
<text x="230" y="190">verifiable</text>
<text x="340" y="190">legacy</text>
<text x="410" y="190">hashes</text>
</svg>
</div>
</section>
<section>
<h2>References</h2>
<ul>
<li>NIST FIPS 202 - SHA-3 Standard (SHAKE256)</li>
<li>BLAKE3 specification - https://github.com/BLAKE3-team/BLAKE3</li>
<li>Merkle, R., "A Digital Signature Based on a Conventional Encryption Function", 1987</li>
<li>Grover, L., "A Fast Quantum Mechanical Algorithm for Database Search", 1996</li>
<li>Memo-040 - Cyberspace Security Architecture</li>
</ul>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-08</li>
<li>Initial draft</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
