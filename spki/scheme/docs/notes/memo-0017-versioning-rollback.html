<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0017: Versioning and Rollback</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0017: Versioning and Rollback</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies user-visible versioning and rollback semantics for Cyberspace vaults, providing clear mental models for version management, safe rollback operations, and recovery from mistakes.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Users need simple answers to simple questions:</p>
<ul>
<li>What version am I on?</li>
<li>What versions exist?</li>
<li>How do I go back?</li>
<li>What if I make a mistake?</li>
</ul>
<p>These questions are universal but git answers them with mechanisms rather than semantics, requiring users to understand implementation details.</p>
<p>Git provides mechanisms. Cyberspace provides semantics:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 510 80" width="510" height="80" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">seal-version</text>
<text x="230" y="10">"2.1.0"</text>
<text x="0" y="30">seal-versions</text>
<text x="230" y="30">[1.0.0,</text>
<text x="310" y="30">1.1.0,</text>
<text x="380" y="30">2.0.0,</text>
<text x="450" y="30">2.1.0]</text>
<text x="0" y="50">seal-rollback</text>
<text x="140" y="50">2.0.0</text>
<text x="230" y="50">Done.</text>
<text x="290" y="50">Now</text>
<text x="330" y="50">at</text>
<text x="360" y="50">2.0.0.</text>
<text x="0" y="70">seal-recover</text>
<text x="230" y="70">Here's</text>
<text x="300" y="70">what</text>
<text x="350" y="70">you</text>
<text x="390" y="70">can</text>
<text x="430" y="70">recover.</text>
</svg>
</div>
</section>
<section>
<h2>Specification</h2>
<h3>Version Model</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 500 140" width="500" height="140" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="250" y="10">HEAD</text>
<text x="40" y="50">1.0.0</text>
<line x1="100" y1="50" x2="110" y2="50"/>
<line x1="110" y1="50" x2="120" y2="50"/>
<text x="140" y="50">1.1.0</text>
<line x1="200" y1="50" x2="210" y2="50"/>
<line x1="210" y1="50" x2="220" y2="50"/>
<text x="240" y="50">2.0.0</text>
<line x1="300" y1="50" x2="310" y2="50"/>
<line x1="310" y1="50" x2="320" y2="50"/>
<text x="340" y="50">2.1.0</text>
<line x1="65" y1="59" x2="65" y2="81"/>
<line x1="265" y1="59" x2="265" y2="81"/>
<line x1="65" y1="79" x2="65" y2="101"/>
<line x1="265" y1="90" x2="270" y2="90"/>
<line x1="265" y1="79" x2="265" y2="90"/>
<line x1="270" y1="90" x2="280" y2="90"/>
<line x1="280" y1="90" x2="290" y2="90"/>
<text x="300" y="90">seal-rollback</text>
<text x="440" y="90">target</text>
<line x1="265" y1="99" x2="265" y2="121"/>
<line x1="65" y1="130" x2="70" y2="130"/>
<line x1="65" y1="119" x2="65" y2="130"/>
<line x1="70" y1="130" x2="80" y2="130"/>
<line x1="80" y1="130" x2="90" y2="130"/>
<text x="100" y="130">seal-archive</text>
<text x="230" y="130">snapshots</text>
</svg>
</div>
<p>Versions are semantic (X.Y.Z), immutable, signed.</p>
<p>HEAD is current working state.</p>
<p>Rollback creates forward commit that restores past state.</p>
<h3>Core Operations</h3>
<p>#### seal-version</p>
<p>Report current version.</p>
<pre class="language-scheme">
(seal-version)
;; =&gt; "2.1.0" or "2.1.0+3" (3 commits past release)
</pre>
<p>Output format: - X.Y.Z - Exactly at release - X.Y.Z+N - N commits past release - X.Y.Z-dev - Development branch - unversioned - No releases yet</p>
<p>#### seal-versions</p>
<p>List all versions.</p>
<pre class="language-scheme">
(seal-versions)
;; =&gt; ("1.0.0" "1.1.0" "2.0.0" "2.1.0")

(seal-versions verbose: #t)
;; =&gt;
;; 1.0.0  2026-01-01  "Initial release"
;; 1.1.0  2026-01-05  "Bug fixes"
;; 2.0.0  2026-01-10  "New governance model"
;; 2.1.0  2026-01-15  "Performance improvements"
</pre>
<p>#### seal-rollback</p>
<p>Roll back to specific version.</p>
<pre class="language-scheme">
(seal-rollback "2.0.0")
</pre>
<p>Process:</p>
<ul>
<li>Verify version exists</li>
<li>Check for uncommitted changes (abort or stash)</li>
<li>Create rollback commit with contents of target version</li>
<li>Record in audit trail</li>
<li>Optionally create rollback tag</li>
</ul>
<p>Rollback commit message:</p>
<pre>
Rollback to 2.0.0

Restored vault state to version 2.0.0.
Previous HEAD was 2.1.0+3.

Reason: [user-provided or "Manual rollback"]
</pre>
<p>NOT a git reset. History preserved. Rollback is a forward operation.</p>
<p>#### seal-diff</p>
<p>Compare versions.</p>
<pre class="language-scheme">
(seal-diff "2.0.0" "2.1.0")
;; Shows what changed between versions

(seal-diff "2.0.0")
;; Shows what changed since 2.0.0
</pre>
<p>#### seal-recover</p>
<p>Recovery options for mistakes.</p>
<pre class="language-scheme">
(seal-recover)
;; =&gt;
;; Recovery options:
;;   1. Uncommitted changes (stashed 5 minutes ago)
;;   2. Last commit (seal-undo)
;;   3. Version 2.1.0 (seal-rollback "2.1.0")
;;   4. Archive vault-2.0.0.archive (seal-restore)
</pre>
</section>
<section>
<h2>Rollback Semantics</h2>
<h3>Forward Rollback (Default)</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 580 140" width="580" height="140" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">Before:</text>
<text x="90" y="10">1.0.0</text>
<text x="170" y="10">1.1.0</text>
<text x="250" y="10">2.0.0</text>
<text x="330" y="10">2.1.0</text>
<text x="410" y="10">HEAD</text>
<text x="210" y="50">rollback</text>
<text x="300" y="50">target</text>
<text x="0" y="70">After:</text>
<text x="90" y="70">1.0.0</text>
<text x="170" y="70">1.1.0</text>
<text x="250" y="70">2.0.0</text>
<text x="330" y="70">2.1.0</text>
<text x="410" y="70">[rollback</text>
<text x="510" y="70">commit]</text>
<line x1="265" y1="79" x2="265" y2="101"/>
<line x1="495" y1="79" x2="495" y2="101"/>
<line x1="265" y1="110" x2="270" y2="110"/>
<line x1="265" y1="99" x2="265" y2="110"/>
<line x1="270" y1="110" x2="280" y2="110"/>
<line x1="280" y1="110" x2="290" y2="110"/>
<line x1="290" y1="110" x2="300" y2="110"/>
<line x1="300" y1="110" x2="310" y2="110"/>
<line x1="310" y1="110" x2="320" y2="110"/>
<line x1="320" y1="110" x2="330" y2="110"/>
<line x1="330" y1="110" x2="340" y2="110"/>
<line x1="340" y1="110" x2="350" y2="110"/>
<line x1="350" y1="110" x2="360" y2="110"/>
<line x1="360" y1="110" x2="370" y2="110"/>
<line x1="370" y1="110" x2="380" y2="110"/>
<line x1="380" y1="110" x2="390" y2="110"/>
<line x1="390" y1="110" x2="400" y2="110"/>
<line x1="400" y1="110" x2="410" y2="110"/>
<line x1="410" y1="110" x2="420" y2="110"/>
<line x1="420" y1="110" x2="430" y2="110"/>
<line x1="430" y1="110" x2="440" y2="110"/>
<line x1="440" y1="110" x2="450" y2="110"/>
<line x1="450" y1="110" x2="460" y2="110"/>
<line x1="460" y1="110" x2="470" y2="110"/>
<line x1="470" y1="110" x2="480" y2="110"/>
<line x1="480" y1="110" x2="490" y2="110"/>
<line x1="490" y1="110" x2="495" y2="110"/>
<line x1="495" y1="99" x2="495" y2="110"/>
<text x="300" y="130">contents</text>
<text x="390" y="130">match</text>
</svg>
</div>
<p>History preserved. Audit trail shows rollback.</p>
<h3>Hard Rollback (Dangerous)</h3>
<pre class="language-scheme">
(seal-rollback "2.0.0" hard: #t)
</pre>
<p>Actually resets to version. Destroys history.</p>
<p>Requires: - Explicit hard: #t flag - Confirmation prompt - Audit entry before destruction</p>
<h3>Rollback with Stash</h3>
<pre class="language-scheme">
(seal-rollback "2.0.0" stash: #t)
</pre>
<p>Stashes uncommitted changes before rollback. Can recover with:</p>
<pre class="language-scheme">
(seal-stash-pop)
</pre>
</section>
<section>
<h2>Version Tags</h2>
<h3>Automatic Tagging</h3>
<pre class="language-scheme">
(seal-release "2.1.0")
;; Creates:
;;   - Git tag: 2.1.0
;;   - Signature: .vault/releases/2.1.0.sig
;;   - Audit entry
</pre>
<h3>Rollback Tags</h3>
<pre class="language-scheme">
(seal-rollback "2.0.0" tag: "rollback-2026-01-15")
;; Creates additional tag marking rollback point
</pre>
<h3>Tag Listing</h3>
<pre class="language-scheme">
(seal-tags)
;; =&gt;
;; 1.0.0              2026-01-01  release
;; 1.1.0              2026-01-05  release
;; 2.0.0              2026-01-10  release
;; 2.1.0              2026-01-15  release
;; rollback-2026-01-15 2026-01-15  rollback
</pre>
</section>
<section>
<h2>Recovery Scenarios</h2>
<h3>Scenario 1: Bad Commit</h3>
<pre class="language-scheme">
;; Oops, committed broken code
(seal-undo)                    ; Undo last commit
;; or
(seal-rollback "2.1.0")        ; Back to last release
</pre>
<h3>Scenario 2: Bad Release</h3>
<pre class="language-scheme">
;; Released 2.2.0 but it's broken
(seal-rollback "2.1.0")        ; Back to good version
(seal-release "2.2.1")         ; Patch release
</pre>
<h3>Scenario 3: Lost Changes</h3>
<pre class="language-scheme">
;; Accidentally discarded work
(seal-recover)                 ; See options
(seal-stash-pop)               ; If stashed
;; or
(seal-reflog)                  ; Find lost commits
</pre>
<h3>Scenario 4: Corrupted Vault</h3>
<pre class="language-scheme">
;; Something went very wrong
(seal-restore "vault-2.0.0.archive" verify-key: "alice.pub")
</pre>
</section>
<section>
<h2>Audit Integration</h2>
<p>Every version operation recorded:</p>
<pre class="language-scheme">
(audit-entry
  (action
    (verb seal-rollback)
    (object "2.0.0")
    (parameters
      (from "2.1.0+3")
      (method forward)
      (reason "Production incident")))
  (seal ...))
</pre>
<p>Audit trail answers: - Who rolled back? - When? - From what version? - Why? (if reason provided)</p>
</section>
<section>
<h2>CLI Interface</h2>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 570 520" width="570" height="520" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">#</text>
<text x="20" y="10">Current</text>
<text x="100" y="10">version</text>
<text x="0" y="30">$</text>
<text x="20" y="30">seal</text>
<text x="70" y="30">version</text>
<text x="0" y="50">2.1.0+3</text>
<text x="0" y="70">#</text>
<text x="20" y="70">List</text>
<text x="70" y="70">versions</text>
<text x="0" y="90">$</text>
<text x="20" y="90">seal</text>
<text x="70" y="90">versions</text>
<text x="0" y="110">1.0.0</text>
<text x="80" y="110">2026-01-01</text>
<text x="210" y="110">Initial</text>
<text x="290" y="110">release</text>
<text x="0" y="130">1.1.0</text>
<text x="80" y="130">2026-01-05</text>
<text x="210" y="130">Bug</text>
<text x="250" y="130">fixes</text>
<text x="0" y="150">2.0.0</text>
<text x="80" y="150">2026-01-10</text>
<text x="210" y="150">New</text>
<text x="250" y="150">governance</text>
<text x="360" y="150">model</text>
<text x="0" y="170">2.1.0</text>
<text x="80" y="170">2026-01-15</text>
<text x="210" y="170">Performance</text>
<text x="330" y="170">improvements</text>
<text x="0" y="190">#</text>
<text x="20" y="190">Rollback</text>
<text x="0" y="210">$</text>
<text x="20" y="210">seal</text>
<text x="70" y="210">rollback</text>
<text x="160" y="210">2.0.0</text>
<text x="0" y="230">Rolling</text>
<text x="80" y="230">back</text>
<text x="130" y="230">to</text>
<text x="160" y="230">2.0.0...</text>
<text x="0" y="250">✓</text>
<text x="20" y="250">Rollback</text>
<text x="110" y="250">complete.</text>
<text x="210" y="250">Now</text>
<text x="250" y="250">at</text>
<text x="280" y="250">2.0.0.</text>
<text x="0" y="270">#</text>
<text x="20" y="270">Rollback</text>
<text x="110" y="270">with</text>
<text x="160" y="270">reason</text>
<text x="0" y="290">$</text>
<text x="20" y="290">seal</text>
<text x="70" y="290">rollback</text>
<text x="160" y="290">2.0.0</text>
<text x="220" y="290">--reason</text>
<text x="310" y="290">"Production</text>
<text x="430" y="290">incident</text>
<text x="520" y="290">#123"</text>
<text x="0" y="310">#</text>
<text x="20" y="310">Compare</text>
<text x="100" y="310">versions</text>
<text x="0" y="330">$</text>
<text x="20" y="330">seal</text>
<text x="70" y="330">diff</text>
<text x="120" y="330">2.0.0</text>
<text x="180" y="330">2.1.0</text>
<text x="10" y="350">M</text>
<text x="30" y="350">config.scm</text>
<text x="10" y="370">A</text>
<text x="30" y="370">new-feature.scm</text>
<text x="10" y="390">D</text>
<text x="30" y="390">deprecated.scm</text>
<text x="0" y="410">#</text>
<text x="20" y="410">Recovery</text>
<text x="110" y="410">options</text>
<text x="0" y="430">$</text>
<text x="20" y="430">seal</text>
<text x="70" y="430">recover</text>
<text x="0" y="450">Recovery</text>
<text x="90" y="450">options:</text>
<text x="20" y="470">1.</text>
<text x="50" y="470">seal</text>
<text x="100" y="470">undo</text>
<text x="240" y="470">-</text>
<text x="260" y="470">Undo</text>
<text x="310" y="470">last</text>
<text x="360" y="470">commit</text>
<text x="20" y="490">2.</text>
<text x="50" y="490">seal</text>
<text x="100" y="490">rollback</text>
<text x="190" y="490">2.1.0</text>
<text x="250" y="490">-</text>
<text x="270" y="490">Return</text>
<text x="340" y="490">to</text>
<text x="370" y="490">last</text>
<text x="420" y="490">release</text>
<text x="20" y="510">3.</text>
<text x="50" y="510">seal</text>
<text x="100" y="510">stash</text>
<text x="160" y="510">pop</text>
<text x="240" y="510">-</text>
<text x="260" y="510">Recover</text>
<text x="340" y="510">stashed</text>
<text x="420" y="510">changes</text>
</svg>
</div>
</section>
<section>
<h2>Safety Mechanisms</h2>
<h3>Uncommitted Changes</h3>
<pre class="language-scheme">
(seal-rollback "2.0.0")
;; Error: Uncommitted changes detected.
;; Use --stash to save changes, or --force to discard.
</pre>
<h3>Protected Versions</h3>
<pre class="language-scheme">
(vault-config 'protected-versions '("1.0.0" "2.0.0"))

(seal-rollback "0.9.0")
;; Warning: Rolling back past protected version 1.0.0
;; This may break compatibility. Continue? [y/N]
</pre>
<h3>Rollback Limits</h3>
<pre class="language-scheme">
(vault-config 'max-rollback-distance 10)

(seal-rollback "0.1.0")
;; Error: Rollback distance (20 versions) exceeds limit (10).
;; Use --force to override.
</pre>
</section>
<section>
<h2>Implementation</h2>
<h3>seal-rollback Implementation</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 810 700" width="810" height="700" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">(define</text>
<text x="80" y="10">(seal-rollback</text>
<text x="230" y="10">version</text>
<text x="310" y="10">#!key</text>
<text x="370" y="10">hard</text>
<text x="420" y="10">stash</text>
<text x="480" y="10">force</text>
<text x="540" y="10">reason</text>
<text x="610" y="10">tag)</text>
<text x="20" y="30">"Roll</text>
<text x="80" y="30">back</text>
<text x="130" y="30">vault</text>
<text x="190" y="30">to</text>
<text x="220" y="30">specified</text>
<text x="320" y="30">version"</text>
<text x="20" y="50">;;</text>
<text x="50" y="50">Validate</text>
<text x="140" y="50">version</text>
<text x="220" y="50">exists</text>
<text x="20" y="70">(unless</text>
<text x="100" y="70">(tag-exists?</text>
<text x="230" y="70">version)</text>
<text x="40" y="90">(error</text>
<text x="110" y="90">"Version</text>
<text x="200" y="90">not</text>
<text x="240" y="90">found"</text>
<text x="310" y="90">version))</text>
<text x="20" y="110">;;</text>
<text x="50" y="110">Check</text>
<text x="110" y="110">for</text>
<text x="150" y="110">uncommitted</text>
<text x="270" y="110">changes</text>
<text x="20" y="130">(when</text>
<text x="80" y="130">(uncommitted-changes?)</text>
<text x="40" y="150">(cond</text>
<text x="60" y="170">(stash</text>
<text x="130" y="170">(seal-stash))</text>
<text x="60" y="190">(force</text>
<text x="130" y="190">(void))</text>
<text x="60" y="210">(else</text>
<text x="120" y="210">(error</text>
<text x="190" y="210">"Uncommitted</text>
<text x="320" y="210">changes.</text>
<text x="410" y="210">Use</text>
<text x="450" y="210">stash:</text>
<text x="520" y="210">or</text>
<text x="550" y="210">force:"))))</text>
<text x="20" y="230">;;</text>
<text x="50" y="230">Record</text>
<text x="120" y="230">current</text>
<text x="200" y="230">state</text>
<text x="20" y="250">(let</text>
<text x="70" y="250">((current</text>
<text x="170" y="250">(seal-version)))</text>
<text x="40" y="270">;;</text>
<text x="70" y="270">Perform</text>
<text x="150" y="270">rollback</text>
<text x="40" y="290">(if</text>
<text x="80" y="290">hard</text>
<text x="80" y="310">(hard-rollback!</text>
<text x="240" y="310">version)</text>
<text x="80" y="330">(forward-rollback!</text>
<text x="270" y="330">version</text>
<text x="350" y="330">reason))</text>
<text x="40" y="350">;;</text>
<text x="70" y="350">Create</text>
<text x="140" y="350">tag</text>
<text x="180" y="350">if</text>
<text x="210" y="350">requested</text>
<text x="40" y="370">(when</text>
<text x="100" y="370">tag</text>
<text x="60" y="390">(run-command</text>
<text x="190" y="390">"git"</text>
<text x="250" y="390">"tag"</text>
<text x="310" y="390">tag))</text>
<text x="40" y="410">;;</text>
<text x="70" y="410">Audit</text>
<text x="40" y="430">(audit-append</text>
<text x="60" y="450">actor:</text>
<text x="130" y="450">(get-vault-principal</text>
<text x="340" y="450">(vault-config</text>
<text x="480" y="450">'signing-key))</text>
<text x="60" y="470">action:</text>
<text x="140" y="470">(list</text>
<text x="200" y="470">'seal-rollback</text>
<text x="350" y="470">version)</text>
<text x="60" y="490">motivation:</text>
<text x="180" y="490">(or</text>
<text x="220" y="490">reason</text>
<text x="290" y="490">(sprintf</text>
<text x="380" y="490">"Rollback</text>
<text x="480" y="490">from</text>
<text x="530" y="490">~a</text>
<text x="560" y="490">to</text>
<text x="590" y="490">~a"</text>
<text x="630" y="490">current</text>
<text x="710" y="490">version)))</text>
<text x="40" y="510">(print</text>
<text x="110" y="510">"✓</text>
<text x="140" y="510">Rolled</text>
<text x="210" y="510">back</text>
<text x="260" y="510">to</text>
<text x="290" y="510">"</text>
<text x="310" y="510">version)))</text>
<text x="0" y="530">(define</text>
<text x="80" y="530">(forward-rollback!</text>
<text x="270" y="530">version</text>
<text x="350" y="530">reason)</text>
<text x="20" y="550">"Create</text>
<text x="100" y="550">rollback</text>
<text x="190" y="550">commit</text>
<text x="260" y="550">(preserves</text>
<text x="370" y="550">history)"</text>
<text x="20" y="570">(run-command</text>
<text x="150" y="570">"git"</text>
<text x="210" y="570">"checkout"</text>
<text x="320" y="570">version</text>
<text x="400" y="570">"--"</text>
<text x="450" y="570">".")</text>
<text x="20" y="590">(run-command</text>
<text x="150" y="590">"git"</text>
<text x="210" y="590">"commit"</text>
<text x="300" y="590">"-m"</text>
<text x="40" y="610">(sprintf</text>
<text x="130" y="610">"Rollback</text>
<text x="230" y="610">to</text>
<text x="260" y="610">~a\n\n~a"</text>
<text x="360" y="610">version</text>
<text x="440" y="610">(or</text>
<text x="480" y="610">reason</text>
<text x="550" y="610">""))))</text>
<text x="0" y="630">(define</text>
<text x="80" y="630">(hard-rollback!</text>
<text x="240" y="630">version)</text>
<text x="20" y="650">"Reset</text>
<text x="90" y="650">to</text>
<text x="120" y="650">version</text>
<text x="200" y="650">(destroys</text>
<text x="300" y="650">history)"</text>
<text x="20" y="670">(print</text>
<text x="90" y="670">"WARNING:</text>
<text x="190" y="670">Hard</text>
<text x="240" y="670">rollback</text>
<text x="330" y="670">destroys</text>
<text x="420" y="670">history")</text>
<text x="20" y="690">(run-command</text>
<text x="150" y="690">"git"</text>
<text x="210" y="690">"reset"</text>
<text x="290" y="690">"--hard"</text>
<text x="380" y="690">version))</text>
</svg>
</div>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Rollback Attacks</h3>
<p>Attacker forces rollback to vulnerable version.</p>
<p>Mitigation: - Threshold signatures for rollback (Memo-008) - Protected version list - Audit trail detection</p>
<h3>History Manipulation</h3>
<p>Hard rollback can hide evidence.</p>
<p>Mitigation: - Prefer forward rollback - Audit before hard rollback - Federation replication preserves history</p>
</section>
<section>
<h2>References</h2>
<ul>
<li>Semantic Versioning 2.0.0 (semver.org)</li>
<li>Git Reset, Checkout, and Revert (git-scm.com)</li>
<li>Memo-003: Cryptographic Audit Trail</li>
<li>Memo-006: Vault System Architecture</li>
</ul>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-06</li>
<li>Initial specification</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
