%!PS-Adobe-3.0
%%Title: memo-0046-keystore-and-attestation
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0046: Realm Keystore and Attestation) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(A realm without identity is not sovereign. This Memo defines two) show newline
(protected stores within the vault:) show newline
() show newline
(1. Keystore - where cryptographic identity lives \(Ed25519 signing keys\)) show newline
(2. Attestation Store - where proofs about the realm live \(hardware,) show newline
(software, identity claims\)) show newline
() show newline
(Together they form the inner vault - the protected core of a realm. Keys) show newline
(prove who you are. Attestations prove what you are.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Memo-040 established that capabilities flow from Ed25519 signatures.) show newline
(Every certificate, every sealed release, every audit entry requires a) show newline
(signature. But where does the signing key live?) show newline
() show newline
(Currently: ephemeral, generated per session. This is fine for testing) show newline
(but broken for production. A realm needs:) show newline
() show newline
(  * Persistent identity - the same principal across sessions) show newline
(  * Protected storage - keys encrypted at rest) show newline
(  * Recovery path - don't lose your realm to a forgotten passphrase) show newline
(  * Rotation support - keys age, compromise happens) show newline
() show newline
(The keystore solves this.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REALM CONTINUITY) show newline
(------------------------------------------------------------------------) show newline
() show newline
(A realm is not a snapshot. It accumulates.) show newline
() show newline
(Identity continuity - Your principal persists across sessions, machines,) show newline
(years. Key rotation creates a signed chain: each new key vouched for by) show newline
(the old. The chain IS your history.) show newline
() show newline
(Context accumulation - Every capability granted, every object stored,) show newline
(every federation established - these form the realm's memory. The audit) show newline
(chain records what happened. The attestation store proves what you were) show newline
(at each moment.) show newline
() show newline
(History matters - A realm that has existed for ten years, rotated keys) show newline
(three times, accumulated thousands of attestations, federated with) show newline
(hundreds of peers - this realm has weight. Trust accrues. Reputation) show newline
(emerges from the chain.) show newline
() show newline
() show newline
(    +-----------------------------------------------------------------+) show newline
(    |                        REALM TIMELINE                            |) show newline
(    +-----------------------------------------------------------------+) show newline
(    |                                                                  |) show newline
(    |  Genesis --> Key₁ --> Key₂ --> Key₃ --> ... --> Current        |) show newline
(    |     |          |        |        |                   |          |) show newline
(    |     v          v        v        v                   v          |) show newline
(    |  [att₀]    [att₁₋₁₀] [att₁₁₋₅₀] [att₅₁₋₁₀₀]    [att_n]        |) show newline
(    |                                                                  |) show newline
(    |  Context grows. History deepens. Trust accumulates.             |) show newline
(    +-----------------------------------------------------------------+) show newline
() show newline
(The inner vault preserves this continuity: - Keystore - the chain of) show newline
(identity - Attestations - the record of what you were - Audit - the log) show newline
(of what you did) show newline
() show newline
(A realm without history is newborn. A realm with history has standing.) show newline
() show newline
() show newline
(The Sealed Closure) show newline
(------------------) show newline
() show newline
(A realm is a sealed closure - it closes over its environment and that) show newline
(closure is cryptographically bound.) show newline
() show newline
() show newline
(    ;; The realm as closure) show newline
(    \(lambda \(request\)) show newline
(      ;; Closed over:) show newline
(      ;;   - genesis: the first key, the origin moment) show newline
(      ;;   - keychain: every rotation, signed by predecessor) show newline
(      ;;   - attestations: every proof of what we were) show newline
(      ;;   - audit: every action taken) show newline
(      ;;   - capabilities: every right we hold) show newline
(      ;;   - objects: every thing we store) show newline
(      ;;) show newline
(      ;; The closure is sealed:) show newline
(      ;;   - Hash-chained: tamper-evident) show newline
(      ;;   - Signed: non-repudiable) show newline
(      ;;   - Content-addressed: self-verifying) show newline
(      ;;) show newline
(      \(verify-and-respond request\)\)) show newline
() show newline
(You cannot forge a realm. You cannot inject false history. You cannot) show newline
(claim attestations you don't have. The closure is sealed at every point) show newline
(- verify any moment, the chain holds or it doesn't.) show newline
() show newline
(Import a realm? You import the entire closure - genesis to present.) show newline
() show newline
(Fork a realm? You create a new closure that references the old. The fork) show newline
(point is signed.) show newline
() show newline
(Merge realms? The histories must be compatible. Conflicts are visible.) show newline
() show newline
(The sealed closure is the unit of trust in cyberspace.) show newline
() show newline
() show newline
(Living in the Soup) show newline
(------------------) show newline
() show newline
(The sealed closure doesn't exist in a vacuum - it lives in the soup.) show newline
() show newline
(The soup is the medium. Objects float in it - content-addressed,) show newline
(immutable, queryable. The realm swims through the soup, accumulating) show newline
(objects, granting capabilities, leaving audit trails. Everything the) show newline
(realm touches becomes part of its context.) show newline
() show newline
() show newline
(    +-----------------------------------------------------------------+) show newline
(    |                          THE SOUP                                |) show newline
(    |                                                                  |) show newline
(    |     ○ obj    ○ obj       +-----------------+      ○ obj         |) show newline
(    |          ○ obj           |░░░░░░░░░░░░░░░░░|           ○ obj    |) show newline
(    |    ○ obj          ○ obj  |░░░  REALM  ░░░░░|    ○ obj           |) show newline
(    |         ○ obj            |░░░ \(island\) ░░░░|         ○ obj      |) show newline
(    |   ○ obj       ○ obj      |░░░░░░░░░░░░░░░░░|  ○ obj             |) show newline
(    |        ○ obj             +-----------------+       ○ obj        |) show newline
(    |   ○ obj    ○ obj     ○ obj           ○ obj    ○ obj             |) show newline
(    |                                                                  |) show newline
(    |   Objects float. The realm is sovereign territory.              |) show newline
(    +-----------------------------------------------------------------+) show newline
() show newline
(The realm is an island in the soup - an enclave of sovereignty, an) show newline
(instance you can address. Objects float past, currents of content flow) show newline
(through cyberspace, but the island is bounded. Its shores are defined by) show newline
(capabilities: what it can see, what it can grant, what attests to it.) show newline
() show newline
(Every realm has coordinates: its principal. ed25519:7f3a2b4c... isn't) show newline
(just an identifier - it's a place you can teleport to. Present the right) show newline
(capability, and you're there. The soup connects all islands; the) show newline
(principal is your destination.) show newline
() show newline
(Or send an agent.) show newline
() show newline
(You needn't go yourself. Delegate a capability to an agent - a) show newline
(subprocess, a daemon, a trusted emissary - and it travels on your) show newline
(behalf. The agent carries your authority \(attenuated, scoped,) show newline
(time-limited\) and acts in the soup. It visits realms, fetches objects,) show newline
(negotiates federation. When it returns, its audit trail merges with) show newline
(yours.) show newline
() show newline
() show newline
(    \(delegate-agent) show newline
(      \(parent "ed25519:your-realm..."\)) show newline
(      \(agent "ed25519:agent-key..."\)) show newline
(      \(capabilities) show newline
(        \(read "sha512:*"\)              ; Can read any object) show newline
(        \(federate "ed25519:peer..."\)\)  ; Can negotiate with this peer) show newline
(      \(valid \(not-after 1736500000\)\)   ; Expires in 24h) show newline
(      \(sandbox                          ; Constraints) show newline
(        \(no-propagate\)                  ; Cannot delegate further) show newline
(        \(audit-required\)\)\)              ; Must return audit chain) show newline
() show newline
(The agent is a sealed closure too - spawned from yours, carrying) show newline
(delegated authority, accumulating its own history. When the mission) show newline
(ends, the histories merge or the agent is revoked.) show newline
() show newline
(Lineage:) show newline
() show newline
(Go yourself - like telnet or VMS SET HOST. You're there, synchronous,) show newline
(your session on that node. Direct presence in another realm.) show newline
() show newline
(Send an agent - like General Magic's Magic Cap and Telescript.) show newline
(Autonomous travelers carrying your intent, visiting places, doing work,) show newline
(returning with results. But recast in the spirit of Newton - agents swim) show newline
(in the soup, query objects, accumulate context. The soup is their) show newline
(medium, capabilities their passport.) show newline
() show newline
(The soup is a wilderness of mirrors. Objects reference objects. Hashes) show newline
(point to hashes. Capabilities chain through delegation. Attestations) show newline
(vouch for attestations. An agent navigating the soup sees reflections) show newline
(within reflections - content-addressed identity means every object is) show newline
(its own mirror. The agent must hold the thread of its capability chain) show newline
(or be lost in infinite regress.) show newline
() show newline
(This is not a safe place. It's cyberspace.) show newline
() show newline
() show newline
(    +----------------+                    +----------------+) show newline
(    |   YOUR REALM   |                    |   PEER REALM   |) show newline
(    |                |                    |                |) show newline
(    |  +----------+  |    SET HOST /      |  +----------+  |) show newline
(    |  |   you    |━━━━━━━━━━━━━━━━━━━━━━━━>|   you    |  |) show newline
(    |  +----------+  |    telnet           |  +----------+  |) show newline
(    |                |                    |                |) show newline
(    |  +----------+  |    delegate        |  +----------+  |) show newline
(    |  |  agent   |━━━━━━━━━━━━━━━━━━━━━━━━>|  agent   |  |) show newline
(    |  +----------+  |    \(Magic Cap\)      |  +----------+  |) show newline
(    |                |                    |                |) show newline
(    +----------------+                    +----------------+) show newline
(                             ^) show newline
(                        THE SOUP) show newline
(                     \(Newton's medium\)) show newline
() show newline
(Objects have no access control - they're just content, identified by) show newline
(hash. The realm closure holds the capabilities that give meaning: "I can) show newline
(read this," "I granted that," "This attests to me.") show newline
() show newline
(The soup is shared. Islands may be near or far. Federation is building) show newline
(bridges between islands - agreeing to share objects, honor capabilities,) show newline
(witness each other's audit chains.) show newline
() show newline
() show newline
(Addressing Objects) show newline
(------------------) show newline
() show newline
(Objects in cyberspace have coordinates:) show newline
() show newline
() show newline
(    ;; Local \(this realm\)) show newline
(    "releases/1.0.3"                    ; By path) show newline
(    "sha512:abc123..."                  ; By hash) show newline
(    ;; Remote \(another realm\) - @ syntax) show newline
(    "@ed25519:7f3a2b.../releases/1.0.3"     ; Named object at realm) show newline
(    "@ed25519:7f3a2b.../sha512:abc123..."   ; Hash-addressed at realm) show newline
(    ;; With role context - @principal+role:/path) show newline
(    "@ed25519:7f3a2b...+curator:/collections/rare-books") show newline
(    "@ed25519:7f3a2b...+guardian:/vault/keys") show newline
(    "@ed25519:7f3a2b...+witness:/audit/signatures") show newline
(    ;; With explicit capabilities - @principal+{caps}:/path) show newline
(    "@ed25519:7f3a2b...+{read}:/objects/sha512:abc...") show newline
(    "@ed25519:7f3a2b...+{read,write}:/collections/working") show newline
(    "@ed25519:7f3a2b...+{read,delegate\(read\)}:/shared/docs") show newline
(    ;; Role with capability refinement) show newline
(    "@ed25519:7f3a2b...+curator{read}:/collections/rare-books"  ; curator, read only) show newline
(    ;; Inspect remote sealed object) show newline
(    \(soup-inspect "@ed25519:7f3a2b.../releases/1.0.3"\)) show newline
(    ;; Fetch requires capability) show newline
(    \(soup-fetch "@ed25519:7f3a2b.../sha512:abc123...") show newline
(      capability: my-read-cert\)) show newline
(    ;; Fetch with role context) show newline
(    \(soup-fetch "@ed25519:7f3a2b...+curator:/collections/rare-books") show newline
(      capability: my-curator-cert\)) show newline
() show newline
(The @principal:/path syntax reads: "at this realm, this object." The) show newline
(principal is your teleport destination. The path or hash is what you're) show newline
(looking for.) show newline
() show newline
(The @principal+role:/path syntax adds role context: "at this realm,) show newline
(acting as this role, this object.") show newline
() show newline
(The @principal+{caps}:/path syntax specifies explicit capabilities: "at) show newline
(this realm, with these specific capabilities, this object." Roles are) show newline
(shorthand for capability bundles; the +{caps} form is the truth) show newline
(underneath.) show newline
() show newline
(+role{caps} combines both: use this role, but only these capabilities) show newline
(from it. Principle of least authority - request only what you need.) show newline
() show newline
(Without a capability granting access, you can see the object exists \(if) show newline
(the realm publishes its bloom filter\) but cannot fetch its contents. The) show newline
(wilderness of mirrors shows reflections - but you need the right key to) show newline
(step through.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(ARCHITECTURE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(The Inner Vault) show newline
(---------------) show newline
() show newline
() show newline
(    .vault/) show newline
(    +-- keystore/                    # Identity store) show newline
(    |   +-- realm.key               # Encrypted private key) show newline
(    |   +-- realm.pub               # Public key \(this is your principal\)) show newline
(    |   +-- keystore.meta           # Metadata, parameters) show newline
(    |   +-- recovery/               # Optional threshold shares) show newline
(    |       +-- share.1.key) show newline
(    |       +-- share.2.key) show newline
(    +-- attestations/                # Proof store) show newline
(    |   +-- hardware/               # Hardware attestations) show newline
(    |   |   +-- anchor-quote.att       # Anchor measurement) show newline
(    |   |   +-- secure-enclave.att  # Apple SE attestation) show newline
(    |   +-- software/               # Software attestations) show newline
(    |   |   +-- boot-hash.att       # Measured boot) show newline
(    |   |   +-- runtime-hash.att    # Runtime measurements) show newline
(    |   +-- identity/               # Third-party vouches) show newline
(    |   |   +-- ca-cert.att         # External CA attestation) show newline
(    |   +-- attestations.meta       # Attestation catalog) show newline
(    +-- releases/) show newline
(    +-- objects/) show newline
(    +-- capabilities/) show newline
(    +-- audit/) show newline
(    +-- node-hardware) show newline
() show newline
() show newline
(Key Files) show newline
(---------) show newline
() show newline
(realm.pub - Your public identity, shareable:) show newline
() show newline
() show newline
(    \(realm-public-key) show newline
(      \(version 1\)) show newline
(      \(created 1736400000\)) show newline
(      \(algorithm "ed25519"\)) show newline
(      \(public-key #${7f3a2b4c...}\)\)) show newline
() show newline
(realm.key - Your private key, encrypted:) show newline
() show newline
() show newline
(    \(realm-private-key) show newline
(      \(version 1\)) show newline
(      \(algorithm "ed25519"\)) show newline
(      \(protection "passphrase"\)      ; or "hardware", "threshold") show newline
(      \(kdf "argon2id"\)) show newline
(      \(kdf-params) show newline
(        \(ops-limit 3\)                ; cryptopwhashOPSLIMIT_MODERATE) show newline
(        \(mem-limit 268435456\)        ; 256 MB) show newline
(        \(salt #${random-32-bytes}\)\)) show newline
(      \(cipher "xchacha20-poly1305"\)) show newline
(      \(nonce #${random-24-bytes}\)) show newline
(      \(ciphertext #${encrypted-private-key}\)\)) show newline
() show newline
(keystore.meta - Configuration:) show newline
() show newline
() show newline
(    \(keystore-meta) show newline
(      \(version 1\)) show newline
(      \(created 1736400000\)) show newline
(      \(last-accessed 1736450000\)) show newline
(      \(protection "passphrase"\)) show newline
(      \(backup-reminder 7776000\)      ; 90 days) show newline
(      \(rotation-reminder 31536000\)\)  ; 1 year) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CRYPTOGRAPHIC OPERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Key Derivation) show newline
(--------------) show newline
() show newline
(Passphrase > encryption key via Argon2id:) show newline
() show newline
() show newline
(    \(define \(derive-key passphrase salt\)) show newline
(      "Derive encryption key from passphrase using Argon2id") show newline
(      \(let \(\(key \(make-blob 32\)\)\)) show newline
(        \(sodium-pwhash!) show newline
(          key) show newline
(          passphrase) show newline
(          salt) show newline
(          3                          ; ops-limit \(moderate\)) show newline
(          268435456                  ; mem-limit \(256 MB\)) show newline
(          'argon2id\)) show newline
(        key\)\)) show newline
() show newline
(Why Argon2id: - Memory-hard: resists GPU/ASIC attacks - Time-hard:) show newline
(configurable iterations - Side-channel resistant: hybrid of Argon2i and) show newline
(Argon2d - Winner of Password Hashing Competition - Already in libsodium) show newline
() show newline
() show newline
(Encryption) show newline
(----------) show newline
() show newline
(Private key encrypted via XChaCha20-Poly1305:) show newline
() show newline
() show newline
(    \(define \(encrypt-private-key private-key encryption-key\)) show newline
(      "Encrypt private key for storage") show newline
(      \(let \(\(nonce \(random-bytes 24\)\)\)) show newline
(        \(values) show newline
(          nonce) show newline
(          \(sodium-secretbox private-key nonce encryption-key\)\)\)\)) show newline
(    \(define \(decrypt-private-key ciphertext nonce encryption-key\)) show newline
(      "Decrypt private key from storage") show newline
(      \(sodium-secretbox-open ciphertext nonce encryption-key\)\)) show newline
() show newline
(Why XChaCha20-Poly1305: - 256-bit key, 192-bit nonce - Extended nonce) show newline
(allows random generation \(no counter needed\) - Authenticated: tampering) show newline
(detected - Fast in software - Already in libsodium \(crypto_secretbox\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(BOOTSTRAP FLOW) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(New Realm) show newline
(---------) show newline
() show newline
() show newline
(    $ ./cyberspace-repl) show newline
(    +-----------------------------------------------------------+) show newline
(    |                    REALM BOOTSTRAP                         |) show newline
(    +-----------------------------------------------------------+) show newline
(    No realm identity found in .vault/keystore/) show newline
(    Create new realm? [y/n] y) show newline
(    Choose protection method:) show newline
(      1. Passphrase \(recommended\)) show newline
(      2. Hardware token \(requires YubiKey\)) show newline
(      3. Threshold \(k-of-n shares\)) show newline
(    Selection: 1) show newline
(    Enter passphrase: ) show newline
(    Confirm passphrase: ) show newline
(    Generating Ed25519 keypair...) show newline
(    Encrypting with Argon2id \(this takes a moment\)...) show newline
(    +-----------------------------------------------------------+) show newline
(    |  REALM CREATED                                             |) show newline
(    |                                                            |) show newline
(    |  Principal: ed25519:7f3a2b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e  |) show newline
(    |  Created:   2026-01-08 14:30:00 UTC                        |) show newline
(    |                                                            |) show newline
(    |  IMPORTANT: Your passphrase cannot be recovered.           |) show newline
(    |  Consider creating recovery shares with \(keystore-backup\)  |) show newline
(    +-----------------------------------------------------------+) show newline
(    cyberspace>) show newline
() show newline
() show newline
(Existing Realm) show newline
(--------------) show newline
() show newline
() show newline
(    $ ./cyberspace-repl) show newline
(    Realm: ed25519:7f3a2b4c...) show newline
(    Passphrase: ) show newline
(    Unlocking keystore...) show newline
(    cyberspace> ; Ready, identity loaded) show newline
() show newline
() show newline
(Failed Unlock) show newline
(-------------) show newline
() show newline
() show newline
(    Passphrase: ) show newline
(    ERROR: Decryption failed \(wrong passphrase?\)) show newline
(    Attempts remaining: 2) show newline
(    Passphrase: ) show newline
(    ERROR: Decryption failed) show newline
(    Attempts remaining: 1) show newline
(    WARNING: One attempt remaining. Consider:) show newline
(      - Recovery shares if configured) show newline
(      - The passphrase is case-sensitive) show newline
(      - Check caps lock) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(RECOVERY) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Threshold Shares) show newline
(----------------) show newline
() show newline
(For high-value realms, split the key into k-of-n shares \(Memo-008\):) show newline
() show newline
() show newline
(    \(keystore-backup) show newline
(      threshold: 2                   ; k - shares needed) show newline
(      shares: 3\)                     ; n - shares created) show newline
(    ;; Output:) show newline
(    ;; Share 1 of 3 \(requires 2 to recover\):) show newline
(    ;; CYBER-SHARE-1-7f3a2b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2) show newline
(    ;;) show newline
(    ;; Share 2 of 3 \(requires 2 to recover\):) show newline
(    ;; CYBER-SHARE-2-8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8) show newline
(    ;;) show newline
(    ;; Share 3 of 3 \(requires 2 to recover\):) show newline
(    ;; CYBER-SHARE-3-9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9) show newline
(    ;;) show newline
(    ;; STORE THESE SEPARATELY. Any 2 can recover your realm.) show newline
() show newline
(Recovery:) show newline
() show newline
() show newline
(    \(keystore-recover) show newline
(      "CYBER-SHARE-1-7f3a2b4c...") show newline
(      "CYBER-SHARE-3-9b0c1d2e..."\)) show newline
(    ;; Realm recovered. Set new passphrase:) show newline
(    ;; New passphrase: ) show newline
(    ;; Confirm: ) show newline
(    ;; Keystore restored.) show newline
() show newline
() show newline
(Paper Backup) show newline
(------------) show newline
() show newline
(For the paranoid \(wisely so\):) show newline
() show newline
() show newline
(    \(keystore-paper-backup\)) show newline
(    ;; Generates QR code + text backup for offline storage) show newline
(    ;; Encrypted with passphrase, prints to terminal/file) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(KEY ROTATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Keys should rotate periodically. Old key signs new key, creating) show newline
(continuity:) show newline
() show newline
() show newline
(    \(keystore-rotate\)) show newline
(    ;; Current principal: ed25519:7f3a2b4c...) show newline
(    ;;) show newline
(    ;; This will:) show newline
(    ;;   1. Generate new Ed25519 keypair) show newline
(    ;;   2. Sign rotation certificate with old key) show newline
(    ;;   3. Store rotation chain in keystore) show newline
(    ;;   4. New principal becomes active) show newline
(    ;;) show newline
(    ;; Proceed? [y/n] y) show newline
(    ;;) show newline
(    ;; Enter current passphrase: ) show newline
(    ;; Enter new passphrase \(or same\): ) show newline
(    ;;) show newline
(    ;; Generating new keypair...) show newline
(    ;; Signing rotation certificate...) show newline
(    ;;) show newline
(    ;; ROTATION COMPLETE) show newline
(    ;; Old principal: ed25519:7f3a2b4c...) show newline
(    ;; New principal: ed25519:2c3d4e5f...) show newline
(    ;; Rotation cert: sha512:rotation-cert-hash...) show newline
(    ;;) show newline
(    ;; Old capabilities referencing ed25519:7f3a2b4c will need reissuance.) show newline
() show newline
(Rotation certificate:) show newline
() show newline
() show newline
(    \(rotation-cert) show newline
(      \(old-principal "ed25519:7f3a2b4c..."\)) show newline
(      \(new-principal "ed25519:2c3d4e5f..."\)) show newline
(      \(timestamp 1736500000\)) show newline
(      \(reason "scheduled-rotation"\)) show newline
(      \(signature "ed25519:old-key-signature..."\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(ATTESTATION STORE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Attestations are signed claims about the realm. They answer: "What can) show newline
(you prove about yourself?") show newline
() show newline
() show newline
(Attestation Types) show newline
(-----------------) show newline
() show newline
(Hardware Attestations - proofs from silicon:) show newline
() show newline
() show newline
(    \(hardware-attestation) show newline
(      \(type "anchor-quote"\)) show newline
(      \(timestamp 1736400000\)) show newline
(      \(platform "Darwin-arm64"\)) show newline
(      \(measurements) show newline
(        \(rune-boot #${boot-measurement...}\)) show newline
(        \(rune-policy #${secureboot-policy...}\)\)) show newline
(      \(signature #${anchor-signature...}\)) show newline
(      \(certificate #${endorsement-key-cert...}\)\)) show newline
() show newline
(Software Attestations - proofs from code:) show newline
() show newline
() show newline
(    \(software-attestation) show newline
(      \(type "runtime-measurement"\)) show newline
(      \(timestamp 1736400000\)) show newline
(      \(binary-hash "sha512:cyberspace-repl..."\)) show newline
(      \(library-hashes) show newline
(        \("libsodium.dylib" "sha512:..."\)) show newline
(        \("libchicken.dylib" "sha512:..."\)\)) show newline
(      \(signature #${realm-signature...}\)\)) show newline
() show newline
(Identity Attestations - third-party vouches:) show newline
() show newline
() show newline
(    \(identity-attestation) show newline
(      \(type "ca-vouch"\)) show newline
(      \(timestamp 1736400000\)) show newline
(      \(subject "ed25519:7f3a2b4c..."\)         ; This realm) show newline
(      \(issuer "ed25519:ca-public-key..."\)     ; Vouching authority) show newline
(      \(claims) show newline
(        \(organization "Acme Corp"\)) show newline
(        \(role "coordinator"\)\)) show newline
(      \(valid \(not-after 1767936000\)\)) show newline
(      \(signature #${ca-signature...}\)\)) show newline
() show newline
(Capability Attestations - proof of holding:) show newline
() show newline
() show newline
(    \(capability-attestation) show newline
(      \(type "capability-proof"\)) show newline
(      \(timestamp 1736400000\)) show newline
(      \(capability "sha512:cert-hash..."\)) show newline
(      \(holder "ed25519:7f3a2b4c..."\)) show newline
(      \(challenge #${nonce...}\)                ; Prevents replay) show newline
(      \(response #${signed-challenge...}\)\)) show newline
() show newline
() show newline
(Attestation Catalog) show newline
(-------------------) show newline
() show newline
(The attestation store maintains a catalog for fast lookup:) show newline
() show newline
() show newline
(    \(attestations-meta) show newline
(      \(version 1\)) show newline
(      \(count 5\)) show newline
(      \(types) show newline
(        \(hardware 2\)) show newline
(        \(software 1\)) show newline
(        \(identity 1\)) show newline
(        \(capability 1\)\)) show newline
(      \(latest-refresh 1736400000\)) show newline
(      \(entries) show newline
(        \(\(id "att-001"\) \(type hardware\) \(file "hardware/anchor-quote.att"\) \(expires #f\)\)) show newline
(        \(\(id "att-002"\) \(type hardware\) \(file "hardware/secure-enclave.att"\) \(expires #f\)\)) show newline
(        \(\(id "att-003"\) \(type software\) \(file "software/runtime-hash.att"\) \(expires #f\)\)) show newline
(        \(\(id "att-004"\) \(type identity\) \(file "identity/ca-cert.att"\) \(expires 1767936000\)\)) show newline
(        \(\(id "att-005"\) \(type capability\) \(file "capability/coord-role.att"\) \(expires 1736500000\)\)\)\)) show newline
() show newline
() show newline
(Attestation Operations) show newline
(----------------------) show newline
() show newline
() show newline
(    ;; Refresh hardware attestations \(re-measure\)) show newline
(    \(attestation-refresh-hardware\)) show newline
(    ;; => Querying Anchor... done.) show newline
(    ;; => Querying Secure Enclave... done.) show newline
(    ;; => 2 hardware attestations updated.) show newline
(    ;; Measure current software state) show newline
(    \(attestation-measure-software\)) show newline
(    ;; => Hashing cyberspace-repl... done.) show newline
(    ;; => Hashing loaded libraries... done.) show newline
(    ;; => Software attestation stored.) show newline
(    ;; Request identity attestation from CA) show newline
(    \(attestation-request-identity "ed25519:ca-key..."\)) show newline
(    ;; => Sending attestation request to CA...) show newline
(    ;; => \(requires CA to sign and return\)) show newline
(    ;; Prove capability holding \(for remote verification\)) show newline
(    \(attestation-prove-capability "sha512:cert-hash..." challenge\)) show newline
(    ;; => \(capability-attestation ...\)) show newline
(    ;; List all attestations) show newline
(    \(attestation-list\)) show newline
(    ;; => \(\(att-001 hardware anchor-quote valid\)) show newline
(    ;;     \(att-002 hardware secure-enclave valid\)) show newline
(    ;;     \(att-003 software runtime-hash valid\)) show newline
(    ;;     \(att-004 identity ca-cert expires:2026-12-31\)) show newline
(    ;;     \(att-005 capability coord-role expires:2026-01-10\)\)) show newline
(    ;; Verify an attestation) show newline
(    \(attestation-verify "att-001"\)) show newline
(    ;; => \(attestation att-001 \(status valid\) \(type hardware\) \(verified #t\)\)) show newline
(    ;; Export for remote verification) show newline
(    \(attestation-export "att-001"\)) show newline
(    ;; => \(hardware-attestation \(type "anchor-quote"\) ...\)) show newline
() show newline
() show newline
(Attestation Chain) show newline
(-----------------) show newline
() show newline
(Attestations can chain - a hardware attestation vouches for software,) show newline
(software vouches for capabilities:) show newline
() show newline
() show newline
(    +---------------------------+) show newline
(    |    The Anchor \(Silicon\)   |  "This boot sequence is measured") show newline
(    +-------------+-------------+) show newline
(                  | vouches for) show newline
(                  v) show newline
(    +---------------------------+) show newline
(    |    Software Runes         |  "These binaries are running") show newline
(    +-------------+-------------+) show newline
(                  | vouches for) show newline
(                  v) show newline
(    +---------------------------+) show newline
(    |    Realm Identity         |  "This is my signing key") show newline
(    +-------------+-------------+) show newline
(                  | vouches for) show newline
(                  v) show newline
(    +---------------------------+) show newline
(    |    Capabilities Held      |  "I can do these things") show newline
(    +---------------------------+) show newline
() show newline
(Remote verifier can walk the chain: "Show me your hardware attestation,) show newline
(software measurement, and the capability you claim.") show newline
() show newline
() show newline
(Use Cases) show newline
(---------) show newline
() show newline
(Coordinator Election \(Memo-037\): Candidate presents attestations proving) show newline
(hardware capability and identity. Voters verify before granting) show newline
(coordinator role.) show newline
() show newline
(Federation Trust \(Memo-039\): Realms exchange attestations when) show newline
(federating. "Before I sync objects with you, prove your software is) show newline
(legitimate.") show newline
() show newline
(High-Security Operations: Some capabilities might require fresh) show newline
(attestation: "This capability requires Anchor attestation less than 1) show newline
(hour old.") show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(HARDWARE TOKEN SUPPORT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Future: YubiKey, secure enclaves, hardware anchors.) show newline
() show newline
() show newline
(    \(keystore-meta) show newline
(      \(version 1\)) show newline
(      \(protection "hardware"\)) show newline
(      \(hardware-type "yubikey-5"\)) show newline
(      \(hardware-serial "12345678"\)) show newline
(      \(public-key #${...}\)\)          ; Private key never leaves device) show newline
() show newline
(The private key never touches disk - it lives in the hardware token.) show newline
(Operations requiring signature prompt for touch.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SECURITY CONSIDERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(What We Protect Against) show newline
(-----------------------) show newline
() show newline
() show newline
(  Threat                 Mitigation                               ) show newline
(  Disk theft             Encrypted at rest \(XChaCha20-Poly1305\)   ) show newline
(  Weak passphrase        Argon2id memory-hard KDF                 ) show newline
(  Brute force            Rate limiting, attempt counter           ) show newline
(  Memory dump            Zero memory after use                    ) show newline
(  Forgotten passphrase   Threshold recovery shares                ) show newline
(  Key compromise         Rotation support                         ) show newline
() show newline
() show newline
(What We Don't Protect Against) show newline
(-----------------------------) show newline
() show newline
() show newline
(  Threat                           Why                                      ) show newline
(  Compromised endpoint             If attacker has root, game over          ) show newline
(  Keylogger capturing passphrase   Endpoint security problem                ) show newline
(  Rubber hose cryptanalysis        Math doesn't help                        ) show newline
(  Quantum computers                Ed25519 vulnerable \(migration planned\)   ) show newline
() show newline
() show newline
(Memory Handling) show newline
(---------------) show newline
() show newline
() show newline
(    \(define \(with-sensitive-data data thunk\)) show newline
(      "Execute thunk with sensitive data, zero on exit") show newline
(      \(dynamic-wind) show newline
(        \(lambda \(\) #f\)) show newline
(        thunk) show newline
(        \(lambda \(\) \(sodium-memzero! data\)\)\)\)) show newline
() show newline
(Private keys are zeroed immediately after use. Passphrases are zeroed) show newline
(after key derivation.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REPL COMMANDS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(    ;; Check keystore status) show newline
(    \(keystore-status\)) show newline
(    ;; => \(keystore \(status unlocked\) \(principal "ed25519:7f3a..."\) \(protection passphrase\)\)) show newline
(    ;; Lock keystore \(zero keys from memory\)) show newline
(    \(keystore-lock\)) show newline
(    ;; => Keystore locked. Re-authentication required for signing.) show newline
(    ;; Unlock keystore) show newline
(    \(keystore-unlock\)) show newline
(    ;; => Passphrase: ) show newline
(    ;; => Keystore unlocked.) show newline
(    ;; Change passphrase) show newline
(    \(keystore-change-passphrase\)) show newline
(    ;; => Current passphrase: ) show newline
(    ;; => New passphrase: ) show newline
(    ;; => Confirm: ) show newline
(    ;; => Passphrase changed.) show newline
(    ;; Create recovery shares) show newline
(    \(keystore-backup threshold: 2 shares: 3\)) show newline
(    ;; Recover from shares) show newline
(    \(keystore-recover share1 share2\)) show newline
(    ;; Rotate key) show newline
(    \(keystore-rotate\)) show newline
(    ;; Export public key \(safe to share\)) show newline
(    \(keystore-export-public\)) show newline
(    ;; => \(realm-public-key \(algorithm "ed25519"\) \(public-key #${7f3a...}\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(VAULT PROTECTION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(The keystore protects itself. The operating system is not trusted.) show newline
() show newline
(realm.key - Never stored plaintext. The ciphertext blob is meaningless) show newline
(without the passphrase. Even if someone copies the file, they have) show newline
(nothing.) show newline
() show newline
(realm.pub - Public by nature. This IS your identity. Share it freely.) show newline
() show newline
(attestations/ - Signed claims. Tamper-evident by construction. Copy) show newline
(them, share them - forgery is computationally infeasible.) show newline
() show newline
(The vault doesn't rely on filesystem permissions, SELinux, or any) show newline
(operating system mechanism. Cyberspace assumes the OS is compromised.) show newline
(Protection comes from:) show newline
() show newline
(1. Encryption - Private key encrypted at rest 2. Memory zeroing - Keys) show newline
(cleared immediately after use 3. Signatures - Everything signed,) show newline
(tampering detected 4. Content addressing - Hash IS identity) show newline
() show newline
(If someone has root on your machine, they can install a keylogger -) show newline
(that's a physical security problem, not a cryptographic one. Cyberspace) show newline
(protects the math. Protect the machine yourself.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(INTEGRATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(With seal-release \(Memo-033\)) show newline
(----------------------------) show newline
() show newline
() show newline
(    \(seal-release "1.0.4" name: "phoenix"\)) show newline
(    ;; Uses keystore signing key automatically) show newline
(    ;; Prompts for unlock if keystore locked) show newline
() show newline
() show newline
(With capabilities \(Memo-004\)) show newline
(----------------------------) show newline
() show newline
() show newline
(    \(spki-cert-create) show newline
(      subject: "ed25519:bob...") show newline
(      tag: '\(read "sha512:doc..."\)\)) show newline
(    ;; Signed with keystore key) show newline
(    ;; Issuer automatically set to realm principal) show newline
() show newline
() show newline
(With audit \(Memo-040\)) show newline
(---------------------) show newline
() show newline
() show newline
(    ;; Audit entries signed with keystore key) show newline
(    ;; Principal identity consistent across sessions) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(INVARIANTS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Keystore) show newline
(--------) show newline
() show newline
() show newline
(    K1. Private key never stored plaintext) show newline
(        stored\(private-key\) > encrypted\(private-key\)) show newline
(    K2. Decryption requires authentication) show newline
(        decrypt\(keystore\) > auth\(passphrase\) ∨ auth\(hardware\) ∨ auth\(threshold\)) show newline
(    K3. Memory zeroed after use) show newline
(        use\(sensitive-data\) > zero\(sensitive-data\)) show newline
(    K4. Rotation preserves identity chain) show newline
(        rotate\(k₁,k₂\) > signed\(k₂, k₁\)) show newline
(    K5. Recovery requires threshold) show newline
(        recover\(keystore\) > shares ≥ k) show newline
() show newline
() show newline
(Attestation) show newline
(-----------) show newline
() show newline
() show newline
(    A1. Attestations are signed) show newline
(        store\(attestation\) > signed\(attestation, issuer\)) show newline
(    A2. Attestation chains are verifiable) show newline
(        chain\(a₁>a₂>...>aₙ\) > ∀i: valid_sig\(aᵢ\)) show newline
(    A3. Hardware attestations originate from anchors) show newline
(        hardware-attestation\(a\) > anchor-signed\(a\)) show newline
(    A4. Attestations are timestamped) show newline
(        attestation\(a\) > timestamp\(a\) ∧ fresh\(a, policy\)) show newline
(    A5. Expired attestations are invalid) show newline
(        expired\(a\) > ¬valid\(a\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(QUANTUM RESISTANCE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(SHA-512 won't survive. Grover's algorithm halves the security - 256 bits) show newline
(becomes 128. For the wilderness of mirrors to endure, we need) show newline
(quantum-resistant Merkle trees.) show newline
() show newline
(The Path Forward:) show newline
() show newline
() show newline
(    Current:     sha512\(content\) > object identity) show newline
(    Future:      merkle-root\(shake256\(chunks...\)\) > object identity) show newline
() show newline
(Why Merkle trees: - Incremental updates without rehashing everything -) show newline
(Selective disclosure - prove a branch without revealing siblings - Tree) show newline
(structure means log\(n\) proof sizes - Quantum-resistant hash at each node) show newline
() show newline
(Candidate hash functions:) show newline
() show newline
() show newline
(  Function    Output     Notes                                                    ) show newline
(  SHAKE256    Variable   SHA-3 family, NIST approved, used by SPHINCS+            ) show newline
(  BLAKE3      256-bit    Fast, tree-based internally, modern                      ) show newline
(  SHA-3-512   512-bit    Conservative choice, different construction than SHA-2   ) show newline
() show newline
(Migration:) show newline
() show newline
(Objects can carry both hashes during transition:) show newline
() show newline
() show newline
(    \(object) show newline
(      \(content-hash "sha512:abc123..."\)           ; Legacy) show newline
(      \(merkle-root "shake256:def456..."\)          ; Quantum-resistant) show newline
(      \(tree-depth 4\)) show newline
(      \(chunk-size 4096\)\)) show newline
() show newline
(The soup becomes a forest of Merkle trees. Each object a tree, each tree) show newline
(quantum-hardened. The wilderness of mirrors, built to outlast the) show newline
(quantum winter.) show newline
() show newline
(Ed25519 replacement: SPHINCS+ or CRYSTALS-Dilithium for signatures.) show newline
(That's a separate RFC.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(1. libsodium documentation - Password Hashing, Secret-key Encryption 2.) show newline
(Argon2 specification - https://github.com/P-H-C/phc-winner-argon2 3.) show newline
(Shamir's Secret Sharing - Shamir, A., "How to Share a Secret", 1979 4.) show newline
(Memo-008 - Threshold Governance 5. Memo-040 - Cyberspace Security) show newline
(Architecture) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * 2026-01-08) show newline
(  * Initial draft) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
