%!PS-Adobe-3.0
%%Title: memo-0057-typesetting
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0057: Typesetting) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(HTML was born without typographic discipline. Browsers render monospace) show newline
(text with variable-width box-drawing characters, destroying the careful) show newline
(geometry of ASCII diagrams. This memo specifies how Cyberspace solves) show newline
(the problem: convert character-cell art to SVG at generation time,) show newline
(preserving the author's intent in a form browsers cannot corrupt.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(THE ORIGINAL SIN) show newline
(------------------------------------------------------------------------) show newline
() show newline
(In the beginning, there was the teletype. Characters occupied fixed) show newline
(cells. Box-drawing characters \(| - + + + +\) aligned perfectly because) show newline
(geometry was enforced by hardware.) show newline
() show newline
(Then came HTML, and the browser vendors said: 'Let there be font) show newline
(substitution.' And there was chaos.) show newline
() show newline
(The problem:) show newline
() show newline
(  * Browsers substitute fonts freely, even within 'monospace') show newline
(  * Box-drawing glyphs often come from different fonts than text) show newline
(  * Different fonts have different metrics) show newline
(  * A '|' from one font may be wider than '-' from another) show newline
(  * Vertical lines no longer align across rows) show newline
() show newline
(The result: carefully composed ASCII diagrams render as visual garbage.) show newline
(Decades of terminal art, protocol diagrams, and architectural) show newline
(sketches—broken by 'progress.') show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(THE SOLUTION: COMPILE TO GEOMETRY) show newline
(------------------------------------------------------------------------) show newline
() show newline
(We solve this at the source. During memo generation, text containing) show newline
(box-drawing characters is converted to SVG—a format where geometry is) show newline
(explicit and browsers cannot reinterpret.) show newline
() show newline
() show newline
(Character Cell Model) show newline
(--------------------) show newline
() show newline
(Every character occupies a fixed cell:) show newline
() show newline
() show newline
(    \(define cell-width 10\)    ; pixels) show newline
(    \(define cell-height 20\)   ; pixels) show newline
() show newline
(Text characters are positioned at cell centers. Box-drawing characters) show newline
(become geometric primitives—lines and rectangles with exact) show newline
(coordinates.) show newline
() show newline
() show newline
(Box-Drawing Primitives) show newline
(----------------------) show newline
() show newline
(Each box-drawing codepoint maps to SVG elements:) show newline
() show newline
() show newline
(  Glyph   Codepoint   SVG Primitives                         ) show newline
(  -       U+2500      Horizontal line through cell center    ) show newline
(  |       U+2502      Vertical line through cell center      ) show newline
(  +       U+250C      Lines: center>right, center>down       ) show newline
(  +       U+2510      Lines: center>left, center>down        ) show newline
(  +       U+2514      Lines: center>right, center>up         ) show newline
(  +       U+2518      Lines: center>left, center>up          ) show newline
(  +       U+251C      Lines: up↔down, center>right         ) show newline
(  +       U+2524      Lines: up↔down, center>left          ) show newline
(  +       U+252C      Lines: left↔right, center>down       ) show newline
(  +       U+2534      Lines: left↔right, center>up         ) show newline
(  +       U+253C      Lines: full cross                      ) show newline
() show newline
(Double-line variants \(- | + + + +\) use the same geometry with doubled) show newline
(strokes.) show newline
() show newline
() show newline
(Text Grouping) show newline
(-------------) show newline
() show newline
(Consecutive text characters are grouped into single SVG text elements:) show newline
() show newline
() show newline
(    Before: <text x="5">c</text><text x="15">h</text><text x="25">a</text>...) show newline
(    After:  <text x="0">chaotic</text>) show newline
() show newline
(This reduces SVG size and ensures proper kerning within text runs.) show newline
(Spaces and box-drawing characters break the grouping.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(AUTO-ALIGNMENT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Authors make mistakes. Lines in a box diagram may differ by one) show newline
(character—an extra space, a missing padding. The renderer detects and) show newline
(corrects this automatically.) show newline
() show newline
() show newline
(The Algorithm) show newline
(-------------) show newline
() show newline
(  * Identify lines ending with box right-edges \(| + + + | + +\)) show newline
(  * Find the most common width among these lines) show newline
(  * Adjust each box-edge line to match the target width) show newline
(  * Add spaces before the edge if too short) show newline
(  * Remove trailing spaces before the edge if too long) show newline
() show newline
(This preserves author intent while correcting typographic errors. A) show newline
(64-character line among 63-character siblings gets trimmed. A) show newline
(62-character line gets padded.) show newline
() show newline
() show newline
(Why Most Common, Not Maximum) show newline
(----------------------------) show newline
() show newline
(If 14 lines are 63 characters and 1 line is 64 characters, the outlier) show newline
(is the error. Taking the maximum would pad 14 correct lines to match 1) show newline
(broken one. Taking the mode identifies the intended width.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(IMPLEMENTATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(The typesetting pipeline lives in memo-format.scm:) show newline
() show newline
() show newline
(    ;; Core functions) show newline
(    \(utf8-chars str\)           ; Extract Unicode codepoints) show newline
(    \(box-drawing-codepoint? cp\) ; Identify box characters  ) show newline
(    \(codepoint->svg cp cx cy\)   ; Map to SVG primitives) show newline
(    \(fix-box-line-widths lines\) ; Auto-align right edges) show newline
(    \(text->svg-diagram text\)    ; Full conversion) show newline
() show newline
(The pipeline:) show newline
() show newline
(  * Split text into lines) show newline
(  * Auto-fix line widths for consistent box edges) show newline
(  * Process each character: box-drawing > geometry, text > grouped spans) show newline
(  * Emit SVG with embedded styles for theme compatibility) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DESIGN PRINCIPLES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * Compile, don't interpret: Fix problems at generation time, not render time) show newline
(  * Preserve intent: The author's diagram should appear as conceived) show newline
(  * Fail gracefully: Unknown characters pass through as text) show newline
(  * Theme-aware: Use currentColor so diagrams respect dark/light mode) show newline
(  * Self-contained: Each SVG includes its own styles) show newline
() show newline
(These principles ensure diagrams render correctly across browsers,) show newline
(operating systems, and color schemes—now and in the future.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(HERITAGE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This work stands on foundations:) show newline
() show newline
(  * Knuth's TeX \(1978\): The discipline of precise typographic control) show newline
(  * Ossanna's troff \(1973\): Document formatting as compilation) show newline
(  * Adobe PostScript \(1984\): Page description as a programming language) show newline
(  * Unicode box-drawing block \(1991\): Standardized character geometry) show newline
(  * SVG 1.0 \(2001\): Vector graphics for the web) show newline
() show newline
(We honor these by taking typography seriously in an age that has largely) show newline
(forgotten it.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * Knuth, D. E. \(1984\). The TeXbook) show newline
(  * Unicode Standard, Chapter 22: Symbols - Box Drawing) show newline
(  * SVG 1.1 Specification, W3C Recommendation) show newline
(  * Kernighan, B. W. \(1978\). A TROFF Tutorial) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * 2026-01-20) show newline
(  * Initial specification) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
