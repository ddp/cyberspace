<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0041: Scaling Architecture for IPv6</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0041: Scaling Architecture for IPv6</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo defines the architectural changes required to scale Cyberspace from a git-backed prototype to a native distributed system capable of operating at IPv6 scale (billions of realms, exabytes of content). Git becomes an export format; the vault becomes the source of truth.</p>
</section>
<section>
<h2>Terminology</h2>
<p>Realm: A node's place in cyberspace - its vault, principal, capabilities, and objects. Each realm is sovereign: local-first, controlled by its operator. Realms federate by choice, sharing objects according to trust relationships.</p>
<p>Vault: The local content-addressed object store (.vault/). The vault IS the realm's storage - all objects, catalogs, audit trails, and configuration live here.</p>
<p>Principal: A node's cryptographic identity (Ed25519 public key). The principal identifies the realm to peers and signs its objects.</p>
<p>At IPv6 scale, cyberspace consists of billions of realms, each occupying its own address space, each sovereign, each choosing what to share and with whom.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Git served as an excellent prototype substrate: - Content-addressed objects (proof of concept) - Merkle tree integrity (validates the model) - Ubiquitous tooling (bootstrap adoption)</p>
<p>Git cannot scale to IPv6: - Full history on every clone - Repository as replication unit (too coarse) - SHA-1 (cryptographically broken) - No native federation or discovery - Merge semantics are wrong model</p>
<p>The internet has 2^128 addresses. Cyberspace should use them.</p>
</section>
<section>
<h2>Design Principles</h2>
<pre>
1. Objects, not repositories
2. Pull, not push
3. Lazy, not eager
4. Local-first, federate-second
5. Trust math, not infrastructure
</pre>
</section>
<section>
<h2>Content-Addressed Object Store</h2>
<h3>Storage Model</h3>
<pre>
.vault/
  objects/
    sha512-a1b2c3.../    # First 8 chars as directory
      a1b2c3d4e5f6...    # Full hash as filename (S-expression)
  catalog/
    manifest.sexp        # Vault catalog object
    bloom.sexp           # Bloom filter object
    indices/             # Secondary index objects
      by-signer.sexp
      by-type.sexp
  chunks/
    sha512-xxxx/         # Chunked large objects
  audit/
    head.sexp            # Current audit chain head
    chain/               # Audit entries (hash-addressed)
</pre>
<h3>Object Format</h3>
<pre class="language-scheme">
(cyberspace-object
  (version 1)
  (type blob|tree|manifest|cert|audit)
  (size 1048576)
  (compression zstd|none)
  (hash "sha512:a1b2c3...")
  (chunks ("sha512:..." "sha512:..." ...))  ; If chunked
  (signature "ed25519:...")
  (timestamp 1736300000))
</pre>
<h3>Chunking Strategy</h3>
<p>Large objects split at content-defined boundaries (Rabin fingerprinting):</p>
<pre>
Target chunk: 64 KB (Starlink-optimized)
Min chunk:    16 KB
Max chunk:   256 KB

Benefits:
  - Deduplication across objects
  - Partial sync (fetch only missing chunks)
  - Resumable transfers
  - Efficient diff
</pre>
<h3>Hash Function</h3>
<pre>
SHA-512 everywhere.

Not SHA-256: We have the bits, use them.
Not SHA-1: Broken.
Not BLAKE3: Less analyzed, marginal speed gain irrelevant at network latency.

SHA-512 is:
  - FIPS certified (GovCloud path)
  - 50 years of cryptanalysis
  - Hardware accelerated
  - Already in use (audit trail, signatures)
</pre>
</section>
<section>
<h2>Catalog and Query</h2>
<p>The soup IS the catalog. No SQL. Objects are S-expressions, queries are pattern matching.</p>
<h3>The Soup Query Model</h3>
<pre class="language-scheme">
;; Find objects by pattern
(soup-query
  '(cyberspace-object
    (type blob)
    (signer "ed25519:alice...")
    ?rest))                        ; Match any object signed by Alice

;; Find by hash (direct lookup)
(soup-fetch "sha512:a1b2c3...")    ; O(1) content-addressed

;; Find by type
(soup-query '(cyberspace-object (type cert) ?rest))

;; Find by time range
(soup-query-range
  type: 'audit
  from: 1736000000
  to:   1736100000)

;; Cursor-based iteration for large result sets
(soup-cursor
  '(cyberspace-object (type ?) ?rest)
  batch: 100)
</pre>
<h3>Object Catalog</h3>
<p>The catalog is itself an object in the soup - a manifest of what the vault contains:</p>
<pre class="language-scheme">
(vault-catalog
  (version 1)
  (realm "ed25519:principal...")
  (object-count 150000)
  (types
    (blob 100000)
    (tree 30000)
    (cert 15000)
    (audit 5000))
  (bloom-filter #${...})           ; Fast existence check
  (updated 1736400000))
</pre>
<h3>Bloom Filter</h3>
<p>Fast existence check before network round-trip:</p>
<pre class="language-scheme">
(define (soup-maybe-contains? hash)
  "Check bloom filter - false means definitely not, true means maybe"
  (let ((catalog (soup-fetch-catalog)))
    (bloom-test (catalog-bloom catalog) hash)))

;; Bloom parameters
(bloom-filter
  (capacity 10000000)              ; 10M objects
  (false-positive 0.001)           ; 0.1% FP rate
  (bits #${...}))
</pre>
<h3>Audit Trail</h3>
<p>The audit trail is a hash-chain of objects in the soup:</p>
<pre class="language-scheme">
(audit-entry
  (sequence 12345)
  (timestamp 1736300000)
  (lamport 67890)
  (actor "ed25519:subject...")
  (action (read "sha512:object..."))
  (previous "sha512:prev-entry...")  ; Chain link
  (signature "ed25519:auditor..."))

;; Query audit by walking the chain
(define (audit-query actor from-seq)
  "Walk audit chain, filter by actor"
  (soup-chain-walk
    start: (audit-head)
    filter: (lambda (entry)
              (equal? (entry-actor entry) actor))
    from: from-seq))
</pre>
<h3>Secondary Indices</h3>
<p>For queries that can't use content-addressing, the soup maintains lightweight indices as objects:</p>
<pre class="language-scheme">
(soup-index
  (name "by-signer")
  (key-type principal)
  (entries
    (("ed25519:alice..." ("sha512:obj1" "sha512:obj2" ...))
     ("ed25519:bob..." ("sha512:obj3" "sha512:obj4" ...)))))

(soup-index
  (name "by-type")
  (key-type symbol)
  (entries
    ((blob ("sha512:..." "sha512:..." ...))
     (cert ("sha512:..." "sha512:..." ...))
     (audit ("sha512:..." "sha512:..." ...)))))
</pre>
<p>Indices are rebuilt on demand, not authoritative - the soup is truth.</p>
</section>
<section>
<h2>Discovery and Routing</h2>
<h3>Realm Identity</h3>
<p>Each realm has a principal (Ed25519 public key). This IS its identity:</p>
<pre class="language-scheme">
(realm-identity
  (principal "ed25519:a1b2c3...")
  (addresses                          ; Where to reach this realm
    (ipv6 "2001:db8::1" port: 7777)
    (ipv4 "192.0.2.1" port: 7777)     ; Legacy
    (onion "xxxx.onion" port: 7777))  ; Tor
  (role witness)
  (capabilities (storage-gb 1000) (bandwidth-mbps 100))
  (signature "ed25519:..."))
</pre>
<h3>Peer Discovery</h3>
<p>Bootstrap:</p>
<pre class="language-scheme">
(bootstrap-peers
  ("ed25519:official1..." "bootstrap.cyberspace.org")
  ("ed25519:official2..." "bootstrap2.cyberspace.org"))
</pre>
<p>Gossip Protocol:</p>
<pre>
1. Realm joins, contacts bootstrap peer
2. Receives partial peer list (random subset)
3. Contacts those peers, exchanges lists
4. Epidemic spread: O(log n) rounds to reach all realms
5. Periodic refresh (every 5 min on Starlink-friendly schedule)
</pre>
<p>Distributed Hash Table (Future):</p>
<pre>
Kademlia-style routing:
  - XOR distance metric on principal hashes
  - O(log n) lookups
  - Realms responsible for nearby hash ranges
  - Natural load balancing
</pre>
<h3>Content Discovery</h3>
<pre class="language-scheme">
;; "Who has this hash?"
(content-locate "sha512:a1b2c3...")

;; Returns list of peers claiming to have it:
(("ed25519:peer1..." (latency-ms 50) (role full))
 ("ed25519:peer2..." (latency-ms 200) (role witness))
 ("ed25519:peer3..." (latency-ms 600) (role archiver)))

;; Fetch from best candidate
(content-fetch "sha512:a1b2c3..." from: "ed25519:peer1...")
</pre>
</section>
<section>
<h2>Transport Protocol</h2>
<h3>End-to-End Encryption</h3>
<p>All network traffic is encrypted. The OS and network are not trusted.</p>
<pre class="language-scheme">
(cyberspace-message
  (version 1)
  (from "ed25519:sender...")
  (to "ed25519:recipient...")        ; Or broadcast key
  (ephemeral "x25519:...")           ; One-time key (PFS)
  (nonce #${24-bytes})               ; Random nonce
  (ciphertext #${...})               ; NaCl box: X25519 + XSalsa20-Poly1305
  (signature "ed25519:..."))         ; Sign the ciphertext
</pre>
<p>Encryption scheme: NaCl crypto_box (libsodium) - Key agreement: X25519 (Curve25519 ECDH) - Cipher: XSalsa20-Poly1305 - Perfect forward secrecy: ephemeral keys per message</p>
<p>Decrypted payload:</p>
<pre class="language-scheme">
(plaintext-payload
  (type request|response|announce|gossip)
  (nonce 12345678)                   ; Replay protection
  (timestamp 1736300000)
  (body ...))
</pre>
<p>Broadcast messages use a shared group key or are signed-only (announcements of public objects).</p>
<h3>Wire Format (Encrypted)</h3>
<pre class="language-scheme">
;; Sender encrypts
(define (seal-message payload recipient-pubkey sender-keypair)
  (let ((ephemeral (x25519-keypair))
         (shared (x25519-shared (ephemeral-secret ephemeral) recipient-pubkey))
         (nonce (random-bytes 24))
         (ciphertext (crypto-box payload nonce shared)))
    `(cyberspace-message
      (version 1)
      (from ,(keypair-public sender-keypair))
      (to ,recipient-pubkey)
      (ephemeral ,(ephemeral-public ephemeral))
      (nonce ,nonce)
      (ciphertext ,ciphertext)
      (signature ,(sign-message ciphertext sender-keypair)))))

;; Recipient decrypts
(define (open-message msg recipient-keypair)
  (let ((shared (x25519-shared (keypair-secret recipient-keypair)
                                (message-ephemeral msg)))
         (plaintext (crypto-box-open (message-ciphertext msg)
                                     (message-nonce msg)
                                     shared)))
    (and (verify-signature msg (message-from msg))
         plaintext)))
</pre>
<h3>Request Types</h3>
<pre class="language-scheme">
;; Existence check
(have? ("sha512:..." "sha512:..." ...))
;; Response: (have ("sha512:..." "sha512:...") missing ("sha512:..."))

;; Fetch object
(fetch "sha512:...")
;; Response: (object ...)

;; Fetch chunk range
(fetch-chunks "sha512:..." start: 5 count: 10)
;; Response: (chunks ...)

;; Peer list exchange
(peers? limit: 50)
;; Response: (peers ...)

;; Announce new content
(announce ("sha512:..." "sha512:..."))
;; Response: (ack)
</pre>
<h3>Transport Bindings</h3>
<pre>
Native:     UDP/IPv6, port 7777 (primary)
Fallback:   TCP/IPv6, port 7777 (firewalls)
Legacy:     TCP/IPv4, port 7777 (transition)
Stealth:    Tor onion service (censorship resistance)
Offline:    USB drive, file copy (sneakernet)
Export:     Git bundle (GitHub compatibility)
</pre>
<h3>Starlink Optimization</h3>
<pre class="language-scheme">
(transport-config
  (mode satellite)
  (batch-window-ms 500)        ; Aggregate small messages
  (chunk-size-kb 64)           ; Match MTU
  (retry-strategy exponential)
  (max-in-flight 10)           ; Parallelism
  (keepalive-sec 300))         ; 5 min, not 30 sec
</pre>
</section>
<section>
<h2>Synchronization Protocol</h2>
<h3>Lazy Sync (Default)</h3>
<pre>
Node A                              Node B
   |                                   |
   |----(have? [h1, h2, h3])----------&gt;|
   |&lt;---(have [h1, h3] missing [h2])---|
   |----(fetch h2)--------------------&gt;|
   |&lt;---(object h2 ...)----------------|
   |                                   |

No coordination. No locks. No leader.
</pre>
<h3>Crdt-Style Convergence</h3>
<p>Objects are immutable and content-addressed. No conflicts possible at object level.</p>
<p>Manifests (collections of objects) use: - Lamport timestamps for ordering - Last-writer-wins with principal tiebreaker - Or: union (add-only sets)</p>
<pre class="language-scheme">
(manifest
  (name "library")
  (version (lamport 42) (principal "ed25519:..."))
  (entries
    ("memo-001" "sha512:...")
    ("memo-002" "sha512:...")
    ...))
</pre>
<h3>Merkle Sync</h3>
<p>Efficient diff for large manifests:</p>
<pre>
         root
        /    \
      h1      h2
     /  \    /  \
    a    b  c    d

Exchange root hash.
If different, recurse on children.
O(log n) round trips to find diff.
</pre>
</section>
<section>
<h2>Federation at Scale</h2>
<h3>Cluster Topology</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 710 440" width="710" height="440" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<line x1="205" y1="10" x2="210" y2="10"/>
<line x1="205" y1="10" x2="205" y2="21"/>
<line x1="210" y1="10" x2="220" y2="10"/>
<line x1="220" y1="10" x2="230" y2="10"/>
<line x1="230" y1="10" x2="240" y2="10"/>
<line x1="240" y1="10" x2="250" y2="10"/>
<line x1="250" y1="10" x2="260" y2="10"/>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="390" y2="10"/>
<line x1="390" y1="10" x2="400" y2="10"/>
<line x1="400" y1="10" x2="410" y2="10"/>
<line x1="410" y1="10" x2="420" y2="10"/>
<line x1="420" y1="10" x2="430" y2="10"/>
<line x1="430" y1="10" x2="440" y2="10"/>
<line x1="440" y1="10" x2="450" y2="10"/>
<line x1="450" y1="10" x2="460" y2="10"/>
<line x1="460" y1="10" x2="470" y2="10"/>
<line x1="470" y1="10" x2="480" y2="10"/>
<line x1="480" y1="10" x2="490" y2="10"/>
<line x1="490" y1="10" x2="500" y2="10"/>
<line x1="500" y1="10" x2="510" y2="10"/>
<line x1="510" y1="10" x2="520" y2="10"/>
<line x1="520" y1="10" x2="530" y2="10"/>
<line x1="530" y1="10" x2="540" y2="10"/>
<line x1="540" y1="10" x2="550" y2="10"/>
<line x1="550" y1="10" x2="560" y2="10"/>
<line x1="560" y1="10" x2="570" y2="10"/>
<line x1="570" y1="10" x2="580" y2="10"/>
<line x1="700" y1="10" x2="705" y2="10"/>
<line x1="705" y1="10" x2="705" y2="21"/>
<line x1="205" y1="19" x2="205" y2="41"/>
<text x="300" y="30">COORDINATOR</text>
<text x="420" y="30">CLUSTER</text>
<line x1="705" y1="19" x2="705" y2="41"/>
<line x1="205" y1="39" x2="205" y2="61"/>
<text x="230" y="50">(3-7</text>
<text x="280" y="50">nodes,</text>
<text x="350" y="50">Byzantine</text>
<text x="450" y="50">consensus)</text>
<line x1="705" y1="39" x2="705" y2="61"/>
<line x1="205" y1="70" x2="210" y2="70"/>
<line x1="205" y1="59" x2="205" y2="70"/>
<line x1="210" y1="70" x2="220" y2="70"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="360" y2="70"/>
<line x1="360" y1="70" x2="370" y2="70"/>
<line x1="370" y1="70" x2="380" y2="70"/>
<line x1="375" y1="70" x2="375" y2="81"/>
<line x1="380" y1="70" x2="390" y2="70"/>
<line x1="390" y1="70" x2="400" y2="70"/>
<line x1="400" y1="70" x2="410" y2="70"/>
<line x1="410" y1="70" x2="420" y2="70"/>
<line x1="420" y1="70" x2="430" y2="70"/>
<line x1="430" y1="70" x2="440" y2="70"/>
<line x1="440" y1="70" x2="450" y2="70"/>
<line x1="450" y1="70" x2="460" y2="70"/>
<line x1="460" y1="70" x2="470" y2="70"/>
<line x1="470" y1="70" x2="480" y2="70"/>
<line x1="480" y1="70" x2="490" y2="70"/>
<line x1="490" y1="70" x2="500" y2="70"/>
<line x1="500" y1="70" x2="510" y2="70"/>
<line x1="510" y1="70" x2="520" y2="70"/>
<line x1="520" y1="70" x2="530" y2="70"/>
<line x1="530" y1="70" x2="540" y2="70"/>
<line x1="540" y1="70" x2="550" y2="70"/>
<line x1="550" y1="70" x2="560" y2="70"/>
<line x1="560" y1="70" x2="570" y2="70"/>
<line x1="570" y1="70" x2="580" y2="70"/>
<line x1="700" y1="70" x2="705" y2="70"/>
<line x1="705" y1="59" x2="705" y2="70"/>
<line x1="705" y1="79" x2="705" y2="101"/>
<line x1="105" y1="110" x2="110" y2="110"/>
<line x1="105" y1="110" x2="105" y2="121"/>
<line x1="110" y1="110" x2="120" y2="110"/>
<line x1="120" y1="110" x2="130" y2="110"/>
<line x1="130" y1="110" x2="140" y2="110"/>
<line x1="140" y1="110" x2="150" y2="110"/>
<line x1="150" y1="110" x2="160" y2="110"/>
<line x1="160" y1="110" x2="170" y2="110"/>
<line x1="170" y1="110" x2="180" y2="110"/>
<line x1="180" y1="110" x2="190" y2="110"/>
<line x1="190" y1="110" x2="200" y2="110"/>
<line x1="200" y1="110" x2="210" y2="110"/>
<line x1="210" y1="110" x2="220" y2="110"/>
<line x1="220" y1="110" x2="230" y2="110"/>
<line x1="230" y1="110" x2="240" y2="110"/>
<line x1="240" y1="110" x2="250" y2="110"/>
<line x1="250" y1="110" x2="260" y2="110"/>
<line x1="260" y1="110" x2="270" y2="110"/>
<line x1="270" y1="110" x2="280" y2="110"/>
<line x1="280" y1="110" x2="290" y2="110"/>
<line x1="290" y1="110" x2="300" y2="110"/>
<line x1="300" y1="110" x2="310" y2="110"/>
<line x1="310" y1="110" x2="320" y2="110"/>
<line x1="320" y1="110" x2="330" y2="110"/>
<line x1="330" y1="110" x2="340" y2="110"/>
<line x1="340" y1="110" x2="350" y2="110"/>
<line x1="350" y1="110" x2="360" y2="110"/>
<line x1="360" y1="110" x2="370" y2="110"/>
<line x1="370" y1="110" x2="380" y2="110"/>
<line x1="375" y1="99" x2="375" y2="121"/>
<line x1="380" y1="110" x2="390" y2="110"/>
<line x1="390" y1="110" x2="400" y2="110"/>
<line x1="400" y1="110" x2="410" y2="110"/>
<line x1="410" y1="110" x2="420" y2="110"/>
<line x1="420" y1="110" x2="430" y2="110"/>
<line x1="430" y1="110" x2="440" y2="110"/>
<line x1="440" y1="110" x2="450" y2="110"/>
<line x1="450" y1="110" x2="460" y2="110"/>
<line x1="460" y1="110" x2="470" y2="110"/>
<line x1="470" y1="110" x2="480" y2="110"/>
<line x1="480" y1="110" x2="490" y2="110"/>
<line x1="490" y1="110" x2="500" y2="110"/>
<line x1="500" y1="110" x2="510" y2="110"/>
<line x1="510" y1="110" x2="520" y2="110"/>
<line x1="520" y1="110" x2="530" y2="110"/>
<line x1="530" y1="110" x2="540" y2="110"/>
<line x1="540" y1="110" x2="550" y2="110"/>
<line x1="550" y1="110" x2="560" y2="110"/>
<line x1="560" y1="110" x2="570" y2="110"/>
<line x1="570" y1="110" x2="580" y2="110"/>
<line x1="580" y1="110" x2="590" y2="110"/>
<line x1="590" y1="110" x2="600" y2="110"/>
<line x1="600" y1="110" x2="610" y2="110"/>
<line x1="610" y1="110" x2="620" y2="110"/>
<line x1="620" y1="110" x2="630" y2="110"/>
<line x1="630" y1="110" x2="640" y2="110"/>
<line x1="700" y1="110" x2="705" y2="110"/>
<line x1="705" y1="110" x2="705" y2="121"/>
<line x1="105" y1="119" x2="105" y2="141"/>
<line x1="375" y1="119" x2="375" y2="141"/>
<line x1="705" y1="119" x2="705" y2="141"/>
<line x1="45" y1="150" x2="50" y2="150"/>
<line x1="45" y1="150" x2="45" y2="161"/>
<line x1="50" y1="150" x2="60" y2="150"/>
<line x1="60" y1="150" x2="70" y2="150"/>
<line x1="70" y1="150" x2="80" y2="150"/>
<line x1="80" y1="150" x2="90" y2="150"/>
<line x1="90" y1="150" x2="100" y2="150"/>
<line x1="110" y1="150" x2="120" y2="150"/>
<line x1="120" y1="150" x2="130" y2="150"/>
<line x1="130" y1="150" x2="140" y2="150"/>
<line x1="140" y1="150" x2="150" y2="150"/>
<line x1="150" y1="150" x2="160" y2="150"/>
<line x1="160" y1="150" x2="165" y2="150"/>
<line x1="165" y1="150" x2="165" y2="161"/>
<line x1="305" y1="150" x2="310" y2="150"/>
<line x1="305" y1="150" x2="305" y2="161"/>
<line x1="310" y1="150" x2="320" y2="150"/>
<line x1="320" y1="150" x2="330" y2="150"/>
<line x1="330" y1="150" x2="340" y2="150"/>
<line x1="340" y1="150" x2="350" y2="150"/>
<line x1="350" y1="150" x2="360" y2="150"/>
<line x1="360" y1="150" x2="370" y2="150"/>
<line x1="380" y1="150" x2="390" y2="150"/>
<line x1="390" y1="150" x2="400" y2="150"/>
<line x1="400" y1="150" x2="410" y2="150"/>
<line x1="410" y1="150" x2="420" y2="150"/>
<line x1="420" y1="150" x2="430" y2="150"/>
<line x1="430" y1="150" x2="435" y2="150"/>
<line x1="435" y1="150" x2="435" y2="161"/>
<line x1="575" y1="150" x2="580" y2="150"/>
<line x1="575" y1="150" x2="575" y2="161"/>
<line x1="580" y1="150" x2="590" y2="150"/>
<line x1="590" y1="150" x2="600" y2="150"/>
<line x1="600" y1="150" x2="610" y2="150"/>
<line x1="610" y1="150" x2="620" y2="150"/>
<line x1="620" y1="150" x2="630" y2="150"/>
<line x1="630" y1="150" x2="640" y2="150"/>
<line x1="650" y1="150" x2="660" y2="150"/>
<line x1="660" y1="150" x2="670" y2="150"/>
<line x1="670" y1="150" x2="680" y2="150"/>
<line x1="680" y1="150" x2="690" y2="150"/>
<line x1="690" y1="150" x2="700" y2="150"/>
<line x1="700" y1="150" x2="705" y2="150"/>
<line x1="705" y1="150" x2="705" y2="161"/>
<line x1="45" y1="159" x2="45" y2="181"/>
<text x="80" y="170">FULL</text>
<line x1="165" y1="159" x2="165" y2="181"/>
<line x1="305" y1="159" x2="305" y2="181"/>
<text x="340" y="170">FULL</text>
<line x1="435" y1="159" x2="435" y2="181"/>
<line x1="575" y1="159" x2="575" y2="181"/>
<text x="620" y="170">FULL</text>
<line x1="705" y1="159" x2="705" y2="181"/>
<line x1="45" y1="179" x2="45" y2="201"/>
<text x="70" y="190">NODES</text>
<line x1="165" y1="179" x2="165" y2="201"/>
<line x1="305" y1="179" x2="305" y2="201"/>
<text x="340" y="190">NODES</text>
<line x1="435" y1="179" x2="435" y2="201"/>
<line x1="575" y1="179" x2="575" y2="201"/>
<text x="610" y="190">NODES</text>
<line x1="705" y1="179" x2="705" y2="201"/>
<line x1="45" y1="210" x2="50" y2="210"/>
<line x1="45" y1="199" x2="45" y2="210"/>
<line x1="50" y1="210" x2="60" y2="210"/>
<line x1="60" y1="210" x2="70" y2="210"/>
<line x1="70" y1="210" x2="80" y2="210"/>
<line x1="80" y1="210" x2="90" y2="210"/>
<line x1="90" y1="210" x2="100" y2="210"/>
<line x1="100" y1="210" x2="110" y2="210"/>
<line x1="105" y1="210" x2="105" y2="221"/>
<line x1="110" y1="210" x2="120" y2="210"/>
<line x1="120" y1="210" x2="130" y2="210"/>
<line x1="130" y1="210" x2="140" y2="210"/>
<line x1="140" y1="210" x2="150" y2="210"/>
<line x1="150" y1="210" x2="160" y2="210"/>
<line x1="160" y1="210" x2="165" y2="210"/>
<line x1="165" y1="199" x2="165" y2="210"/>
<line x1="305" y1="210" x2="310" y2="210"/>
<line x1="305" y1="199" x2="305" y2="210"/>
<line x1="310" y1="210" x2="320" y2="210"/>
<line x1="320" y1="210" x2="330" y2="210"/>
<line x1="330" y1="210" x2="340" y2="210"/>
<line x1="340" y1="210" x2="350" y2="210"/>
<line x1="350" y1="210" x2="360" y2="210"/>
<line x1="360" y1="210" x2="370" y2="210"/>
<line x1="365" y1="210" x2="365" y2="221"/>
<line x1="370" y1="210" x2="380" y2="210"/>
<line x1="380" y1="210" x2="390" y2="210"/>
<line x1="390" y1="210" x2="400" y2="210"/>
<line x1="400" y1="210" x2="410" y2="210"/>
<line x1="410" y1="210" x2="420" y2="210"/>
<line x1="420" y1="210" x2="430" y2="210"/>
<line x1="430" y1="210" x2="435" y2="210"/>
<line x1="435" y1="199" x2="435" y2="210"/>
<line x1="575" y1="210" x2="580" y2="210"/>
<line x1="575" y1="199" x2="575" y2="210"/>
<line x1="580" y1="210" x2="590" y2="210"/>
<line x1="590" y1="210" x2="600" y2="210"/>
<line x1="600" y1="210" x2="610" y2="210"/>
<line x1="610" y1="210" x2="620" y2="210"/>
<line x1="620" y1="210" x2="630" y2="210"/>
<line x1="630" y1="210" x2="640" y2="210"/>
<line x1="635" y1="210" x2="635" y2="221"/>
<line x1="640" y1="210" x2="650" y2="210"/>
<line x1="650" y1="210" x2="660" y2="210"/>
<line x1="660" y1="210" x2="670" y2="210"/>
<line x1="670" y1="210" x2="680" y2="210"/>
<line x1="680" y1="210" x2="690" y2="210"/>
<line x1="690" y1="210" x2="700" y2="210"/>
<line x1="700" y1="210" x2="705" y2="210"/>
<line x1="705" y1="199" x2="705" y2="210"/>
<line x1="105" y1="219" x2="105" y2="241"/>
<line x1="365" y1="219" x2="365" y2="241"/>
<line x1="705" y1="219" x2="705" y2="241"/>
<line x1="45" y1="250" x2="50" y2="250"/>
<line x1="45" y1="250" x2="45" y2="261"/>
<line x1="50" y1="250" x2="60" y2="250"/>
<line x1="60" y1="250" x2="70" y2="250"/>
<line x1="70" y1="250" x2="80" y2="250"/>
<line x1="80" y1="250" x2="90" y2="250"/>
<line x1="90" y1="250" x2="100" y2="250"/>
<line x1="110" y1="250" x2="120" y2="250"/>
<line x1="120" y1="250" x2="130" y2="250"/>
<line x1="130" y1="250" x2="140" y2="250"/>
<line x1="140" y1="250" x2="150" y2="250"/>
<line x1="150" y1="250" x2="160" y2="250"/>
<line x1="160" y1="250" x2="165" y2="250"/>
<line x1="165" y1="250" x2="165" y2="261"/>
<line x1="305" y1="250" x2="310" y2="250"/>
<line x1="305" y1="250" x2="305" y2="261"/>
<line x1="310" y1="250" x2="320" y2="250"/>
<line x1="320" y1="250" x2="330" y2="250"/>
<line x1="330" y1="250" x2="340" y2="250"/>
<line x1="340" y1="250" x2="350" y2="250"/>
<line x1="350" y1="250" x2="360" y2="250"/>
<line x1="370" y1="250" x2="380" y2="250"/>
<line x1="380" y1="250" x2="390" y2="250"/>
<line x1="390" y1="250" x2="400" y2="250"/>
<line x1="400" y1="250" x2="410" y2="250"/>
<line x1="410" y1="250" x2="420" y2="250"/>
<line x1="420" y1="250" x2="430" y2="250"/>
<line x1="430" y1="250" x2="435" y2="250"/>
<line x1="435" y1="250" x2="435" y2="261"/>
<line x1="575" y1="250" x2="580" y2="250"/>
<line x1="575" y1="250" x2="575" y2="261"/>
<line x1="580" y1="250" x2="590" y2="250"/>
<line x1="590" y1="250" x2="600" y2="250"/>
<line x1="600" y1="250" x2="610" y2="250"/>
<line x1="610" y1="250" x2="620" y2="250"/>
<line x1="620" y1="250" x2="630" y2="250"/>
<line x1="640" y1="250" x2="650" y2="250"/>
<line x1="650" y1="250" x2="660" y2="250"/>
<line x1="660" y1="250" x2="670" y2="250"/>
<line x1="670" y1="250" x2="680" y2="250"/>
<line x1="680" y1="250" x2="690" y2="250"/>
<line x1="690" y1="250" x2="700" y2="250"/>
<line x1="700" y1="250" x2="705" y2="250"/>
<line x1="705" y1="250" x2="705" y2="261"/>
<line x1="45" y1="259" x2="45" y2="281"/>
<text x="60" y="270">WITNESSES</text>
<line x1="165" y1="259" x2="165" y2="281"/>
<line x1="305" y1="259" x2="305" y2="281"/>
<text x="320" y="270">WITNESSES</text>
<line x1="435" y1="259" x2="435" y2="281"/>
<line x1="575" y1="259" x2="575" y2="281"/>
<text x="590" y="270">WITNESSES</text>
<line x1="705" y1="259" x2="705" y2="281"/>
<line x1="45" y1="279" x2="45" y2="301"/>
<text x="60" y="290">ARCHIVERS</text>
<line x1="165" y1="279" x2="165" y2="301"/>
<line x1="305" y1="279" x2="305" y2="301"/>
<text x="320" y="290">ARCHIVERS</text>
<line x1="435" y1="279" x2="435" y2="301"/>
<line x1="575" y1="279" x2="575" y2="301"/>
<text x="590" y="290">ARCHIVERS</text>
<line x1="705" y1="279" x2="705" y2="301"/>
<line x1="45" y1="299" x2="45" y2="321"/>
<text x="80" y="310">EDGES</text>
<line x1="165" y1="299" x2="165" y2="321"/>
<line x1="305" y1="299" x2="305" y2="321"/>
<text x="340" y="310">EDGES</text>
<line x1="435" y1="299" x2="435" y2="321"/>
<line x1="575" y1="299" x2="575" y2="321"/>
<text x="610" y="310">EDGES</text>
<line x1="705" y1="299" x2="705" y2="321"/>
<line x1="45" y1="330" x2="50" y2="330"/>
<line x1="45" y1="319" x2="45" y2="330"/>
<line x1="50" y1="330" x2="60" y2="330"/>
<line x1="60" y1="330" x2="70" y2="330"/>
<line x1="70" y1="330" x2="80" y2="330"/>
<line x1="80" y1="330" x2="90" y2="330"/>
<line x1="90" y1="330" x2="100" y2="330"/>
<line x1="100" y1="330" x2="110" y2="330"/>
<line x1="110" y1="330" x2="120" y2="330"/>
<line x1="120" y1="330" x2="130" y2="330"/>
<line x1="130" y1="330" x2="140" y2="330"/>
<line x1="140" y1="330" x2="150" y2="330"/>
<line x1="150" y1="330" x2="160" y2="330"/>
<line x1="160" y1="330" x2="165" y2="330"/>
<line x1="165" y1="319" x2="165" y2="330"/>
<line x1="305" y1="330" x2="310" y2="330"/>
<line x1="305" y1="319" x2="305" y2="330"/>
<line x1="310" y1="330" x2="320" y2="330"/>
<line x1="320" y1="330" x2="330" y2="330"/>
<line x1="330" y1="330" x2="340" y2="330"/>
<line x1="340" y1="330" x2="350" y2="330"/>
<line x1="350" y1="330" x2="360" y2="330"/>
<line x1="360" y1="330" x2="370" y2="330"/>
<line x1="370" y1="330" x2="380" y2="330"/>
<line x1="380" y1="330" x2="390" y2="330"/>
<line x1="390" y1="330" x2="400" y2="330"/>
<line x1="400" y1="330" x2="410" y2="330"/>
<line x1="410" y1="330" x2="420" y2="330"/>
<line x1="420" y1="330" x2="430" y2="330"/>
<line x1="430" y1="330" x2="435" y2="330"/>
<line x1="435" y1="319" x2="435" y2="330"/>
<line x1="575" y1="330" x2="580" y2="330"/>
<line x1="575" y1="319" x2="575" y2="330"/>
<line x1="580" y1="330" x2="590" y2="330"/>
<line x1="590" y1="330" x2="600" y2="330"/>
<line x1="600" y1="330" x2="610" y2="330"/>
<line x1="610" y1="330" x2="620" y2="330"/>
<line x1="620" y1="330" x2="630" y2="330"/>
<line x1="630" y1="330" x2="640" y2="330"/>
<line x1="640" y1="330" x2="650" y2="330"/>
<line x1="650" y1="330" x2="660" y2="330"/>
<line x1="660" y1="330" x2="670" y2="330"/>
<line x1="670" y1="330" x2="680" y2="330"/>
<line x1="680" y1="330" x2="690" y2="330"/>
<line x1="690" y1="330" x2="700" y2="330"/>
<line x1="700" y1="330" x2="705" y2="330"/>
<line x1="705" y1="319" x2="705" y2="330"/>
<text x="0" y="350">Coordinators:</text>
<text x="140" y="350">Rare,</text>
<text x="200" y="350">high-capability</text>
<text x="360" y="350">realms,</text>
<text x="440" y="350">run</text>
<text x="480" y="350">consensus</text>
<text x="0" y="370">Full:</text>
<text x="60" y="370">Common</text>
<text x="130" y="370">realms,</text>
<text x="210" y="370">replicate</text>
<text x="310" y="370">everything,</text>
<text x="430" y="370">serve</text>
<text x="490" y="370">content</text>
<text x="0" y="390">Witnesses:</text>
<text x="110" y="390">Abundant</text>
<text x="200" y="390">realms,</text>
<text x="280" y="390">verify</text>
<text x="350" y="390">and</text>
<text x="390" y="390">store,</text>
<text x="460" y="390">passive</text>
<text x="540" y="390">sync</text>
<text x="0" y="410">Archivers:</text>
<text x="110" y="410">Cold</text>
<text x="160" y="410">storage</text>
<text x="240" y="410">realms,</text>
<text x="320" y="410">batch</text>
<text x="380" y="410">sync</text>
<text x="0" y="430">Edges:</text>
<text x="70" y="430">Read-only</text>
<text x="170" y="430">realms,</text>
<text x="250" y="430">intermittent,</text>
<text x="390" y="430">mobile</text>
</svg>
</div>
<h3>Partition Tolerance</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 660 100" width="660" height="100" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">Network</text>
<text x="80" y="10">splits</text>
<text x="170" y="10">clusters</text>
<text x="260" y="10">diverge</text>
<text x="360" y="10">clusters</text>
<text x="450" y="10">converge</text>
<text x="540" y="10">on</text>
<text x="570" y="10">reconnect</text>
<text x="0" y="30">No</text>
<text x="30" y="30">data</text>
<text x="80" y="30">loss</text>
<text x="130" y="30">(content-addressed)</text>
<text x="0" y="50">No</text>
<text x="30" y="50">conflicts</text>
<text x="130" y="50">(immutable</text>
<text x="240" y="50">objects)</text>
<text x="0" y="70">Audit</text>
<text x="60" y="70">trails</text>
<text x="130" y="70">merge</text>
<text x="190" y="70">(union</text>
<text x="260" y="70">of</text>
<text x="290" y="70">entries,</text>
<text x="380" y="70">Lamport</text>
<text x="460" y="70">ordering)</text>
<text x="0" y="90">Manifests</text>
<text x="100" y="90">resolve</text>
<text x="180" y="90">(LWW</text>
<text x="230" y="90">or</text>
<text x="260" y="90">union</text>
<text x="320" y="90">based</text>
<text x="380" y="90">on</text>
<text x="410" y="90">type)</text>
</svg>
</div>
</section>
<section>
<h2>Git as Export Format</h2>
<h3>The Transition</h3>
<pre>
Phase 1 (Now):      Git is source of truth, vault is cache
Phase 2 (Next):     Vault is source of truth, git is export
Phase 3 (Future):   Git optional, purely for GitHub presence
</pre>
<h3>Export Process</h3>
<pre class="language-scheme">
(git-export
  from: ".vault"
  to: "/tmp/cyberspace-export"
  format: 'git-repo)

;; Creates standard git repo from vault contents
;; For publishing to GitHub, GitLab, etc.
</pre>
<h3>Import Process</h3>
<pre class="language-scheme">
(git-import
  from: "https://github.com/ddp/cyberspace.git"
  to: ".vault")

;; Extracts objects from git, stores in vault
;; Discards git history, keeps content
</pre>
</section>
<section>
<h2>Security at Scale</h2>
<h3>Sybil Resistance</h3>
<p>Problem: Attacker creates many fake nodes to dominate network.</p>
<p>Mitigations:</p>
<ul>
<li>Stake-weighted voting (not proof-of-work, just reputation)</li>
<li>Web of trust - new nodes introduced by existing trusted nodes</li>
<li>Rate limiting - bound resources per principal</li>
<li>Coordinator consensus - Byzantine-resistant core</li>
</ul>
<h3>Eclipse Attack Resistance</h3>
<p>Problem: Attacker isolates a node by controlling all its peers.</p>
<p>Mitigations:</p>
<ul>
<li>Diverse bootstrap - multiple independent entry points</li>
<li>Random peer selection - can't predict who you'll connect to</li>
<li>Peer rotation - periodically reconnect to new peers</li>
<li>Out-of-band verification - publish peer lists via DNS, blockchain, etc.</li>
</ul>
<h3>Denial of Service</h3>
<p>Problem: Attacker floods network with junk.</p>
<p>Mitigations:</p>
<ul>
<li>Proof of work on announcements (small, CPU cost)</li>
<li>Rate limiting per principal</li>
<li>Reputation scoring - misbehaving peers deprioritized</li>
<li>Content validation - reject malformed objects immediately</li>
</ul>
</section>
<section>
<h2>Implementation Phases</h2>
<h3>Phase 1: Native Object Store</h3>
<ul>
<li>Implement .vault/objects/ storage</li>
<li>Soup catalog and query</li>
<li>Keep git for development workflow</li>
</ul>
<h3>Phase 2: Local-First Sync</h3>
<ul>
<li>Direct node-to-node protocol - have?/fetch message types</li>
<li>UDP transport with TCP fallback</li>
</ul>
<h3>Phase 3: Discovery</h3>
<ul>
<li>Gossip peer exchange</li>
<li>Bootstrap nodes</li>
<li>Bloom filters for content location</li>
</ul>
<h3>Phase 4: Scale Testing</h3>
<ul>
<li>100 nodes - 1000 nodes - 10000 nodes</li>
<li>Measure: latency, convergence time, bandwidth</li>
</ul>
<p>Implementation proceeds from working local storage to network protocols to discovery to scale testing. Each phase validates assumptions before the next builds on them. Git deprecation comes last—the proven system remains as fallback until the native system earns trust.</p>
<h3>Phase 5: Git Deprecation</h3>
<ul>
<li>Vault as source of truth</li>
<li>Git export for compatibility</li>
<li>Remove git dependency from core operations</li>
</ul>
</section>
<section>
<h2>Metrics and Monitoring</h2>
<pre class="language-scheme">
(node-metrics)
;; Returns:
((objects-stored 150000)
 (objects-size-gb 50)
 (peers-known 500)
 (peers-connected 20)
 (sync-lag-seconds 30)
 (bandwidth-in-mbps 10)
 (bandwidth-out-mbps 5)
 (requests-per-second 100)
 (errors-per-second 0.1))
</pre>
</section>
<section>
<h2>References</h2>
<ul>
<li>Memo-010: Federation Protocol</li>
<li>Memo-016: Lazy Clustering</li>
<li>Memo-037: Node Roles and Capabilities</li>
<li>Maymounkov, P. (2002). Kademlia: A Peer-to-peer Information System</li>
<li>Rabin, M. (1981). Fingerprinting by Random Polynomials</li>
<li>IPFS Whitepaper (2014)</li>
<li>Shapiro, M. (2011). Conflict-Free Replicated Data Types</li>
</ul>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-07</li>
<li>Initial draft</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
