%!PS-Adobe-3.0
%%Title: memo-0042-fuse-filesystem
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0042: Wormholes) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This Memo specifies wormholes—FUSE-based bidirectional portals between) show newline
(the macOS filesystem and the Library of Cyberspace vault. Wormholes) show newline
(preserve full metadata including extended attributes, Finder tags, and) show newline
(ACLs. All operations are auditable \(Memo-003\) and rate-limited) show newline
(\(Memo-032\).[^h1]) show newline
() show newline
([^h1]: Historical: FUSE originated in Linux 2.6 \(2005\), inspired by) show newline
(earlier userspace filesystem work in Plan 9 and Hurd. macFUSE) show newline
(\(originally MacFUSE\) brought it to macOS in 2007. The abstraction) show newline
(outlived Apple's hostility.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Users need seamless integration between their existing filesystem and) show newline
(the vault. Manual import/export creates friction and risks metadata) show newline
(loss.) show newline
() show newline
(A wormhole provides:) show newline
() show newline
(  * Transparency - Finder, cp, rsync work unchanged) show newline
(  * Bidirectionality - No separate sync step; it IS the filesystem) show newline
(  * Metadata preservation - Full macOS attributes captured automatically) show newline
(  * Content addressing - Deduplication and integrity built-in) show newline
(  * Security - First-class Simple Public Key Infrastructure \(SPKI\) object with audit and rate-limit) show newline
() show newline
(The filesystem abstraction is the right boundary—everything above it) show newline
(\(apps, shell, Finder\) works without modification.[^d1]) show newline
() show newline
([^d1]: Design: FUSE inverts the usual model. Instead of teaching) show newline
(applications about vaults, we teach the vault to speak filesystem. Unix) show newline
(got this right: everything is a file.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(WORMHOLE AS SECURITY OBJECT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(A wormhole is a first-class security object in cyberspace, subject) show newline
(to:[^d2]) show newline
() show newline
(  * SPKI Authorization \(Memo-004\) — Opening requires valid certificate) show newline
(  * Capability Delegation \(Memo-021\) — Wormhole access can be delegated) show newline
(  * Audit Trail \(Memo-003\) — All operations logged) show newline
(  * Rate Limiting \(Memo-032\) — Configurable ops/minute) show newline
(  * Sandboxing \(Memo-023\) — Agents access wormholes through capabilities) show newline
() show newline
(Wormholes bridge two security domains—the filesystem and the) show newline
(vault—making them inherently privileged operations. Treating wormholes) show newline
(as first-class security objects ensures that filesystem access remains) show newline
(under cryptographic control, not just ambient POSIX permissions.) show newline
() show newline
([^d2]: Design: Wormholes are attack surface. Unrestricted filesystem) show newline
(access defeats vault security. Every wormhole must be explicitly) show newline
(authorized, continuously audited, and rate-limited against abuse.) show newline
() show newline
() show newline
(Wormhole Certificate) show newline
(--------------------) show newline
() show newline
() show newline
(    \(define \(wormhole-cert issuer fs-path vault-path permissions\)) show newline
(      "Create SPKI certificate authorizing wormhole") show newline
(      \(create-cert) show newline
(       issuer) show newline
(       \(wormhole-principal fs-path vault-path\)) show newline
(       `\(tag \(wormhole) show newline
(              \(fs-path ,fs-path\)) show newline
(              \(vault-path ,vault-path\)) show newline
(              \(permissions ,@permissions\)   ; read, write, delete) show newline
(              \(rate-limit 1000\)             ; ops/minute) show newline
(              \(expires ,\(+ \(current-seconds\) 86400\)\)\)\)\)\)) show newline
() show newline
() show newline
(Capability Model) show newline
(----------------) show newline
() show newline
(Wormholes support fine-grained capabilities:[^d3]) show newline
() show newline
([^d3]: Design: Rich capabilities enable principle of least privilege. A) show newline
(backup agent needs read-only; a sync agent needs read-write but not) show newline
(delete. Capabilities compose—grant exactly what's needed.) show newline
() show newline
(Table 0: Wormhole Capabilities) show newline
() show newline
() show newline
(  Capability    Allows                            ) show newline
(  Data Access   ) show newline
(  read          Read file contents                ) show newline
(  write         Write/modify file contents        ) show newline
(  create        Create new files                  ) show newline
(  delete        Remove files                      ) show newline
(  rename        Rename/move files                 ) show newline
(  Metadata      ) show newline
(  stat          Read POSIX attributes             ) show newline
(  chmod         Modify permissions                ) show newline
(  chown         Change ownership                  ) show newline
(  xattr-read    Read extended attributes          ) show newline
(  xattr-write   Modify extended attributes        ) show newline
(  acl-read      Read ACLs                         ) show newline
(  acl-write     Modify ACLs                       ) show newline
(  Directory     ) show newline
(  readdir       List directory contents           ) show newline
(  mkdir         Create directories                ) show newline
(  rmdir         Remove directories                ) show newline
(  Control       ) show newline
(  admin         Configure wormhole                ) show newline
(  delegate      Delegate capabilities to others   ) show newline
(  audit-read    Read wormhole audit log           ) show newline
(  rate-limit    Modify rate limits                ) show newline
() show newline
() show newline
(Capability Composition) show newline
(----------------------) show newline
() show newline
() show newline
(    ;; Common capability sets \(long form for readability\)) show newline
(    \(define capability:read-only) show newline
(      '\(read stat readdir xattr-read acl-read\)\)) show newline
(    \(define capability:read-write) show newline
(      '\(read write create stat chmod readdir mkdir xattr-read xattr-write\)\)) show newline
(    \(define capability:full) show newline
(      '\(read write create delete rename) show newline
(        stat chmod chown) show newline
(        xattr-read xattr-write acl-read acl-write) show newline
(        readdir mkdir rmdir admin delegate audit-read rate-limit\)\)) show newline
(    \(define capability:backup) show newline
(      '\(read stat readdir xattr-read acl-read\)\)) show newline
(    \(define capability:synchronize) show newline
(      '\(read write create delete rename) show newline
(        stat chmod readdir mkdir rmdir) show newline
(        xattr-read xattr-write\)\)) show newline
() show newline
() show newline
(Capability Attenuation) show newline
(----------------------) show newline
() show newline
(Capabilities can only be reduced, never amplified:[^r1]) show newline
() show newline
([^r1]: Research: Capability attenuation is fundamental to the) show newline
(object-capability model. See Miller, "Robust Composition" \(2006\). You) show newline
(cannot grant more authority than you possess.) show newline
() show newline
() show newline
(    \(define \(wormhole-delegate wormhole new-caps recipient\)) show newline
(      "Delegate subset of wormhole capabilities") show newline
(      \(let \(\(my-caps \(wormhole-capabilities wormhole\)\)\)) show newline
(        \(unless \(subset? new-caps my-caps\)) show newline
(          \(error 'capability-amplification) show newline
(                 "Cannot delegate capabilities you don't have"\)\)) show newline
(        \(wormhole-cert) show newline
(         \(wormhole-issuer wormhole\)) show newline
(         \(wormhole-fs-path wormhole\)) show newline
(         \(wormhole-vault-path wormhole\)) show newline
(         new-caps) show newline
(         recipient: recipient\)\)\)) show newline
() show newline
() show newline
(Opening a Wormhole) show newline
(------------------) show newline
() show newline
() show newline
(    \(define \(wormhole-open fs-path #!key \(vault-path "/"\)) show newline
(                                         \(capabilities capability:read-write\)) show newline
(                                         \(rate-limit 1000\)) show newline
(                                         \(locked #f\)) show newline
(                                         \(auth-required '\(\)\)) show newline
(                                         \(certificate #f\)\)) show newline
(      "Open wormhole - requires valid certificate") show newline
(      \(unless certificate) show newline
(        \(error 'unauthorized "Wormhole requires SPKI certificate"\)\)) show newline
(      \(unless \(verify-wormhole-cert certificate fs-path vault-path\)) show newline
(        \(error 'unauthorized "Invalid wormhole certificate"\)\)) show newline
(      ;; Audit the open) show newline
(      \(wormhole-audit 'wormhole-open fs-path) show newline
(                      `\(\(vault ,vault-path\)) show newline
(                        \(capabilities ,\(length capabilities\)\)\)\)) show newline
(      ;; Proceed with FUSE mount) show newline
(      ...\)) show newline
() show newline
() show newline
(Usage Examples) show newline
(--------------) show newline
() show newline
() show newline
(    ;; Basic read-write wormhole) show newline
(    \(wormhole-open "~/Cyberspace"\)) show newline
(    ;; Read-only wormhole for browsing) show newline
(    \(wormhole-open "~/Archive" capabilities: capability:read-only\)) show newline
(    ;; Sync wormhole with rate limiting) show newline
(    \(wormhole-open "~/Sync") show newline
(      capabilities: capability:synchronize) show newline
(      rate-limit: 500\)) show newline
(    ;; Locked wormhole requiring unlock for sensitive operations) show newline
(    \(wormhole-open "~/Secure") show newline
(      capabilities: capability:full) show newline
(      locked: #t) show newline
(      auth-required: '\(delete admin\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(ARCHITECTURE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Mount Topology) show newline
(--------------) show newline
() show newline
() show newline
(    ~/Cyberspace/                    < FUSE mount point) show newline
(    +-- documents/) show newline
(    |   +-- paper.pdf               < Virtual file \(content in vault\)) show newline
(    |   +-- notes.txt) show newline
(    +-- projects/) show newline
(    |   +-- cyberspace/) show newline
(    |       +-- ...) show newline
(    +-- .vault/                      < Hidden, actual storage) show newline
(        +-- objects/                 < Content-addressed blobs) show newline
(        |   +-- sha256:abc123...) show newline
(        |   +-- sha256:def456...) show newline
(        +-- manifests/               < Directory > file mappings) show newline
(        +-- metadata/                < Per-file metadata store) show newline
() show newline
() show newline
(Component Stack) show newline
(---------------) show newline
() show newline
() show newline
(    +-------------------------------------+) show newline
(    |         Applications                |) show newline
(    |    \(Finder, cp, rsync, etc.\)        |) show newline
(    +-------------------------------------+) show newline
(    |         VFS \(kernel\)                |) show newline
(    +-------------------------------------+) show newline
(    |      FUSE-T / macFUSE               |) show newline
(    +-------------------------------------+) show newline
(    |    cyberspace-fuse daemon           |  < Our code) show newline
(    +-------------------------------------+) show newline
(    |         Vault layer                 |) show newline
(    |   \(content-address, metadata\)       |) show newline
(    +-------------------------------------+) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(METADATA PRESERVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(macOS Metadata Captured) show newline
(-----------------------) show newline
() show newline
(Table 1: Preserved Metadata) show newline
() show newline
() show newline
(  Category         Attributes                       Capture Method                 ) show newline
(  POSIX            mode, uid, gid, size             stat\(\)                         ) show newline
(  Timestamps       mtime, atime, ctime, birthtime   stat\(\)                         ) show newline
(  Extended attrs   Finder info, tags, quarantine    listxattr\(\), getxattr\(\)        ) show newline
(  Spotlight        kMDItem* metadata                mdls / MDItem API              ) show newline
(  ACLs             Access control lists             aclgetfile\(\)                   ) show newline
(  Flags            hidden, locked, immutable        chflags\(\) / stat\(\)             ) show newline
(  Resource fork    Legacy resource data             xattr com.apple.ResourceFork   ) show newline
() show newline
() show newline
(Internal Representation) show newline
(-----------------------) show newline
() show newline
() show newline
(    \(define-record-type <vault-file>) show newline
(      \(make-vault-file path content-hash metadata\)) show newline
(      vault-file?) show newline
(      \(path vault-file-path\)) show newline
(      \(content-hash vault-file-hash\)) show newline
(      \(metadata vault-file-metadata\)\)) show newline
(    \(define \(capture-metadata path\)) show newline
(      "Capture all macOS metadata for a file") show newline
(      `\(\(posix) show newline
(         \(mode ,\(file-mode path\)\)) show newline
(         \(uid ,\(file-uid path\)\)) show newline
(         \(gid ,\(file-gid path\)\)) show newline
(         \(size ,\(file-size path\)\)) show newline
(         \(mtime ,\(file-mtime path\)\)) show newline
(         \(atime ,\(file-atime path\)\)) show newline
(         \(ctime ,\(file-ctime path\)\)) show newline
(         \(birthtime ,\(file-birthtime path\)\)\)) show newline
(        \(xattr ,\(capture-xattrs path\)\)) show newline
(        \(flags ,\(capture-flags path\)\)) show newline
(        \(acl ,\(capture-acl path\)\)\)\)) show newline
() show newline
() show newline
(Restoration) show newline
(-----------) show newline
() show newline
() show newline
(    \(define \(restore-metadata path metadata\)) show newline
(      "Restore all metadata to a file") show newline
(      \(let \(\(posix \(alist-ref 'posix metadata\)\)) show newline
(            \(xattr \(alist-ref 'xattr metadata\)\)) show newline
(            \(flags \(alist-ref 'flags metadata\)\)) show newline
(            \(acl \(alist-ref 'acl metadata\)\)\)) show newline
(        \(restore-posix path posix\)) show newline
(        \(restore-xattrs path xattr\)) show newline
(        \(restore-flags path flags\)) show newline
(        \(restore-acl path acl\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(FUSE OPERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Required Operations) show newline
(-------------------) show newline
() show newline
(Table 2: FUSE Operations) show newline
() show newline
() show newline
(  Operation   Purpose               Vault Action                       ) show newline
(  getattr     stat\(\)                Return stored metadata             ) show newline
(  readdir     List directory        Read manifest                      ) show newline
(  open        Open file             Validate hash exists               ) show newline
(  read        Read content          Fetch by content hash              ) show newline
(  write       Write content         Content-address, update manifest   ) show newline
(  create      Create file           Allocate manifest entry            ) show newline
(  unlink      Delete file           Remove from manifest \(GC later\)    ) show newline
(  mkdir       Create directory      Create manifest node               ) show newline
(  rmdir       Remove directory      Remove manifest node               ) show newline
(  rename      Move/rename           Update manifest path               ) show newline
(  setxattr    Set extended attr     Store in metadata                  ) show newline
(  getxattr    Get extended attr     Retrieve from metadata             ) show newline
(  listxattr   List extended attrs   Enumerate metadata                 ) show newline
() show newline
() show newline
(Implementation Sketch) show newline
(---------------------) show newline
() show newline
() show newline
(    \(define \(fuse-getattr path\)) show newline
(      "Return file attributes from vault metadata") show newline
(      \(let \(\(entry \(manifest-lookup path\)\)\)) show newline
(        \(if entry) show newline
(            \(let \(\(meta \(vault-file-metadata entry\)\)\)) show newline
(              \(make-stat) show newline
(               \(alist-ref 'mode \(alist-ref 'posix meta\)\)) show newline
(               \(alist-ref 'size \(alist-ref 'posix meta\)\)) show newline
(               \(alist-ref 'mtime \(alist-ref 'posix meta\)\)) show newline
(               ...\)\)) show newline
(            -ENOENT\)\)\)) show newline
(    \(define \(fuse-read path size offset\)) show newline
(      "Read file content from vault") show newline
(      \(let \(\(entry \(manifest-lookup path\)\)) show newline
(             \(hash \(vault-file-hash entry\)\)) show newline
(             \(content \(vault-fetch hash\)\)\)) show newline
(        \(subbytes content offset \(+ offset size\)\)\)\)) show newline
(    \(define \(fuse-write path data offset\)) show newline
(      "Write to file, content-address the result") show newline
(      \(let \(\(entry \(manifest-lookup path\)\)) show newline
(             \(current \(vault-fetch \(vault-file-hash entry\)\)\)) show newline
(             \(updated \(bytes-splice current offset data\)\)) show newline
(             \(new-hash \(content-address updated\)\)\)) show newline
(        \(manifest-update! path new-hash\)) show newline
(        \(string-length data\)\)\)) show newline
(    \(define \(fuse-setxattr path name value\)) show newline
(      "Store extended attribute in vault metadata") show newline
(      \(let \(\(entry \(manifest-lookup path\)\)\)) show newline
(        \(metadata-set-xattr! entry name value\)) show newline
(        0\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CONTENT ADDRESSING) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Files are stored by content hash \(Memo-020\):) show newline
() show newline
() show newline
(    \(define \(content-address data\)) show newline
(      "Store data, return hash") show newline
(      \(let* \(\(hash \(sha256 data\)\)) show newline
(             \(path \(vault-object-path hash\)\)\)) show newline
(        \(unless \(file-exists? path\)) show newline
(          \(write-blob path data\)\)) show newline
(        hash\)\)) show newline
(    \(define \(vault-fetch hash\)) show newline
(      "Retrieve data by hash") show newline
(      \(read-blob \(vault-object-path hash\)\)\)) show newline
() show newline
(Benefits: - Identical files stored once \(deduplication\) - Integrity) show newline
(verification on every read - Immutable objects enable safe caching) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SYNCHRONIZATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Change Detection) show newline
(----------------) show newline
() show newline
(The FUSE layer captures all writes in real-time. No separate sync needed) show newline
(for local changes.) show newline
() show newline
(For multi-device sync, the manifest includes version vectors \(Memo-012\):) show newline
() show newline
() show newline
(    \(define \(manifest-entry path hash metadata\)) show newline
(      `\(entry) show newline
(        \(path ,path\)) show newline
(        \(hash ,hash\)) show newline
(        \(metadata ,metadata\)) show newline
(        \(version-vector ,local-node ,lamport-clock\)\)\)) show newline
() show newline
() show newline
(Conflict Resolution) show newline
(-------------------) show newline
() show newline
(When merging manifests from different devices \(Memo-016 lazy) show newline
(clustering\):) show newline
() show newline
(  * Same hash - No conflict \(identical content\)) show newline
(  * Different hash, one newer - Take newer) show newline
(  * Different hash, concurrent - Conflict, apply lazy-resolve) show newline
() show newline
(Content-addressing eliminates most conflicts at the object level; the) show newline
(manifest's version vectors resolve the remainder. Lazy clustering defers) show newline
(conflicts to user decision rather than attempting automatic resolution) show newline
(that may lose work.) show newline
() show newline
() show newline
(    \(define \(merge-manifests local remote\)) show newline
(      \(for-each) show newline
(       \(lambda \(path\)) show newline
(         \(let \(\(l \(manifest-lookup local path\)\)) show newline
(               \(r \(manifest-lookup remote path\)\)\)) show newline
(           \(cond) show newline
(            \(\(not l\) \(manifest-add! local r\)\)) show newline
(            \(\(not r\) 'keep-local\)) show newline
(            \(\(equal? \(vault-file-hash l\) \(vault-file-hash r\)\) 'identical\)) show newline
(            \(\(version-newer? r l\) \(manifest-update! local r\)\)) show newline
(            \(\(version-newer? l r\) 'keep-local\)) show newline
(            \(else \(queue-conflict! path l r\)\)\)\)\)) show newline
(       \(union \(manifest-paths local\) \(manifest-paths remote\)\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOUNT COMMANDS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(REPL Interface) show newline
(--------------) show newline
() show newline
() show newline
(    \(define \(vault-mount point\)) show newline
(      "Mount vault at filesystem path") show newline
(      \(fuse-main point) show newline
(        `\(\(getattr . ,fuse-getattr\)) show newline
(          \(readdir . ,fuse-readdir\)) show newline
(          \(open . ,fuse-open\)) show newline
(          \(read . ,fuse-read\)) show newline
(          \(write . ,fuse-write\)) show newline
(          \(create . ,fuse-create\)) show newline
(          \(unlink . ,fuse-unlink\)) show newline
(          \(mkdir . ,fuse-mkdir\)) show newline
(          \(rmdir . ,fuse-rmdir\)) show newline
(          \(rename . ,fuse-rename\)) show newline
(          \(setxattr . ,fuse-setxattr\)) show newline
(          \(getxattr . ,fuse-getxattr\)) show newline
(          \(listxattr . ,fuse-listxattr\)\)\)\)) show newline
(    \(define \(vault-unmount point\)) show newline
(      "Unmount vault filesystem") show newline
(      \(fuse-unmount point\)\)) show newline
() show newline
() show newline
(Command Line) show newline
(------------) show newline
() show newline
() show newline
(    # Mount) show newline
(    cyberspace mount ~/Cyberspace) show newline
(    # Unmount) show newline
(    cyberspace unmount ~/Cyberspace) show newline
(    # Or via REPL) show newline
(    $ ./repl) show newline
(    > \(vault-mount "~/Cyberspace"\)) show newline
(    Mounted vault at /Users/ddp/Cyberspace) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MACOS INTEGRATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(FUSE-T vs macFUSE) show newline
(-----------------) show newline
() show newline
(Table 3: FUSE Implementation Options) show newline
() show newline
() show newline
(  Feature            macFUSE            FUSE-T     ) show newline
(  Kernel extension   Yes \(deprecated\)   No         ) show newline
(  System extension   Optional           Uses NFS   ) show newline
(  SIP compatible     Requires disable   Yes        ) show newline
(  Performance        Better             Adequate   ) show newline
(  Maintenance        Active             Active     ) show newline
() show newline
(FUSE-T recommended for new installations—no kernel extension) show newline
(required.[^i1]) show newline
() show newline
([^i1]: Implementation: FUSE-T implements FUSE API over NFS loopback.) show newline
(Slightly higher latency but avoids Apple's kernel extension hostility.) show newline
() show newline
() show newline
(Installation) show newline
(------------) show newline
() show newline
() show newline
(    # FUSE-T \(recommended\)) show newline
(    brew install fuse-t) show newline
(    # Or macFUSE \(if kernel ext acceptable\)) show newline
(    brew install macfuse) show newline
() show newline
() show newline
(Finder Integration) show newline
(------------------) show newline
() show newline
(The mount appears as a regular volume in Finder. Optional) show newline
(.VolumeIcon.icns for custom icon.) show newline
() show newline
(Spotlight indexing can be enabled by implementing getxattr for) show newline
(com.apple.FinderInfo and related Spotlight attributes.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(INFORMATION FLOW MODEL) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Wormholes bridge two security domains—the macOS filesystem and the) show newline
(vault. This section makes the information flow semantics explicit.[^s1]) show newline
() show newline
([^s1]: Security: Classic mandatory access control \(Bell-LaPadula, Biba\)) show newline
(uses security labels and lattice-based flow rules. We choose a simpler) show newline
(model: capability attenuation at the boundary, no lattice, no mandatory) show newline
(labels.) show newline
() show newline
() show newline
(Vault-Authoritative) show newline
(-------------------) show newline
() show newline
(The vault is the source of truth. The filesystem mount is a) show newline
(capability-constrained view of vault contents, not a peer. Writes are) show newline
(ingested into the vault's content-addressed store; reads retrieve) show newline
(content by hash. The filesystem namespace is a manifest overlay.) show newline
(Unmounted, the projection vanishes; the vault remains.) show newline
() show newline
() show newline
(Bidirectional by Default) show newline
(------------------------) show newline
() show newline
(Unless capabilities restrict it, data flows both ways through the) show newline
(wormhole. A read-only capability creates a one-way flow) show newline
(\(vault>filesystem\); a write-only capability creates the reverse) show newline
(\(filesystem>vault, the dropbox pattern\). The default read+write permits) show newline
(bidirectional flow.) show newline
() show newline
() show newline
(No Implicit Labels) show newline
(------------------) show newline
() show newline
(Unlike VMS security classifications, vault objects carry no mandatory) show newline
(security labels. Flow control is purely through capability attenuation) show newline
(at the wormhole boundary.[^s2]) show newline
() show newline
([^s2]: Security: Mandatory labels require a trusted labeling authority) show newline
(and policy engine. We avoid this complexity. The tradeoff: no automatic) show newline
("top secret can't flow to unclassified" enforcement. If an application) show newline
(requires labeled objects with mandatory flow rules, it must implement) show newline
(them at a layer above the wormhole.) show newline
() show newline
(The deeper rationale is human factors: labels are cognitively hostile.) show newline
(SELinux is technically sound but practically disabled on most systems) show newline
(because administrators cannot reason about label propagation correctly.) show newline
(Capabilities are intuitive—"I have this, I can use it, I can delegate) show newline
(a subset"—requiring no classification decisions and producing no "why) show newline
(can't I access my own file" mysteries.[^s2a]) show newline
() show newline
([^s2a]: Security: Experience with deployed MAC systems \(SEVMS, SELinux,) show newline
(Windows MIC\) shows that label complexity defeats usability. SEVMS was a) show newline
(layered product on VMS providing B1-level security) show newline
(classifications—powerful but rarely deployed outside government) show newline
(contracts. Users misconfigure labels, administrators disable) show newline
(enforcement, and the security model exists only on paper. Capability) show newline
(attenuation succeeds because it matches human intuition about possession) show newline
(and delegation.) show newline
() show newline
() show newline
(Audit as Flow Record) show newline
(--------------------) show newline
() show newline
(Every crossing \(read or write\) is logged. The audit trail IS the flow) show newline
(history. Post-hoc analysis can reconstruct what data moved through which) show newline
(wormholes, when, and under what authority.) show newline
() show newline
(This is the key assurance property: you cannot prove that information) show newline
(didn't flow \(covert channels exist in any real system\), but you can) show newline
(prove what DID flow and reconstruct the path post-hoc. The audit trail) show newline
(provides accountability rather than prevention—a pragmatic tradeoff) show newline
(that scales to real-world use.[^s3]) show newline
() show newline
([^s3]: Security: Mandatory access control aims to prevent unauthorized) show newline
(flows. We aim to detect and attribute them. Prevention requires trusting) show newline
(the entire stack; detection requires only trusting the audit log. For) show newline
(most threat models, accountable flow is sufficient.) show newline
() show newline
(Audit is orthogonal to authorization. The capability check determines) show newline
(what is permitted; audit records what occurred. The audit trail is never) show newline
(consulted to decide whether to allow an operation—only to reconstruct) show newline
(flow history after the fact.) show newline
() show newline
() show newline
(Capability as Flow Constraint) show newline
(-----------------------------) show newline
() show newline
(Table 4: Capability and Information Flow) show newline
() show newline
() show newline
(  Capabilities         Flow Direction            Pattern               ) show newline
(  read without write   vault>filesystem only     Browse, export        ) show newline
(  write without read   filesystem>vault only     Dropbox, ingest       ) show newline
(  read+write           bidirectional             Full sync             ) show newline
(  neither              no data flow              Metadata-only mount   ) show newline
() show newline
() show newline
(Reference Monitor) show newline
(-----------------) show newline
() show newline
(The wormhole acts as a reference monitor at the domain boundary. Every) show newline
(operation crosses the monitor, which validates capability, enforces rate) show newline
(limits \(Memo-032\), and records the audit trail \(Memo-003\). The monitor) show newline
(is complete \(all crossings pass through it\) and verifiable \(audit) show newline
(enables post-hoc analysis\).) show newline
() show newline
() show newline
(    \(define \(wormhole-flow-guard wormhole operation object\)) show newline
(      "Reference monitor for wormhole operations") show newline
(      \(let \(\(caps \(wormhole-capabilities wormhole\)\)\)) show newline
(        \(unless \(memq operation caps\)) show newline
(          \(wormhole-audit 'denied operation object\)) show newline
(          \(error 'capability-denied operation\)\)) show newline
(        \(unless \(rate-limit-ok? wormhole\)) show newline
(          \(wormhole-audit 'rate-limited operation object\)) show newline
(          \(error 'rate-limited\)\)) show newline
(        \(wormhole-audit 'permitted operation object\)) show newline
(        `\(permitted ,operation ,object\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SECURITY CONSIDERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Permissions) show newline
(-----------) show newline
() show newline
(FUSE daemon runs as user, not root. Respects vault ACLs.) show newline
() show newline
() show newline
(Content Integrity) show newline
(-----------------) show newline
() show newline
(Every read verifies content hash. Corruption detected immediately.) show newline
() show newline
() show newline
(Metadata Trust) show newline
(--------------) show newline
() show newline
(Metadata is stored separately from content. A compromised metadata store) show newline
(cannot alter file contents \(hashes won't match\).) show newline
() show newline
() show newline
(Mount Security) show newline
(--------------) show newline
() show newline
() show newline
(    \(define \(vault-mount point #!key \(allow-other #f\)\)) show newline
(      ;; allow-other permits other users to access mount) show newline
(      ;; Default: owner only) show newline
(      ...\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DEPENDENCIES) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(  Component           Purpose                ) show newline
(  FUSE-T or macFUSE   Userspace filesystem   ) show newline
(  libfuse             FUSE library           ) show newline
(  Scheme FFI          Bindings to libfuse    ) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * Memo-012: Lamport Clocks) show newline
(  * Memo-016: Lazy Clustering) show newline
(  * Memo-020: Content-Addressed Storage) show newline
(  * FUSE documentation: https://libfuse.github.io/) show newline
(  * FUSE-T: https://github.com/macos-fuse-t/fuse-t) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * 2026-01-07) show newline
(  * Initial specification) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
