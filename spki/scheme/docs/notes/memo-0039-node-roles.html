<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0039: Realm Roles and Capabilities</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0039: Realm Roles and Capabilities</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo defines functional roles for nodes in a Library of Cyberspace confederation based on compute, storage, network, and security capabilities. Roles determine what operations a node can perform and how it participates in the distributed system.</p>
</section>
<section>
<h2>Terminology</h2>
<p>Realm: A node's place in cyberspace. A realm encompasses: - The node's vault (local content-addressed object store) - The node's principal (Ed25519 identity) - The node's capabilities (hardware, network, security) - The node's objects (what it stores and serves)</p>
<p>A realm is local-first and sovereign. The node controls what to share, who to trust, what to replicate. When nodes federate, their realms overlap - objects flow between them according to trust relationships.</p>
<p>The hardware manifest stored at .vault/node-hardware declares what kind of place this realm occupies in cyberspace.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Memo-010 (Federation Protocol) defines trust relationships between peers (publisher, subscriber, peer). However, it does not address functional capabilities - what operations each node can actually perform based on its hardware and network constraints.</p>
<p>A Raspberry Pi on a solar-powered satellite uplink has different capabilities than a rack-mounted server in a datacenter. The system should:</p>
<p>1. Self-assess - Nodes should know their own capabilities 2. Declare - Nodes should advertise their role to peers 3. Adapt - Operations should degrade gracefully based on available roles 4. Persist - Role assignments should survive restarts</p>
</section>
<section>
<h2>Node Roles</h2>
<h3>Role Hierarchy</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 750 320" width="750" height="320" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<line x1="205" y1="10" x2="210" y2="10"/>
<line x1="205" y1="10" x2="205" y2="20"/>
<line x1="210" y1="10" x2="220" y2="10"/>
<line x1="220" y1="10" x2="230" y2="10"/>
<line x1="230" y1="10" x2="240" y2="10"/>
<line x1="240" y1="10" x2="250" y2="10"/>
<line x1="250" y1="10" x2="260" y2="10"/>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="345" y2="10"/>
<line x1="345" y1="10" x2="345" y2="20"/>
<line x1="205" y1="20" x2="205" y2="40"/>
<text x="225" y="30">C</text>
<text x="235" y="30">O</text>
<text x="245" y="30">O</text>
<text x="255" y="30">R</text>
<text x="265" y="30">D</text>
<text x="275" y="30">I</text>
<text x="285" y="30">N</text>
<text x="295" y="30">A</text>
<text x="305" y="30">T</text>
<text x="315" y="30">O</text>
<text x="325" y="30">R</text>
<line x1="345" y1="20" x2="345" y2="40"/>
<text x="375" y="30">B</text>
<text x="385" y="30">y</text>
<text x="395" y="30">z</text>
<text x="405" y="30">a</text>
<text x="415" y="30">n</text>
<text x="425" y="30">t</text>
<text x="435" y="30">i</text>
<text x="445" y="30">n</text>
<text x="455" y="30">e</text>
<text x="475" y="30">c</text>
<text x="485" y="30">o</text>
<text x="495" y="30">n</text>
<text x="505" y="30">s</text>
<text x="515" y="30">e</text>
<text x="525" y="30">n</text>
<text x="535" y="30">s</text>
<text x="545" y="30">u</text>
<text x="555" y="30">s</text>
<text x="565" y="30">,</text>
<text x="585" y="30">t</text>
<text x="595" y="30">h</text>
<text x="605" y="30">r</text>
<text x="615" y="30">e</text>
<text x="625" y="30">s</text>
<text x="635" y="30">h</text>
<text x="645" y="30">o</text>
<text x="655" y="30">l</text>
<text x="665" y="30">d</text>
<text x="685" y="30">s</text>
<text x="695" y="30">i</text>
<text x="705" y="30">g</text>
<text x="715" y="30">n</text>
<text x="725" y="30">i</text>
<text x="735" y="30">n</text>
<text x="745" y="30">g</text>
<line x1="205" y1="40" x2="205" y2="60"/>
<text x="245" y="50">(</text>
<text x="255" y="50">r</text>
<text x="265" y="50">a</text>
<text x="275" y="50">r</text>
<text x="285" y="50">e</text>
<text x="295" y="50">)</text>
<line x1="345" y1="40" x2="345" y2="60"/>
<text x="375" y="50">A</text>
<text x="385" y="50">l</text>
<text x="395" y="50">w</text>
<text x="405" y="50">a</text>
<text x="415" y="50">y</text>
<text x="425" y="50">s</text>
<text x="435" y="50">-</text>
<text x="445" y="50">o</text>
<text x="455" y="50">n</text>
<text x="465" y="50">,</text>
<text x="485" y="50">h</text>
<text x="495" y="50">i</text>
<text x="505" y="50">g</text>
<text x="515" y="50">h</text>
<text x="535" y="50">c</text>
<text x="545" y="50">o</text>
<text x="555" y="50">m</text>
<text x="565" y="50">p</text>
<text x="575" y="50">u</text>
<text x="585" y="50">t</text>
<text x="595" y="50">e</text>
<line x1="205" y1="70" x2="210" y2="70"/>
<line x1="205" y1="60" x2="205" y2="70"/>
<line x1="210" y1="70" x2="220" y2="70"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="275" y1="70" x2="275" y2="80"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="345" y2="70"/>
<line x1="345" y1="60" x2="345" y2="70"/>
<line x1="275" y1="80" x2="275" y2="100"/>
<line x1="145" y1="110" x2="150" y2="110"/>
<line x1="145" y1="110" x2="145" y2="120"/>
<line x1="150" y1="110" x2="160" y2="110"/>
<line x1="160" y1="110" x2="170" y2="110"/>
<line x1="170" y1="110" x2="180" y2="110"/>
<line x1="180" y1="110" x2="190" y2="110"/>
<line x1="190" y1="110" x2="200" y2="110"/>
<line x1="200" y1="110" x2="210" y2="110"/>
<line x1="210" y1="110" x2="220" y2="110"/>
<line x1="220" y1="110" x2="230" y2="110"/>
<line x1="230" y1="110" x2="240" y2="110"/>
<line x1="240" y1="110" x2="250" y2="110"/>
<line x1="250" y1="110" x2="260" y2="110"/>
<line x1="260" y1="110" x2="270" y2="110"/>
<line x1="270" y1="110" x2="280" y2="110"/>
<line x1="275" y1="100" x2="275" y2="120"/>
<line x1="280" y1="110" x2="290" y2="110"/>
<line x1="290" y1="110" x2="300" y2="110"/>
<line x1="300" y1="110" x2="310" y2="110"/>
<line x1="310" y1="110" x2="320" y2="110"/>
<line x1="320" y1="110" x2="330" y2="110"/>
<line x1="330" y1="110" x2="340" y2="110"/>
<line x1="340" y1="110" x2="350" y2="110"/>
<line x1="350" y1="110" x2="360" y2="110"/>
<line x1="360" y1="110" x2="370" y2="110"/>
<line x1="370" y1="110" x2="380" y2="110"/>
<line x1="380" y1="110" x2="390" y2="110"/>
<line x1="390" y1="110" x2="400" y2="110"/>
<line x1="400" y1="110" x2="405" y2="110"/>
<line x1="405" y1="110" x2="405" y2="120"/>
<text x="145" y="130">↓</text>
<text x="275" y="130">↓</text>
<text x="405" y="130">↓</text>
<line x1="75" y1="150" x2="80" y2="150"/>
<line x1="75" y1="150" x2="75" y2="160"/>
<line x1="80" y1="150" x2="90" y2="150"/>
<line x1="90" y1="150" x2="100" y2="150"/>
<line x1="100" y1="150" x2="110" y2="150"/>
<line x1="110" y1="150" x2="120" y2="150"/>
<line x1="120" y1="150" x2="130" y2="150"/>
<line x1="130" y1="150" x2="140" y2="150"/>
<line x1="140" y1="150" x2="150" y2="150"/>
<line x1="150" y1="150" x2="160" y2="150"/>
<line x1="160" y1="150" x2="170" y2="150"/>
<line x1="170" y1="150" x2="180" y2="150"/>
<line x1="180" y1="150" x2="190" y2="150"/>
<line x1="190" y1="150" x2="195" y2="150"/>
<line x1="195" y1="150" x2="195" y2="160"/>
<line x1="215" y1="150" x2="220" y2="150"/>
<line x1="215" y1="150" x2="215" y2="160"/>
<line x1="220" y1="150" x2="230" y2="150"/>
<line x1="230" y1="150" x2="240" y2="150"/>
<line x1="240" y1="150" x2="250" y2="150"/>
<line x1="250" y1="150" x2="260" y2="150"/>
<line x1="260" y1="150" x2="270" y2="150"/>
<line x1="270" y1="150" x2="280" y2="150"/>
<line x1="280" y1="150" x2="290" y2="150"/>
<line x1="290" y1="150" x2="300" y2="150"/>
<line x1="300" y1="150" x2="310" y2="150"/>
<line x1="310" y1="150" x2="320" y2="150"/>
<line x1="320" y1="150" x2="330" y2="150"/>
<line x1="330" y1="150" x2="335" y2="150"/>
<line x1="335" y1="150" x2="335" y2="160"/>
<line x1="355" y1="150" x2="360" y2="150"/>
<line x1="355" y1="150" x2="355" y2="160"/>
<line x1="360" y1="150" x2="370" y2="150"/>
<line x1="370" y1="150" x2="380" y2="150"/>
<line x1="380" y1="150" x2="390" y2="150"/>
<line x1="390" y1="150" x2="400" y2="150"/>
<line x1="400" y1="150" x2="410" y2="150"/>
<line x1="410" y1="150" x2="420" y2="150"/>
<line x1="420" y1="150" x2="430" y2="150"/>
<line x1="430" y1="150" x2="440" y2="150"/>
<line x1="440" y1="150" x2="450" y2="150"/>
<line x1="450" y1="150" x2="460" y2="150"/>
<line x1="460" y1="150" x2="470" y2="150"/>
<line x1="470" y1="150" x2="475" y2="150"/>
<line x1="475" y1="150" x2="475" y2="160"/>
<line x1="75" y1="160" x2="75" y2="180"/>
<text x="115" y="170">F</text>
<text x="125" y="170">U</text>
<text x="135" y="170">L</text>
<text x="145" y="170">L</text>
<line x1="195" y1="160" x2="195" y2="180"/>
<line x1="215" y1="160" x2="215" y2="180"/>
<text x="245" y="170">W</text>
<text x="255" y="170">I</text>
<text x="265" y="170">T</text>
<text x="275" y="170">N</text>
<text x="285" y="170">E</text>
<text x="295" y="170">S</text>
<text x="305" y="170">S</text>
<line x1="335" y1="160" x2="335" y2="180"/>
<line x1="355" y1="160" x2="355" y2="180"/>
<text x="375" y="170">A</text>
<text x="385" y="170">R</text>
<text x="395" y="170">C</text>
<text x="405" y="170">H</text>
<text x="415" y="170">I</text>
<text x="425" y="170">V</text>
<text x="435" y="170">E</text>
<text x="445" y="170">R</text>
<line x1="475" y1="160" x2="475" y2="180"/>
<line x1="75" y1="180" x2="75" y2="200"/>
<text x="115" y="190">N</text>
<text x="125" y="190">O</text>
<text x="135" y="190">D</text>
<text x="145" y="190">E</text>
<line x1="195" y1="180" x2="195" y2="200"/>
<line x1="215" y1="180" x2="215" y2="200"/>
<line x1="335" y1="180" x2="335" y2="200"/>
<line x1="355" y1="180" x2="355" y2="200"/>
<line x1="475" y1="180" x2="475" y2="200"/>
<line x1="75" y1="210" x2="80" y2="210"/>
<line x1="75" y1="200" x2="75" y2="210"/>
<line x1="80" y1="210" x2="90" y2="210"/>
<line x1="90" y1="210" x2="100" y2="210"/>
<line x1="100" y1="210" x2="110" y2="210"/>
<line x1="110" y1="210" x2="120" y2="210"/>
<line x1="120" y1="210" x2="130" y2="210"/>
<line x1="130" y1="210" x2="140" y2="210"/>
<line x1="135" y1="210" x2="135" y2="220"/>
<line x1="140" y1="210" x2="150" y2="210"/>
<line x1="150" y1="210" x2="160" y2="210"/>
<line x1="160" y1="210" x2="170" y2="210"/>
<line x1="170" y1="210" x2="180" y2="210"/>
<line x1="180" y1="210" x2="190" y2="210"/>
<line x1="190" y1="210" x2="195" y2="210"/>
<line x1="195" y1="200" x2="195" y2="210"/>
<line x1="215" y1="210" x2="220" y2="210"/>
<line x1="215" y1="200" x2="215" y2="210"/>
<line x1="220" y1="210" x2="230" y2="210"/>
<line x1="230" y1="210" x2="240" y2="210"/>
<line x1="240" y1="210" x2="250" y2="210"/>
<line x1="250" y1="210" x2="260" y2="210"/>
<line x1="260" y1="210" x2="270" y2="210"/>
<line x1="270" y1="210" x2="280" y2="210"/>
<line x1="280" y1="210" x2="290" y2="210"/>
<line x1="290" y1="210" x2="300" y2="210"/>
<line x1="300" y1="210" x2="310" y2="210"/>
<line x1="310" y1="210" x2="320" y2="210"/>
<line x1="320" y1="210" x2="330" y2="210"/>
<line x1="330" y1="210" x2="335" y2="210"/>
<line x1="335" y1="200" x2="335" y2="210"/>
<line x1="355" y1="210" x2="360" y2="210"/>
<line x1="355" y1="200" x2="355" y2="210"/>
<line x1="360" y1="210" x2="370" y2="210"/>
<line x1="370" y1="210" x2="380" y2="210"/>
<line x1="380" y1="210" x2="390" y2="210"/>
<line x1="390" y1="210" x2="400" y2="210"/>
<line x1="400" y1="210" x2="410" y2="210"/>
<line x1="410" y1="210" x2="420" y2="210"/>
<line x1="420" y1="210" x2="430" y2="210"/>
<line x1="430" y1="210" x2="440" y2="210"/>
<line x1="440" y1="210" x2="450" y2="210"/>
<line x1="450" y1="210" x2="460" y2="210"/>
<line x1="460" y1="210" x2="470" y2="210"/>
<line x1="470" y1="210" x2="475" y2="210"/>
<line x1="475" y1="200" x2="475" y2="210"/>
<line x1="135" y1="220" x2="135" y2="240"/>
<text x="135" y="250">↓</text>
<line x1="75" y1="270" x2="80" y2="270"/>
<line x1="75" y1="270" x2="75" y2="280"/>
<line x1="80" y1="270" x2="90" y2="270"/>
<line x1="90" y1="270" x2="100" y2="270"/>
<line x1="100" y1="270" x2="110" y2="270"/>
<line x1="110" y1="270" x2="120" y2="270"/>
<line x1="120" y1="270" x2="130" y2="270"/>
<line x1="130" y1="270" x2="140" y2="270"/>
<line x1="140" y1="270" x2="150" y2="270"/>
<line x1="150" y1="270" x2="160" y2="270"/>
<line x1="160" y1="270" x2="170" y2="270"/>
<line x1="170" y1="270" x2="180" y2="270"/>
<line x1="180" y1="270" x2="190" y2="270"/>
<line x1="190" y1="270" x2="195" y2="270"/>
<line x1="195" y1="270" x2="195" y2="280"/>
<line x1="75" y1="280" x2="75" y2="300"/>
<text x="115" y="290">E</text>
<text x="125" y="290">D</text>
<text x="135" y="290">G</text>
<text x="145" y="290">E</text>
<line x1="195" y1="280" x2="195" y2="300"/>
<text x="225" y="290">R</text>
<text x="235" y="290">e</text>
<text x="245" y="290">a</text>
<text x="255" y="290">d</text>
<text x="265" y="290">-</text>
<text x="275" y="290">o</text>
<text x="285" y="290">n</text>
<text x="295" y="290">l</text>
<text x="305" y="290">y</text>
<text x="315" y="290">,</text>
<text x="335" y="290">m</text>
<text x="345" y="290">o</text>
<text x="355" y="290">b</text>
<text x="365" y="290">i</text>
<text x="375" y="290">l</text>
<text x="385" y="290">e</text>
<text x="395" y="290">,</text>
<text x="415" y="290">i</text>
<text x="425" y="290">n</text>
<text x="435" y="290">t</text>
<text x="445" y="290">e</text>
<text x="455" y="290">r</text>
<text x="465" y="290">m</text>
<text x="475" y="290">i</text>
<text x="485" y="290">t</text>
<text x="495" y="290">t</text>
<text x="505" y="290">e</text>
<text x="515" y="290">n</text>
<text x="525" y="290">t</text>
<line x1="75" y1="310" x2="80" y2="310"/>
<line x1="75" y1="300" x2="75" y2="310"/>
<line x1="80" y1="310" x2="90" y2="310"/>
<line x1="90" y1="310" x2="100" y2="310"/>
<line x1="100" y1="310" x2="110" y2="310"/>
<line x1="110" y1="310" x2="120" y2="310"/>
<line x1="120" y1="310" x2="130" y2="310"/>
<line x1="130" y1="310" x2="140" y2="310"/>
<line x1="140" y1="310" x2="150" y2="310"/>
<line x1="150" y1="310" x2="160" y2="310"/>
<line x1="160" y1="310" x2="170" y2="310"/>
<line x1="170" y1="310" x2="180" y2="310"/>
<line x1="180" y1="310" x2="190" y2="310"/>
<line x1="190" y1="310" x2="195" y2="310"/>
<line x1="195" y1="300" x2="195" y2="310"/>
</svg>
</div>
<h3>Role Definitions</h3>
<table>
<tr><th>Role </th><th>Compute </th><th>Storage </th><th>Network </th><th>Operations </th></tr>
<tr><td>coordinator </td><td>High </td><td>Medium </td><td>Always-on </td><td>Byzantine consensus, threshold signing, key ceremony </td></tr>
<tr><td>full </td><td>Medium </td><td>High </td><td>Reliable </td><td>All vault operations, replication origin </td></tr>
<tr><td>witness </td><td>Low </td><td>High </td><td>Intermittent </td><td>Passive storage, hash verification, audit </td></tr>
<tr><td>archiver </td><td>Low </td><td>Maximum </td><td>Batch </td><td>Cold storage, offline preservation </td></tr>
<tr><td>edge </td><td>Minimal </td><td>Minimal </td><td>Sporadic </td><td>Read-only sync, mobile access </td></tr>
</table>
<h3>Capability Requirements</h3>
<pre class="language-scheme">
(node-role-capabilities
  (coordinator
    (compute    (min-cores 4) (min-ram-gb 8))
    (storage    (min-gb 100) (type ssd))
    (network    (uptime 0.99) (latency-ms 50))
    (security   (hsm optional) (secure-enclave optional)))

  (full
    (compute    (min-cores 2) (min-ram-gb 4))
    (storage    (min-gb 500) (type any))
    (network    (uptime 0.95) (latency-ms 200))
    (security   (signing-key required)))

  (witness
    (compute    (min-cores 1) (min-ram-gb 1))
    (storage    (min-gb 100) (type any))
    (network    (uptime 0.50) (latency-ms 1000))
    (security   (verify-key required)))

  (archiver
    (compute    (min-cores 1) (min-ram-gb 512mb))
    (storage    (min-gb 1000) (type cold))
    (network    (uptime 0.10) (batch-ok #t))
    (security   (verify-key required) (offline-ok #t)))

  (edge
    (compute    (min-cores 1) (min-ram-gb 256mb))
    (storage    (min-gb 1) (type any))
    (network    (uptime 0.01) (latency-ms 5000))
    (security   (read-only #t))))
</pre>
</section>
<section>
<h2>Role Detection</h2>
<h3>Automatic Probing</h3>
<pre class="language-scheme">
(define (node-probe-capabilities)
  "Probe local system capabilities"
  `((compute
     (cores ,(get-cpu-cores))
     (ram-gb ,(get-ram-gb))
     (load-avg ,(get-load-average)))
    (storage
     (available-gb ,(get-available-storage))
     (type ,(detect-storage-type)))
    (network
     (latency-ms ,(probe-network-latency))
     (bandwidth-mbps ,(estimate-bandwidth))
     (type ,(detect-network-type)))  ; ethernet, wifi, cellular, satellite
    (security
     (signing-key ,(has-signing-key?))
     (verify-key ,(has-verify-key?))
     (hsm ,(has-hsm?)))))
</pre>
<h3>Role Assignment</h3>
<pre class="language-scheme">
(define (node-assign-role capabilities)
  "Assign role based on probed capabilities"
  (let ((compute (assq 'compute capabilities))
        (storage (assq 'storage capabilities))
        (network (assq 'network capabilities)))
    (cond
     ;; Coordinator: high everything
     ((and (&gt;= (get-cores compute) 4)
           (&gt;= (get-ram compute) 8)
           (&lt;= (get-latency network) 50))
      'coordinator)

     ;; Full node: medium compute, high storage
     ((and (&gt;= (get-cores compute) 2)
           (&gt;= (get-storage storage) 500))
      'full)

     ;; Archiver: low compute, massive storage, batch network
     ((and (&gt;= (get-storage storage) 1000)
           (eq? (get-network-type network) 'batch))
      'archiver)

     ;; Witness: low compute, decent storage
     ((&gt;= (get-storage storage) 100)
      'witness)

     ;; Edge: everything else
     (else 'edge))))
</pre>
</section>
<section>
<h2>Role Declaration</h2>
<h3>Local Configuration</h3>
<pre class="language-scheme">
;; ~/.cyberspace/node-role
(node-config
  (role witness)                    ; Declared role
  (auto-detect #f)                  ; Don't override with probed
  (capabilities                     ; Known constraints
    (network (type satellite)
             (latency-ms 600)
             (bandwidth-mbps 100))))
</pre>
<h3>Role Announcement</h3>
<pre class="language-scheme">
(define (node-announce-role)
  "Announce role to federation peers"
  (let ((role (node-current-role))
        (caps (node-probe-capabilities))
        (key (vault-config 'signing-key)))
    (when key
      (let ((announcement
             `(node-role-announcement
               (principal ,(get-vault-principal key))
               (role ,role)
               (capabilities ,caps)
               (timestamp ,(current-seconds)))))
        ;; Sign and broadcast
        (federation-broadcast
         (sign-announcement announcement key))))))
</pre>
</section>
<section>
<h2>Role-Based Operation Constraints</h2>
<h3>Operation Matrix</h3>
<table>
<tr><th>Operation </th><th>coordinator </th><th>full </th><th>witness </th><th>archiver </th><th>edge </th></tr>
<tr><td>seal-commit </td></tr>
<tr><td>seal-release </td></tr>
<tr><td>seal-archive </td></tr>
<tr><td>seal-restore </td></tr>
<tr><td>seal-publish </td></tr>
<tr><td>seal-subscribe </td></tr>
<tr><td>seal-synchronize </td></tr>
<tr><td>seal-verify </td></tr>
<tr><td>threshold-sign </td></tr>
<tr><td>byzantine-vote </td></tr>
<tr><td>key-ceremony </td></tr>
<tr><td>audit-append </td></tr>
<tr><td>audit-verify </td></tr>
</table>
<h3>Graceful Degradation</h3>
<pre class="language-scheme">
(define (node-can-perform? operation)
  "Check if current role permits operation"
  (let ((role (node-current-role))
        (required (operation-required-role operation)))
    (role-permits? role required)))

(define (role-permits? actual required)
  "Check role hierarchy"
  (let ((hierarchy '(coordinator full witness archiver edge)))
    (&lt;= (list-index hierarchy actual)
        (list-index hierarchy required))))
</pre>
</section>
<section>
<h2>Starlink Considerations</h2>
<p>Per Memo-016, the system is optimized for satellite links:</p>
<pre class="language-scheme">
(node-config
  (role witness)
  (network
    (type satellite)
    (provider starlink)
    (characteristics
      (latency-ms 20-40)           ; Low-earth orbit
      (bandwidth-mbps 100-200)     ; Bursty
      (jitter high)                ; Variable
      (uptime 0.95)                ; Weather dependent
      (data-cap none))))           ; Unlimited for now

;; Satellite-optimized behavior
(define satellite-mode
  '((batch-sync #t)                ; Aggregate operations
    (lazy-pull #t)                 ; Don't fetch eagerly
    (compress-always #t)           ; Minimize transfer
    (retry-aggressive #t)          ; Handle drops
    (heartbeat-interval 300)))     ; 5 min, not seconds
</pre>
<h3>Role Implications for Satellite Nodes</h3>
<p>- coordinator: Generally NOT suitable for satellite (latency too variable for consensus) - full: Marginal (can work with lazy clustering) - witness: IDEAL (passive, tolerates latency) - archiver: IDEAL (batch operations) - edge: IDEAL (intermittent by design)</p>
</section>
<section>
<h2>Implementation</h2>
<h3>REPL Commands</h3>
<pre class="language-scheme">
;; Probe and display capabilities
(node-probe)

;; Show current role
(node-role)

;; Set role explicitly
(node-role 'witness)

;; Check if operation permitted
(node-can? 'threshold-sign)

;; Announce role to peers
(node-announce)
</pre>
<h3>Persistence</h3>
<p>Role configuration stored in the realm:</p>
<pre>
~/.cyberspace/node-role      ; User override (global)
.vault/node-role             ; Realm-specific role
.vault/node-hardware         ; Hardware manifest (auto-refreshed)
</pre>
<p>The hardware manifest is automatically updated on REPL startup, declaring the realm's capabilities to federated peers.</p>
<h3>Audit Trail</h3>
<p>Role changes are auditable events:</p>
<pre class="language-scheme">
(audit-entry
  (type node-role-change)
  (timestamp 1736280000)
  (from edge)
  (to witness)
  (reason "Storage expanded")
  (actor #${principal}))
</pre>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Role Spoofing</h3>
<p>A node could claim a higher role than its capabilities warrant. Mitigations:</p>
<p>1. Capability proofs: Require benchmark results 2. Peer validation: Other nodes can challenge claims 3. Reputation: Track role fulfillment history 4. Threshold trust: Multiple witnesses needed</p>
<h3>Role Downgrade Attacks</h3>
<p>An attacker could force nodes to operate at lower roles:</p>
<p>1. Signed role declarations: Can't forge 2. Local override: Node controls own role 3. Audit trail: Role changes are logged</p>
</section>
<section>
<h2>References</h2>
<p>1. Memo-010: Federation Protocol 2. Memo-011: Byzantine Consensus 3. Memo-016: Lazy Clustering 4. Memo-017: Security Considerations</p>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-07</li>
<li>Initial draft</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
