<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0005: Cryptographic Audit Trail</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0005: Cryptographic Audit Trail</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies the cryptographic audit trail system for the Library of Cyberspace, providing tamper-evident, hash-chained logging with Simple Public Key Infrastructure (SPKI) principal attribution and Ed25519 signatures.</p>
</section>
<section>
<h2>Motivation</h2>
<blockquote>
<p>The first principle is that you must not fool yourself—and you are the easiest person to fool. — Richard Feynman</p>
</blockquote>
<p>Distributed systems require accountability. Who did what, when, and under whose authority? Without cryptographic audit trails, the answer is always "we think so" rather than "we can prove it."</p>
<p>Every security breach postmortem asks the same questions: What happened? When? Who had access? Could the logs have been tampered with? Traditional logging cannot answer these questions with certainty. Cyberspace audit trails can.</p>
<h3>Heritage</h3>
<p>Inspired by VMS cluster-wide audit (1993). See Memo-0009 section 7.7 for design heritage.</p>
<h3>The Problem</h3>
<p>Traditional logging fails on all counts:</p>
<ul>
<li>Tamperable: Text files can be edited after the fact</li>
<li>Anonymous: No cryptographic identity binds actor to action</li>
<li>Disconnected: No provable ordering between entries</li>
<li>Unverifiable: No mathematical proof of integrity</li>
</ul>
<p>Cyberspace audit trails provide:</p>
<ul>
<li>Content-addressed entries - Tamper-evident by hash</li>
<li>Hash-chained structure - Append-only ordering</li>
<li>SPKI attribution - Cryptographic actor identity</li>
<li>Ed25519 seals - Mathematical proof of authenticity</li>
<li>Dual context - Human-readable motivation + machine-parseable environment</li>
</ul>
</section>
<section>
<h2>Specification</h2>
<h3>Entry Structure</h3>
<pre class="language-scheme">
(audit-entry
  (id "sha512:b14471cd57ea557f...")
  (timestamp "2026-01-05 23:38:20Z")
  (sequence 1)
  (parent-id "sha512:previous...")
  (actor
    (principal #${public-key-blob})
    (authorization-chain))
  (action
    (verb seal-publish)
    (object "1.0.0")
    (parameters "/path/to/remote"))
  (context
    (motivation "Published to filesystem")
    (language "en"))
  (environment
    (platform "darwin")
    (timestamp 1767685100))
  (seal
    (algorithm "ed25519-sha512")
    (content-hash "...")
    (signature "...")))
</pre>
<h3>Core Fields</h3>
<table>
<tr><th>Field </th><th>Type </th><th>Description </th></tr>
<tr><td>id </td><td>string </td><td>Content-addressed hash (SHA-512, first 32 hex chars) </td></tr>
<tr><td>timestamp </td><td>string </td><td>ISO 8601 UTC (YYYY-MM-DD HH:MM:SSZ) </td></tr>
<tr><td>sequence </td><td>integer </td><td>Monotonic counter within audit trail </td></tr>
<tr><td>parent-id </td><td>string/nil </td><td>ID of previous entry (hash chain) </td></tr>
<tr><td>actor </td><td>record </td><td>SPKI principal who performed action </td></tr>
<tr><td>action </td><td>record </td><td>What was done (verb, object, parameters) </td></tr>
<tr><td>context </td><td>record </td><td>Human-readable motivation </td></tr>
<tr><td>environment </td><td>alist </td><td>Machine environment snapshot </td></tr>
<tr><td>seal </td><td>record </td><td>Cryptographic signature </td></tr>
</table>
<h3>Actor Record</h3>
<p>Every action has an actor. Not a username—a cryptographic identity that can be verified mathematically.</p>
<pre class="language-scheme">
(define-record-type &lt;audit-actor&gt;
  (make-audit-actor principal authorization-chain)
  audit-actor?
  (principal actor-principal)              ; Public key blob
  (authorization-chain actor-authorization-chain))  ; SPKI cert chain
</pre>
<p>The actor is identified by:</p>
<ul>
<li>Principal: Ed25519 public key (32 bytes) - unforgeable identity</li>
<li>Authorization chain: Optional SPKI certificate chain proving delegation</li>
</ul>
<p>The authorization chain answers "under whose authority?" - crucial for auditing delegated actions.</p>
<h3>Action Record</h3>
<p>Actions are structured as verb-object-parameters, mirroring natural language: "Alice committed version 1.0 to the vault."</p>
<pre class="language-scheme">
(define-record-type &lt;audit-action&gt;
  (make-audit-action verb object parameters)
  audit-action?
  (verb action-verb)        ; Symbol: seal-commit, seal-publish, etc.
  (object action-object)    ; Primary target
  (parameters action-parameters))  ; Additional arguments
</pre>
<p>Standard verbs:</p>
<table>
<tr><th>Verb </th><th>Meaning </th></tr>
<tr><td>seal-commit </td><td>Version control commit to local vault </td></tr>
<tr><td>seal-publish </td><td>Release publication to remote </td></tr>
<tr><td>seal-subscribe </td><td>Subscription to remote feed </td></tr>
<tr><td>seal-synchronize </td><td>Bidirectional sync with peer </td></tr>
<tr><td>seal-release </td><td>Version tagging for distribution </td></tr>
</table>
<h3>Context Record</h3>
<p>Machines record what happened. Humans need to know why. The context record captures motivation in natural language—the commit message, the reason for the release, the justification for the access.</p>
<pre class="language-scheme">
(define-record-type &lt;audit-context&gt;
  (make-audit-context motivation relates-to language)
  audit-context?
  (motivation context-motivation)    ; Human explanation
  (relates-to context-relates-to)    ; Related entries
  (language context-language))       ; ISO 639-1 code
</pre>
<p>Context provides:</p>
<ul>
<li>Motivation: Why the action was taken, in the actor's own words</li>
<li>Relates-to: Cross-references to related audit entries</li>
<li>Language: ISO 639-1 code for internationalization</li>
</ul>
<p>Six months later, "Fixed the bug" means nothing. "Fixed CVE-2026-1234 buffer overflow in certificate parser" means everything.</p>
<h3>Seal Record</h3>
<pre class="language-scheme">
(define-record-type &lt;audit-seal&gt;
  (make-audit-seal algorithm content-hash signature)
  audit-seal?
  (algorithm seal-algorithm)        ; "ed25519-sha512"
  (content-hash seal-content-hash)  ; SHA-512 of unsealed entry
  (signature seal-signature))       ; Ed25519 signature
</pre>
</section>
<section>
<h2>Operations</h2>
<h3>audit-init</h3>
<p>Initialize audit trail for a vault.</p>
<pre class="language-scheme">
(audit-init signing-key: key audit-dir: ".vault/audit")
</pre>
<h3>audit-append</h3>
<p>Create and sign a new audit entry.</p>
<pre class="language-scheme">
(audit-append
  actor: public-key-blob
  action: '(seal-commit "hash123")
  motivation: "Added new feature"
  signing-key: private-key-blob)
</pre>
<p>Process:</p>
<ul>
<li>Increment sequence counter</li>
<li>Get parent entry ID (hash chain link)</li>
<li>Build unsealed entry structure</li>
<li>Compute SHA-512 hash of canonical S-expression</li>
<li>Sign hash with Ed25519</li>
<li>Create seal record</li>
<li>Save entry to disk</li>
</ul>
<h3>audit-verify</h3>
<p>Verify cryptographic seal on an entry.</p>
<pre class="language-scheme">
(audit-verify entry public-key: key)
</pre>
<p>Verification steps:</p>
<ul>
<li>Reconstruct unsealed entry</li>
<li>Compute SHA-512 hash</li>
<li>Compare with stored content-hash</li>
<li>Verify Ed25519 signature</li>
</ul>
<h3>audit-chain</h3>
<p>Verify the entire audit chain from genesis to present. One broken link invalidates everything after it.</p>
<pre class="language-scheme">
(audit-chain verify-key: public-key)
</pre>
<p>Verifies:</p>
<ul>
<li>Each entry's signature is valid</li>
<li>Parent-id references form unbroken chain</li>
<li>Sequence numbers are strictly monotonic</li>
</ul>
<p>A valid chain proves no entries were inserted, deleted, or modified after signing.</p>
<h3>audit-read</h3>
<p>Read specific audit entry.</p>
<pre class="language-scheme">
(audit-read sequence: 42)
(audit-read id: "sha512:...")
</pre>
</section>
<section>
<h2>Storage Format</h2>
<p>Simplicity over cleverness. Entries are individual S-expression files, one per action, named by sequence number.</p>
<pre>
.vault/audit/
  1.sexp
  2.sexp
  3.sexp
  ...
</pre>
<p>This format trades storage density for operational simplicity:</p>
<ul>
<li>Sequential reads: cat the files in order</li>
<li>Range queries: list files between N and M</li>
<li>Latest entry: highest-numbered file</li>
<li>Debugging: read any entry with a text editor</li>
</ul>
<p>No database. No binary format. No special tools required to inspect the audit trail.</p>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Threat Model</h3>
<p>We trust as little as possible.</p>
<p>Trusted:</p>
<ul>
<li>Local filesystem during operation (not after)</li>
<li>Ed25519 implementation (libsodium, audited)</li>
<li>Private keys (your responsibility)</li>
</ul>
<p>Untrusted:</p>
<ul>
<li>Storage medium after entry creation</li>
<li>Network transport between nodes</li>
<li>Other actors, including administrators</li>
</ul>
<p>This threat model assumes a hostile environment where storage can be tampered with and network traffic can be intercepted. The cryptography protects the audit trail even when everything else is compromised.</p>
<h3>Attack Mitigations</h3>
<table>
<tr><th>Attack </th><th>Mitigation </th></tr>
<tr><td>Entry modification </td><td>SHA-512 hash detects tampering </td></tr>
<tr><td>Entry deletion </td><td>Chain breaks are detectable </td></tr>
<tr><td>Entry insertion </td><td>Hash chain prevents backdating </td></tr>
<tr><td>Actor impersonation </td><td>Ed25519 signatures verify identity </td></tr>
<tr><td>Replay attacks </td><td>Sequence numbers detect duplicates </td></tr>
</table>
<h3>Non-Repudiation</h3>
<p>Once an entry is signed and published, the actor cannot credibly deny it. This is non-repudiation: mathematical proof of authorship.</p>
<ul>
<li>Actor cannot deny performing the action—their key signed it</li>
<li>Timestamp cannot be backdated—hash chain enforces ordering</li>
<li>Content cannot be altered—hash would change</li>
<li>Signature mathematically proves authorship—no "someone else used my account"</li>
</ul>
<p>In court, in audits, in incident response: cryptographic proof beats testimony.</p>
</section>
<section>
<h2>Integration Points</h2>
<h3>Vault Operations</h3>
<p>All vault operations record audit entries:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 640 60" width="640" height="60" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<text x="5" y="10">(</text>
<text x="15" y="10">s</text>
<text x="25" y="10">e</text>
<text x="35" y="10">a</text>
<text x="45" y="10">l</text>
<text x="55" y="10">-</text>
<text x="65" y="10">c</text>
<text x="75" y="10">o</text>
<text x="85" y="10">m</text>
<text x="95" y="10">m</text>
<text x="105" y="10">i</text>
<text x="115" y="10">t</text>
<text x="135" y="10">"</text>
<text x="145" y="10">m</text>
<text x="155" y="10">e</text>
<text x="165" y="10">s</text>
<text x="175" y="10">s</text>
<text x="185" y="10">a</text>
<text x="195" y="10">g</text>
<text x="205" y="10">e</text>
<text x="215" y="10">"</text>
<text x="225" y="10">)</text>
<text x="285" y="10">→</text>
<text x="305" y="10">(</text>
<text x="315" y="10">a</text>
<text x="325" y="10">c</text>
<text x="335" y="10">t</text>
<text x="345" y="10">i</text>
<text x="355" y="10">o</text>
<text x="365" y="10">n</text>
<text x="385" y="10">(</text>
<text x="395" y="10">v</text>
<text x="405" y="10">e</text>
<text x="415" y="10">r</text>
<text x="425" y="10">b</text>
<text x="445" y="10">s</text>
<text x="455" y="10">e</text>
<text x="465" y="10">a</text>
<text x="475" y="10">l</text>
<text x="485" y="10">-</text>
<text x="495" y="10">c</text>
<text x="505" y="10">o</text>
<text x="515" y="10">m</text>
<text x="525" y="10">m</text>
<text x="535" y="10">i</text>
<text x="545" y="10">t</text>
<text x="555" y="10">)</text>
<text x="575" y="10">.</text>
<text x="585" y="10">.</text>
<text x="595" y="10">.</text>
<text x="605" y="10">)</text>
<text x="5" y="30">(</text>
<text x="15" y="30">s</text>
<text x="25" y="30">e</text>
<text x="35" y="30">a</text>
<text x="45" y="30">l</text>
<text x="55" y="30">-</text>
<text x="65" y="30">p</text>
<text x="75" y="30">u</text>
<text x="85" y="30">b</text>
<text x="95" y="30">l</text>
<text x="105" y="30">i</text>
<text x="115" y="30">s</text>
<text x="125" y="30">h</text>
<text x="145" y="30">"</text>
<text x="155" y="30">1</text>
<text x="165" y="30">.</text>
<text x="175" y="30">0</text>
<text x="185" y="30">.</text>
<text x="195" y="30">0</text>
<text x="205" y="30">"</text>
<text x="225" y="30">.</text>
<text x="235" y="30">.</text>
<text x="245" y="30">.</text>
<text x="255" y="30">)</text>
<text x="285" y="30">→</text>
<text x="305" y="30">(</text>
<text x="315" y="30">a</text>
<text x="325" y="30">c</text>
<text x="335" y="30">t</text>
<text x="345" y="30">i</text>
<text x="355" y="30">o</text>
<text x="365" y="30">n</text>
<text x="385" y="30">(</text>
<text x="395" y="30">v</text>
<text x="405" y="30">e</text>
<text x="415" y="30">r</text>
<text x="425" y="30">b</text>
<text x="445" y="30">s</text>
<text x="455" y="30">e</text>
<text x="465" y="30">a</text>
<text x="475" y="30">l</text>
<text x="485" y="30">-</text>
<text x="495" y="30">p</text>
<text x="505" y="30">u</text>
<text x="515" y="30">b</text>
<text x="525" y="30">l</text>
<text x="535" y="30">i</text>
<text x="545" y="30">s</text>
<text x="555" y="30">h</text>
<text x="565" y="30">)</text>
<text x="585" y="30">.</text>
<text x="595" y="30">.</text>
<text x="605" y="30">.</text>
<text x="615" y="30">)</text>
<text x="5" y="50">(</text>
<text x="15" y="50">s</text>
<text x="25" y="50">e</text>
<text x="35" y="50">a</text>
<text x="45" y="50">l</text>
<text x="55" y="50">-</text>
<text x="65" y="50">s</text>
<text x="75" y="50">u</text>
<text x="85" y="50">b</text>
<text x="95" y="50">s</text>
<text x="105" y="50">c</text>
<text x="115" y="50">r</text>
<text x="125" y="50">i</text>
<text x="135" y="50">b</text>
<text x="145" y="50">e</text>
<text x="165" y="50">r</text>
<text x="175" y="50">e</text>
<text x="185" y="50">m</text>
<text x="195" y="50">o</text>
<text x="205" y="50">t</text>
<text x="215" y="50">e</text>
<text x="235" y="50">.</text>
<text x="245" y="50">.</text>
<text x="255" y="50">.</text>
<text x="265" y="50">)</text>
<text x="285" y="50">→</text>
<text x="305" y="50">(</text>
<text x="315" y="50">a</text>
<text x="325" y="50">c</text>
<text x="335" y="50">t</text>
<text x="345" y="50">i</text>
<text x="355" y="50">o</text>
<text x="365" y="50">n</text>
<text x="385" y="50">(</text>
<text x="395" y="50">v</text>
<text x="405" y="50">e</text>
<text x="415" y="50">r</text>
<text x="425" y="50">b</text>
<text x="445" y="50">s</text>
<text x="455" y="50">e</text>
<text x="465" y="50">a</text>
<text x="475" y="50">l</text>
<text x="485" y="50">-</text>
<text x="495" y="50">s</text>
<text x="505" y="50">u</text>
<text x="515" y="50">b</text>
<text x="525" y="50">s</text>
<text x="535" y="50">c</text>
<text x="545" y="50">r</text>
<text x="555" y="50">i</text>
<text x="565" y="50">b</text>
<text x="575" y="50">e</text>
<text x="585" y="50">)</text>
<text x="605" y="50">.</text>
<text x="615" y="50">.</text>
<text x="625" y="50">.</text>
<text x="635" y="50">)</text>
</svg>
</div>
<h3>SPKI Authorization</h3>
<p>Audit entries can include authorization chains:</p>
<pre class="language-scheme">
(actor
  (principal #${bob-public-key})
  (authorization-chain
    (signed-cert ...)   ; Alice delegated to Bob
    (signed-cert ...))) ; Root delegated to Alice
</pre>
<p>This proves not just who acted, but under whose authority.</p>
</section>
<section>
<h2>Export Formats</h2>
<h3>S-expression Export</h3>
<pre class="language-scheme">
(audit-export-sexp output: "audit-export.sexp")
</pre>
<p>Produces:</p>
<pre class="language-scheme">
(audit-trail
  (audit-entry ...)
  (audit-entry ...)
  ...)
</pre>
<h3>Human-readable Export</h3>
<pre class="language-scheme">
(audit-export-human output: "audit-export.txt")
</pre>
<p>Produces:</p>
<pre>
AUDIT TRAIL - Library of Cyberspace
===================================

Entry #1
  ID: sha512:b14471cd57ea557f...
  Time: 2026-01-05 23:38:20Z
  Action: seal-publish
  Why: Published release to filesystem

Entry #2
  ...
</pre>
</section>
<section>
<h2>Implementation Notes</h2>
<h3>Dependencies</h3>
<ul>
<li>crypto-ffi: Ed25519 signatures, SHA-512 hashing</li>
<li>srfi-1: List utilities</li>
<li>srfi-4: u8vectors for binary data</li>
<li>srfi-13: String utilities</li>
</ul>
<h3>Performance Considerations</h3>
<ul>
<li>Content-addressed IDs enable O(1) lookup by hash</li>
<li>Sequential file naming enables efficient range queries</li>
<li>Lazy verification: verify on read, not on load</li>
</ul>
</section>
<section>
<h2>References</h2>
<ul>
<li>Haber, S., &amp; Stornetta, W. S. (1991). How to time-stamp a digital document.</li>
<li>Merkle, R. C. (1987). A digital signature based on a conventional encryption function.</li>
<li>Bernstein, D. J. (2006). Curve25519: new Diffie-Hellman speed records.</li>
<li>SDSI/SPKI - RFC 2693, RFC 2692</li>
</ul>
</section>
<section>
<h2>Changelog</h2>
<p>2026-01-19 - Expanded narrative and rationale</p>
<p>2026-01-06 - Initial specification</p>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
