%!PS-Adobe-3.0
%%Title: memo-005-metadata-levels
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 005: Progressive Metadata Levels) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This Memo specifies progressive metadata levels for vault commits,) show newline
(enabling configurable richness from minimal overhead to full) show newline
(preservation context. Three levels serve different use cases: minimal) show newline
(\(fast iteration\), catalog \(discovery\), and preserve \(archival\).) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Different commits deserve different metadata:) show newline
() show newline
(  * Quick fix: Just record it happened) show newline
(  * Feature release: Add searchable keywords) show newline
(  * Archival snapshot: Capture full environment) show newline
() show newline
(Traditional VCS provides one-size-fits-all commit messages. Cyberspace) show newline
(provides progressive levels:) show newline
() show newline
(1. Minimal - Hash, timestamp, message \(default\) 2. Catalog - Add) show newline
(subjects, keywords, descriptions \(discovery\) 3. Preserve - Add) show newline
(environment, dependencies, git state \(archival\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SPECIFICATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Level 1: Minimal \(Default\)) show newline
(--------------------------) show newline
() show newline
(Every commit includes:) show newline
() show newline
() show newline
(    \(commit-metadata) show newline
(      \(hash "abc123..."\)) show newline
(      \(timestamp 1767685100\)) show newline
(      \(message "Fix typo in README"\)\)) show newline
() show newline
(Usage:) show newline
() show newline
() show newline
(    \(seal-commit "Fix typo in README"\)) show newline
() show newline
(This is the default. No extra flags needed. Git handles storage.) show newline
() show newline
() show newline
(Level 2: Catalog) show newline
(----------------) show newline
() show newline
(Adds discovery metadata:) show newline
() show newline
() show newline
(    \(commit-metadata) show newline
(      \(hash "def456..."\)) show newline
(      \(timestamp 1767685200\)) show newline
(      \(message "Implement user authentication"\)) show newline
(      \(catalog) show newline
(        \(subjects "authentication" "security"\)) show newline
(        \(keywords "login" "oauth" "jwt"\)) show newline
(        \(description "Added OAuth2 authentication flow with JWT tokens"\)\)\)) show newline
() show newline
(Usage:) show newline
() show newline
() show newline
(    \(seal-commit "Implement user authentication") show newline
(      catalog: #t) show newline
(      subjects: '\("authentication" "security"\)) show newline
(      keywords: '\("login" "oauth" "jwt"\)) show newline
(      description: "Added OAuth2 authentication flow with JWT tokens"\)) show newline
() show newline
(Purpose: Enable search and categorization without full environmental) show newline
(capture.) show newline
() show newline
() show newline
(Level 3: Preserve) show newline
(-----------------) show newline
() show newline
(Adds archival metadata:) show newline
() show newline
() show newline
(    \(commit-metadata) show newline
(      \(hash "789abc..."\)) show newline
(      \(timestamp 1767685300\)) show newline
(      \(message "Release v2.0.0"\)) show newline
(      \(preservation) show newline
(        \(environment) show newline
(          \(platform "darwin"\)) show newline
(          \(hostname "dev-machine"\)) show newline
(          \(chicken-version "5.x"\)) show newline
(          \(timestamp 1767685300\)\)) show newline
(        \(dependencies) show newline
(          \(egg "srfi-1" "1.0"\)) show newline
(          \(egg "crypto-ffi" "0.1"\)\)) show newline
(        \(git-state) show newline
(          \(branch "main"\)) show newline
(          \(remote "git@github.com:ddp/cyberspace.git"\)\)\)\)) show newline
() show newline
(Usage:) show newline
() show newline
() show newline
(    \(seal-commit "Release v2.0.0") show newline
(      preserve: #t\)) show newline
() show newline
(Purpose: Capture everything needed to understand and reproduce the) show newline
(commit environment.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(METADATA FIELDS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Catalog Fields) show newline
(--------------) show newline
() show newline
() show newline
(  Field         Type     Description                                    ) show newline
(  subjects      list     Library of Congress style subject headings     ) show newline
(  keywords      list     Free-form search terms                         ) show newline
(  description   string   Extended description \(beyond commit message\)   ) show newline
() show newline
() show newline
(Preservation Fields) show newline
(-------------------) show newline
() show newline
() show newline
(  Field                         Type      Description                     ) show newline
(  environment.platform          string    OS type \(darwin, linux, etc.\)   ) show newline
(  environment.hostname          string    Machine name                    ) show newline
(  environment.chicken-version   string    Scheme implementation version   ) show newline
(  environment.timestamp         integer   Unix epoch seconds              ) show newline
(  dependencies                  list      Installed eggs/libraries        ) show newline
(  git-state.branch              string    Current branch                  ) show newline
(  git-state.remote              string    Remote URL                      ) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(STORAGE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Metadata stored in .vault/metadata/:) show newline
() show newline
() show newline
(    .vault/) show newline
(      metadata/) show newline
(        abc123.sexp) show newline
(        def456.sexp) show newline
(        789abc.sexp) show newline
() show newline
(Filename is commit hash. Content is S-expression metadata.) show newline
() show newline
() show newline
(Optional Git Tracking) show newline
(---------------------) show newline
() show newline
() show newline
(    \(vault-config 'track-metadata #t\)) show newline
() show newline
(When enabled, metadata files are staged for the next commit, creating a) show newline
(self-documenting archive.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(IMPLEMENTATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(save-commit-metadata) show newline
(--------------------) show newline
() show newline
() show newline
(    \(define \(save-commit-metadata commit-hash) show newline
(              #!key message catalog subjects keywords description preserve\)) show newline
(      "Save optional metadata for a commit") show newline
(      \(create-directory ".vault/metadata" #t\)) show newline
(      \(let \(\(metadata-file \(sprintf ".vault/metadata/~a.sexp" commit-hash\)\)\)) show newline
(        ;; Build metadata structure) show newline
(        \(let \(\(metadata \(list 'commit-metadata) show newline
(                             \(list 'hash commit-hash\)) show newline
(                             \(list 'timestamp \(current-seconds\)\)) show newline
(                             \(list 'message message\)\)\)\)) show newline
(          ;; Add catalog if requested) show newline
(          \(when \(or catalog subjects keywords description\)) show newline
(            \(set! metadata \(append metadata \(list \(build-catalog ...\)\)\)\)\)) show newline
(          ;; Add preservation if requested) show newline
(          \(when preserve) show newline
(            \(set! metadata \(append metadata \(list \(build-preservation ...\)\)\)\)\)) show newline
(          ;; Write metadata file) show newline
(          \(with-output-to-file metadata-file) show newline
(            \(lambda \(\)) show newline
(              \(write metadata\)) show newline
(              \(newline\)\)\)\)\)\)) show newline
() show newline
() show newline
(Environment Capture) show newline
(-------------------) show newline
() show newline
() show newline
(    \(define \(get-environment-snapshot\)) show newline
(      "Capture current build environment") show newline
(      \(\(platform ,\(or \(get-environment-variable "OSTYPE"\) "unknown"\)\)) show newline
(        \(hostname ,\(or \(get-environment-variable "HOSTNAME"\) "unknown"\)\)) show newline
(        \(chicken-version "5.x"\)) show newline
(        \(timestamp ,\(current-seconds\)\)\)\)) show newline
(    \(define \(get-dependencies-snapshot\)) show newline
(      "Capture current dependencies") show newline
(      ;; Could scan imports, check installed eggs) show newline
(      '\(\)\)) show newline
(    \(define \(get-git-state-snapshot\)) show newline
(      "Capture git repository state") show newline
(      \(let \(\(branch \(with-input-from-pipe "git branch --show-current" read-line\)\)) show newline
(            \(remote \(with-input-from-pipe "git remote -v" read-line\)\)\)) show newline
(        \(\(branch ,branch\)) show newline
(          \(remote ,remote\)\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(USE CASES) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Daily Development \(Minimal\)) show newline
(---------------------------) show newline
() show newline
() show newline
(    \(seal-commit "WIP: refactoring auth module"\)) show newline
(    \(seal-commit "Fix off-by-one error"\)) show newline
(    \(seal-commit "Update dependencies"\)) show newline
() show newline
(Fast, lightweight, no overhead.) show newline
() show newline
() show newline
(Feature Completion \(Catalog\)) show newline
(----------------------------) show newline
() show newline
() show newline
(    \(seal-commit "Add two-factor authentication") show newline
(      catalog: #t) show newline
(      subjects: '\("authentication" "security" "2FA"\)) show newline
(      keywords: '\("totp" "authenticator" "login"\)) show newline
(      description: "Implements TOTP-based 2FA per RFC 6238"\)) show newline
() show newline
(Enables later discovery: "find all commits about authentication") show newline
() show newline
() show newline
(Release Snapshot \(Preserve\)) show newline
(---------------------------) show newline
() show newline
() show newline
(    \(seal-commit "Release v2.0.0") show newline
(      preserve: #t\)) show newline
() show newline
(Captures full environment for reproducibility and forensics.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(QUERY SUPPORT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Future enhancement: query interface for metadata.) show newline
() show newline
() show newline
(    ;; Find by subject) show newline
(    \(vault-search subjects: '\("authentication"\)\)) show newline
(    ;; Find by keyword) show newline
(    \(vault-search keywords: '\("oauth"\)\)) show newline
(    ;; Find by date range) show newline
(    \(vault-search from: "2026-01-01" to: "2026-01-31"\)) show newline
(    ;; Find with preservation data) show newline
(    \(vault-search has-preservation: #t\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SECURITY CONSIDERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Information Leakage) show newline
(-------------------) show newline
() show newline
(Preservation metadata captures: - Hostname \(could reveal infrastructure\)) show newline
(- Platform \(could reveal vulnerabilities\) - Dependencies \(could reveal) show newline
(attack surface\)) show newline
() show newline
(Recommendation: Use preserve level only for internal archives. Strip) show newline
(when publishing externally.) show newline
() show newline
() show newline
(Metadata Integrity) show newline
(------------------) show newline
() show newline
(Metadata files are not automatically signed. For tamper-evidence: 1.) show newline
(Enable track-metadata to include in commits 2. Use seal-release for) show newline
(cryptographic sealing 3. Audit trail captures metadata operations) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DESIGN RATIONALE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Why Not Always Full Metadata?) show newline
(-----------------------------) show newline
() show newline
(1. Performance: Environment capture adds latency 2. Noise: Not every) show newline
(commit needs forensic detail 3. Privacy: Some metadata reveals sensitive) show newline
(info 4. Storage: Full metadata increases repository size) show newline
() show newline
() show newline
(Why S-expressions?) show newline
(------------------) show newline
() show newline
(1. Readable: Human-inspectable without tools 2. Parseable:) show newline
(Machine-processable 3. Extensible: Add fields without schema changes 4.) show newline
(Native: Scheme can read/write directly) show newline
() show newline
() show newline
(Why Separate Files?) show newline
(-------------------) show newline
() show newline
(1. Git-friendly: Small files diff well 2. Query-friendly: Can glob/grep) show newline
(metadata 3. Optional: Metadata doesn't bloat git objects 4. Flexible:) show newline
(Can delete without rewriting history) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(1. Dublin Core Metadata Initiative \(DCMI\) 2. Library of Congress Subject) show newline
(Headings \(LCSH\) 3. Software Heritage Archive Metadata 4. Reproducible) show newline
(Builds Project) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * 2026-01-06) show newline
(  * Initial specification) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
