%!PS-Adobe-3.0
%%Title: memo-0041-ipv6-scaling
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0041: Scaling Architecture for IPv6) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This Memo defines the architectural changes required to scale Cyberspace) show newline
(from a git-backed prototype to a native distributed system capable of) show newline
(operating at IPv6 scale \(billions of realms, exabytes of content\). Git) show newline
(becomes an export format; the vault becomes the source of truth.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(TERMINOLOGY) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Realm: A node's place in cyberspace - its vault, principal,) show newline
(capabilities, and objects. Each realm is sovereign: local-first,) show newline
(controlled by its operator. Realms federate by choice, sharing objects) show newline
(according to trust relationships.) show newline
() show newline
(Vault: The local content-addressed object store \(.vault/\). The vault IS) show newline
(the realm's storage - all objects, catalogs, audit trails, and) show newline
(configuration live here.) show newline
() show newline
(Principal: A node's cryptographic identity \(Ed25519 public key\). The) show newline
(principal identifies the realm to peers and signs its objects.) show newline
() show newline
(At IPv6 scale, cyberspace consists of billions of realms, each occupying) show newline
(its own address space, each sovereign, each choosing what to share and) show newline
(with whom.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Git served as an excellent prototype substrate: - Content-addressed) show newline
(objects \(proof of concept\) - Merkle tree integrity \(validates the model\)) show newline
(- Ubiquitous tooling \(bootstrap adoption\)) show newline
() show newline
(Git cannot scale to IPv6: - Full history on every clone - Repository as) show newline
(replication unit \(too coarse\) - SHA-1 \(cryptographically broken\) - No) show newline
(native federation or discovery - Merge semantics are wrong model) show newline
() show newline
(The internet has 2^128 addresses. Cyberspace should use them.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DESIGN PRINCIPLES) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(    1. Objects, not repositories) show newline
(    2. Pull, not push) show newline
(    3. Lazy, not eager) show newline
(    4. Local-first, federate-second) show newline
(    5. Trust math, not infrastructure) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CONTENT-ADDRESSED OBJECT STORE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Storage Model) show newline
(-------------) show newline
() show newline
() show newline
(    .vault/) show newline
(      objects/) show newline
(        sha512-a1b2c3.../    # First 8 chars as directory) show newline
(          a1b2c3d4e5f6...    # Full hash as filename \(S-expression\)) show newline
(      catalog/) show newline
(        manifest.sexp        # Vault catalog object) show newline
(        bloom.sexp           # Bloom filter object) show newline
(        indices/             # Secondary index objects) show newline
(          by-signer.sexp) show newline
(          by-type.sexp) show newline
(      chunks/) show newline
(        sha512-xxxx/         # Chunked large objects) show newline
(      audit/) show newline
(        head.sexp            # Current audit chain head) show newline
(        chain/               # Audit entries \(hash-addressed\)) show newline
() show newline
() show newline
(Object Format) show newline
(-------------) show newline
() show newline
() show newline
(    \(cyberspace-object) show newline
(      \(version 1\)) show newline
(      \(type blob|tree|manifest|cert|audit\)) show newline
(      \(size 1048576\)) show newline
(      \(compression zstd|none\)) show newline
(      \(hash "sha512:a1b2c3..."\)) show newline
(      \(chunks \("sha512:..." "sha512:..." ...\)\)  ; If chunked) show newline
(      \(signature "ed25519:..."\)) show newline
(      \(timestamp 1736300000\)\)) show newline
() show newline
() show newline
(Chunking Strategy) show newline
(-----------------) show newline
() show newline
(Large objects split at content-defined boundaries \(Rabin) show newline
(fingerprinting\). Chunk size adapts to link characteristics:) show newline
() show newline
() show newline
(    Link Profile          RTT        Bandwidth    Target Chunk) show newline
(    ─────────────────────────────────────────────────────────────) show newline
(    Fiber/Datacenter     1-5ms      1Gbps+       256KB-1MB) show newline
(    Cable/DSL            10-30ms    50-500Mbps   128KB) show newline
(    Starlink             20-40ms    100-300Mbps  64KB) show newline
(    LTE/5G               10-50ms    variable     32-128KB) show newline
(    LoRa/Mesh            100ms+     kbps         4-16KB) show newline
(    Sneakernet           ∞          ∞            no chunking) show newline
(    Rabin parameters \(content-defined\):) show newline
(      Min chunk:    4 KB   \(floor for all links\)) show newline
(      Max chunk:    1 MB   \(ceiling for all links\)) show newline
(      Target:       link-adaptive \(see above\)) show newline
() show newline
(Chunk size continuously adapts as links come and go. Mobile nodes may) show newline
(switch from WiFi to LTE to Starlink - the transfer strategy adjusts in) show newline
(real-time. Deduplication works across chunk sizes - same content, same) show newline
(hash.) show newline
() show newline
() show newline
(    \(define \(optimal-chunk-size link\)) show newline
(      "Calculate target chunk size for link characteristics.") show newline
(      \(let \(\(rtt-ms \(link-rtt link\)\)) show newline
(            \(bandwidth-mbps \(link-bandwidth link\)\)\)) show newline
(        \(cond) show newline
(          \(\(< rtt-ms 10\)   \(* 256 1024\)\)   ; Datacenter) show newline
(          \(\(< rtt-ms 30\)   \(* 128 1024\)\)   ; Cable/DSL) show newline
(          \(\(< rtt-ms 50\)   \(* 64 1024\)\)    ; Starlink/LTE) show newline
(          \(\(< rtt-ms 100\)  \(* 32 1024\)\)    ; Slow mobile) show newline
(          \(else            \(* 8 1024\)\)\)\)\)  ; Constrained) show newline
(    ;; Auto-tune from observed performance) show newline
(    \(define \(auto-tune-chunk-size! link\)) show newline
(      "Adjust chunk size based on transfer performance.") show newline
(      \(let* \(\(samples \(link-transfer-samples link\)\)) show newline
(             \(avg-throughput \(mean \(map sample-throughput samples\)\)\)) show newline
(             \(avg-rtt \(mean \(map sample-rtt samples\)\)\)\)) show newline
(        \(link-chunk-size-set! link \(optimal-chunk-size-for avg-rtt avg-throughput\)\)\)\)) show newline
() show newline
(Benefits:) show newline
() show newline
() show newline
(      - Deduplication across objects \(hash-based\)) show newline
(      - Partial sync \(fetch only missing chunks\)) show newline
(      - Resumable transfers) show newline
(      - Efficient diff) show newline
(      - Link-optimal transfer sizes) show newline
(      - Graceful degradation on constrained links) show newline
() show newline
() show newline
(Hash Function) show newline
(-------------) show newline
() show newline
() show newline
(    SHA-512 everywhere.) show newline
(    Not SHA-256: We have the bits, use them.) show newline
(    Not SHA-1: Broken.) show newline
(    Not BLAKE3: Less analyzed, marginal speed gain irrelevant at network latency.) show newline
(    SHA-512 is:) show newline
(      - FIPS certified \(GovCloud path\)) show newline
(      - 50 years of cryptanalysis) show newline
(      - Hardware accelerated) show newline
(      - Already in use \(audit trail, signatures\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CATALOG AND QUERY) show newline
(------------------------------------------------------------------------) show newline
() show newline
(The soup IS the catalog. No SQL. Objects are S-expressions, queries are) show newline
(pattern matching.) show newline
() show newline
() show newline
(The Soup Query Model) show newline
(--------------------) show newline
() show newline
() show newline
(    ;; Find objects by pattern) show newline
(    \(soup-query) show newline
(      '\(cyberspace-object) show newline
(        \(type blob\)) show newline
(        \(signer "ed25519:alice..."\)) show newline
(        ?rest\)\)                        ; Match any object signed by Alice) show newline
(    ;; Find by hash \(direct lookup\)) show newline
(    \(soup-fetch "sha512:a1b2c3..."\)    ; O\(1\) content-addressed) show newline
(    ;; Find by type) show newline
(    \(soup-query '\(cyberspace-object \(type cert\) ?rest\)\)) show newline
(    ;; Find by time range) show newline
(    \(soup-query-range) show newline
(      type: 'audit) show newline
(      from: 1736000000) show newline
(      to:   1736100000\)) show newline
(    ;; Cursor-based iteration for large result sets) show newline
(    \(soup-cursor) show newline
(      '\(cyberspace-object \(type ?\) ?rest\)) show newline
(      batch: 100\)) show newline
() show newline
() show newline
(Object Catalog) show newline
(--------------) show newline
() show newline
(The catalog is itself an object in the soup - a manifest of what the) show newline
(vault contains:) show newline
() show newline
() show newline
(    \(vault-catalog) show newline
(      \(version 1\)) show newline
(      \(realm "ed25519:principal..."\)) show newline
(      \(object-count 150000\)) show newline
(      \(types) show newline
(        \(blob 100000\)) show newline
(        \(tree 30000\)) show newline
(        \(cert 15000\)) show newline
(        \(audit 5000\)\)) show newline
(      \(bloom-filter #${...}\)           ; Fast existence check) show newline
(      \(updated 1736400000\)\)) show newline
() show newline
() show newline
(Bloom Filter) show newline
(------------) show newline
() show newline
(Fast existence check before network round-trip:) show newline
() show newline
() show newline
(    \(define \(soup-maybe-contains? hash\)) show newline
(      "Check bloom filter - false means definitely not, true means maybe") show newline
(      \(let \(\(catalog \(soup-fetch-catalog\)\)\)) show newline
(        \(bloom-test \(catalog-bloom catalog\) hash\)\)\)) show newline
(    ;; Bloom parameters) show newline
(    \(bloom-filter) show newline
(      \(capacity 10000000\)              ; 10M objects) show newline
(      \(false-positive 0.001\)           ; 0.1% FP rate) show newline
(      \(bits #${...}\)\)) show newline
() show newline
() show newline
(Audit Trail) show newline
(-----------) show newline
() show newline
(The audit trail is a hash-chain of objects in the soup:) show newline
() show newline
() show newline
(    \(audit-entry) show newline
(      \(sequence 12345\)) show newline
(      \(timestamp 1736300000\)) show newline
(      \(lamport 67890\)) show newline
(      \(actor "ed25519:subject..."\)) show newline
(      \(action \(read "sha512:object..."\)\)) show newline
(      \(previous "sha512:prev-entry..."\)  ; Chain link) show newline
(      \(signature "ed25519:auditor..."\)\)) show newline
(    ;; Query audit by walking the chain) show newline
(    \(define \(audit-query actor from-seq\)) show newline
(      "Walk audit chain, filter by actor") show newline
(      \(soup-chain-walk) show newline
(        start: \(audit-head\)) show newline
(        filter: \(lambda \(entry\)) show newline
(                  \(equal? \(entry-actor entry\) actor\)\)) show newline
(        from: from-seq\)\)) show newline
() show newline
() show newline
(Secondary Indices) show newline
(-----------------) show newline
() show newline
(For queries that can't use content-addressing, the soup maintains) show newline
(lightweight indices as objects:) show newline
() show newline
() show newline
(    \(soup-index) show newline
(      \(name "by-signer"\)) show newline
(      \(key-type principal\)) show newline
(      \(entries) show newline
(        \(\("ed25519:alice..." \("sha512:obj1" "sha512:obj2" ...\)\)) show newline
(         \("ed25519:bob..." \("sha512:obj3" "sha512:obj4" ...\)\)\)\)\)) show newline
(    \(soup-index) show newline
(      \(name "by-type"\)) show newline
(      \(key-type symbol\)) show newline
(      \(entries) show newline
(        \(\(blob \("sha512:..." "sha512:..." ...\)\)) show newline
(         \(cert \("sha512:..." "sha512:..." ...\)\)) show newline
(         \(audit \("sha512:..." "sha512:..." ...\)\)\)\)\)) show newline
() show newline
(Indices are rebuilt on demand, not authoritative - the soup is truth.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DISCOVERY AND ROUTING) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Realm Identity) show newline
(--------------) show newline
() show newline
(Each realm has a principal \(Ed25519 public key\). This IS its identity:) show newline
() show newline
() show newline
(    \(realm-identity) show newline
(      \(principal "ed25519:a1b2c3..."\)) show newline
(      \(addresses                          ; Where to reach this realm) show newline
(        \(ipv6 "2001:db8::1" port: 7777\)) show newline
(        \(ipv4 "192.0.2.1" port: 7777\)     ; Legacy) show newline
(        \(onion "xxxx.onion" port: 7777\)\)  ; Tor) show newline
(      \(role witness\)) show newline
(      \(capabilities \(storage-gb 1000\) \(bandwidth-mbps 100\)\)) show newline
(      \(signature "ed25519:..."\)\)) show newline
() show newline
() show newline
(Peer Discovery) show newline
(--------------) show newline
() show newline
(Bootstrap:) show newline
() show newline
() show newline
(    \(bootstrap-peers) show newline
(      \("ed25519:official1..." "bootstrap.cyberspace.org"\)) show newline
(      \("ed25519:official2..." "bootstrap2.cyberspace.org"\)\)) show newline
() show newline
(Gossip Protocol:) show newline
() show newline
() show newline
(    1. Realm joins, contacts bootstrap peer) show newline
(    2. Receives partial peer list \(random subset\)) show newline
(    3. Contacts those peers, exchanges lists) show newline
(    4. Epidemic spread: O\(log n\) rounds to reach all realms) show newline
(    5. Periodic refresh \(every 5 min on Starlink-friendly schedule\)) show newline
() show newline
(Distributed Hash Table \(Future\):) show newline
() show newline
() show newline
(    Kademlia-style routing:) show newline
(      - XOR distance metric on principal hashes) show newline
(      - O\(log n\) lookups) show newline
(      - Realms responsible for nearby hash ranges) show newline
(      - Natural load balancing) show newline
() show newline
() show newline
(Content Discovery) show newline
(-----------------) show newline
() show newline
() show newline
(    ;; "Who has this hash?") show newline
(    \(content-locate "sha512:a1b2c3..."\)) show newline
(    ;; Returns list of peers claiming to have it:) show newline
(    \(\("ed25519:peer1..." \(latency-ms 50\) \(role full\)\)) show newline
(     \("ed25519:peer2..." \(latency-ms 200\) \(role witness\)\)) show newline
(     \("ed25519:peer3..." \(latency-ms 600\) \(role archiver\)\)\)) show newline
(    ;; Fetch from best candidate) show newline
(    \(content-fetch "sha512:a1b2c3..." from: "ed25519:peer1..."\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(TRANSPORT PROTOCOL) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(End-to-End Encryption) show newline
(---------------------) show newline
() show newline
(All network traffic is encrypted. The OS and network are not trusted.) show newline
() show newline
() show newline
(    \(cyberspace-message) show newline
(      \(version 1\)) show newline
(      \(from "ed25519:sender..."\)) show newline
(      \(to "ed25519:recipient..."\)        ; Or broadcast key) show newline
(      \(ephemeral "x25519:..."\)           ; One-time key \(PFS\)) show newline
(      \(nonce #${24-bytes}\)               ; Random nonce) show newline
(      \(ciphertext #${...}\)               ; NaCl box: X25519 + XSalsa20-Poly1305) show newline
(      \(signature "ed25519:..."\)\)         ; Sign the ciphertext) show newline
() show newline
(Encryption scheme: NaCl crypto_box \(libsodium\) - Key agreement: X25519) show newline
(\(Curve25519 ECDH\) - Cipher: XSalsa20-Poly1305 - Perfect forward secrecy:) show newline
(ephemeral keys per message) show newline
() show newline
(Decrypted payload:) show newline
() show newline
() show newline
(    \(plaintext-payload) show newline
(      \(type request|response|announce|gossip\)) show newline
(      \(nonce 12345678\)                   ; Replay protection) show newline
(      \(timestamp 1736300000\)) show newline
(      \(body ...\)\)) show newline
() show newline
(Broadcast messages use a shared group key or are signed-only) show newline
(\(announcements of public objects\).) show newline
() show newline
() show newline
(Wire Format \(Encrypted\)) show newline
(-----------------------) show newline
() show newline
() show newline
(    ;; Sender encrypts) show newline
(    \(define \(seal-message payload recipient-pubkey sender-keypair\)) show newline
(      \(let \(\(ephemeral \(x25519-keypair\)\)) show newline
(             \(shared \(x25519-shared \(ephemeral-secret ephemeral\) recipient-pubkey\)\)) show newline
(             \(nonce \(random-bytes 24\)\)) show newline
(             \(ciphertext \(crypto-box payload nonce shared\)\)\)) show newline
(        `\(cyberspace-message) show newline
(          \(version 1\)) show newline
(          \(from ,\(keypair-public sender-keypair\)\)) show newline
(          \(to ,recipient-pubkey\)) show newline
(          \(ephemeral ,\(ephemeral-public ephemeral\)\)) show newline
(          \(nonce ,nonce\)) show newline
(          \(ciphertext ,ciphertext\)) show newline
(          \(signature ,\(sign-message ciphertext sender-keypair\)\)\)\)\)) show newline
(    ;; Recipient decrypts) show newline
(    \(define \(open-message msg recipient-keypair\)) show newline
(      \(let \(\(shared \(x25519-shared \(keypair-secret recipient-keypair\)) show newline
(                                    \(message-ephemeral msg\)\)\)) show newline
(             \(plaintext \(crypto-box-open \(message-ciphertext msg\)) show newline
(                                         \(message-nonce msg\)) show newline
(                                         shared\)\)\)) show newline
(        \(and \(verify-signature msg \(message-from msg\)\)) show newline
(             plaintext\)\)\)) show newline
() show newline
() show newline
(Request Types) show newline
(-------------) show newline
() show newline
() show newline
(    ;; Existence check) show newline
(    \(have? \("sha512:..." "sha512:..." ...\)\)) show newline
(    ;; Response: \(have \("sha512:..." "sha512:..."\) missing \("sha512:..."\)\)) show newline
(    ;; Fetch object) show newline
(    \(fetch "sha512:..."\)) show newline
(    ;; Response: \(object ...\)) show newline
(    ;; Fetch chunk range) show newline
(    \(fetch-chunks "sha512:..." start: 5 count: 10\)) show newline
(    ;; Response: \(chunks ...\)) show newline
(    ;; Peer list exchange) show newline
(    \(peers? limit: 50\)) show newline
(    ;; Response: \(peers ...\)) show newline
(    ;; Announce new content) show newline
(    \(announce \("sha512:..." "sha512:..."\)\)) show newline
(    ;; Response: \(ack\)) show newline
() show newline
() show newline
(Transport Bindings) show newline
(------------------) show newline
() show newline
() show newline
(    Native:     UDP/IPv6, port 7777 \(primary\)) show newline
(    Fallback:   TCP/IPv6, port 7777 \(firewalls\)) show newline
(    Legacy:     TCP/IPv4, port 7777 \(transition\)) show newline
(    Stealth:    Tor onion service \(censorship resistance\)) show newline
(    Offline:    USB drive, file copy \(sneakernet\)) show newline
(    Export:     Git bundle \(GitHub compatibility\)) show newline
() show newline
() show newline
(Link-Adaptive Transport) show newline
(-----------------------) show newline
() show newline
(Transport parameters adapt to detected link type:) show newline
() show newline
() show newline
(    \(transport-config) show newline
(      \(link-detection auto\)          ; Probe RTT/bandwidth) show newline
(      \(chunk-size adaptive\)          ; See Chunking Strategy) show newline
(      \(batch-window-ms               ; Aggregate small messages) show newline
(        \(fiber 50\)) show newline
(        \(starlink 500\)) show newline
(        \(lte 200\)) show newline
(        \(lora 2000\)\)) show newline
(      \(retry-strategy exponential\)) show newline
(      \(max-in-flight                 ; Parallelism based on BDP) show newline
(        \(fiber 100\)) show newline
(        \(starlink 10\)) show newline
(        \(lte 5\)) show newline
(        \(lora 1\)\)) show newline
(      \(keepalive-sec                 ; Idle timeout) show newline
(        \(fiber 60\)) show newline
(        \(starlink 300\)) show newline
(        \(lte 120\)) show newline
(        \(lora 600\)\)\)) show newline
(    ;; Re-evaluate on link change) show newline
(    \(define \(on-link-change! old-link new-link\)) show newline
(      "Adjust transport when connectivity changes.") show newline
(      \(let \(\(config \(detect-link-profile new-link\)\)\)) show newline
(        \(transport-reconfigure! config\)) show newline
(        \(log-link-transition old-link new-link\)\)\)) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
