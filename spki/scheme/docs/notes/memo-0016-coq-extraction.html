<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0016: Coq Extraction for TCB</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0016: Coq Extraction for TCB</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies the use of Coq proof assistant for verified implementation of the Trusted Computing Base, with extraction to OCaml for production use. Prove once, trust forever.</p>
</section>
<section>
<h2>Motivation</h2>
<p>The Prime Directive (Memo-0001):</p>
<blockquote>
<p>If it's in the TCB, it's in OCaml. Otherwise it's in Chicken Scheme.</p>
</blockquote>
<p>But even OCaml can have bugs. The TCB handles: - Ed25519 signatures - SHA-512 hashing - Signature chain verification</p>
<p>A single bug breaks everything.</p>
<p>Coq provides:</p>
<ul>
<li>Machine-checked proofs: Theorems verified by computer</li>
<li>Extraction: Generate OCaml from proofs</li>
<li>Correctness by construction: Implementation matches specification</li>
<li>Eternal validity: Proofs don't expire</li>
</ul>
<p>Extraction bridges the gap between specification and implementation: the code that runs is the code that was proven.</p>
<p>From the Coq motto:</p>
<blockquote>
<p>The proof is in the code.</p>
</blockquote>
</section>
<section>
<h2>Specification</h2>
<h3>Trusted Computing Base</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 630 400" width="630" height="400" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<line x1="5" y1="10" x2="10" y2="10"/>
<line x1="5" y1="10" x2="5" y2="21"/>
<line x1="10" y1="10" x2="20" y2="10"/>
<line x1="20" y1="10" x2="30" y2="10"/>
<line x1="30" y1="10" x2="40" y2="10"/>
<line x1="40" y1="10" x2="50" y2="10"/>
<line x1="50" y1="10" x2="60" y2="10"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<line x1="110" y1="10" x2="120" y2="10"/>
<line x1="120" y1="10" x2="130" y2="10"/>
<line x1="130" y1="10" x2="140" y2="10"/>
<line x1="140" y1="10" x2="150" y2="10"/>
<line x1="150" y1="10" x2="160" y2="10"/>
<line x1="160" y1="10" x2="170" y2="10"/>
<line x1="170" y1="10" x2="180" y2="10"/>
<line x1="180" y1="10" x2="190" y2="10"/>
<line x1="190" y1="10" x2="200" y2="10"/>
<line x1="200" y1="10" x2="210" y2="10"/>
<line x1="210" y1="10" x2="220" y2="10"/>
<line x1="220" y1="10" x2="230" y2="10"/>
<line x1="230" y1="10" x2="240" y2="10"/>
<line x1="240" y1="10" x2="250" y2="10"/>
<line x1="250" y1="10" x2="260" y2="10"/>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="390" y2="10"/>
<line x1="390" y1="10" x2="400" y2="10"/>
<line x1="400" y1="10" x2="410" y2="10"/>
<line x1="410" y1="10" x2="420" y2="10"/>
<line x1="420" y1="10" x2="430" y2="10"/>
<line x1="430" y1="10" x2="440" y2="10"/>
<line x1="440" y1="10" x2="450" y2="10"/>
<line x1="450" y1="10" x2="460" y2="10"/>
<line x1="460" y1="10" x2="470" y2="10"/>
<line x1="470" y1="10" x2="480" y2="10"/>
<line x1="480" y1="10" x2="490" y2="10"/>
<line x1="490" y1="10" x2="500" y2="10"/>
<line x1="500" y1="10" x2="510" y2="10"/>
<line x1="510" y1="10" x2="520" y2="10"/>
<line x1="520" y1="10" x2="530" y2="10"/>
<line x1="530" y1="10" x2="540" y2="10"/>
<line x1="540" y1="10" x2="550" y2="10"/>
<line x1="550" y1="10" x2="560" y2="10"/>
<line x1="560" y1="10" x2="570" y2="10"/>
<line x1="570" y1="10" x2="580" y2="10"/>
<line x1="580" y1="10" x2="590" y2="10"/>
<line x1="590" y1="10" x2="600" y2="10"/>
<line x1="600" y1="10" x2="610" y2="10"/>
<line x1="610" y1="10" x2="620" y2="10"/>
<line x1="620" y1="10" x2="625" y2="10"/>
<line x1="625" y1="10" x2="625" y2="21"/>
<line x1="5" y1="19" x2="5" y2="41"/>
<text x="210" y="30">CYBERSPACE</text>
<text x="320" y="30">TCB</text>
<line x1="625" y1="19" x2="625" y2="41"/>
<line x1="5" y1="39" x2="5" y2="61"/>
<line x1="625" y1="39" x2="625" y2="61"/>
<line x1="5" y1="59" x2="5" y2="81"/>
<line x1="45" y1="70" x2="50" y2="70"/>
<line x1="45" y1="70" x2="45" y2="81"/>
<line x1="50" y1="70" x2="60" y2="70"/>
<line x1="60" y1="70" x2="70" y2="70"/>
<line x1="70" y1="70" x2="80" y2="70"/>
<line x1="80" y1="70" x2="90" y2="70"/>
<line x1="90" y1="70" x2="100" y2="70"/>
<line x1="100" y1="70" x2="110" y2="70"/>
<line x1="110" y1="70" x2="120" y2="70"/>
<line x1="120" y1="70" x2="130" y2="70"/>
<line x1="130" y1="70" x2="140" y2="70"/>
<line x1="140" y1="70" x2="150" y2="70"/>
<line x1="150" y1="70" x2="160" y2="70"/>
<line x1="160" y1="70" x2="170" y2="70"/>
<line x1="170" y1="70" x2="180" y2="70"/>
<line x1="180" y1="70" x2="185" y2="70"/>
<line x1="185" y1="70" x2="185" y2="81"/>
<line x1="215" y1="70" x2="220" y2="70"/>
<line x1="215" y1="70" x2="215" y2="81"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="355" y2="70"/>
<line x1="355" y1="70" x2="355" y2="81"/>
<line x1="385" y1="70" x2="390" y2="70"/>
<line x1="385" y1="70" x2="385" y2="81"/>
<line x1="390" y1="70" x2="400" y2="70"/>
<line x1="400" y1="70" x2="410" y2="70"/>
<line x1="410" y1="70" x2="420" y2="70"/>
<line x1="420" y1="70" x2="430" y2="70"/>
<line x1="430" y1="70" x2="440" y2="70"/>
<line x1="440" y1="70" x2="450" y2="70"/>
<line x1="450" y1="70" x2="460" y2="70"/>
<line x1="460" y1="70" x2="470" y2="70"/>
<line x1="470" y1="70" x2="480" y2="70"/>
<line x1="480" y1="70" x2="490" y2="70"/>
<line x1="490" y1="70" x2="500" y2="70"/>
<line x1="500" y1="70" x2="510" y2="70"/>
<line x1="510" y1="70" x2="520" y2="70"/>
<line x1="520" y1="70" x2="525" y2="70"/>
<line x1="525" y1="70" x2="525" y2="81"/>
<line x1="615" y1="59" x2="615" y2="81"/>
<line x1="5" y1="79" x2="5" y2="101"/>
<line x1="45" y1="79" x2="45" y2="101"/>
<text x="80" y="90">Ed25519</text>
<line x1="185" y1="79" x2="185" y2="101"/>
<line x1="215" y1="79" x2="215" y2="101"/>
<text x="250" y="90">SHA-512</text>
<line x1="355" y1="79" x2="355" y2="101"/>
<line x1="385" y1="79" x2="385" y2="101"/>
<text x="420" y="90">Verify</text>
<line x1="525" y1="79" x2="525" y2="101"/>
<line x1="615" y1="79" x2="615" y2="101"/>
<line x1="5" y1="99" x2="5" y2="121"/>
<line x1="45" y1="99" x2="45" y2="121"/>
<text x="80" y="110">Proven</text>
<line x1="185" y1="99" x2="185" y2="121"/>
<line x1="215" y1="99" x2="215" y2="121"/>
<text x="250" y="110">Proven</text>
<line x1="355" y1="99" x2="355" y2="121"/>
<line x1="385" y1="99" x2="385" y2="121"/>
<text x="420" y="110">Proven</text>
<line x1="525" y1="99" x2="525" y2="121"/>
<line x1="615" y1="99" x2="615" y2="121"/>
<line x1="5" y1="119" x2="5" y2="141"/>
<line x1="45" y1="130" x2="50" y2="130"/>
<line x1="45" y1="119" x2="45" y2="130"/>
<line x1="50" y1="130" x2="60" y2="130"/>
<line x1="60" y1="130" x2="70" y2="130"/>
<line x1="70" y1="130" x2="80" y2="130"/>
<line x1="80" y1="130" x2="90" y2="130"/>
<line x1="90" y1="130" x2="100" y2="130"/>
<line x1="100" y1="130" x2="110" y2="130"/>
<line x1="110" y1="130" x2="120" y2="130"/>
<line x1="115" y1="130" x2="115" y2="141"/>
<line x1="120" y1="130" x2="130" y2="130"/>
<line x1="130" y1="130" x2="140" y2="130"/>
<line x1="140" y1="130" x2="150" y2="130"/>
<line x1="150" y1="130" x2="160" y2="130"/>
<line x1="160" y1="130" x2="170" y2="130"/>
<line x1="170" y1="130" x2="180" y2="130"/>
<line x1="180" y1="130" x2="185" y2="130"/>
<line x1="185" y1="119" x2="185" y2="130"/>
<line x1="215" y1="130" x2="220" y2="130"/>
<line x1="215" y1="119" x2="215" y2="130"/>
<line x1="220" y1="130" x2="230" y2="130"/>
<line x1="230" y1="130" x2="240" y2="130"/>
<line x1="240" y1="130" x2="250" y2="130"/>
<line x1="250" y1="130" x2="260" y2="130"/>
<line x1="260" y1="130" x2="270" y2="130"/>
<line x1="270" y1="130" x2="280" y2="130"/>
<line x1="280" y1="130" x2="290" y2="130"/>
<line x1="285" y1="130" x2="285" y2="141"/>
<line x1="290" y1="130" x2="300" y2="130"/>
<line x1="300" y1="130" x2="310" y2="130"/>
<line x1="310" y1="130" x2="320" y2="130"/>
<line x1="320" y1="130" x2="330" y2="130"/>
<line x1="330" y1="130" x2="340" y2="130"/>
<line x1="340" y1="130" x2="350" y2="130"/>
<line x1="350" y1="130" x2="355" y2="130"/>
<line x1="355" y1="119" x2="355" y2="130"/>
<line x1="385" y1="130" x2="390" y2="130"/>
<line x1="385" y1="119" x2="385" y2="130"/>
<line x1="390" y1="130" x2="400" y2="130"/>
<line x1="400" y1="130" x2="410" y2="130"/>
<line x1="410" y1="130" x2="420" y2="130"/>
<line x1="420" y1="130" x2="430" y2="130"/>
<line x1="430" y1="130" x2="440" y2="130"/>
<line x1="440" y1="130" x2="450" y2="130"/>
<line x1="450" y1="130" x2="460" y2="130"/>
<line x1="455" y1="130" x2="455" y2="141"/>
<line x1="460" y1="130" x2="470" y2="130"/>
<line x1="470" y1="130" x2="480" y2="130"/>
<line x1="480" y1="130" x2="490" y2="130"/>
<line x1="490" y1="130" x2="500" y2="130"/>
<line x1="500" y1="130" x2="510" y2="130"/>
<line x1="510" y1="130" x2="520" y2="130"/>
<line x1="520" y1="130" x2="525" y2="130"/>
<line x1="525" y1="119" x2="525" y2="130"/>
<line x1="615" y1="119" x2="615" y2="141"/>
<line x1="5" y1="139" x2="5" y2="161"/>
<line x1="115" y1="139" x2="115" y2="161"/>
<line x1="285" y1="139" x2="285" y2="161"/>
<line x1="455" y1="139" x2="455" y2="161"/>
<line x1="625" y1="139" x2="625" y2="161"/>
<line x1="5" y1="159" x2="5" y2="181"/>
<line x1="115" y1="170" x2="120" y2="170"/>
<line x1="115" y1="159" x2="115" y2="170"/>
<line x1="120" y1="170" x2="130" y2="170"/>
<line x1="130" y1="170" x2="140" y2="170"/>
<line x1="140" y1="170" x2="150" y2="170"/>
<line x1="150" y1="170" x2="160" y2="170"/>
<line x1="160" y1="170" x2="170" y2="170"/>
<line x1="170" y1="170" x2="180" y2="170"/>
<line x1="180" y1="170" x2="190" y2="170"/>
<line x1="190" y1="170" x2="200" y2="170"/>
<line x1="200" y1="170" x2="210" y2="170"/>
<line x1="210" y1="170" x2="220" y2="170"/>
<line x1="220" y1="170" x2="230" y2="170"/>
<line x1="230" y1="170" x2="240" y2="170"/>
<line x1="240" y1="170" x2="250" y2="170"/>
<line x1="250" y1="170" x2="260" y2="170"/>
<line x1="260" y1="170" x2="270" y2="170"/>
<line x1="270" y1="170" x2="280" y2="170"/>
<line x1="280" y1="170" x2="290" y2="170"/>
<line x1="285" y1="159" x2="285" y2="181"/>
<line x1="290" y1="170" x2="300" y2="170"/>
<line x1="300" y1="170" x2="310" y2="170"/>
<line x1="310" y1="170" x2="320" y2="170"/>
<line x1="320" y1="170" x2="330" y2="170"/>
<line x1="330" y1="170" x2="340" y2="170"/>
<line x1="340" y1="170" x2="350" y2="170"/>
<line x1="350" y1="170" x2="360" y2="170"/>
<line x1="360" y1="170" x2="370" y2="170"/>
<line x1="370" y1="170" x2="380" y2="170"/>
<line x1="380" y1="170" x2="390" y2="170"/>
<line x1="390" y1="170" x2="400" y2="170"/>
<line x1="400" y1="170" x2="410" y2="170"/>
<line x1="410" y1="170" x2="420" y2="170"/>
<line x1="420" y1="170" x2="430" y2="170"/>
<line x1="430" y1="170" x2="440" y2="170"/>
<line x1="440" y1="170" x2="450" y2="170"/>
<line x1="450" y1="170" x2="455" y2="170"/>
<line x1="455" y1="159" x2="455" y2="170"/>
<line x1="625" y1="159" x2="625" y2="181"/>
<line x1="5" y1="179" x2="5" y2="201"/>
<line x1="285" y1="179" x2="285" y2="201"/>
<line x1="625" y1="179" x2="625" y2="201"/>
<line x1="5" y1="199" x2="5" y2="221"/>
<text x="210" y="210">Coq</text>
<text x="250" y="210">Extraction</text>
<line x1="625" y1="199" x2="625" y2="221"/>
<line x1="5" y1="219" x2="5" y2="241"/>
<line x1="285" y1="219" x2="285" y2="241"/>
<line x1="625" y1="219" x2="625" y2="241"/>
<line x1="5" y1="239" x2="5" y2="261"/>
<line x1="215" y1="250" x2="220" y2="250"/>
<line x1="215" y1="250" x2="215" y2="261"/>
<line x1="220" y1="250" x2="230" y2="250"/>
<line x1="230" y1="250" x2="240" y2="250"/>
<line x1="240" y1="250" x2="250" y2="250"/>
<line x1="250" y1="250" x2="260" y2="250"/>
<line x1="260" y1="250" x2="270" y2="250"/>
<line x1="270" y1="250" x2="280" y2="250"/>
<line x1="290" y1="250" x2="300" y2="250"/>
<line x1="300" y1="250" x2="310" y2="250"/>
<line x1="310" y1="250" x2="320" y2="250"/>
<line x1="320" y1="250" x2="330" y2="250"/>
<line x1="330" y1="250" x2="340" y2="250"/>
<line x1="340" y1="250" x2="350" y2="250"/>
<line x1="350" y1="250" x2="355" y2="250"/>
<line x1="355" y1="250" x2="355" y2="261"/>
<line x1="625" y1="239" x2="625" y2="261"/>
<line x1="5" y1="259" x2="5" y2="281"/>
<line x1="215" y1="259" x2="215" y2="281"/>
<text x="260" y="270">OCaml</text>
<line x1="355" y1="259" x2="355" y2="281"/>
<line x1="625" y1="259" x2="625" y2="281"/>
<line x1="5" y1="279" x2="5" y2="301"/>
<line x1="215" y1="279" x2="215" y2="301"/>
<text x="250" y="290">~1000</text>
<text x="310" y="290">LOC</text>
<line x1="355" y1="279" x2="355" y2="301"/>
<line x1="625" y1="279" x2="625" y2="301"/>
<line x1="5" y1="299" x2="5" y2="321"/>
<line x1="215" y1="310" x2="220" y2="310"/>
<line x1="215" y1="299" x2="215" y2="310"/>
<line x1="220" y1="310" x2="230" y2="310"/>
<line x1="230" y1="310" x2="240" y2="310"/>
<line x1="240" y1="310" x2="250" y2="310"/>
<line x1="250" y1="310" x2="260" y2="310"/>
<line x1="260" y1="310" x2="270" y2="310"/>
<line x1="270" y1="310" x2="280" y2="310"/>
<line x1="280" y1="310" x2="290" y2="310"/>
<line x1="290" y1="310" x2="300" y2="310"/>
<line x1="300" y1="310" x2="310" y2="310"/>
<line x1="310" y1="310" x2="320" y2="310"/>
<line x1="320" y1="310" x2="330" y2="310"/>
<line x1="330" y1="310" x2="340" y2="310"/>
<line x1="340" y1="310" x2="350" y2="310"/>
<line x1="350" y1="310" x2="355" y2="310"/>
<line x1="355" y1="299" x2="355" y2="310"/>
<line x1="625" y1="299" x2="625" y2="321"/>
<line x1="5" y1="319" x2="5" y2="341"/>
<line x1="625" y1="319" x2="625" y2="341"/>
<line x1="5" y1="339" x2="5" y2="361"/>
<text x="40" y="350">Proven</text>
<text x="110" y="350">in</text>
<text x="140" y="350">Coq.</text>
<text x="190" y="350">Extracted</text>
<text x="290" y="350">to</text>
<text x="320" y="350">OCaml.</text>
<text x="390" y="350">Called</text>
<text x="460" y="350">from</text>
<text x="510" y="350">Scheme.</text>
<line x1="615" y1="339" x2="615" y2="361"/>
<line x1="5" y1="359" x2="5" y2="381"/>
<line x1="625" y1="359" x2="625" y2="381"/>
<line x1="5" y1="390" x2="10" y2="390"/>
<line x1="5" y1="379" x2="5" y2="390"/>
<line x1="10" y1="390" x2="20" y2="390"/>
<line x1="20" y1="390" x2="30" y2="390"/>
<line x1="30" y1="390" x2="40" y2="390"/>
<line x1="40" y1="390" x2="50" y2="390"/>
<line x1="50" y1="390" x2="60" y2="390"/>
<line x1="60" y1="390" x2="70" y2="390"/>
<line x1="70" y1="390" x2="80" y2="390"/>
<line x1="80" y1="390" x2="90" y2="390"/>
<line x1="90" y1="390" x2="100" y2="390"/>
<line x1="100" y1="390" x2="110" y2="390"/>
<line x1="110" y1="390" x2="120" y2="390"/>
<line x1="120" y1="390" x2="130" y2="390"/>
<line x1="130" y1="390" x2="140" y2="390"/>
<line x1="140" y1="390" x2="150" y2="390"/>
<line x1="150" y1="390" x2="160" y2="390"/>
<line x1="160" y1="390" x2="170" y2="390"/>
<line x1="170" y1="390" x2="180" y2="390"/>
<line x1="180" y1="390" x2="190" y2="390"/>
<line x1="190" y1="390" x2="200" y2="390"/>
<line x1="200" y1="390" x2="210" y2="390"/>
<line x1="210" y1="390" x2="220" y2="390"/>
<line x1="220" y1="390" x2="230" y2="390"/>
<line x1="230" y1="390" x2="240" y2="390"/>
<line x1="240" y1="390" x2="250" y2="390"/>
<line x1="250" y1="390" x2="260" y2="390"/>
<line x1="260" y1="390" x2="270" y2="390"/>
<line x1="270" y1="390" x2="280" y2="390"/>
<line x1="280" y1="390" x2="290" y2="390"/>
<line x1="290" y1="390" x2="300" y2="390"/>
<line x1="300" y1="390" x2="310" y2="390"/>
<line x1="310" y1="390" x2="320" y2="390"/>
<line x1="320" y1="390" x2="330" y2="390"/>
<line x1="330" y1="390" x2="340" y2="390"/>
<line x1="340" y1="390" x2="350" y2="390"/>
<line x1="350" y1="390" x2="360" y2="390"/>
<line x1="360" y1="390" x2="370" y2="390"/>
<line x1="370" y1="390" x2="380" y2="390"/>
<line x1="380" y1="390" x2="390" y2="390"/>
<line x1="390" y1="390" x2="400" y2="390"/>
<line x1="400" y1="390" x2="410" y2="390"/>
<line x1="410" y1="390" x2="420" y2="390"/>
<line x1="420" y1="390" x2="430" y2="390"/>
<line x1="430" y1="390" x2="440" y2="390"/>
<line x1="440" y1="390" x2="450" y2="390"/>
<line x1="450" y1="390" x2="460" y2="390"/>
<line x1="460" y1="390" x2="470" y2="390"/>
<line x1="470" y1="390" x2="480" y2="390"/>
<line x1="480" y1="390" x2="490" y2="390"/>
<line x1="490" y1="390" x2="500" y2="390"/>
<line x1="500" y1="390" x2="510" y2="390"/>
<line x1="510" y1="390" x2="520" y2="390"/>
<line x1="520" y1="390" x2="530" y2="390"/>
<line x1="530" y1="390" x2="540" y2="390"/>
<line x1="540" y1="390" x2="550" y2="390"/>
<line x1="550" y1="390" x2="560" y2="390"/>
<line x1="560" y1="390" x2="570" y2="390"/>
<line x1="570" y1="390" x2="580" y2="390"/>
<line x1="580" y1="390" x2="590" y2="390"/>
<line x1="590" y1="390" x2="600" y2="390"/>
<line x1="600" y1="390" x2="610" y2="390"/>
<line x1="610" y1="390" x2="620" y2="390"/>
<line x1="620" y1="390" x2="625" y2="390"/>
<line x1="625" y1="379" x2="625" y2="390"/>
</svg>
</div>
</section>
<section>
<h2>Coq Specifications</h2>
<h3>Types</h3>
<pre class="language-coq">
( Byte arrays )
Definition bytes := list byte.

( Keys )
Record ed25519publickey := {
  pkbytes : bytes;
  pklength : length pkbytes = 32
}.

Record ed25519privatekey := {
  skbytes : bytes;
  sklength : length skbytes = 64
}.

( Signatures )
Record ed25519signature := {
  sigbytes : bytes;
  siglength : length sigbytes = 64
}.

( Hashes )
Record sha512hash := {
  hashbytes : bytes;
  hashlength : length hashbytes = 64
}.
</pre>
<h3>Signature Specification</h3>
<pre class="language-coq">
( Abstract signature scheme )
Module Type ED25519SPEC.
  Parameter sign : ed25519privatekey -&gt; bytes -&gt; ed25519signature.
  Parameter verify : ed25519publickey -&gt; bytes -&gt; ed25519signature -&gt; bool.

  ( Correctness: valid signatures verify )
  Axiom signverifycorrect :
    forall sk pk msg,
      pk = derivepublic sk -&gt;
      verify pk msg (sign sk msg) = true.

  ( Security: cannot forge without private key )
  Axiom unforgeability :
    forall pk msg sig,
      verify pk msg sig = true -&gt;
      exists sk, pk = derivepublic sk /\ sig = sign sk msg.
End ED25519SPEC.
</pre>
<h3>Hash Specification</h3>
<pre class="language-coq">
Module Type SHA512SPEC.
  Parameter hash : bytes -&gt; sha512hash.

  ( Determinism )
  Axiom hashdeterministic :
    forall x, hash x = hash x.

  ( Collision resistance (assumed) )
  Axiom collisionresistant :
    forall x y, hash x = hash y -&gt; x = y. ( Idealized )
End SHA512_SPEC.
</pre>
<h3>Chain Verification</h3>
<pre class="language-coq">
( Certificate chain verification )
Fixpoint verifychain
  (root : ed25519publickey)
  (certs : list signedcert)
  (targettag : tag) : bool :=
  match certs with
  | nil =&gt; false
  | cert :: rest =&gt;
      let issuerkey := certissuer cert in
      let subjectkey := certsubject cert in
      let certtag := certtag cert in
      ( Check issuer matches current key )
      andb (keyeq root issuerkey)
      ( Check signature valid )
      (andb (verify issuerkey (certcontent cert) (certsignature cert))
      ( Check tag grants permission )
      (andb (tagimplies certtag targettag)
      ( Continue chain )
      (match rest with
       | nil =&gt; true
       |  =&gt; verifychain subjectkey rest targettag
       end)))
  end.

( Theorem: Valid chain implies authorization )
Theorem chainauthorization :
  forall root certs tag,
    verify_chain root certs tag = true -&gt;
    authorized root tag.
Proof.
  ( Proof by induction on chain length )
  ...
Qed.
</pre>
</section>
<section>
<h2>Extraction to OCaml</h2>
<h3>Extraction Directives</h3>
<pre class="language-coq">
Require Import ExtrOcamlBasic.
Require Import ExtrOcamlString.

( Extract to OCaml types )
Extract Inductive bool =&gt; "bool" ["true" "false"].
Extract Inductive list =&gt; "list" ["[]" "(::)"].

( Link to libsodium )
Extract Constant ed25519sign =&gt; "Sodium.Ed25519.sign".
Extract Constant ed25519verify =&gt; "Sodium.Ed25519.verify".
Extract Constant sha512hash =&gt; "Sodium.SHA512.hash".

( Generate OCaml )
Extraction "tcb.ml" verifychain sign verify hash.
</pre>
<h3>Generated OCaml</h3>
<pre class="language-ocaml">
( tcb.ml - Extracted from Coq )

let rec verifychain root certs targettag =
  match certs with
  | [] -&gt; false
  | cert :: rest -&gt;
      let issuerkey = certissuer cert in
      let subjectkey = certsubject cert in
      keyeq root issuerkey &amp;&amp;
      Sodium.Ed25519.verify issuerkey (certcontent cert) (certsignature cert) &amp;&amp;
      tagimplies (certtag cert) targettag &amp;&amp;
      (match rest with
       | [] -&gt; true
       |  -&gt; verifychain subjectkey rest targettag)
</pre>
</section>
<section>
<h2>Integration with Scheme</h2>
<h3>FFI Layer</h3>
<pre class="language-ocaml">
( tcbffi.ml - FFI bindings for Chicken Scheme )

let () = Callback.register "tcbverifychain" verifychain
let () = Callback.register "tcbsign" sign
let () = Callback.register "tcbverify" verify
let () = Callback.register "tcb_hash" hash
</pre>
<h3>Scheme Bindings</h3>
<pre class="language-scheme">
;; crypto-ffi.scm
(module crypto-ffi
  (ed25519-sign ed25519-verify sha512-hash verify-chain)

  (import (chicken foreign))

  ;; Call into verified OCaml
  (define ed25519-sign
    (foreign-lambda blob ((blob key) (blob msg))
      "return tcbsign(key, msg);"))

  (define verify-chain
    (foreign-lambda bool ((blob root) (pointer certs) (pointer tag))
      "return tcbverify_chain(root, certs, tag);"))

  ...)
</pre>
</section>
<section>
<h2>Proof Obligations</h2>
<h3>What We Prove</h3>
<ul>
<li>Signature correctness: Valid signatures verify</li>
<li>Chain soundness: Valid chain implies authorization</li>
<li>Hash properties: Determinism, length preservation</li>
<li>Type safety: No buffer overflows, no null pointers</li>
</ul>
<h3>What We Assume</h3>
<ul>
<li>Cryptographic hardness: Ed25519 unforgeability</li>
<li>libsodium correctness: Implementation matches spec</li>
<li>OCaml runtime: Extraction target is correct</li>
<li>Hardware: CPU executes instructions correctly</li>
</ul>
<h3>Trust Chain</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 360 180" width="360" height="180" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">Mathematical</text>
<text x="130" y="10">proof</text>
<text x="190" y="10">(Coq)</text>
<text x="0" y="50">Extraction</text>
<text x="110" y="50">(verified</text>
<text x="210" y="50">by</text>
<text x="240" y="50">Coq)</text>
<text x="0" y="90">OCaml</text>
<text x="60" y="90">code</text>
<text x="110" y="90">(typed,</text>
<text x="190" y="90">memory-safe)</text>
<text x="0" y="130">libsodium</text>
<text x="100" y="130">(audited,</text>
<text x="200" y="130">widely</text>
<text x="270" y="130">deployed)</text>
<text x="0" y="170">CPU</text>
<text x="40" y="170">instructions</text>
<text x="170" y="170">(trust</text>
<text x="240" y="170">hardware)</text>
</svg>
</div>
</section>
<section>
<h2>Development Workflow</h2>
<h3>1. Specify in Coq</h3>
<pre class="language-coq">
( Define types and operations )
( State properties and theorems )
</pre>
<h3>2. Prove Correctness</h3>
<pre class="language-coq">
( Prove theorems )
( Coq checks proofs mechanically )
</pre>
<h3>3. Extract to OCaml</h3>
<pre class="language-bash">
$ coqc -R . Cyberspace tcb.v
$ coqc -R . Cyberspace extract.v
$ ls *.ml
tcb.ml tcb_types.ml
</pre>
<h3>4. Compile and Link</h3>
<pre class="language-bash">
$ ocamlfind ocamlopt -package sodium -linkpkg \
    tcb.ml tcb_ffi.ml -o tcb.cmxa
</pre>
<h3>5. Call from Scheme</h3>
<pre class="language-scheme">
(import crypto-ffi)
(ed25519-sign key message)  ; Calls verified code
</pre>
</section>
<section>
<h2>Existing Verified Libraries</h2>
<h3>Fiat-Crypto</h3>
<ul>
<li>Verified elliptic curve implementations</li>
<li>Used by BoringSSL, Chrome</li>
<li>Extraction to C, Java, Go</li>
</ul>
<h3>HACL*</h3>
<ul>
<li>Verified cryptographic library</li>
<li>Written in F* (similar to Coq)</li>
<li>Used by Firefox, Wireguard</li>
</ul>
<h3>Potential Use</h3>
<pre class="language-coq">
Require Import Fiat.Crypto.Ed25519.
( Use pre-verified Ed25519 implementation )
</pre>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Verified Components</h3>
<ul>
<li>Signature operations</li>
<li>Hash operations</li>
<li>Chain verification logic</li>
</ul>
<h3>Unverified (Trusted)</h3>
<ul>
<li>FFI layer (small, auditable) - libsodium bindings</li>
<li>Scheme runtime</li>
</ul>
<h3>Audit Surface</h3>
<pre>
Total TCB:     ~1000 lines OCaml
Verified:      ~800 lines (extracted from ~2000 lines Coq)
Trusted:       ~200 lines (FFI, bindings)
</pre>
</section>
<section>
<h2>References</h2>
<ul>
<li>Coq Development Team. The Coq Proof Assistant Reference Manual.</li>
<li>Erbsen, A., et al. (2019). Simple High-Level Code for Cryptographic Arithmetic.</li>
<li>Protzenko, J., et al. (2017). Verified Low-Level Programming Embedded in F*.</li>
<li>Chlipala, A. (2013). Certified Programming with Dependent Types.</li>
<li>Memo-0001: Cyberspace Architecture</li>
</ul>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-06</li>
<li>Initial specification</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
