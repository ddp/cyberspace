%!PS-Adobe-3.0
%%Title: memo-0053-compilation
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0053: Compilation and Debugging Manual) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This Memo is the compilation and debugging manual for Cyberspace Scheme.) show newline
(It specifies type inference conventions, build system architecture,) show newline
(debugging infrastructure, exception handling, and inspector design. The) show newline
(guiding principles are Ada's "declare everything, infer nothing" and) show newline
(Dylan's "inspect everything, hide nothing.") show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PART I: COMPILATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(1. TYPE SYSTEM OVERVIEW) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(1.1 Chicken's Scrutinizer) show newline
(-------------------------) show newline
() show newline
(Chicken Scheme includes a flow-sensitive type analyzer called the) show newline
(scrutinizer. When invoked with -strict-types, it performs whole-program) show newline
(type inference and reports errors when types cannot be proven safe.) show newline
() show newline
(The scrutinizer tracks type information through:) show newline
() show newline
(  * Variable bindings and assignments) show newline
(  * Conditional branches \(if, cond, case\)) show newline
(  * Procedure calls and returns) show newline
(  * Special forms \(let, let*, letrec\)) show newline
() show newline
() show newline
(1.2 The Inference Problem) show newline
(-------------------------) show newline
() show newline
(Whole-program type inference without declarations can exhibit) show newline
(exponential complexity. The scrutinizer's flow-sensitive analysis) show newline
(becomes intractable when:) show newline
() show newline
(  * Functions contain many conditional branches with side effects) show newline
(  * Format strings \(sprintf\) create implicit polymorphic constraints) show newline
(  * Type information cannot flow through set! mutations) show newline
(  * Multiple paths merge with incompatible inferred types) show newline
() show newline
(Empirical observation: A function with 30 conditional sprintf calls can) show newline
(take 5+ minutes to analyze. The same function with type declarations) show newline
(compiles in under 1 second.) show newline
() show newline
() show newline
(1.3 The Ada Principle) show newline
(---------------------) show newline
() show newline
(Ada's compilation model requires explicit type declarations everywhere.) show newline
(The compiler is a checker, not a guesser. Jean Ichbiah's design traded) show newline
(verbosity for predictability - when Ada compiles, it tends to run) show newline
(correctly.) show newline
() show newline
(For Cyberspace modules, we adopt this principle:) show newline
() show newline
() show newline
(    DECLARE EVERYTHING, INFER NOTHING) show newline
() show newline
(Benefits:) show newline
() show newline
(  * Predictable compilation times) show newline
(  * Better error messages \(mismatch against declaration, not inference\)) show newline
(  * Documentation of programmer intent) show newline
(  * Enables separate compilation) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(2. TYPE DECLARATION CONVENTIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(2.1 Required Import) show newline
(-------------------) show newline
() show newline
(Modules using type declarations must import the type system:) show newline
() show newline
() show newline
(    \(import \(chicken type\)\)) show newline
() show newline
(Place this import with other chicken imports, before srfi and cyberspace) show newline
(modules.) show newline
() show newline
() show newline
(2.2 Declaration Placement) show newline
(-------------------------) show newline
() show newline
(Type declarations are placed in a dedicated section after imports,) show newline
(before any function definitions:) show newline
() show newline
() show newline
(    \(module example) show newline
(      \(export1 export2\)) show newline
(      \(import scheme) show newline
(              \(chicken base\)) show newline
(              \(chicken type\)) show newline
(              ...\)) show newline
(      ;;; ============================================================) show newline
(      ;;; Type Declarations) show newline
(      ;;; ============================================================) show newline
(      \(: export1 \(string -> boolean\)\)) show newline
(      \(: export2 \(fixnum fixnum -> fixnum\)\)) show newline
(      \(: internal-helper \(list -> \(or string false\)\)\)) show newline
(      ;;; ============================================================) show newline
(      ;;; Implementation) show newline
(      ;;; ============================================================) show newline
(      \(define \(export1 s\) ...\)) show newline
(      ...\)) show newline
() show newline
() show newline
(2.3 Declaration Syntax) show newline
(----------------------) show newline
() show newline
(The \(: name type\) form declares the type of a binding:) show newline
() show newline
() show newline
(    ;; Simple function types) show newline
(    \(: add1 \(fixnum -> fixnum\)\)) show newline
(    \(: string-empty? \(string -> boolean\)\)) show newline
(    ;; Multiple arguments) show newline
(    \(: substring \(string fixnum fixnum -> string\)\)) show newline
(    ;; Optional arguments) show newline
(    \(: open-file \(string #!optional symbol -> port\)\)) show newline
(    ;; Rest arguments) show newline
(    \(: format \(string #!rest * -> string\)\)) show newline
(    ;; Union types) show newline
(    \(: find-item \(symbol -> \(or item false\)\)\)) show newline
(    ;; Procedures as arguments) show newline
(    \(: map-items \(\(item -> result\) \(list-of item\) -> \(list-of result\)\)\)) show newline
(    ;; No return \(exits or loops forever\)) show newline
(    \(: fatal-error \(string -> noreturn\)\)) show newline
() show newline
() show newline
(2.4 Common Type Names) show newline
(---------------------) show newline
() show newline
() show newline
(  Type           Description          Example Values         ) show newline
(  fixnum         Small exact integer  0, 42, -17             ) show newline
(  flonum         Floating point       3.14, -2.5e10          ) show newline
(  number         Any number           fixnum or flonum       ) show newline
(  string         Character string     "hello"                ) show newline
(  symbol         Symbolic atom        'foo, 'bar             ) show newline
(  boolean        Truth value          #t, #f                 ) show newline
(  char           Single character     #\\a, #\\newline         ) show newline
(  list           Proper list          '\(1 2 3\)               ) show newline
(  \(list-of T\)    Homogeneous list     \(list-of string\)       ) show newline
(  pair           Cons cell            '\(a . b\)               ) show newline
(  vector         Fixed-size array     #\(1 2 3\)               ) show newline
(  blob           Byte vector          \(make-blob 16\)         ) show newline
(  port           I/O port             \(current-input-port\)   ) show newline
(  procedure      Any procedure        car, +                 ) show newline
(  \(T1 -> T2\)     Specific procedure   \(string -> fixnum\)     ) show newline
(  \(or T1 T2\)     Union type           \(or string false\)      ) show newline
(  \(struct name\)  C struct wrapper     \(struct tcp-listener\)  ) show newline
(  false          The #f value         #f                     ) show newline
(  *              Any type             anything               ) show newline
(  noreturn       Never returns        for exit, error        ) show newline
() show newline
() show newline
(2.5 When Declarations Are Required) show newline
(----------------------------------) show newline
() show newline
(Type declarations are REQUIRED for:) show newline
() show newline
(  * Functions with more than 5 conditional branches) show newline
(  * Functions using set! on local variables) show newline
(  * Functions with multiple sprintf/format calls) show newline
(  * All exported \(public API\) functions) show newline
(  * Functions that call other modules' exported functions) show newline
() show newline
(Type declarations are OPTIONAL for:) show newline
() show newline
(  * Simple leaf functions \(< 5 lines, no branching\)) show newline
(  * Local helper functions with obvious types) show newline
(  * Functions used only in one place) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(3. TYPED HELPER PATTERN) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(3.1 The Problem) show newline
(---------------) show newline
() show newline
(A common pattern causes exponential inference:) show newline
() show newline
() show newline
(    ;; BAD: Exponential type inference) show newline
(    \(define \(session-summary\)) show newline
(      \(let \(\(stats '\(\)\)\)) show newline
(        \(when \(> \(session-stat 'reads\) 0\)) show newline
(          \(set! stats \(cons \(sprintf "~a read~a") show newline
(                                      \(session-stat 'reads\)) show newline
(                                      \(if \(= 1 \(session-stat 'reads\)\) "" "s"\)\)) show newline
(                            stats\)\)\)) show newline
(        \(when \(> \(session-stat 'writes\) 0\)) show newline
(          \(set! stats \(cons \(sprintf "~a write~a" ...\) stats\)\)\)) show newline
(        ;; ... 28 more similar blocks ...) show newline
(        \(reverse stats\)\)\)) show newline
() show newline
(The scrutinizer must analyze all 2^30 possible paths through this) show newline
(function.) show newline
() show newline
() show newline
(3.2 The Solution) show newline
(----------------) show newline
() show newline
(Factor into small typed helpers:) show newline
() show newline
() show newline
(    ;; GOOD: Linear type inference) show newline
(    \(: format-stat \(symbol string string -> \(or string false\)\)\)) show newline
(    \(define \(format-stat key singular plural-suffix\)) show newline
(      "Format a session stat with pluralization, or #f if zero.") show newline
(      \(let \(\(n \(session-stat key\)\)\)) show newline
(        \(if \(> n 0\)) show newline
(            \(string-append \(number->string n\) " " singular) show newline
(                           \(if \(= n 1\) "" plural-suffix\)\)) show newline
(            #f\)\)\)) show newline
(    \(: format-stat-irregular \(symbol string string -> \(or string false\)\)\)) show newline
(    \(define \(format-stat-irregular key singular plural\)) show newline
(      "Format with irregular plural.") show newline
(      \(let \(\(n \(session-stat key\)\)\)) show newline
(        \(if \(> n 0\)) show newline
(            \(string-append \(number->string n\) " ") show newline
(                           \(if \(= n 1\) singular plural\)\)) show newline
(            #f\)\)\)) show newline
(    \(: session-summary \(-> \(list-of string\)\)\)) show newline
(    \(define \(session-summary\)) show newline
(      "Generate session statistics summary.") show newline
(      \(filter identity) show newline
(        \(list) show newline
(          \(format-stat 'reads "read" "s"\)) show newline
(          \(format-stat 'writes "write" "s"\)) show newline
(          \(format-stat-irregular 'queries "query" "queries"\)) show newline
(          ...\)\)\)) show newline
() show newline
(Each helper is independently typed. The scrutinizer analyzes them) show newline
(separately, giving O\(n\) instead of O\(2^n\) complexity.) show newline
() show newline
() show newline
(3.3 Composition via filter) show newline
(--------------------------) show newline
() show newline
(The pattern \(filter identity \(list ...\)\) collects non-#f results:) show newline
() show newline
() show newline
(    \(filter identity \(list "a" #f "b" #f "c"\)\)) show newline
(    ;; => \("a" "b" "c"\)) show newline
() show newline
(This replaces imperative set!/cons accumulation with functional) show newline
(composition.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(4. BUILD SYSTEM ARCHITECTURE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(4.1 The Forge) show newline
(-------------) show newline
() show newline
(The forge is the build system for Cyberspace modules. It compiles Scheme) show newline
(to shared libraries \(.so\) with import specifications \(.import.scm\).) show newline
() show newline
(The name is deliberate. Not CompilationManager or BuildSystem - forge.) show newline
(Words a squirrel would use. The same MIT hackers who gave us LISP,) show newline
(Scheme, and the λ-calculus named things to mean something: lambda,) show newline
(cons, car, cdr. We continue that tradition: forge, vault, portal,) show newline
(gossip, bloom, keyring.) show newline
() show newline
(Invocation:) show newline
() show newline
() show newline
(    \(bootstrap-modules!\)  ; Called automatically at REPL start) show newline
() show newline
(Output format:) show newline
() show newline
() show newline
(    +---------------- forge: portal ----------------+) show newline
(    | csc -shared -J -strict-types portal.scm       |) show newline
(    | ✓ 241K + 677B import in 921ms                 |) show newline
(    |   296 LOC · 42 λ · 7 LOC/λ                    |) show newline
(    +-----------------------------------------------+) show newline
() show newline
(The SICP metrics line shows:) show newline
() show newline
(  * LOC: Lines of code \(excluding blanks and comments\)) show newline
(  * λ: Procedure definitions \(define + lambda forms\)) show newline
(  * LOC/λ: Average lines per procedure \(smaller = more compositional\)) show newline
() show newline
(The fundamental unit is not the line - it's the λ. This is the heritage) show newline
(of computer science invented at MIT by smart squirrel/hackers:) show newline
(McCarthy's LISP, Sussman and Steele's Scheme, the AI Lab, Building 20.) show newline
(They saw computation as pure thought, λ as the primitive, parentheses) show newline
(as liberation not burden.) show newline
() show newline
(Measuring λ-density is measuring compositional discipline. A module) show newline
(with 6 LOC/λ has crystallized more thought per line than one with 10.) show newline
(The ratio tells you how SICP-minded the code is.) show newline
() show newline
(Metrics are stored in .forge/<module>.meta as s-expressions:) show newline
() show newline
() show newline
(    \(\(module . "vault"\)) show newline
(     \(timestamp . 1768359548\)) show newline
(     \(so-size . 951016\)) show newline
(     \(import-size . 3258\)) show newline
(     \(compile-time-ms . 12686\)) show newline
(     \(metrics \(loc . 2793\) \(lambdas . 260\) \(imports . 1\) \(loc/lambda . 10\)\)\)) show newline
() show newline
(The forge knows how λ-dense your code is. Each compilation records:) show newline
(timestamp \(Unix epoch\), artifact sizes, build time, and the metrics that) show newline
(matter - lines of code, lambda count, λ-density ratio.) show newline
() show newline
(Queryable via:) show newline
() show newline
() show newline
(    \(forged "portal"\)     ; Single module metrics) show newline
(    \(forged-all\)          ; Bitfarm harvest: all modules) show newline
(    \(sicp\)                ; Live analysis \(no forge metadata needed\)) show newline
() show newline
(Standalone script for shell usage:) show newline
() show newline
() show newline
(    $ ./sicp              # From spki/scheme directory) show newline
(    $ lscs                # Shell alias \(defined in .zshrc\)) show newline
() show newline
(Compositional threshold:) show newline
() show newline
() show newline
(    LOC/λ < 10  \(enforced\)) show newline
() show newline
(Modules exceeding 10 LOC/λ trigger a warning during forge and are) show newline
(flagged in sicp output. This enforces SICP-style compositional) show newline
(discipline: small procedures composed to build complex behavior.) show newline
() show newline
(Current totals \(v0.61\):) show newline
() show newline
() show newline
(    Σ 8502 LOC · 920 λ · 9 LOC/λ ✓) show newline
() show newline
() show newline
(4.2 Compiler Invocation) show newline
(-----------------------) show newline
() show newline
(The forge invokes csc \(Chicken Scheme Compiler\) with these flags:) show newline
() show newline
() show newline
(  Flag           Purpose                                  ) show newline
(  -shared        Produce shared library \(.so\)             ) show newline
(  -J             Generate import library \(.import.scm\)    ) show newline
(  -strict-types  Enable scrutinizer type checking \(beta\)  ) show newline
(  -I path        Add include path \(for FFI\)               ) show newline
(  -L path        Add library path \(for FFI\)               ) show newline
(  -l lib         Link library \(e.g., -lsodium\)            ) show newline
() show newline
(Example invocations:) show newline
() show newline
() show newline
(    # Standard module) show newline
(    csc -shared -J -strict-types portal.scm) show newline
(    # FFI module with libsodium) show newline
(    csc -shared -J -strict-types crypto-ffi.scm \\) show newline
(        -I/opt/homebrew/include -L/opt/homebrew/lib -lsodium) show newline
() show newline
() show newline
(4.3 Dependency Levels) show newline
(---------------------) show newline
() show newline
(Modules are organized into dependency levels. Modules within a level) show newline
(have no mutual dependencies and compile in parallel.) show newline
() show newline
() show newline
(    ;; Level 0: Foundation \(no cyberspace dependencies\)) show newline
(    \("os" "crypto-ffi" "sexp" "capability"\)) show newline
(    ;; Level 1: Core utilities \(depend on Level 0 only\)) show newline
(    \("mdns" "fips" "audit" "wordlist" "bloom") show newline
(     "catalog" "keyring" "portal"\)) show newline
(    ;; Level 2: Certificates and enrollment \(depend on Levels 0-1\)) show newline
(    \("cert" "enroll"\)) show newline
(    ;; Level 3: Protocols \(depend on Levels 0-2\)) show newline
(    \("gossip" "security"\)) show newline
(    ;; Level 4: High-level operations \(depend on Levels 0-3\)) show newline
(    \("vault" "auto-enroll"\)) show newline
(    ;; Level 5: User interface \(depend on all prior\)) show newline
(    \("ui"\)) show newline
() show newline
(To determine a module's level, examine its imports:) show newline
() show newline
(  * If it imports only chicken/srfi modules: Level 0) show newline
(  * If it imports Level 0 modules: Level 1) show newline
(  * If it imports Level N modules: Level N+1 or higher) show newline
() show newline
() show newline
(4.4 Parallel Compilation) show newline
(------------------------) show newline
() show newline
(Each level compiles in parallel using process-fork:) show newline
() show newline
() show newline
(    \(define \(rebuild-level-parallel! modules\)) show newline
(      \(let \(\(pids \(map \(lambda \(module\)) show newline
(                         \(process-fork) show newline
(                           \(lambda \(\)) show newline
(                             \(rebuild-module! module\)) show newline
(                             \(exit 0\)\)\)\)) show newline
(                       modules\)\)\)) show newline
(        \(for-each process-wait pids\)) show newline
(        \(length modules\)\)\)) show newline
() show newline
(The build blocks until all processes in a level complete before starting) show newline
(the next level. This ensures dependencies are satisfied.) show newline
() show newline
() show newline
(4.5 Architecture Neutrality) show newline
(---------------------------) show newline
() show newline
(The weave must be universal. Only content-addressed,) show newline
(architecture-neutral artifacts flow through the weave: s-expressions,) show newline
(signatures, proofs. Binary artifacts \(.so, .o, the REPL executable\) are) show newline
(local materializations - ephemeral as the hardware they run on.) show newline
() show newline
(Machine code is gibberish outside the local realm. Could be ARM64, could) show newline
(be x86_64, could be a JPEG of a cat. The weave cannot inspect it, cannot) show newline
(verify it, cannot reason about it. Only the s-expression source has) show newline
(universal meaning - it parses the same on lambda as on fluffy as on) show newline
(whatever Linux box joins the realm next.) show newline
() show newline
(Consequently, compiled artifacts are excluded from version control and) show newline
(replication:) show newline
() show newline
() show newline
(    # .gitignore) show newline
(    spki/scheme/cyberspace-repl) show newline
(    spki/scheme/*.so) show newline
(    spki/scheme/*.o) show newline
(    spki/scheme/*.import.scm) show newline
(    spki/scheme/.*.arch) show newline
() show newline
(Each node compiles its own. Lambda is portable. Machine code is not.) show newline
() show newline
() show newline
(4.6 Rebuild Detection) show newline
(---------------------) show newline
() show newline
(A module needs rebuilding when any of these conditions hold:) show newline
() show newline
(  * The .so file does not exist) show newline
(  * The .import.scm file does not exist) show newline
(  * The source .scm is newer than the .so \(mtime comparison\)) show newline
(  * The platform stamp doesn't match \(e.g., Darwin-arm64 vs Linux-x86_64\)) show newline
() show newline
() show newline
(    \(define \(needs-rebuild? module\)) show newline
(      \(or \(not \(file-exists? \(string-append module ".so"\)\)\)) show newline
(          \(not \(file-exists? \(string-append module ".import.scm"\)\)\)) show newline
(          \(> \(file-mtime \(string-append module ".scm"\)\)) show newline
(             \(file-mtime \(string-append module ".so"\)\)\)) show newline
(          \(not \(string=? \(read-arch-stamp module\) \(current-arch\)\)\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(5. BETA VS PRODUCTION BUILDS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(5.1 Build Mode Flag) show newline
(-------------------) show newline
() show newline
(The *beta-build* flag controls strict type checking:) show newline
() show newline
() show newline
(    ;; In cyberspace-repl.scm) show newline
(    \(define *beta-build* #t\)  ; Enable for development) show newline
(    \(define *beta-build* #f\)  ; Disable for release) show newline
() show newline
() show newline
(5.2 Beta Mode Benefits) show newline
(----------------------) show newline
() show newline
(With *beta-build* = #t:) show newline
() show newline
(  * All modules compile with -strict-types) show newline
(  * Type mismatches are compile-time errors) show newline
(  * Invalid arguments are detected) show newline
(  * Deprecated identifiers are flagged) show newline
(  * Format string errors are caught) show newline
() show newline
(Build time impact: ~20-25 seconds for full rebuild) show newline
() show newline
() show newline
(5.3 Production Mode) show newline
(-------------------) show newline
() show newline
(With *beta-build* = #f:) show newline
() show newline
(  * Modules compile without -strict-types) show newline
(  * Type declarations remain as documentation) show newline
(  * Faster compilation) show newline
(  * Smaller binaries \(no type metadata\)) show newline
() show newline
(Build time impact: ~10-15 seconds for full rebuild) show newline
() show newline
() show newline
(5.4 When to Use Each Mode) show newline
(-------------------------) show newline
() show newline
() show newline
(  Scenario             Mode        Rationale                 ) show newline
(  Active development   Beta        Catch type errors early   ) show newline
(  CI/CD pipeline       Beta        Prevent type regressions  ) show newline
(  Release builds       Production  Optimize for users        ) show newline
(  Debugging issues     Beta        Better error context      ) show newline
(  Performance testing  Production  Measure real performance  ) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PART II: DEBUGGING) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(6. EXCEPTION HANDLING) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(6.1 Condition System) show newline
(--------------------) show newline
() show newline
(Chicken uses the SRFI-12 condition system. Exceptions are condition) show newline
(objects with properties:) show newline
() show newline
() show newline
(    \(handle-exceptions exn) show newline
(      ;; Handler: exn is the condition object) show newline
(      \(print "Error: " \(get-condition-property exn 'exn 'message\)\)) show newline
(      ;; Protected code) show newline
(      \(dangerous-operation\)\)) show newline
() show newline
() show newline
(6.2 Standard Condition Properties) show newline
(---------------------------------) show newline
() show newline
() show newline
(  Property          Type    Description                     ) show newline
(  'exn 'message     string  Human-readable error message    ) show newline
(  'exn 'location    symbol  Procedure where error occurred  ) show newline
(  'exn 'arguments   list    Arguments that caused error     ) show newline
(  'exn 'call-chain  list    Stack trace                     ) show newline
() show newline
() show newline
(    \(define \(safe-operation x\)) show newline
(      \(handle-exceptions exn) show newline
(        \(let \(\(msg \(get-condition-property exn 'exn 'message "unknown"\)\)) show newline
(              \(loc \(get-condition-property exn 'exn 'location #f\)\)) show newline
(              \(chain \(get-condition-property exn 'exn 'call-chain '\(\)\)\)\)) show newline
(          \(printf "Error in ~a: ~a~n" loc msg\)) show newline
(          \(print-call-chain chain\)) show newline
(          #f\)) show newline
(        \(actual-operation x\)\)\)) show newline
() show newline
() show newline
(6.3 Rich Exception Display) show newline
(--------------------------) show newline
() show newline
(The REPL provides rich exception display with box formatting:) show newline
() show newline
() show newline
(    +-------------- Exception ---------------+) show newline
(    | division by zero                       |) show newline
(    | Location: quotient                     |) show newline
(    | Arguments: \(42 0\)                      |) show newline
(    +-----------------------------------------+) show newline
(    | Call Chain:                            |) show newline
(    |   divide-values                        |) show newline
(    |   process-input                        |) show newline
(    |   main-loop                            |) show newline
(    +-----------------------------------------+) show newline
() show newline
(Implementation uses the centralized box-drawing API from os.scm.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(7. TRACING AND PROFILING) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(7.1 Procedure Tracing) show newline
(---------------------) show newline
() show newline
(Trace procedure calls and returns:) show newline
() show newline
() show newline
(    ;; Enable tracing) show newline
(    \(trace foo\)) show newline
(    \(trace bar baz\)) show newline
(    ;; Disable tracing) show newline
(    \(untrace foo\)) show newline
(    \(untrace\)  ; untrace all) show newline
() show newline
(Trace output:) show newline
() show newline
() show newline
(    \(foo 1 2 3\)) show newline
(      |\(bar 1\)) show newline
(      | \(baz 2\)) show newline
(      | baz -> 4) show newline
(      |bar -> 5) show newline
(    foo -> 8) show newline
() show newline
() show newline
(7.2 REPL Trace Commands) show newline
(-----------------------) show newline
() show newline
(CSI provides trace commands:) show newline
() show newline
() show newline
(    ,trace proc     ; trace procedure) show newline
(    ,trace         ; show traced procedures) show newline
(    ,untrace proc  ; stop tracing) show newline
(    ,untrace       ; stop all tracing) show newline
() show newline
() show newline
(7.3 Call Chain) show newline
(--------------) show newline
() show newline
(Get the current call chain at any point:) show newline
() show newline
() show newline
(    \(define \(debug-here\)) show newline
(      \(print-call-chain \(get-call-chain\)\)\)) show newline
(    ;; Or after an error in the REPL:) show newline
(    ,n              ; show call chain) show newline
(    ,c              ; continue) show newline
(    ,d              ; describe exception) show newline
() show newline
() show newline
(7.4 Time Profiling) show newline
(------------------) show newline
() show newline
(Measure execution time:) show newline
() show newline
() show newline
(    \(time \(expensive-operation\)\)) show newline
(    ;; => 0.142s CPU, 0.145s real, 12345 bytes allocated) show newline
() show newline
(For more detailed profiling, compile with -profile and use) show newline
(chicken-profile.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(8. INSPECTOR DESIGN) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Inspired by Dylan's inspector - the gold standard for interactive) show newline
(debugging.) show newline
() show newline
() show newline
(8.1 Design Principles) show newline
(---------------------) show newline
() show newline
(The Dylan inspector philosophy:) show newline
() show newline
(  * INSPECT EVERYTHING: Any object can be inspected) show newline
(  * HIDE NOTHING: Internal structure is visible) show newline
(  * NAVIGATE FREELY: Drill down into any component) show newline
(  * MODIFY CAREFULLY: Live patching with safety checks) show newline
(  * HISTORY MATTERS: Navigation history, bookmarks) show newline
() show newline
() show newline
(8.2 Inspector Commands \(Planned\)) show newline
(--------------------------------) show newline
() show newline
() show newline
(  Command      Action                     ) show newline
(  :i obj       Inspect object             ) show newline
(  :s           Show current object        ) show newline
(  :d N         Descend into slot N        ) show newline
(  :u           Up to parent object        ) show newline
(  :h           Show inspection history    ) show newline
(  :b           Bookmark current object    ) show newline
(  :m slot val  Modify slot value          ) show newline
(  :t           Show object type info      ) show newline
(  :r           Show references to object  ) show newline
() show newline
() show newline
(8.3 Object Display Format) show newline
(-------------------------) show newline
() show newline
() show newline
(    +---------- Inspecting: pair -------------+) show newline
(    | Type: pair                             |) show newline
(    | Address: 0x7fff5fbff8a0                |) show newline
(    +-----------------------------------------+) show newline
(    | [0] car: symbol 'foo                   |) show newline
(    | [1] cdr: pair \(...\)                    |) show newline
(    +-----------------------------------------+) show newline
(    | :d 0  - inspect car                    |) show newline
(    | :d 1  - inspect cdr                    |) show newline
(    | :u    - go back                        |) show newline
(    +-----------------------------------------+) show newline
() show newline
() show newline
(8.4 Type-Specific Inspectors) show newline
(----------------------------) show newline
() show newline
(Specialized display for common types:) show newline
() show newline
(  * Procedures: arity, source location, closure variables) show newline
(  * Ports: direction, filename, position) show newline
(  * Blobs: hex dump, ASCII preview) show newline
(  * Hash tables: key count, load factor, entries) show newline
(  * SPKI certs: issuer, subject, validity, delegation) show newline
(  * Audit entries: timestamp, actor, operation) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(9. REPL DEBUGGING COMMANDS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(9.1 Built-in Commands) show newline
(---------------------) show newline
() show newline
() show newline
(  Command    Description                  ) show newline
(  ,?         Show help                    ) show newline
(  ,l file    Load file                    ) show newline
(  ,r         Show recent expressions      ) show newline
(  ,s         Show current module          ) show newline
(  ,m module  Enter module                 ) show newline
(  ,n         Show call chain after error  ) show newline
(  ,d         Describe last exception      ) show newline
(  ,c         Continue after break         ) show newline
(  ,q         Quit REPL                    ) show newline
(  ,t proc    Trace procedure              ) show newline
(  ,u proc    Untrace procedure            ) show newline
() show newline
() show newline
(9.2 Cyberspace Extensions) show newline
(-------------------------) show newline
() show newline
() show newline
(  Command       Description                ) show newline
(  :rebuild      Force rebuild all modules  ) show newline
(  :status       Show session statistics    ) show newline
(  :soup         Enter soup browser         ) show newline
(  :inspect obj  Inspect object \(planned\)   ) show newline
(  :audit        Show recent audit entries  ) show newline
(  :keys         Show loaded keys           ) show newline
() show newline
() show newline
(9.3 Error Recovery) show newline
(------------------) show newline
() show newline
(After an error, the REPL captures context:) show newline
() show newline
() show newline
(    > \(/ 1 0\)) show newline
(    +-------------- Exception ---------------+) show newline
(    | division by zero                       |) show newline
(    +-----------------------------------------+) show newline
(    > ,n) show newline
(    Call chain:) show newline
(      \(/ 1 0\)) show newline
(      <toplevel>) show newline
(    > ,d) show newline
(    Condition: exn) show newline
(      message: "division by zero") show newline
(      location: /) show newline
(      arguments: \(1 0\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(10. COMPILER WARNINGS REFERENCE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(10.1 Type Warnings) show newline
(------------------) show newline
() show newline
() show newline
(    Warning: Invalid argument) show newline
(      Argument #1 to procedure `tcp-accept' has an invalid type:) show newline
(        false) show newline
(      The expected type is:) show newline
(        \(struct tcp-listener\)) show newline
() show newline
(Fix: Add type check or adjust control flow to ensure correct type.) show newline
() show newline
() show newline
(10.2 Deprecation Warnings) show newline
(-------------------------) show newline
() show newline
() show newline
(    Warning: Deprecated identifier `current-milliseconds') show newline
(      Use of deprecated identifier from module `chicken.time'.) show newline
() show newline
(Fix: Use current-process-milliseconds instead.) show newline
() show newline
() show newline
(10.3 Format String Warnings) show newline
(---------------------------) show newline
() show newline
() show newline
(    Warning: `printf', in format string "~.2f",) show newline
(      illegal format-string character `.') show newline
() show newline
(Fix: Chicken format doesn't support precision specifiers. Use manual) show newline
(rounding.) show newline
() show newline
() show newline
(10.4 Redefinition Warnings) show newline
(--------------------------) show newline
() show newline
() show newline
(    Warning: redefinition of imported value binding: blob=?) show newline
() show newline
(Fix: Either don't redefine, or explicitly shadow with \(only \(chicken) show newline
(blob\) \(not blob=?\)\)) show newline
() show newline
() show newline
(10.5 Warning Policy) show newline
(-------------------) show newline
() show newline
(For production code:) show newline
() show newline
(  * Zero warnings is the goal) show newline
(  * All warnings should be investigated) show newline
(  * Known acceptable warnings should be documented) show newline
(  * CI should fail on new warnings) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(11. PERFORMANCE TUNING) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(11.1 Compilation Performance) show newline
(----------------------------) show newline
() show newline
() show newline
(  Module Size           Without -strict-types  With -strict-types  ) show newline
(  < 500 LOC             ~500ms                 ~700ms              ) show newline
(  500-2000 LOC          ~1s                    ~2s                 ) show newline
(  > 2000 LOC \(typed\)    ~2s                    ~7s                 ) show newline
(  > 2000 LOC \(untyped\)  ~2s                    exponential         ) show newline
() show newline
(Full bootstrap \(21 modules\): ~20-25s with strict types) show newline
() show newline
() show newline
(11.2 Runtime Performance) show newline
(------------------------) show newline
() show newline
(Type declarations have no runtime cost - they're only used at compile) show newline
(time.) show newline
() show newline
(For runtime optimization:) show newline
() show newline
(  * Use fixnum operations for integer math \(fx+, fx<, etc.\)) show newline
(  * Use flonum operations for float math \(fp+, fp<, etc.\)) show newline
(  * Avoid unnecessary string allocation) show newline
(  * Prefer vectors over lists for random access) show newline
(  * Use hash tables for lookup-heavy operations) show newline
() show newline
() show newline
(11.3 Memory Profiling) show newline
(---------------------) show newline
() show newline
(Track allocations:) show newline
() show newline
() show newline
(    \(gc #t\)  ; Force GC and print statistics) show newline
(    \(memory-statistics\)  ; Show current memory use) show newline
() show newline
(For detailed profiling, compile with -profile flag.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(12. MODULE CONVENTIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(12.1 File Structure) show newline
(-------------------) show newline
() show newline
() show newline
(    ;;; module.scm - One line description) show newline
(    ;;;) show newline
(    ;;; Longer description of purpose, heritage, references.) show newline
(    ;;;) show newline
(    ;;; Copyright \(c\) 2026 Author. See LICENSE.) show newline
(    \(module module-name) show newline
(      \(;; Exports grouped by category) show newline
(       export1) show newline
(       export2) show newline
(       ;; Internal \(for testing/debugging\)) show newline
(       internal-helper\)) show newline
(      \(import scheme) show newline
(              \(chicken base\)) show newline
(              \(chicken type\)) show newline
(              ...\)) show newline
(      ;;; ============================================================) show newline
(      ;;; Type Declarations) show newline
(      ;;; ============================================================) show newline
(      \(: export1 ...\)) show newline
(      \(: export2 ...\)) show newline
(      ;;; ============================================================) show newline
(      ;;; Section Name) show newline
(      ;;; ============================================================) show newline
(      \(define \(export1 ...\) ...\)) show newline
(    \) ; end module) show newline
() show newline
() show newline
(12.2 Naming Conventions) show newline
(-----------------------) show newline
() show newline
() show newline
(  Type        Convention    Example                           ) show newline
(  Procedure   verb-noun     read-file, parse-cert             ) show newline
(  Predicate   noun?         empty?, valid-cert?               ) show newline
(  Conversion  x->y          string->blob, cert->sexp          ) show newline
(  Mutator     verb!         set-value!, init!                 ) show newline
(  Constant    *name*        *default-port*, *max-retries*     ) show newline
(  Parameter   current-name  current-realm, current-principal  ) show newline
() show newline
() show newline
(12.3 Documentation Strings) show newline
(--------------------------) show newline
() show newline
(All exported procedures should have docstrings:) show newline
() show newline
() show newline
(    \(define \(read-file path\)) show newline
(      "Read entire file contents as string.) show newline
(       Returns #f if file doesn't exist.") show newline
(      ...\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(13. TESTING CONVENTIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(13.1 Test File Location) show newline
(-----------------------) show newline
() show newline
(Tests live alongside source:) show newline
() show newline
() show newline
(    module.scm       ; Source) show newline
(    module-test.scm  ; Tests) show newline
() show newline
() show newline
(13.2 Test Structure) show newline
(-------------------) show newline
() show newline
() show newline
(    \(import module\)) show newline
(    \(import test\)  ; SRFI-64 or similar) show newline
(    \(test-begin "module"\)) show newline
(    \(test-group "feature-name") show newline
(      \(test-equal "description" expected \(actual\)\)) show newline
(      \(test-assert "predicate" \(condition?\)\)\)) show newline
(    \(test-end "module"\)) show newline
() show newline
() show newline
(13.3 Running Tests) show newline
(------------------) show newline
() show newline
() show newline
(    csi -s module-test.scm) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(14. REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * Chicken Scheme User's Manual: Types) show newline
(  * Chicken Scheme User's Manual: Debugging) show newline
(  * SRFI-12: Exception Handling) show newline
(  * Ada Reference Manual: Type System) show newline
(  * Dylan Reference Manual: Inspector) show newline
(  * Memo-054 Terminal Interface Conventions) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
