<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0018: Lazy Clustering</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0018: Lazy Clustering</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies Lazy Clustering for Cyberspace federation: a relaxed synchronization model where nodes sync when convenient, not continuously. Optimized for the "loose confederacy of friends" model.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Not every deployment needs Byzantine consensus:</p>
<ul>
<li>Friends trust friends: No active adversary</li>
<li>Bandwidth costs: Continuous sync is expensive</li>
<li>Offline operation: Internet isn't always available</li>
<li>Simplicity: Complex protocols have complex bugs</li>
</ul>
<p>Protocol complexity should match trust assumptions; using Byzantine consensus among friends wastes resources and adds failure modes.</p>
<p>Lazy Clustering provides:</p>
<ul>
<li>Sync when ready: Push/pull at human pace</li>
<li>Offline-first: Work without network</li>
<li>Conflict detection: Know when divergence happens</li>
<li>Manual resolution: Humans resolve, not algorithms</li>
<li>Audit everything: Full history preserved</li>
</ul>
<p>These properties prioritize simplicity and autonomy over consistency, appropriate when participants have aligned interests and can tolerate temporary divergence.</p>
<blockquote>
<p>The best protocol is the one you don't run.</p>
</blockquote>
</section>
<section>
<h2>Specification</h2>
<h3>Cluster Model</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 450 280" width="450" height="280" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<line x1="55" y1="10" x2="60" y2="10"/>
<line x1="55" y1="10" x2="55" y2="21"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<line x1="110" y1="10" x2="120" y2="10"/>
<line x1="120" y1="10" x2="130" y2="10"/>
<line x1="130" y1="10" x2="140" y2="10"/>
<line x1="140" y1="10" x2="150" y2="10"/>
<line x1="150" y1="10" x2="155" y2="10"/>
<line x1="155" y1="10" x2="155" y2="21"/>
<line x1="55" y1="19" x2="55" y2="41"/>
<text x="80" y="30">Alice</text>
<line x1="155" y1="19" x2="155" y2="41"/>
<line x1="55" y1="39" x2="55" y2="61"/>
<text x="70" y="50">(lazy)</text>
<line x1="155" y1="39" x2="155" y2="61"/>
<line x1="55" y1="70" x2="60" y2="70"/>
<line x1="55" y1="59" x2="55" y2="70"/>
<line x1="60" y1="70" x2="70" y2="70"/>
<line x1="70" y1="70" x2="80" y2="70"/>
<line x1="80" y1="70" x2="90" y2="70"/>
<line x1="90" y1="70" x2="100" y2="70"/>
<line x1="100" y1="70" x2="110" y2="70"/>
<line x1="105" y1="70" x2="105" y2="81"/>
<line x1="110" y1="70" x2="120" y2="70"/>
<line x1="120" y1="70" x2="130" y2="70"/>
<line x1="130" y1="70" x2="140" y2="70"/>
<line x1="140" y1="70" x2="150" y2="70"/>
<line x1="150" y1="70" x2="155" y2="70"/>
<line x1="155" y1="59" x2="155" y2="70"/>
<line x1="155" y1="79" x2="155" y2="101"/>
<line x1="105" y1="99" x2="105" y2="121"/>
<text x="120" y="110">sync</text>
<text x="170" y="110">when</text>
<text x="220" y="110">ready</text>
<text x="280" y="110">@</text>
<text x="300" y="110">10Gb/s</text>
<line x1="155" y1="119" x2="155" y2="141"/>
<line x1="55" y1="150" x2="60" y2="150"/>
<line x1="55" y1="150" x2="55" y2="161"/>
<line x1="60" y1="150" x2="70" y2="150"/>
<line x1="70" y1="150" x2="80" y2="150"/>
<line x1="80" y1="150" x2="90" y2="150"/>
<line x1="90" y1="150" x2="100" y2="150"/>
<line x1="110" y1="150" x2="120" y2="150"/>
<line x1="120" y1="150" x2="130" y2="150"/>
<line x1="130" y1="150" x2="140" y2="150"/>
<line x1="140" y1="150" x2="150" y2="150"/>
<line x1="150" y1="150" x2="155" y2="150"/>
<line x1="155" y1="150" x2="155" y2="161"/>
<line x1="255" y1="150" x2="260" y2="150"/>
<line x1="255" y1="150" x2="255" y2="161"/>
<line x1="260" y1="150" x2="270" y2="150"/>
<line x1="270" y1="150" x2="280" y2="150"/>
<line x1="280" y1="150" x2="290" y2="150"/>
<line x1="290" y1="150" x2="300" y2="150"/>
<line x1="300" y1="150" x2="310" y2="150"/>
<line x1="310" y1="150" x2="320" y2="150"/>
<line x1="320" y1="150" x2="330" y2="150"/>
<line x1="330" y1="150" x2="340" y2="150"/>
<line x1="340" y1="150" x2="350" y2="150"/>
<line x1="350" y1="150" x2="355" y2="150"/>
<line x1="355" y1="150" x2="355" y2="161"/>
<line x1="55" y1="159" x2="55" y2="181"/>
<text x="90" y="170">Bob</text>
<line x1="155" y1="159" x2="155" y2="181"/>
<line x1="170" y1="170" x2="180" y2="170"/>
<line x1="180" y1="170" x2="190" y2="170"/>
<line x1="190" y1="170" x2="200" y2="170"/>
<line x1="200" y1="170" x2="210" y2="170"/>
<line x1="210" y1="170" x2="220" y2="170"/>
<line x1="220" y1="170" x2="230" y2="170"/>
<line x1="230" y1="170" x2="240" y2="170"/>
<line x1="255" y1="159" x2="255" y2="181"/>
<text x="280" y="170">Carol</text>
<line x1="355" y1="159" x2="355" y2="181"/>
<line x1="55" y1="179" x2="55" y2="201"/>
<text x="70" y="190">(lazy)</text>
<line x1="155" y1="179" x2="155" y2="201"/>
<text x="170" y="190">10Gb/s</text>
<line x1="255" y1="179" x2="255" y2="201"/>
<text x="270" y="190">(lazy)</text>
<line x1="355" y1="179" x2="355" y2="201"/>
<line x1="55" y1="210" x2="60" y2="210"/>
<line x1="55" y1="199" x2="55" y2="210"/>
<line x1="60" y1="210" x2="70" y2="210"/>
<line x1="70" y1="210" x2="80" y2="210"/>
<line x1="80" y1="210" x2="90" y2="210"/>
<line x1="90" y1="210" x2="100" y2="210"/>
<line x1="100" y1="210" x2="110" y2="210"/>
<line x1="110" y1="210" x2="120" y2="210"/>
<line x1="120" y1="210" x2="130" y2="210"/>
<line x1="130" y1="210" x2="140" y2="210"/>
<line x1="140" y1="210" x2="150" y2="210"/>
<line x1="150" y1="210" x2="155" y2="210"/>
<line x1="155" y1="199" x2="155" y2="210"/>
<line x1="255" y1="210" x2="260" y2="210"/>
<line x1="255" y1="199" x2="255" y2="210"/>
<line x1="260" y1="210" x2="270" y2="210"/>
<line x1="270" y1="210" x2="280" y2="210"/>
<line x1="280" y1="210" x2="290" y2="210"/>
<line x1="290" y1="210" x2="300" y2="210"/>
<line x1="300" y1="210" x2="310" y2="210"/>
<line x1="310" y1="210" x2="320" y2="210"/>
<line x1="320" y1="210" x2="330" y2="210"/>
<line x1="330" y1="210" x2="340" y2="210"/>
<line x1="340" y1="210" x2="350" y2="210"/>
<line x1="350" y1="210" x2="355" y2="210"/>
<line x1="355" y1="199" x2="355" y2="210"/>
<text x="0" y="230">No</text>
<text x="30" y="230">heartbeats.</text>
<text x="150" y="230">No</text>
<text x="180" y="230">leader</text>
<text x="250" y="230">election.</text>
<text x="350" y="230">No</text>
<text x="380" y="230">quorum.</text>
<text x="0" y="250">Just</text>
<text x="50" y="250">friends</text>
<text x="130" y="250">sharing</text>
<text x="210" y="250">when</text>
<text x="260" y="250">they're</text>
<text x="340" y="250">ready.</text>
<text x="0" y="270">At</text>
<text x="30" y="270">line</text>
<text x="80" y="270">speed</text>
<text x="140" y="270">when</text>
<text x="190" y="270">they</text>
<text x="240" y="270">do.</text>
</svg>
</div>
<h3>Performance Model</h3>
<p>Lazy semantics, line speed execution.</p>
<pre>
Line speed (10 Gb/s):
  Typical release: 10 MB archive
  Transfer time:   8 ms
  Effective rate:  ~1000 releases/second

Starlink (100-200 Mb/s, 20-40ms latency):
  Typical release: 10 MB archive
  Transfer time:   400-800 ms
  Effective rate:  ~1-2 releases/second
  Optimized for:   Bursty, high-latency satellite links

Minimum bandwidth:
  Floor:           128 Kb/s (dual-ISDN)
  Target:          1 Mb/s (T1)
  Typical release: 10 MB archive
  Transfer time:   ~80 sec (T1), ~10 min (dual-ISDN)
  Strategy:        Delta sync, compressed archives
</pre>
<p>Crypto overhead (constant):</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 480 60" width="480" height="60" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">Signature</text>
<text x="100" y="10">verify:</text>
<text x="180" y="10">~10</text>
<text x="220" y="10">μs</text>
<text x="250" y="10">(Ed25519)</text>
<text x="0" y="30">Hash</text>
<text x="50" y="30">verify:</text>
<text x="180" y="30">~1</text>
<text x="210" y="30">ms</text>
<text x="240" y="30">(SHA-512,</text>
<text x="340" y="30">10MB)</text>
<text x="0" y="50">Total</text>
<text x="60" y="50">overhead:</text>
<text x="180" y="50">~1</text>
<text x="210" y="50">ms</text>
<text x="240" y="50">(negligible</text>
<text x="360" y="50">vs</text>
<text x="390" y="50">transfer)</text>
</svg>
</div>
<p>"Lazy" means when, not how fast. When you sync, it saturates the pipe.</p>
<p>Design priorities:</p>
<ul>
<li>Optimized for Starlink and satellite links</li>
<li>Tolerant of high latency (no chatty protocols)</li>
<li>Graceful degradation to minimum bandwidth</li>
<li>Bursty transfer patterns (sync then idle)</li>
</ul>
<h3>Heartbeat and Timekeeping</h3>
<p>No mandatory heartbeat. That's the design.</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 600 40" width="600" height="40" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">Traditional</text>
<text x="120" y="10">cluster:</text>
<text x="220" y="10">ping</text>
<text x="290" y="10">pong</text>
<text x="360" y="10">ping</text>
<text x="430" y="10">pong</text>
<text x="500" y="10">...</text>
<text x="0" y="30">Lazy</text>
<text x="50" y="30">cluster:</text>
<text x="220" y="30">...</text>
<text x="260" y="30">silence</text>
<text x="340" y="30">...</text>
<text x="380" y="30">(sync)</text>
<text x="450" y="30">...</text>
<text x="490" y="30">silence</text>
<text x="570" y="30">...</text>
</svg>
</div>
<p>Timekeeping: Lamport clocks (Memo-012), not wall clocks. - Causality without synchronization - No NTP dependency - No GPS required - Works across time zones, planets</p>
<p>When you need consensus: Byzantine consensus (Memo-011) + Lamport clocks. - Lazy clustering for everyday sync - Byzantine consensus for critical decisions - Same Lamport clock across both modes</p>
<p>Optional presence beacon:</p>
<pre class="language-scheme">
(cluster-beacon
  (peer "alice")
  (lamport-time 4271)
  (last-release "2.1.0")
  (status available)
  (next-expected "when ready"))
</pre>
<p>Beacons are: - Pull-based (query, don't push) - Cached (no flood) - Stale-tolerant (hours/days old is fine) - Unsigned (advisory only)</p>
<h3>Sync Modes</h3>
<p>#### Push (I have something)</p>
<pre class="language-scheme">
(lazy-push peer)
;; Sends my new releases to peer
;; Non-blocking, fire-and-forget
</pre>
<p>#### Pull (What do you have?)</p>
<pre class="language-scheme">
(lazy-pull peer)
;; Fetches peer's new releases
;; Verifies signatures, stores locally
</pre>
<p>#### Sync (Bidirectional)</p>
<pre class="language-scheme">
(lazy-sync peer)
;; Push then pull
;; Returns conflict report if any
</pre>
<h3>Lazy Semantics</h3>
<p>No continuous connection. Nodes are offline by default.</p>
<p>No consistency guarantees. Nodes may diverge.</p>
<p>No automatic resolution. Conflicts flagged for humans.</p>
<p>No urgency. Sync happens when convenient.</p>
</section>
<section>
<h2>State Tracking</h2>
<h3>Version Vector</h3>
<p>Each node tracks what it knows about others:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 580 120" width="580" height="120" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">(define-record-type</text>
<text x="200" y="10">&lt;version-vector&gt;</text>
<text x="20" y="30">(make-version-vector</text>
<text x="230" y="30">entries)</text>
<text x="20" y="50">version-vector?</text>
<text x="20" y="70">(entries</text>
<text x="110" y="70">vv-entries))</text>
<text x="250" y="70">;</text>
<text x="270" y="70">Hash:</text>
<text x="330" y="70">node-id</text>
<text x="430" y="70">latest-sequence</text>
<text x="0" y="90">;;</text>
<text x="30" y="90">Alice's</text>
<text x="110" y="90">view:</text>
<text x="0" y="110">;;</text>
<text x="30" y="110">{</text>
<text x="50" y="110">alice:</text>
<text x="120" y="110">42,</text>
<text x="160" y="110">bob:</text>
<text x="210" y="110">37,</text>
<text x="250" y="110">carol:</text>
<text x="320" y="110">29</text>
<text x="350" y="110">}</text>
</svg>
</div>
<h3>Sync Calculation</h3>
<pre class="language-scheme">
(define (compute-sync-set local-vv remote-vv)
  "What to send/receive"
  (let ((to-send '())
        (to-receive '()))
    (for-each
      (lambda (node)
        (let ((local-seq (vv-get local-vv node))
              (remote-seq (vv-get remote-vv node)))
          (cond
            ((&gt; local-seq remote-seq)
             (push! to-send (releases-between node remote-seq local-seq)))
            ((&lt; local-seq remote-seq)
             (push! to-receive (list node remote-seq local-seq))))))
      (all-nodes local-vv remote-vv))
    (values to-send to-receive)))
</pre>
</section>
<section>
<h2>Conflict Detection</h2>
<h3>Divergence</h3>
<p>Same version, different content:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 460 160" width="460" height="160" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">(lazy-sync</text>
<text x="110" y="10">"bob")</text>
<text x="0" y="30">;;</text>
<text x="30" y="30">=&gt;</text>
<text x="0" y="50">;;</text>
<text x="30" y="50">⚠</text>
<text x="50" y="50">Conflict</text>
<text x="140" y="50">detected:</text>
<text x="0" y="70">;;</text>
<text x="50" y="70">Version</text>
<text x="130" y="70">2.1.0</text>
<text x="0" y="90">;;</text>
<text x="50" y="90">Local:</text>
<text x="130" y="90">sha512:abc123...</text>
<text x="0" y="110">;;</text>
<text x="50" y="110">Remote:</text>
<text x="130" y="110">sha512:def456...</text>
<text x="0" y="130">;;</text>
<text x="0" y="150">;;</text>
<text x="50" y="150">Both</text>
<text x="100" y="150">modified</text>
<text x="190" y="150">since</text>
<text x="250" y="150">common</text>
<text x="320" y="150">ancestor</text>
<text x="410" y="150">2.0.0</text>
</svg>
</div>
<h3>Conflict Record</h3>
<pre class="language-scheme">
(conflict
  (version "2.1.0")
  (local-hash "sha512:abc123...")
  (remote-hash "sha512:def456...")
  (common-ancestor "2.0.0")
  (detected "2026-01-06T15:30:00Z")
  (status pending))  ; pending, resolved-local, resolved-remote, merged
</pre>
<h3>Resolution</h3>
<p>Manual resolution required:</p>
<pre class="language-scheme">
(lazy-resolve "2.1.0" prefer: 'local)
;; or
(lazy-resolve "2.1.0" prefer: 'remote)
;; or
(lazy-resolve "2.1.0" merged: "2.1.0-merged")
</pre>
</section>
<section>
<h2>Offline Operation</h2>
<h3>Work Offline</h3>
<pre class="language-scheme">
(seal-commit "Add feature")
(seal-release "2.2.0")
;; All local, no network required
</pre>
<h3>Queue for Sync</h3>
<pre class="language-scheme">
(lazy-queue)
;; =&gt;
;; Pending sync:
;;   2.1.1  (local, not pushed)
;;   2.2.0  (local, not pushed)
;;
;; To sync: (lazy-push "bob")
</pre>
<h3>Reconnect and Sync</h3>
<pre class="language-scheme">
(lazy-sync "bob")
;; Sends 2.1.1, 2.2.0
;; Receives bob's changes
;; Reports any conflicts
</pre>
</section>
<section>
<h2>Cluster Operations</h2>
<h3>Join Cluster</h3>
<pre class="language-scheme">
(lazy-join "bob"
  uri: "git@github.com:bob/vault.git"
  key: bob-public-key)
;; Registers peer, doesn't sync yet
</pre>
<h3>Initial Sync</h3>
<pre class="language-scheme">
(lazy-pull "bob")
;; Gets bob's full history
;; Verifies all signatures
</pre>
<h3>Leave Cluster</h3>
<pre class="language-scheme">
(lazy-leave "bob")
;; Removes peer from sync list
;; Keeps local copies of bob's releases
</pre>
<h3>Cluster Status</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 700 160" width="700" height="160" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">(lazy-status)</text>
<text x="0" y="30">;;</text>
<text x="30" y="30">=&gt;</text>
<text x="0" y="50">;;</text>
<text x="30" y="50">Cluster</text>
<text x="110" y="50">peers:</text>
<text x="0" y="70">;;</text>
<text x="50" y="70">bob</text>
<text x="120" y="70">last-sync:</text>
<text x="230" y="70">2026-01-05</text>
<text x="350" y="70">versions:</text>
<text x="450" y="70">1.0.0-2.1.0</text>
<text x="580" y="70">✓</text>
<text x="0" y="90">;;</text>
<text x="50" y="90">carol</text>
<text x="120" y="90">last-sync:</text>
<text x="230" y="90">2026-01-03</text>
<text x="350" y="90">versions:</text>
<text x="450" y="90">1.0.0-2.0.0</text>
<text x="580" y="90">(2</text>
<text x="610" y="90">behind)</text>
<text x="0" y="110">;;</text>
<text x="50" y="110">dave</text>
<text x="120" y="110">last-sync:</text>
<text x="230" y="110">never</text>
<text x="350" y="110">versions:</text>
<text x="450" y="110">none</text>
<text x="580" y="110">(not</text>
<text x="630" y="110">synced)</text>
<text x="0" y="130">;;</text>
<text x="0" y="150">;;</text>
<text x="30" y="150">Local:</text>
<text x="100" y="150">2.2.0</text>
<text x="160" y="150">(2</text>
<text x="190" y="150">ahead</text>
<text x="250" y="150">of</text>
<text x="280" y="150">cluster)</text>
</svg>
</div>
</section>
<section>
<h2>Sync Strategies</h2>
<h3>Manual (Default)</h3>
<pre class="language-scheme">
(vault-config 'sync-strategy 'manual)
;; User explicitly calls lazy-sync
</pre>
<h3>Periodic</h3>
<pre class="language-scheme">
(vault-config 'sync-strategy 'periodic)
(vault-config 'sync-interval 3600)  ; hourly
;; Background sync when network available
</pre>
<h3>On-Commit</h3>
<pre class="language-scheme">
(vault-config 'sync-strategy 'on-commit)
;; Push after each seal-commit
;; Still lazy (non-blocking, best-effort)
</pre>
<h3>On-Release</h3>
<pre class="language-scheme">
(vault-config 'sync-strategy 'on-release)
;; Push only after seal-release
;; Most conservative
</pre>
</section>
<section>
<h2>Consistency Guarantees</h2>
<h3>What We Guarantee</h3>
<ul>
<li>Signature integrity: All releases verified</li>
<li>Causal ordering: Within single node</li>
<li>Conflict detection: Divergence detected</li>
<li>Audit preservation: Full history kept</li>
</ul>
<h3>What We Don't Guarantee</h3>
<ul>
<li>Global ordering: Nodes may see different orders</li>
<li>Consistency: Nodes may have different content</li>
<li>Availability: Offline nodes are offline</li>
<li>Automatic resolution: Humans must resolve</li>
</ul>
<h3>CAP Theorem Position</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 270 200" width="270" height="200" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="60" y="10">Consistency</text>
<text x="100" y="30">/\</text>
<text x="90" y="50">/</text>
<text x="120" y="50">\</text>
<text x="80" y="70">/</text>
<text x="130" y="70">\</text>
<text x="70" y="90">/</text>
<text x="90" y="90">Lazy</text>
<text x="140" y="90">\</text>
<text x="60" y="110">/</text>
<text x="80" y="110">Cluster\</text>
<text x="50" y="130">/</text>
<text x="100" y="130">✓</text>
<text x="160" y="130">\</text>
<text x="40" y="150">/\</text>
<text x="0" y="170">Availability</text>
<text x="160" y="170">Partition</text>
<text x="40" y="190">✓</text>
<text x="160" y="190">Tolerance</text>
<text x="260" y="190">✓</text>
</svg>
</div>
<p>We choose AP: Available and Partition-tolerant, eventually consistent.</p>
</section>
<section>
<h2>Comparison with Other Modes</h2>
<table>
<tr><th>Aspect </th><th>Lazy Cluster </th><th>Federation (Memo-010) </th><th>Byzantine (Memo-011) </th></tr>
<tr><td>Trust </td><td>Friends </td><td>Verified peers </td><td>Adversarial </td></tr>
<tr><td>Sync </td><td>Manual/periodic </td><td>Announcement-based </td><td>Consensus </td></tr>
<tr><td>Conflicts </td><td>Manual resolve </td><td>Detect + flag </td><td>Prevented </td></tr>
<tr><td>Offline </td><td>Full support </td><td>Partial </td><td>Requires quorum </td></tr>
<tr><td>Complexity </td><td>Minimal </td><td>Medium </td><td>High </td></tr>
<tr><td>Use case </td><td>Small groups </td><td>Organizations </td><td>Critical systems </td></tr>
</table>
</section>
<section>
<h2>Example Session</h2>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 520 280" width="520" height="280" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: 'JetBrains Mono', monospace; font-size: 14px; fill: currentColor; dominant-baseline: central; }
</style>
<text x="0" y="10">;;</text>
<text x="30" y="10">Morning:</text>
<text x="120" y="10">Alice</text>
<text x="180" y="10">works</text>
<text x="240" y="10">offline</text>
<text x="0" y="30">(seal-commit</text>
<text x="130" y="30">"Add</text>
<text x="180" y="30">authentication")</text>
<text x="0" y="50">(seal-commit</text>
<text x="130" y="50">"Add</text>
<text x="180" y="50">authorization")</text>
<text x="0" y="70">(seal-release</text>
<text x="140" y="70">"2.3.0")</text>
<text x="0" y="90">;;</text>
<text x="30" y="90">Lunch:</text>
<text x="100" y="90">Alice</text>
<text x="160" y="90">syncs</text>
<text x="220" y="90">with</text>
<text x="270" y="90">Bob</text>
<text x="0" y="110">(lazy-sync</text>
<text x="110" y="110">"bob")</text>
<text x="0" y="130">;;</text>
<text x="30" y="130">=&gt;</text>
<text x="60" y="130">Pushed</text>
<text x="130" y="130">2.3.0</text>
<text x="190" y="130">to</text>
<text x="220" y="130">bob</text>
<text x="0" y="150">;;</text>
<text x="30" y="150">=&gt;</text>
<text x="60" y="150">Pulled</text>
<text x="130" y="150">2.2.1</text>
<text x="190" y="150">from</text>
<text x="240" y="150">bob</text>
<text x="0" y="170">;;</text>
<text x="30" y="170">=&gt;</text>
<text x="60" y="170">No</text>
<text x="90" y="170">conflicts</text>
<text x="0" y="190">;;</text>
<text x="30" y="190">Evening:</text>
<text x="120" y="190">Alice</text>
<text x="180" y="190">syncs</text>
<text x="240" y="190">with</text>
<text x="290" y="190">Carol</text>
<text x="0" y="210">(lazy-sync</text>
<text x="110" y="210">"carol")</text>
<text x="0" y="230">;;</text>
<text x="30" y="230">=&gt;</text>
<text x="60" y="230">Pushed</text>
<text x="130" y="230">2.2.1,</text>
<text x="200" y="230">2.3.0</text>
<text x="260" y="230">to</text>
<text x="290" y="230">carol</text>
<text x="0" y="250">;;</text>
<text x="30" y="250">=&gt;</text>
<text x="60" y="250">Pulled</text>
<text x="130" y="250">nothing</text>
<text x="210" y="250">(carol</text>
<text x="280" y="250">hasn't</text>
<text x="350" y="250">released)</text>
<text x="0" y="270">;;</text>
<text x="30" y="270">=&gt;</text>
<text x="60" y="270">⚠</text>
<text x="80" y="270">Carol</text>
<text x="140" y="270">has</text>
<text x="180" y="270">unsynced</text>
<text x="270" y="270">commits</text>
<text x="350" y="270">(not</text>
<text x="400" y="270">our</text>
<text x="440" y="270">concern)</text>
</svg>
</div>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Trust Model</h3>
<p>Lazy clustering assumes good-faith peers:</p>
<ul>
<li>Peers won't inject malicious releases</li>
<li>Peers won't withhold releases maliciously</li>
<li>Peers will eventually sync</li>
</ul>
<p>Not suitable for: Adversarial environments, high-value targets.</p>
<p>Suitable for: Research groups, open source projects, friend networks.</p>
<h3>Signature Verification</h3>
<p>All releases still verified:</p>
<pre class="language-scheme">
(lazy-pull "bob")
;; Each release:
;;   1. Verify Ed25519 signature
;;   2. Verify hash matches content
;;   3. Check against known bob public key
;;   4. Store only if valid
</pre>
<h3>Conflict Attacks</h3>
<p>Malicious peer creates conflicting release.</p>
<p>Mitigation: - Conflicts flagged, not auto-resolved - Full audit trail of conflict - Peer reputation tracking</p>
</section>
<section>
<h2>Implementation Notes</h2>
<h3>Dependencies</h3>
<ul>
<li>crypto-ffi</li>
<li>Signature verification - audit</li>
<li>Sync logging</li>
<li>Transport (git/HTTP/filesystem)</li>
</ul>
<h3>Storage</h3>
<pre>
.vault/
  lazy/
    peers.sexp        # Registered peers
    vectors.sexp      # Version vectors
    conflicts/        # Unresolved conflicts
    queue/            # Pending pushes
</pre>
</section>
<section>
<h2>References</h2>
<ul>
<li>Saito, Y., &amp; Shapiro, M. (2005). Optimistic Replication.</li>
<li>Terry, D., et al. (1995). Managing Update Conflicts in Bayou.</li>
<li>DeCandia, G., et al. (2007). Dynamo: Amazon's Key-Value Store.</li>
<li>Memo-010: Federation Protocol</li>
<li>Memo-012: Lamport Logical Clocks</li>
</ul>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-06</li>
<li>Set minimum bandwidth: 128 Kb/s floor (dual-ISDN), 1 Mb/s target (T1) - 2026-01-06</li>
<li>Initial specification</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
