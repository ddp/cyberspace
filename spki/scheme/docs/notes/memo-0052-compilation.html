<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0052: Compilation and Debugging Manual</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0052: Compilation and Debugging Manual</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo is the compilation and debugging manual for Cyberspace Scheme. It specifies type inference conventions, build system architecture, debugging infrastructure, exception handling, and inspector design. The guiding principles are Ada's "declare everything, infer nothing" and Dylan's "inspect everything, hide nothing."</p>
</section>
<section>
<h2>Part I: Compilation</h2>
<p></p>
</section>
<section>
<h2>1. Type System Overview</h2>
<h3>1.1 Chicken's Scrutinizer</h3>
<p>Chicken Scheme includes a flow-sensitive type analyzer called the scrutinizer. When invoked with -strict-types, it performs whole-program type inference and reports errors when types cannot be proven safe.</p>
<p>The scrutinizer tracks type information through:</p>
<ul>
<li>Variable bindings and assignments</li>
<li>Conditional branches (if, cond, case)</li>
<li>Procedure calls and returns</li>
<li>Special forms (let, let*, letrec)</li>
</ul>
<h3>1.2 The Inference Problem</h3>
<p>Whole-program type inference without declarations can exhibit exponential complexity. The scrutinizer's flow-sensitive analysis becomes intractable when:</p>
<ul>
<li>Functions contain many conditional branches with side effects</li>
<li>Format strings (sprintf) create implicit polymorphic constraints</li>
<li>Type information cannot flow through set! mutations</li>
<li>Multiple paths merge with incompatible inferred types</li>
</ul>
<p>Empirical observation: A function with 30 conditional sprintf calls can take 5+ minutes to analyze. The same function with type declarations compiles in under 1 second.</p>
<h3>1.3 The Ada Principle</h3>
<p>Ada's compilation model requires explicit type declarations everywhere. The compiler is a checker, not a guesser. Jean Ichbiah's design traded verbosity for predictability - when Ada compiles, it tends to run correctly.</p>
<p>For Cyberspace modules, we adopt this principle:</p>
<pre>
DECLARE EVERYTHING, INFER NOTHING
</pre>
<p>Benefits:</p>
<ul>
<li>Predictable compilation times</li>
<li>Better error messages (mismatch against declaration, not inference)</li>
<li>Documentation of programmer intent</li>
<li>Enables separate compilation</li>
</ul>
</section>
<section>
<h2>2. Type Declaration Conventions</h2>
<h3>2.1 Required Import</h3>
<p>Modules using type declarations must import the type system:</p>
<pre class="language-scheme">
(import (chicken type))
</pre>
<p>Place this import with other chicken imports, before srfi and cyberspace modules.</p>
<h3>2.2 Declaration Placement</h3>
<p>Type declarations are placed in a dedicated section after imports, before any function definitions:</p>
<pre class="language-scheme">
(module example
  (export1 export2)

  (import scheme
          (chicken base)
          (chicken type)
          ...)

  ;;; ============================================================
  ;;; Type Declarations
  ;;; ============================================================

  (: export1 (string -&gt; boolean))
  (: export2 (fixnum fixnum -&gt; fixnum))
  (: internal-helper (list -&gt; (or string false)))

  ;;; ============================================================
  ;;; Implementation
  ;;; ============================================================

  (define (export1 s) ...)
  ...)
</pre>
<h3>2.3 Declaration Syntax</h3>
<p>The (: name type) form declares the type of a binding:</p>
<pre class="language-scheme">
;; Simple function types
(: add1 (fixnum -&gt; fixnum))
(: string-empty? (string -&gt; boolean))

;; Multiple arguments
(: substring (string fixnum fixnum -&gt; string))

;; Optional arguments
(: open-file (string #!optional symbol -&gt; port))

;; Rest arguments
(: format (string #!rest * -&gt; string))

;; Union types
(: find-item (symbol -&gt; (or item false)))

;; Procedures as arguments
(: map-items ((item -&gt; result) (list-of item) -&gt; (list-of result)))

;; No return (exits or loops forever)
(: fatal-error (string -&gt; noreturn))
</pre>
<h3>2.4 Common Type Names</h3>
<table>
<tr><th>Type</th><th>Description</th><th>Example Values</th></tr>
<tr><td>fixnum</td><td>Small exact integer</td><td>0, 42, -17</td></tr>
<tr><td>flonum</td><td>Floating point</td><td>3.14, -2.5e10</td></tr>
<tr><td>number</td><td>Any number</td><td>fixnum or flonum</td></tr>
<tr><td>string</td><td>Character string</td><td>"hello"</td></tr>
<tr><td>symbol</td><td>Symbolic atom</td><td>'foo, 'bar</td></tr>
<tr><td>boolean</td><td>Truth value</td><td>#t, #f</td></tr>
<tr><td>char</td><td>Single character</td><td>#\a, #\newline</td></tr>
<tr><td>list</td><td>Proper list</td><td>'(1 2 3)</td></tr>
<tr><td>(list-of T)</td><td>Homogeneous list</td><td>(list-of string)</td></tr>
<tr><td>pair</td><td>Cons cell</td><td>'(a . b)</td></tr>
<tr><td>vector</td><td>Fixed-size array</td><td>#(1 2 3)</td></tr>
<tr><td>blob</td><td>Byte vector</td><td>(make-blob 16)</td></tr>
<tr><td>port</td><td>I/O port</td><td>(current-input-port)</td></tr>
<tr><td>procedure</td><td>Any procedure</td><td>car, +</td></tr>
<tr><td>(T1 -&gt; T2)</td><td>Specific procedure</td><td>(string -&gt; fixnum)</td></tr>
<tr><td>(or T1 T2)</td><td>Union type</td><td>(or string false)</td></tr>
<tr><td>(struct name)</td><td>C struct wrapper</td><td>(struct tcp-listener)</td></tr>
<tr><td>false</td><td>The #f value</td><td>#f</td></tr>
<tr><td>*</td><td>Any type</td><td>anything</td></tr>
<tr><td>noreturn</td><td>Never returns</td><td>for exit, error</td></tr>
</table>
<h3>2.5 When Declarations Are Required</h3>
<p>Type declarations are REQUIRED for:</p>
<ul>
<li>Functions with more than 5 conditional branches</li>
<li>Functions using set! on local variables</li>
<li>Functions with multiple sprintf/format calls</li>
<li>All exported (public API) functions</li>
<li>Functions that call other modules' exported functions</li>
</ul>
<p>Type declarations are OPTIONAL for:</p>
<ul>
<li>Simple leaf functions (&lt; 5 lines, no branching)</li>
<li>Local helper functions with obvious types</li>
<li>Functions used only in one place</li>
</ul>
</section>
<section>
<h2>3. Typed Helper Pattern</h2>
<h3>3.1 The Problem</h3>
<p>A common pattern causes exponential inference:</p>
<pre class="language-scheme">
;; BAD: Exponential type inference
(define (session-summary)
  (let ((stats '()))
    (when (&gt; (session-stat 'reads) 0)
      (set! stats (cons (sprintf "~a read~a"
                                  (session-stat 'reads)
                                  (if (= 1 (session-stat 'reads)) "" "s"))
                        stats)))
    (when (&gt; (session-stat 'writes) 0)
      (set! stats (cons (sprintf "~a write~a" ...) stats)))
    ;; ... 28 more similar blocks ...
    (reverse stats)))
</pre>
<p>The scrutinizer must analyze all 2^30 possible paths through this function.</p>
<h3>3.2 The Solution</h3>
<p>Factor into small typed helpers:</p>
<pre class="language-scheme">
;; GOOD: Linear type inference
(: format-stat (symbol string string -&gt; (or string false)))
(define (format-stat key singular plural-suffix)
  "Format a session stat with pluralization, or #f if zero."
  (let ((n (session-stat key)))
    (if (&gt; n 0)
        (string-append (number-&gt;string n) " " singular
                       (if (= n 1) "" plural-suffix))
        #f)))

(: format-stat-irregular (symbol string string -&gt; (or string false)))
(define (format-stat-irregular key singular plural)
  "Format with irregular plural."
  (let ((n (session-stat key)))
    (if (&gt; n 0)
        (string-append (number-&gt;string n) " "
                       (if (= n 1) singular plural))
        #f)))

(: session-summary (-&gt; (list-of string)))
(define (session-summary)
  "Generate session statistics summary."
  (filter identity
    (list
      (format-stat 'reads "read" "s")
      (format-stat 'writes "write" "s")
      (format-stat-irregular 'queries "query" "queries")
      ...)))
</pre>
<p>Each helper is independently typed. The scrutinizer analyzes them separately, giving O(n) instead of O(2^n) complexity.</p>
<h3>3.3 Composition via filter</h3>
<p>The pattern (filter identity (list ...)) collects non-#f results:</p>
<pre class="language-scheme">
(filter identity (list "a" #f "b" #f "c"))
;; =&gt; ("a" "b" "c")
</pre>
<p>This replaces imperative set!/cons accumulation with functional composition.</p>
</section>
<section>
<h2>4. Build System Architecture</h2>
<h3>4.1 The Forge</h3>
<p>The forge is the build system for Cyberspace modules. It compiles Scheme to shared libraries (.so) with import specifications (.import.scm).</p>
<p>The name is deliberate. Not CompilationManager or BuildSystem - forge. Words a squirrel would use. The same MIT hackers who gave us LISP, Scheme, and the λ-calculus named things to mean something: lambda, cons, car, cdr. We continue that tradition: forge, vault, portal, gossip, bloom, keyring.</p>
<p>Invocation:</p>
<pre class="language-scheme">
(bootstrap-modules!)  ; Called automatically at REPL start
</pre>
<p>Output format:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 490 100" width="490" height="100" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<line x1="5" y1="10" x2="10" y2="10"/>
<line x1="5" y1="10" x2="5" y2="21"/>
<line x1="10" y1="10" x2="20" y2="10"/>
<line x1="20" y1="10" x2="30" y2="10"/>
<line x1="30" y1="10" x2="40" y2="10"/>
<line x1="40" y1="10" x2="50" y2="10"/>
<line x1="50" y1="10" x2="60" y2="10"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<line x1="110" y1="10" x2="120" y2="10"/>
<line x1="120" y1="10" x2="130" y2="10"/>
<line x1="130" y1="10" x2="140" y2="10"/>
<line x1="140" y1="10" x2="150" y2="10"/>
<line x1="150" y1="10" x2="160" y2="10"/>
<line x1="160" y1="10" x2="170" y2="10"/>
<text x="185" y="10">f</text>
<text x="195" y="10">o</text>
<text x="205" y="10">r</text>
<text x="215" y="10">g</text>
<text x="225" y="10">e</text>
<text x="235" y="10">:</text>
<text x="255" y="10">p</text>
<text x="265" y="10">o</text>
<text x="275" y="10">r</text>
<text x="285" y="10">t</text>
<text x="295" y="10">a</text>
<text x="305" y="10">l</text>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="390" y2="10"/>
<line x1="390" y1="10" x2="400" y2="10"/>
<line x1="400" y1="10" x2="410" y2="10"/>
<line x1="410" y1="10" x2="420" y2="10"/>
<line x1="420" y1="10" x2="430" y2="10"/>
<line x1="430" y1="10" x2="440" y2="10"/>
<line x1="440" y1="10" x2="450" y2="10"/>
<line x1="450" y1="10" x2="460" y2="10"/>
<line x1="460" y1="10" x2="470" y2="10"/>
<line x1="470" y1="10" x2="480" y2="10"/>
<line x1="480" y1="10" x2="485" y2="10"/>
<line x1="485" y1="10" x2="485" y2="21"/>
<line x1="5" y1="19" x2="5" y2="41"/>
<text x="25" y="30">c</text>
<text x="35" y="30">s</text>
<text x="45" y="30">c</text>
<text x="65" y="30">-</text>
<text x="75" y="30">s</text>
<text x="85" y="30">h</text>
<text x="95" y="30">a</text>
<text x="105" y="30">r</text>
<text x="115" y="30">e</text>
<text x="125" y="30">d</text>
<text x="145" y="30">-</text>
<text x="155" y="30">J</text>
<text x="175" y="30">-</text>
<text x="185" y="30">s</text>
<text x="195" y="30">t</text>
<text x="205" y="30">r</text>
<text x="215" y="30">i</text>
<text x="225" y="30">c</text>
<text x="235" y="30">t</text>
<text x="245" y="30">-</text>
<text x="255" y="30">t</text>
<text x="265" y="30">y</text>
<text x="275" y="30">p</text>
<text x="285" y="30">e</text>
<text x="295" y="30">s</text>
<text x="315" y="30">p</text>
<text x="325" y="30">o</text>
<text x="335" y="30">r</text>
<text x="345" y="30">t</text>
<text x="355" y="30">a</text>
<text x="365" y="30">l</text>
<text x="375" y="30">.</text>
<text x="385" y="30">s</text>
<text x="395" y="30">c</text>
<text x="405" y="30">m</text>
<line x1="485" y1="19" x2="485" y2="41"/>
<line x1="5" y1="39" x2="5" y2="61"/>
<text x="25" y="50">✓</text>
<text x="45" y="50">2</text>
<text x="55" y="50">4</text>
<text x="65" y="50">1</text>
<text x="75" y="50">K</text>
<text x="95" y="50">+</text>
<text x="115" y="50">6</text>
<text x="125" y="50">7</text>
<text x="135" y="50">7</text>
<text x="145" y="50">B</text>
<text x="165" y="50">i</text>
<text x="175" y="50">m</text>
<text x="185" y="50">p</text>
<text x="195" y="50">o</text>
<text x="205" y="50">r</text>
<text x="215" y="50">t</text>
<text x="235" y="50">i</text>
<text x="245" y="50">n</text>
<text x="265" y="50">9</text>
<text x="275" y="50">2</text>
<text x="285" y="50">1</text>
<text x="295" y="50">m</text>
<text x="305" y="50">s</text>
<line x1="485" y1="39" x2="485" y2="61"/>
<line x1="5" y1="59" x2="5" y2="81"/>
<text x="45" y="70">2</text>
<text x="55" y="70">9</text>
<text x="65" y="70">6</text>
<text x="85" y="70">L</text>
<text x="95" y="70">O</text>
<text x="105" y="70">C</text>
<text x="125" y="70">·</text>
<text x="145" y="70">4</text>
<text x="155" y="70">2</text>
<text x="175" y="70">λ</text>
<text x="195" y="70">·</text>
<text x="215" y="70">7</text>
<text x="235" y="70">L</text>
<text x="245" y="70">O</text>
<text x="255" y="70">C</text>
<text x="265" y="70">/</text>
<text x="275" y="70">λ</text>
<line x1="485" y1="59" x2="485" y2="81"/>
<line x1="5" y1="90" x2="10" y2="90"/>
<line x1="5" y1="79" x2="5" y2="90"/>
<line x1="10" y1="90" x2="20" y2="90"/>
<line x1="20" y1="90" x2="30" y2="90"/>
<line x1="30" y1="90" x2="40" y2="90"/>
<line x1="40" y1="90" x2="50" y2="90"/>
<line x1="50" y1="90" x2="60" y2="90"/>
<line x1="60" y1="90" x2="70" y2="90"/>
<line x1="70" y1="90" x2="80" y2="90"/>
<line x1="80" y1="90" x2="90" y2="90"/>
<line x1="90" y1="90" x2="100" y2="90"/>
<line x1="100" y1="90" x2="110" y2="90"/>
<line x1="110" y1="90" x2="120" y2="90"/>
<line x1="120" y1="90" x2="130" y2="90"/>
<line x1="130" y1="90" x2="140" y2="90"/>
<line x1="140" y1="90" x2="150" y2="90"/>
<line x1="150" y1="90" x2="160" y2="90"/>
<line x1="160" y1="90" x2="170" y2="90"/>
<line x1="170" y1="90" x2="180" y2="90"/>
<line x1="180" y1="90" x2="190" y2="90"/>
<line x1="190" y1="90" x2="200" y2="90"/>
<line x1="200" y1="90" x2="210" y2="90"/>
<line x1="210" y1="90" x2="220" y2="90"/>
<line x1="220" y1="90" x2="230" y2="90"/>
<line x1="230" y1="90" x2="240" y2="90"/>
<line x1="240" y1="90" x2="250" y2="90"/>
<line x1="250" y1="90" x2="260" y2="90"/>
<line x1="260" y1="90" x2="270" y2="90"/>
<line x1="270" y1="90" x2="280" y2="90"/>
<line x1="280" y1="90" x2="290" y2="90"/>
<line x1="290" y1="90" x2="300" y2="90"/>
<line x1="300" y1="90" x2="310" y2="90"/>
<line x1="310" y1="90" x2="320" y2="90"/>
<line x1="320" y1="90" x2="330" y2="90"/>
<line x1="330" y1="90" x2="340" y2="90"/>
<line x1="340" y1="90" x2="350" y2="90"/>
<line x1="350" y1="90" x2="360" y2="90"/>
<line x1="360" y1="90" x2="370" y2="90"/>
<line x1="370" y1="90" x2="380" y2="90"/>
<line x1="380" y1="90" x2="390" y2="90"/>
<line x1="390" y1="90" x2="400" y2="90"/>
<line x1="400" y1="90" x2="410" y2="90"/>
<line x1="410" y1="90" x2="420" y2="90"/>
<line x1="420" y1="90" x2="430" y2="90"/>
<line x1="430" y1="90" x2="440" y2="90"/>
<line x1="440" y1="90" x2="450" y2="90"/>
<line x1="450" y1="90" x2="460" y2="90"/>
<line x1="460" y1="90" x2="470" y2="90"/>
<line x1="470" y1="90" x2="480" y2="90"/>
<line x1="480" y1="90" x2="485" y2="90"/>
<line x1="485" y1="79" x2="485" y2="90"/>
</svg>
</div>
<p>The SICP metrics line shows:</p>
<ul>
<li>LOC: Lines of code (excluding blanks and comments)</li>
<li>λ: Procedure definitions (define + lambda forms)</li>
<li>LOC/λ: Average lines per procedure (smaller = more compositional)</li>
</ul>
<p>The fundamental unit is not the line - it's the λ. This is the heritage of computer science invented at MIT by smart squirrel/hackers: McCarthy's LISP, Sussman and Steele's Scheme, the AI Lab, Building 20. They saw computation as pure thought, λ as the primitive, parentheses as liberation not burden.</p>
<p>Measuring λ-density is measuring compositional discipline. A module with 6 LOC/λ has crystallized more thought per line than one with 10. The ratio tells you how SICP-minded the code is.</p>
<p>Metrics are stored in .forge/&lt;module&gt;.meta as s-expressions:</p>
<pre class="language-scheme">
((module . "vault")
 (timestamp . 1768359548)
 (so-size . 951016)
 (import-size . 3258)
 (compile-time-ms . 12686)
 (metrics (loc . 2793) (lambdas . 260) (imports . 1) (loc/lambda . 10)))
</pre>
<p>The forge knows how λ-dense your code is. Each compilation records: timestamp (Unix epoch), artifact sizes, build time, and the metrics that matter - lines of code, lambda count, λ-density ratio.</p>
<p>Queryable via:</p>
<pre class="language-scheme">
(forged "portal")     ; Single module metrics
(forged-all)          ; Bitfarm harvest: all modules
(sicp)                ; Live analysis (no forge metadata needed)
</pre>
<p>Standalone script for shell usage:</p>
<pre>
$ ./sicp              # From spki/scheme directory
$ lscs                # Shell alias (defined in .zshrc)
</pre>
<p>Compositional threshold:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 220 20" width="220" height="20" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<text x="5" y="10">L</text>
<text x="15" y="10">O</text>
<text x="25" y="10">C</text>
<text x="35" y="10">/</text>
<text x="45" y="10">λ</text>
<text x="65" y="10">&lt;</text>
<text x="85" y="10">1</text>
<text x="95" y="10">0</text>
<text x="125" y="10">(</text>
<text x="135" y="10">e</text>
<text x="145" y="10">n</text>
<text x="155" y="10">f</text>
<text x="165" y="10">o</text>
<text x="175" y="10">r</text>
<text x="185" y="10">c</text>
<text x="195" y="10">e</text>
<text x="205" y="10">d</text>
<text x="215" y="10">)</text>
</svg>
</div>
<p>Modules exceeding 10 LOC/λ trigger a warning during forge and are flagged in sicp output. This enforces SICP-style compositional discipline: small procedures composed to build complex behavior.</p>
<p>Current totals (v0.61):</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 300 20" width="300" height="20" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<text x="5" y="10">Σ</text>
<text x="25" y="10">8</text>
<text x="35" y="10">5</text>
<text x="45" y="10">0</text>
<text x="55" y="10">2</text>
<text x="75" y="10">L</text>
<text x="85" y="10">O</text>
<text x="95" y="10">C</text>
<text x="115" y="10">·</text>
<text x="135" y="10">9</text>
<text x="145" y="10">2</text>
<text x="155" y="10">0</text>
<text x="175" y="10">λ</text>
<text x="195" y="10">·</text>
<text x="215" y="10">9</text>
<text x="235" y="10">L</text>
<text x="245" y="10">O</text>
<text x="255" y="10">C</text>
<text x="265" y="10">/</text>
<text x="275" y="10">λ</text>
<text x="295" y="10">✓</text>
</svg>
</div>
<h3>4.2 Compiler Invocation</h3>
<p>The forge invokes csc (Chicken Scheme Compiler) with these flags:</p>
<table>
<tr><th>Flag</th><th>Purpose</th></tr>
<tr><td>-shared</td><td>Produce shared library (.so)</td></tr>
<tr><td>-J</td><td>Generate import library (.import.scm)</td></tr>
<tr><td>-strict-types</td><td>Enable scrutinizer type checking (beta)</td></tr>
<tr><td>-I path</td><td>Add include path (for FFI)</td></tr>
<tr><td>-L path</td><td>Add library path (for FFI)</td></tr>
<tr><td>-l lib</td><td>Link library (e.g., -lsodium)</td></tr>
</table>
<p>Example invocations:</p>
<pre class="language-shell">
# Standard module
csc -shared -J -strict-types portal.scm

# FFI module with libsodium
csc -shared -J -strict-types crypto-ffi.scm \
    -I/opt/homebrew/include -L/opt/homebrew/lib -lsodium
</pre>
<h3>4.3 Dependency Levels</h3>
<p>Modules are organized into dependency levels. Modules within a level have no mutual dependencies and compile in parallel.</p>
<pre class="language-scheme">
;; Level 0: Foundation (no cyberspace dependencies)
("os" "crypto-ffi" "sexp" "capability")

;; Level 1: Core utilities (depend on Level 0 only)
("mdns" "fips" "audit" "wordlist" "bloom"
 "catalog" "keyring" "portal")

;; Level 2: Certificates and enrollment (depend on Levels 0-1)
("cert" "enroll")

;; Level 3: Protocols (depend on Levels 0-2)
("gossip" "security")

;; Level 4: High-level operations (depend on Levels 0-3)
("vault" "auto-enroll")

;; Level 5: User interface (depend on all prior)
("ui")
</pre>
<p>To determine a module's level, examine its imports:</p>
<ul>
<li>If it imports only chicken/srfi modules: Level 0</li>
<li>If it imports Level 0 modules: Level 1</li>
<li>If it imports Level N modules: Level N+1 or higher</li>
</ul>
<h3>4.4 Parallel Compilation</h3>
<p>Each level compiles in parallel using process-fork:</p>
<pre class="language-scheme">
(define (rebuild-level-parallel! modules)
  (let ((pids (map (lambda (module)
                     (process-fork
                       (lambda ()
                         (rebuild-module! module)
                         (exit 0))))
                   modules)))
    (for-each process-wait pids)
    (length modules)))
</pre>
<p>The build blocks until all processes in a level complete before starting the next level. This ensures dependencies are satisfied.</p>
<h3>4.5 Architecture Neutrality</h3>
<p>The weave must be universal. Only content-addressed, architecture-neutral artifacts flow through the weave: s-expressions, signatures, proofs. Binary artifacts (.so, .o, the REPL executable) are local materializations - ephemeral as the hardware they run on.</p>
<p>Machine code is gibberish outside the local realm. Could be ARM64, could be x86_64, could be a JPEG of a cat. The weave cannot inspect it, cannot verify it, cannot reason about it. Only the s-expression source has universal meaning - it parses the same on lambda as on fluffy as on whatever Linux box joins the realm next.</p>
<p>Consequently, compiled artifacts are excluded from version control and replication:</p>
<pre>
# .gitignore
spki/scheme/cyberspace-repl
spki/scheme/*.so
spki/scheme/*.o
spki/scheme/*.import.scm
spki/scheme/.*.arch
</pre>
<p>Each node compiles its own. Lambda is portable. Machine code is not.</p>
<h3>4.6 Rebuild Detection</h3>
<p>A module needs rebuilding when any of these conditions hold:</p>
<ul>
<li>The .so file does not exist</li>
<li>The .import.scm file does not exist</li>
<li>The source .scm is newer than the .so (mtime comparison)</li>
<li>The platform stamp doesn't match (e.g., Darwin-arm64 vs Linux-x86_64)</li>
</ul>
<pre class="language-scheme">
(define (needs-rebuild? module)
  (or (not (file-exists? (string-append module ".so")))
      (not (file-exists? (string-append module ".import.scm")))
      (&gt; (file-mtime (string-append module ".scm"))
         (file-mtime (string-append module ".so")))
      (not (string=? (read-arch-stamp module) (current-arch)))))
</pre>
</section>
<section>
<h2>5. Beta vs Production Builds</h2>
<h3>5.1 Build Mode Flag</h3>
<p>The *beta-build* flag controls strict type checking:</p>
<pre class="language-scheme">
;; In cyberspace-repl.scm
(define *beta-build* #t)  ; Enable for development
(define *beta-build* #f)  ; Disable for release
</pre>
<h3>5.2 Beta Mode Benefits</h3>
<p>With *beta-build* = #t:</p>
<ul>
<li>All modules compile with -strict-types</li>
<li>Type mismatches are compile-time errors</li>
<li>Invalid arguments are detected</li>
<li>Deprecated identifiers are flagged</li>
<li>Format string errors are caught</li>
</ul>
<p>Build time impact: ~20-25 seconds for full rebuild</p>
<h3>5.3 Production Mode</h3>
<p>With *beta-build* = #f:</p>
<ul>
<li>Modules compile without -strict-types</li>
<li>Type declarations remain as documentation</li>
<li>Faster compilation</li>
<li>Smaller binaries (no type metadata)</li>
</ul>
<p>Build time impact: ~10-15 seconds for full rebuild</p>
<h3>5.4 When to Use Each Mode</h3>
<table>
<tr><th>Scenario</th><th>Mode</th><th>Rationale</th></tr>
<tr><td>Active development</td><td>Beta</td><td>Catch type errors early</td></tr>
<tr><td>CI/CD pipeline</td><td>Beta</td><td>Prevent type regressions</td></tr>
<tr><td>Release builds</td><td>Production</td><td>Optimize for users</td></tr>
<tr><td>Debugging issues</td><td>Beta</td><td>Better error context</td></tr>
<tr><td>Performance testing</td><td>Production</td><td>Measure real performance</td></tr>
</table>
</section>
<section>
<h2>Part II: Debugging</h2>
<p></p>
</section>
<section>
<h2>6. Exception Handling</h2>
<h3>6.1 Condition System</h3>
<p>Chicken uses the SRFI-12 condition system. Exceptions are condition objects with properties:</p>
<pre class="language-scheme">
(handle-exceptions exn
  ;; Handler: exn is the condition object
  (print "Error: " (get-condition-property exn 'exn 'message))

  ;; Protected code
  (dangerous-operation))
</pre>
<h3>6.2 Standard Condition Properties</h3>
<table>
<tr><th>Property</th><th>Type</th><th>Description</th></tr>
<tr><td>'exn 'message</td><td>string</td><td>Human-readable error message</td></tr>
<tr><td>'exn 'location</td><td>symbol</td><td>Procedure where error occurred</td></tr>
<tr><td>'exn 'arguments</td><td>list</td><td>Arguments that caused error</td></tr>
<tr><td>'exn 'call-chain</td><td>list</td><td>Stack trace</td></tr>
</table>
<pre class="language-scheme">
(define (safe-operation x)
  (handle-exceptions exn
    (let ((msg (get-condition-property exn 'exn 'message "unknown"))
          (loc (get-condition-property exn 'exn 'location #f))
          (chain (get-condition-property exn 'exn 'call-chain '())))
      (printf "Error in ~a: ~a~n" loc msg)
      (print-call-chain chain)
      #f)
    (actual-operation x)))
</pre>
<h3>6.3 Rich Exception Display</h3>
<p>The REPL provides rich exception display with box formatting:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 430 200" width="430" height="200" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<line x1="5" y1="10" x2="10" y2="10"/>
<line x1="5" y1="10" x2="5" y2="21"/>
<line x1="10" y1="10" x2="20" y2="10"/>
<line x1="20" y1="10" x2="30" y2="10"/>
<line x1="30" y1="10" x2="40" y2="10"/>
<line x1="40" y1="10" x2="50" y2="10"/>
<line x1="50" y1="10" x2="60" y2="10"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<line x1="110" y1="10" x2="120" y2="10"/>
<line x1="120" y1="10" x2="130" y2="10"/>
<line x1="130" y1="10" x2="140" y2="10"/>
<line x1="140" y1="10" x2="150" y2="10"/>
<text x="165" y="10">E</text>
<text x="175" y="10">x</text>
<text x="185" y="10">c</text>
<text x="195" y="10">e</text>
<text x="205" y="10">p</text>
<text x="215" y="10">t</text>
<text x="225" y="10">i</text>
<text x="235" y="10">o</text>
<text x="245" y="10">n</text>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="390" y2="10"/>
<line x1="390" y1="10" x2="400" y2="10"/>
<line x1="400" y1="10" x2="410" y2="10"/>
<line x1="420" y1="10" x2="425" y2="10"/>
<line x1="425" y1="10" x2="425" y2="21"/>
<line x1="5" y1="19" x2="5" y2="41"/>
<text x="25" y="30">d</text>
<text x="35" y="30">i</text>
<text x="45" y="30">v</text>
<text x="55" y="30">i</text>
<text x="65" y="30">s</text>
<text x="75" y="30">i</text>
<text x="85" y="30">o</text>
<text x="95" y="30">n</text>
<text x="115" y="30">b</text>
<text x="125" y="30">y</text>
<text x="145" y="30">z</text>
<text x="155" y="30">e</text>
<text x="165" y="30">r</text>
<text x="175" y="30">o</text>
<line x1="425" y1="19" x2="425" y2="41"/>
<line x1="5" y1="39" x2="5" y2="61"/>
<text x="25" y="50">L</text>
<text x="35" y="50">o</text>
<text x="45" y="50">c</text>
<text x="55" y="50">a</text>
<text x="65" y="50">t</text>
<text x="75" y="50">i</text>
<text x="85" y="50">o</text>
<text x="95" y="50">n</text>
<text x="105" y="50">:</text>
<text x="125" y="50">q</text>
<text x="135" y="50">u</text>
<text x="145" y="50">o</text>
<text x="155" y="50">t</text>
<text x="165" y="50">i</text>
<text x="175" y="50">e</text>
<text x="185" y="50">n</text>
<text x="195" y="50">t</text>
<line x1="425" y1="39" x2="425" y2="61"/>
<line x1="5" y1="59" x2="5" y2="81"/>
<text x="25" y="70">A</text>
<text x="35" y="70">r</text>
<text x="45" y="70">g</text>
<text x="55" y="70">u</text>
<text x="65" y="70">m</text>
<text x="75" y="70">e</text>
<text x="85" y="70">n</text>
<text x="95" y="70">t</text>
<text x="105" y="70">s</text>
<text x="115" y="70">:</text>
<text x="135" y="70">(</text>
<text x="145" y="70">4</text>
<text x="155" y="70">2</text>
<text x="175" y="70">0</text>
<text x="185" y="70">)</text>
<line x1="425" y1="59" x2="425" y2="81"/>
<line x1="5" y1="79" x2="5" y2="101"/>
<line x1="5" y1="90" x2="10" y2="90"/>
<line x1="10" y1="90" x2="20" y2="90"/>
<line x1="20" y1="90" x2="30" y2="90"/>
<line x1="30" y1="90" x2="40" y2="90"/>
<line x1="40" y1="90" x2="50" y2="90"/>
<line x1="50" y1="90" x2="60" y2="90"/>
<line x1="60" y1="90" x2="70" y2="90"/>
<line x1="70" y1="90" x2="80" y2="90"/>
<line x1="80" y1="90" x2="90" y2="90"/>
<line x1="90" y1="90" x2="100" y2="90"/>
<line x1="100" y1="90" x2="110" y2="90"/>
<line x1="110" y1="90" x2="120" y2="90"/>
<line x1="120" y1="90" x2="130" y2="90"/>
<line x1="130" y1="90" x2="140" y2="90"/>
<line x1="140" y1="90" x2="150" y2="90"/>
<line x1="150" y1="90" x2="160" y2="90"/>
<line x1="160" y1="90" x2="170" y2="90"/>
<line x1="170" y1="90" x2="180" y2="90"/>
<line x1="180" y1="90" x2="190" y2="90"/>
<line x1="190" y1="90" x2="200" y2="90"/>
<line x1="200" y1="90" x2="210" y2="90"/>
<line x1="210" y1="90" x2="220" y2="90"/>
<line x1="220" y1="90" x2="230" y2="90"/>
<line x1="230" y1="90" x2="240" y2="90"/>
<line x1="240" y1="90" x2="250" y2="90"/>
<line x1="250" y1="90" x2="260" y2="90"/>
<line x1="260" y1="90" x2="270" y2="90"/>
<line x1="270" y1="90" x2="280" y2="90"/>
<line x1="280" y1="90" x2="290" y2="90"/>
<line x1="290" y1="90" x2="300" y2="90"/>
<line x1="300" y1="90" x2="310" y2="90"/>
<line x1="310" y1="90" x2="320" y2="90"/>
<line x1="320" y1="90" x2="330" y2="90"/>
<line x1="330" y1="90" x2="340" y2="90"/>
<line x1="340" y1="90" x2="350" y2="90"/>
<line x1="350" y1="90" x2="360" y2="90"/>
<line x1="360" y1="90" x2="370" y2="90"/>
<line x1="370" y1="90" x2="380" y2="90"/>
<line x1="380" y1="90" x2="390" y2="90"/>
<line x1="390" y1="90" x2="400" y2="90"/>
<line x1="400" y1="90" x2="410" y2="90"/>
<line x1="410" y1="90" x2="420" y2="90"/>
<line x1="425" y1="79" x2="425" y2="101"/>
<line x1="420" y1="90" x2="425" y2="90"/>
<line x1="5" y1="99" x2="5" y2="121"/>
<text x="25" y="110">C</text>
<text x="35" y="110">a</text>
<text x="45" y="110">l</text>
<text x="55" y="110">l</text>
<text x="75" y="110">C</text>
<text x="85" y="110">h</text>
<text x="95" y="110">a</text>
<text x="105" y="110">i</text>
<text x="115" y="110">n</text>
<text x="125" y="110">:</text>
<line x1="425" y1="99" x2="425" y2="121"/>
<line x1="5" y1="119" x2="5" y2="141"/>
<text x="45" y="130">d</text>
<text x="55" y="130">i</text>
<text x="65" y="130">v</text>
<text x="75" y="130">i</text>
<text x="85" y="130">d</text>
<text x="95" y="130">e</text>
<text x="105" y="130">-</text>
<text x="115" y="130">v</text>
<text x="125" y="130">a</text>
<text x="135" y="130">l</text>
<text x="145" y="130">u</text>
<text x="155" y="130">e</text>
<text x="165" y="130">s</text>
<line x1="425" y1="119" x2="425" y2="141"/>
<line x1="5" y1="139" x2="5" y2="161"/>
<text x="45" y="150">p</text>
<text x="55" y="150">r</text>
<text x="65" y="150">o</text>
<text x="75" y="150">c</text>
<text x="85" y="150">e</text>
<text x="95" y="150">s</text>
<text x="105" y="150">s</text>
<text x="115" y="150">-</text>
<text x="125" y="150">i</text>
<text x="135" y="150">n</text>
<text x="145" y="150">p</text>
<text x="155" y="150">u</text>
<text x="165" y="150">t</text>
<line x1="425" y1="139" x2="425" y2="161"/>
<line x1="5" y1="159" x2="5" y2="181"/>
<text x="45" y="170">m</text>
<text x="55" y="170">a</text>
<text x="65" y="170">i</text>
<text x="75" y="170">n</text>
<text x="85" y="170">-</text>
<text x="95" y="170">l</text>
<text x="105" y="170">o</text>
<text x="115" y="170">o</text>
<text x="125" y="170">p</text>
<line x1="425" y1="159" x2="425" y2="181"/>
<line x1="5" y1="190" x2="10" y2="190"/>
<line x1="5" y1="179" x2="5" y2="190"/>
<line x1="10" y1="190" x2="20" y2="190"/>
<line x1="20" y1="190" x2="30" y2="190"/>
<line x1="30" y1="190" x2="40" y2="190"/>
<line x1="40" y1="190" x2="50" y2="190"/>
<line x1="50" y1="190" x2="60" y2="190"/>
<line x1="60" y1="190" x2="70" y2="190"/>
<line x1="70" y1="190" x2="80" y2="190"/>
<line x1="80" y1="190" x2="90" y2="190"/>
<line x1="90" y1="190" x2="100" y2="190"/>
<line x1="100" y1="190" x2="110" y2="190"/>
<line x1="110" y1="190" x2="120" y2="190"/>
<line x1="120" y1="190" x2="130" y2="190"/>
<line x1="130" y1="190" x2="140" y2="190"/>
<line x1="140" y1="190" x2="150" y2="190"/>
<line x1="150" y1="190" x2="160" y2="190"/>
<line x1="160" y1="190" x2="170" y2="190"/>
<line x1="170" y1="190" x2="180" y2="190"/>
<line x1="180" y1="190" x2="190" y2="190"/>
<line x1="190" y1="190" x2="200" y2="190"/>
<line x1="200" y1="190" x2="210" y2="190"/>
<line x1="210" y1="190" x2="220" y2="190"/>
<line x1="220" y1="190" x2="230" y2="190"/>
<line x1="230" y1="190" x2="240" y2="190"/>
<line x1="240" y1="190" x2="250" y2="190"/>
<line x1="250" y1="190" x2="260" y2="190"/>
<line x1="260" y1="190" x2="270" y2="190"/>
<line x1="270" y1="190" x2="280" y2="190"/>
<line x1="280" y1="190" x2="290" y2="190"/>
<line x1="290" y1="190" x2="300" y2="190"/>
<line x1="300" y1="190" x2="310" y2="190"/>
<line x1="310" y1="190" x2="320" y2="190"/>
<line x1="320" y1="190" x2="330" y2="190"/>
<line x1="330" y1="190" x2="340" y2="190"/>
<line x1="340" y1="190" x2="350" y2="190"/>
<line x1="350" y1="190" x2="360" y2="190"/>
<line x1="360" y1="190" x2="370" y2="190"/>
<line x1="370" y1="190" x2="380" y2="190"/>
<line x1="380" y1="190" x2="390" y2="190"/>
<line x1="390" y1="190" x2="400" y2="190"/>
<line x1="400" y1="190" x2="410" y2="190"/>
<line x1="410" y1="190" x2="420" y2="190"/>
<line x1="420" y1="190" x2="425" y2="190"/>
<line x1="425" y1="179" x2="425" y2="190"/>
</svg>
</div>
<p>Implementation uses the centralized box-drawing API from os.scm.</p>
<h2>7. Tracing and Profiling</h2>
<h3>7.1 Procedure Tracing</h3>
<p>Trace procedure calls and returns:</p>
<pre class="language-scheme">
;; Enable tracing
(trace foo)
(trace bar baz)

;; Disable tracing
(untrace foo)
(untrace)  ; untrace all
</pre>
<p>Trace output:</p>
<pre>
(foo 1 2 3)
  |(bar 1)
  | (baz 2)
  | baz -&gt; 4
  |bar -&gt; 5
foo -&gt; 8
</pre>
<h3>7.2 REPL Trace Commands</h3>
<p>CSI provides trace commands:</p>
<pre>
,trace proc     ; trace procedure
,trace         ; show traced procedures
,untrace proc  ; stop tracing
,untrace       ; stop all tracing
</pre>
<h3>7.3 Call Chain</h3>
<p>Get the current call chain at any point:</p>
<pre class="language-scheme">
(define (debug-here)
  (print-call-chain (get-call-chain)))

;; Or after an error in the REPL:
,n              ; show call chain
,c              ; continue
,d              ; describe exception
</pre>
<h3>7.4 Time Profiling</h3>
<p>Measure execution time:</p>
<pre class="language-scheme">
(time (expensive-operation))
;; =&gt; 0.142s CPU, 0.145s real, 12345 bytes allocated
</pre>
<p>For more detailed profiling, compile with -profile and use chicken-profile.</p>
<h2>8. Inspector Design</h2>
<p>Inspired by Dylan's inspector - the gold standard for interactive debugging.</p>
<h3>8.1 Design Principles</h3>
<p>The Dylan inspector philosophy:</p>
<ul>
<li>INSPECT EVERYTHING: Any object can be inspected</li>
<li>HIDE NOTHING: Internal structure is visible</li>
<li>NAVIGATE FREELY: Drill down into any component</li>
<li>MODIFY CAREFULLY: Live patching with safety checks</li>
<li>HISTORY MATTERS: Navigation history, bookmarks</li>
</ul>
<h3>8.2 Inspector Commands (Planned)</h3>
<table>
<tr><th>Command</th><th>Action</th></tr>
<tr><td>:i obj</td><td>Inspect object</td></tr>
<tr><td>:s</td><td>Show current object</td></tr>
<tr><td>:d N</td><td>Descend into slot N</td></tr>
<tr><td>:u</td><td>Up to parent object</td></tr>
<tr><td>:h</td><td>Show inspection history</td></tr>
<tr><td>:b</td><td>Bookmark current object</td></tr>
<tr><td>:m slot val</td><td>Modify slot value</td></tr>
<tr><td>:t</td><td>Show object type info</td></tr>
<tr><td>:r</td><td>Show references to object</td></tr>
</table>
<h3>8.3 Object Display Format</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 430 220" width="430" height="220" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<line x1="5" y1="10" x2="10" y2="10"/>
<line x1="5" y1="10" x2="5" y2="21"/>
<line x1="10" y1="10" x2="20" y2="10"/>
<line x1="20" y1="10" x2="30" y2="10"/>
<line x1="30" y1="10" x2="40" y2="10"/>
<line x1="40" y1="10" x2="50" y2="10"/>
<line x1="50" y1="10" x2="60" y2="10"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<text x="125" y="10">I</text>
<text x="135" y="10">n</text>
<text x="145" y="10">s</text>
<text x="155" y="10">p</text>
<text x="165" y="10">e</text>
<text x="175" y="10">c</text>
<text x="185" y="10">t</text>
<text x="195" y="10">i</text>
<text x="205" y="10">n</text>
<text x="215" y="10">g</text>
<text x="225" y="10">:</text>
<text x="245" y="10">p</text>
<text x="255" y="10">a</text>
<text x="265" y="10">i</text>
<text x="275" y="10">r</text>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="390" y2="10"/>
<line x1="390" y1="10" x2="400" y2="10"/>
<line x1="400" y1="10" x2="410" y2="10"/>
<line x1="410" y1="10" x2="420" y2="10"/>
<line x1="420" y1="10" x2="425" y2="10"/>
<line x1="425" y1="10" x2="425" y2="21"/>
<line x1="5" y1="19" x2="5" y2="41"/>
<text x="25" y="30">T</text>
<text x="35" y="30">y</text>
<text x="45" y="30">p</text>
<text x="55" y="30">e</text>
<text x="65" y="30">:</text>
<text x="85" y="30">p</text>
<text x="95" y="30">a</text>
<text x="105" y="30">i</text>
<text x="115" y="30">r</text>
<line x1="425" y1="19" x2="425" y2="41"/>
<line x1="5" y1="39" x2="5" y2="61"/>
<text x="25" y="50">A</text>
<text x="35" y="50">d</text>
<text x="45" y="50">d</text>
<text x="55" y="50">r</text>
<text x="65" y="50">e</text>
<text x="75" y="50">s</text>
<text x="85" y="50">s</text>
<text x="95" y="50">:</text>
<text x="115" y="50">0</text>
<text x="125" y="50">x</text>
<text x="135" y="50">7</text>
<text x="145" y="50">f</text>
<text x="155" y="50">f</text>
<text x="165" y="50">f</text>
<text x="175" y="50">5</text>
<text x="185" y="50">f</text>
<text x="195" y="50">b</text>
<text x="205" y="50">f</text>
<text x="215" y="50">f</text>
<text x="225" y="50">8</text>
<text x="235" y="50">a</text>
<text x="245" y="50">0</text>
<line x1="425" y1="39" x2="425" y2="61"/>
<line x1="5" y1="59" x2="5" y2="81"/>
<line x1="5" y1="70" x2="10" y2="70"/>
<line x1="10" y1="70" x2="20" y2="70"/>
<line x1="20" y1="70" x2="30" y2="70"/>
<line x1="30" y1="70" x2="40" y2="70"/>
<line x1="40" y1="70" x2="50" y2="70"/>
<line x1="50" y1="70" x2="60" y2="70"/>
<line x1="60" y1="70" x2="70" y2="70"/>
<line x1="70" y1="70" x2="80" y2="70"/>
<line x1="80" y1="70" x2="90" y2="70"/>
<line x1="90" y1="70" x2="100" y2="70"/>
<line x1="100" y1="70" x2="110" y2="70"/>
<line x1="110" y1="70" x2="120" y2="70"/>
<line x1="120" y1="70" x2="130" y2="70"/>
<line x1="130" y1="70" x2="140" y2="70"/>
<line x1="140" y1="70" x2="150" y2="70"/>
<line x1="150" y1="70" x2="160" y2="70"/>
<line x1="160" y1="70" x2="170" y2="70"/>
<line x1="170" y1="70" x2="180" y2="70"/>
<line x1="180" y1="70" x2="190" y2="70"/>
<line x1="190" y1="70" x2="200" y2="70"/>
<line x1="200" y1="70" x2="210" y2="70"/>
<line x1="210" y1="70" x2="220" y2="70"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="360" y2="70"/>
<line x1="360" y1="70" x2="370" y2="70"/>
<line x1="370" y1="70" x2="380" y2="70"/>
<line x1="380" y1="70" x2="390" y2="70"/>
<line x1="390" y1="70" x2="400" y2="70"/>
<line x1="400" y1="70" x2="410" y2="70"/>
<line x1="410" y1="70" x2="420" y2="70"/>
<line x1="425" y1="59" x2="425" y2="81"/>
<line x1="420" y1="70" x2="425" y2="70"/>
<line x1="5" y1="79" x2="5" y2="101"/>
<text x="25" y="90">[</text>
<text x="35" y="90">0</text>
<text x="45" y="90">]</text>
<text x="65" y="90">c</text>
<text x="75" y="90">a</text>
<text x="85" y="90">r</text>
<text x="95" y="90">:</text>
<text x="115" y="90">s</text>
<text x="125" y="90">y</text>
<text x="135" y="90">m</text>
<text x="145" y="90">b</text>
<text x="155" y="90">o</text>
<text x="165" y="90">l</text>
<text x="185" y="90">'</text>
<text x="195" y="90">f</text>
<text x="205" y="90">o</text>
<text x="215" y="90">o</text>
<line x1="425" y1="79" x2="425" y2="101"/>
<line x1="5" y1="99" x2="5" y2="121"/>
<text x="25" y="110">[</text>
<text x="35" y="110">1</text>
<text x="45" y="110">]</text>
<text x="65" y="110">c</text>
<text x="75" y="110">d</text>
<text x="85" y="110">r</text>
<text x="95" y="110">:</text>
<text x="115" y="110">p</text>
<text x="125" y="110">a</text>
<text x="135" y="110">i</text>
<text x="145" y="110">r</text>
<text x="165" y="110">(</text>
<text x="175" y="110">.</text>
<text x="185" y="110">.</text>
<text x="195" y="110">.</text>
<text x="205" y="110">)</text>
<line x1="425" y1="99" x2="425" y2="121"/>
<line x1="5" y1="119" x2="5" y2="141"/>
<line x1="5" y1="130" x2="10" y2="130"/>
<line x1="10" y1="130" x2="20" y2="130"/>
<line x1="20" y1="130" x2="30" y2="130"/>
<line x1="30" y1="130" x2="40" y2="130"/>
<line x1="40" y1="130" x2="50" y2="130"/>
<line x1="50" y1="130" x2="60" y2="130"/>
<line x1="60" y1="130" x2="70" y2="130"/>
<line x1="70" y1="130" x2="80" y2="130"/>
<line x1="80" y1="130" x2="90" y2="130"/>
<line x1="90" y1="130" x2="100" y2="130"/>
<line x1="100" y1="130" x2="110" y2="130"/>
<line x1="110" y1="130" x2="120" y2="130"/>
<line x1="120" y1="130" x2="130" y2="130"/>
<line x1="130" y1="130" x2="140" y2="130"/>
<line x1="140" y1="130" x2="150" y2="130"/>
<line x1="150" y1="130" x2="160" y2="130"/>
<line x1="160" y1="130" x2="170" y2="130"/>
<line x1="170" y1="130" x2="180" y2="130"/>
<line x1="180" y1="130" x2="190" y2="130"/>
<line x1="190" y1="130" x2="200" y2="130"/>
<line x1="200" y1="130" x2="210" y2="130"/>
<line x1="210" y1="130" x2="220" y2="130"/>
<line x1="220" y1="130" x2="230" y2="130"/>
<line x1="230" y1="130" x2="240" y2="130"/>
<line x1="240" y1="130" x2="250" y2="130"/>
<line x1="250" y1="130" x2="260" y2="130"/>
<line x1="260" y1="130" x2="270" y2="130"/>
<line x1="270" y1="130" x2="280" y2="130"/>
<line x1="280" y1="130" x2="290" y2="130"/>
<line x1="290" y1="130" x2="300" y2="130"/>
<line x1="300" y1="130" x2="310" y2="130"/>
<line x1="310" y1="130" x2="320" y2="130"/>
<line x1="320" y1="130" x2="330" y2="130"/>
<line x1="330" y1="130" x2="340" y2="130"/>
<line x1="340" y1="130" x2="350" y2="130"/>
<line x1="350" y1="130" x2="360" y2="130"/>
<line x1="360" y1="130" x2="370" y2="130"/>
<line x1="370" y1="130" x2="380" y2="130"/>
<line x1="380" y1="130" x2="390" y2="130"/>
<line x1="390" y1="130" x2="400" y2="130"/>
<line x1="400" y1="130" x2="410" y2="130"/>
<line x1="410" y1="130" x2="420" y2="130"/>
<line x1="425" y1="119" x2="425" y2="141"/>
<line x1="420" y1="130" x2="425" y2="130"/>
<line x1="5" y1="139" x2="5" y2="161"/>
<text x="25" y="150">:</text>
<text x="35" y="150">d</text>
<text x="55" y="150">0</text>
<text x="85" y="150">-</text>
<text x="105" y="150">i</text>
<text x="115" y="150">n</text>
<text x="125" y="150">s</text>
<text x="135" y="150">p</text>
<text x="145" y="150">e</text>
<text x="155" y="150">c</text>
<text x="165" y="150">t</text>
<text x="185" y="150">c</text>
<text x="195" y="150">a</text>
<text x="205" y="150">r</text>
<line x1="425" y1="139" x2="425" y2="161"/>
<line x1="5" y1="159" x2="5" y2="181"/>
<text x="25" y="170">:</text>
<text x="35" y="170">d</text>
<text x="55" y="170">1</text>
<text x="85" y="170">-</text>
<text x="105" y="170">i</text>
<text x="115" y="170">n</text>
<text x="125" y="170">s</text>
<text x="135" y="170">p</text>
<text x="145" y="170">e</text>
<text x="155" y="170">c</text>
<text x="165" y="170">t</text>
<text x="185" y="170">c</text>
<text x="195" y="170">d</text>
<text x="205" y="170">r</text>
<line x1="425" y1="159" x2="425" y2="181"/>
<line x1="5" y1="179" x2="5" y2="201"/>
<text x="25" y="190">:</text>
<text x="35" y="190">u</text>
<text x="85" y="190">-</text>
<text x="105" y="190">g</text>
<text x="115" y="190">o</text>
<text x="135" y="190">b</text>
<text x="145" y="190">a</text>
<text x="155" y="190">c</text>
<text x="165" y="190">k</text>
<line x1="425" y1="179" x2="425" y2="201"/>
<line x1="5" y1="210" x2="10" y2="210"/>
<line x1="5" y1="199" x2="5" y2="210"/>
<line x1="10" y1="210" x2="20" y2="210"/>
<line x1="20" y1="210" x2="30" y2="210"/>
<line x1="30" y1="210" x2="40" y2="210"/>
<line x1="40" y1="210" x2="50" y2="210"/>
<line x1="50" y1="210" x2="60" y2="210"/>
<line x1="60" y1="210" x2="70" y2="210"/>
<line x1="70" y1="210" x2="80" y2="210"/>
<line x1="80" y1="210" x2="90" y2="210"/>
<line x1="90" y1="210" x2="100" y2="210"/>
<line x1="100" y1="210" x2="110" y2="210"/>
<line x1="110" y1="210" x2="120" y2="210"/>
<line x1="120" y1="210" x2="130" y2="210"/>
<line x1="130" y1="210" x2="140" y2="210"/>
<line x1="140" y1="210" x2="150" y2="210"/>
<line x1="150" y1="210" x2="160" y2="210"/>
<line x1="160" y1="210" x2="170" y2="210"/>
<line x1="170" y1="210" x2="180" y2="210"/>
<line x1="180" y1="210" x2="190" y2="210"/>
<line x1="190" y1="210" x2="200" y2="210"/>
<line x1="200" y1="210" x2="210" y2="210"/>
<line x1="210" y1="210" x2="220" y2="210"/>
<line x1="220" y1="210" x2="230" y2="210"/>
<line x1="230" y1="210" x2="240" y2="210"/>
<line x1="240" y1="210" x2="250" y2="210"/>
<line x1="250" y1="210" x2="260" y2="210"/>
<line x1="260" y1="210" x2="270" y2="210"/>
<line x1="270" y1="210" x2="280" y2="210"/>
<line x1="280" y1="210" x2="290" y2="210"/>
<line x1="290" y1="210" x2="300" y2="210"/>
<line x1="300" y1="210" x2="310" y2="210"/>
<line x1="310" y1="210" x2="320" y2="210"/>
<line x1="320" y1="210" x2="330" y2="210"/>
<line x1="330" y1="210" x2="340" y2="210"/>
<line x1="340" y1="210" x2="350" y2="210"/>
<line x1="350" y1="210" x2="360" y2="210"/>
<line x1="360" y1="210" x2="370" y2="210"/>
<line x1="370" y1="210" x2="380" y2="210"/>
<line x1="380" y1="210" x2="390" y2="210"/>
<line x1="390" y1="210" x2="400" y2="210"/>
<line x1="400" y1="210" x2="410" y2="210"/>
<line x1="410" y1="210" x2="420" y2="210"/>
<line x1="420" y1="210" x2="425" y2="210"/>
<line x1="425" y1="199" x2="425" y2="210"/>
</svg>
</div>
<h3>8.4 Type-Specific Inspectors</h3>
<p>Specialized display for common types:</p>
<ul>
<li>Procedures: arity, source location, closure variables</li>
<li>Ports: direction, filename, position</li>
<li>Blobs: hex dump, ASCII preview</li>
<li>Hash tables: key count, load factor, entries</li>
<li>SPKI certs: issuer, subject, validity, delegation</li>
<li>Audit entries: timestamp, actor, operation</li>
</ul>
<h2>9. REPL Debugging Commands</h2>
<h3>9.1 Built-in Commands</h3>
<table>
<tr><th>Command</th><th>Description</th></tr>
<tr><td>,?</td><td>Show help</td></tr>
<tr><td>,l file</td><td>Load file</td></tr>
<tr><td>,r</td><td>Show recent expressions</td></tr>
<tr><td>,s</td><td>Show current module</td></tr>
<tr><td>,m module</td><td>Enter module</td></tr>
<tr><td>,n</td><td>Show call chain after error</td></tr>
<tr><td>,d</td><td>Describe last exception</td></tr>
<tr><td>,c</td><td>Continue after break</td></tr>
<tr><td>,q</td><td>Quit REPL</td></tr>
<tr><td>,t proc</td><td>Trace procedure</td></tr>
<tr><td>,u proc</td><td>Untrace procedure</td></tr>
</table>
<h3>9.2 Cyberspace Extensions</h3>
<table>
<tr><th>Command</th><th>Description</th></tr>
<tr><td>:rebuild</td><td>Force rebuild all modules</td></tr>
<tr><td>:status</td><td>Show session statistics</td></tr>
<tr><td>:soup</td><td>Enter soup browser</td></tr>
<tr><td>:inspect obj</td><td>Inspect object (planned)</td></tr>
<tr><td>:audit</td><td>Show recent audit entries</td></tr>
<tr><td>:keys</td><td>Show loaded keys</td></tr>
</table>
<h3>9.3 Error Recovery</h3>
<p>After an error, the REPL captures context:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 430 260" width="430" height="260" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<text x="5" y="10">&gt;</text>
<text x="25" y="10">(</text>
<text x="35" y="10">/</text>
<text x="55" y="10">1</text>
<text x="75" y="10">0</text>
<text x="85" y="10">)</text>
<line x1="5" y1="30" x2="10" y2="30"/>
<line x1="5" y1="30" x2="5" y2="41"/>
<line x1="10" y1="30" x2="20" y2="30"/>
<line x1="20" y1="30" x2="30" y2="30"/>
<line x1="30" y1="30" x2="40" y2="30"/>
<line x1="40" y1="30" x2="50" y2="30"/>
<line x1="50" y1="30" x2="60" y2="30"/>
<line x1="60" y1="30" x2="70" y2="30"/>
<line x1="70" y1="30" x2="80" y2="30"/>
<line x1="80" y1="30" x2="90" y2="30"/>
<line x1="90" y1="30" x2="100" y2="30"/>
<line x1="100" y1="30" x2="110" y2="30"/>
<line x1="110" y1="30" x2="120" y2="30"/>
<line x1="120" y1="30" x2="130" y2="30"/>
<line x1="130" y1="30" x2="140" y2="30"/>
<line x1="140" y1="30" x2="150" y2="30"/>
<text x="165" y="30">E</text>
<text x="175" y="30">x</text>
<text x="185" y="30">c</text>
<text x="195" y="30">e</text>
<text x="205" y="30">p</text>
<text x="215" y="30">t</text>
<text x="225" y="30">i</text>
<text x="235" y="30">o</text>
<text x="245" y="30">n</text>
<line x1="260" y1="30" x2="270" y2="30"/>
<line x1="270" y1="30" x2="280" y2="30"/>
<line x1="280" y1="30" x2="290" y2="30"/>
<line x1="290" y1="30" x2="300" y2="30"/>
<line x1="300" y1="30" x2="310" y2="30"/>
<line x1="310" y1="30" x2="320" y2="30"/>
<line x1="320" y1="30" x2="330" y2="30"/>
<line x1="330" y1="30" x2="340" y2="30"/>
<line x1="340" y1="30" x2="350" y2="30"/>
<line x1="350" y1="30" x2="360" y2="30"/>
<line x1="360" y1="30" x2="370" y2="30"/>
<line x1="370" y1="30" x2="380" y2="30"/>
<line x1="380" y1="30" x2="390" y2="30"/>
<line x1="390" y1="30" x2="400" y2="30"/>
<line x1="400" y1="30" x2="410" y2="30"/>
<line x1="420" y1="30" x2="425" y2="30"/>
<line x1="425" y1="30" x2="425" y2="41"/>
<line x1="5" y1="39" x2="5" y2="61"/>
<text x="25" y="50">d</text>
<text x="35" y="50">i</text>
<text x="45" y="50">v</text>
<text x="55" y="50">i</text>
<text x="65" y="50">s</text>
<text x="75" y="50">i</text>
<text x="85" y="50">o</text>
<text x="95" y="50">n</text>
<text x="115" y="50">b</text>
<text x="125" y="50">y</text>
<text x="145" y="50">z</text>
<text x="155" y="50">e</text>
<text x="165" y="50">r</text>
<text x="175" y="50">o</text>
<line x1="425" y1="39" x2="425" y2="61"/>
<line x1="5" y1="70" x2="10" y2="70"/>
<line x1="5" y1="59" x2="5" y2="70"/>
<line x1="10" y1="70" x2="20" y2="70"/>
<line x1="20" y1="70" x2="30" y2="70"/>
<line x1="30" y1="70" x2="40" y2="70"/>
<line x1="40" y1="70" x2="50" y2="70"/>
<line x1="50" y1="70" x2="60" y2="70"/>
<line x1="60" y1="70" x2="70" y2="70"/>
<line x1="70" y1="70" x2="80" y2="70"/>
<line x1="80" y1="70" x2="90" y2="70"/>
<line x1="90" y1="70" x2="100" y2="70"/>
<line x1="100" y1="70" x2="110" y2="70"/>
<line x1="110" y1="70" x2="120" y2="70"/>
<line x1="120" y1="70" x2="130" y2="70"/>
<line x1="130" y1="70" x2="140" y2="70"/>
<line x1="140" y1="70" x2="150" y2="70"/>
<line x1="150" y1="70" x2="160" y2="70"/>
<line x1="160" y1="70" x2="170" y2="70"/>
<line x1="170" y1="70" x2="180" y2="70"/>
<line x1="180" y1="70" x2="190" y2="70"/>
<line x1="190" y1="70" x2="200" y2="70"/>
<line x1="200" y1="70" x2="210" y2="70"/>
<line x1="210" y1="70" x2="220" y2="70"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="360" y2="70"/>
<line x1="360" y1="70" x2="370" y2="70"/>
<line x1="370" y1="70" x2="380" y2="70"/>
<line x1="380" y1="70" x2="390" y2="70"/>
<line x1="390" y1="70" x2="400" y2="70"/>
<line x1="400" y1="70" x2="410" y2="70"/>
<line x1="410" y1="70" x2="420" y2="70"/>
<line x1="420" y1="70" x2="425" y2="70"/>
<line x1="425" y1="59" x2="425" y2="70"/>
<text x="5" y="90">&gt;</text>
<text x="25" y="90">,</text>
<text x="35" y="90">n</text>
<text x="5" y="110">C</text>
<text x="15" y="110">a</text>
<text x="25" y="110">l</text>
<text x="35" y="110">l</text>
<text x="55" y="110">c</text>
<text x="65" y="110">h</text>
<text x="75" y="110">a</text>
<text x="85" y="110">i</text>
<text x="95" y="110">n</text>
<text x="105" y="110">:</text>
<text x="25" y="130">(</text>
<text x="35" y="130">/</text>
<text x="55" y="130">1</text>
<text x="75" y="130">0</text>
<text x="85" y="130">)</text>
<text x="25" y="150">&lt;</text>
<text x="35" y="150">t</text>
<text x="45" y="150">o</text>
<text x="55" y="150">p</text>
<text x="65" y="150">l</text>
<text x="75" y="150">e</text>
<text x="85" y="150">v</text>
<text x="95" y="150">e</text>
<text x="105" y="150">l</text>
<text x="115" y="150">&gt;</text>
<text x="5" y="170">&gt;</text>
<text x="25" y="170">,</text>
<text x="35" y="170">d</text>
<text x="5" y="190">C</text>
<text x="15" y="190">o</text>
<text x="25" y="190">n</text>
<text x="35" y="190">d</text>
<text x="45" y="190">i</text>
<text x="55" y="190">t</text>
<text x="65" y="190">i</text>
<text x="75" y="190">o</text>
<text x="85" y="190">n</text>
<text x="95" y="190">:</text>
<text x="115" y="190">e</text>
<text x="125" y="190">x</text>
<text x="135" y="190">n</text>
<text x="25" y="210">m</text>
<text x="35" y="210">e</text>
<text x="45" y="210">s</text>
<text x="55" y="210">s</text>
<text x="65" y="210">a</text>
<text x="75" y="210">g</text>
<text x="85" y="210">e</text>
<text x="95" y="210">:</text>
<text x="115" y="210">"</text>
<text x="125" y="210">d</text>
<text x="135" y="210">i</text>
<text x="145" y="210">v</text>
<text x="155" y="210">i</text>
<text x="165" y="210">s</text>
<text x="175" y="210">i</text>
<text x="185" y="210">o</text>
<text x="195" y="210">n</text>
<text x="215" y="210">b</text>
<text x="225" y="210">y</text>
<text x="245" y="210">z</text>
<text x="255" y="210">e</text>
<text x="265" y="210">r</text>
<text x="275" y="210">o</text>
<text x="285" y="210">"</text>
<text x="25" y="230">l</text>
<text x="35" y="230">o</text>
<text x="45" y="230">c</text>
<text x="55" y="230">a</text>
<text x="65" y="230">t</text>
<text x="75" y="230">i</text>
<text x="85" y="230">o</text>
<text x="95" y="230">n</text>
<text x="105" y="230">:</text>
<text x="125" y="230">/</text>
<text x="25" y="250">a</text>
<text x="35" y="250">r</text>
<text x="45" y="250">g</text>
<text x="55" y="250">u</text>
<text x="65" y="250">m</text>
<text x="75" y="250">e</text>
<text x="85" y="250">n</text>
<text x="95" y="250">t</text>
<text x="105" y="250">s</text>
<text x="115" y="250">:</text>
<text x="135" y="250">(</text>
<text x="145" y="250">1</text>
<text x="165" y="250">0</text>
<text x="175" y="250">)</text>
</svg>
</div>
<h2>10. Compiler Warnings Reference</h2>
<h3>10.1 Type Warnings</h3>
<pre>
Warning: Invalid argument
  Argument #1 to procedure `tcp-accept' has an invalid type:
    false
  The expected type is:
    (struct tcp-listener)
</pre>
<p>Fix: Add type check or adjust control flow to ensure correct type.</p>
<h3>10.2 Deprecation Warnings</h3>
<pre>
Warning: Deprecated identifier `current-milliseconds'
  Use of deprecated identifier from module `chicken.time'.
</pre>
<p>Fix: Use current-process-milliseconds instead.</p>
<h3>10.3 Format String Warnings</h3>
<pre>
Warning: `printf', in format string "~.2f",
  illegal format-string character `.'
</pre>
<p>Fix: Chicken format doesn't support precision specifiers. Use manual rounding.</p>
<h3>10.4 Redefinition Warnings</h3>
<pre>
Warning: redefinition of imported value binding: blob=?
</pre>
<p>Fix: Either don't redefine, or explicitly shadow with (only (chicken blob) (not blob=?))</p>
<h3>10.5 Warning Policy</h3>
<p>For production code:</p>
<ul>
<li>Zero warnings is the goal</li>
<li>All warnings should be investigated</li>
<li>Known acceptable warnings should be documented</li>
<li>CI should fail on new warnings</li>
</ul>
<h2>11. Performance Tuning</h2>
<h3>11.1 Compilation Performance</h3>
<table>
<tr><th>Module Size</th><th>Without -strict-types</th><th>With -strict-types</th></tr>
<tr><td>&lt; 500 LOC</td><td>~500ms</td><td>~700ms</td></tr>
<tr><td>500-2000 LOC</td><td>~1s</td><td>~2s</td></tr>
<tr><td>&gt; 2000 LOC (typed)</td><td>~2s</td><td>~7s</td></tr>
<tr><td>&gt; 2000 LOC (untyped)</td><td>~2s</td><td>exponential</td></tr>
</table>
<p>Full bootstrap (21 modules): ~20-25s with strict types</p>
<h3>11.2 Runtime Performance</h3>
<p>Type declarations have no runtime cost - they're only used at compile time.</p>
<p>For runtime optimization:</p>
<ul>
<li>Use fixnum operations for integer math (fx+, fx&lt;, etc.)</li>
<li>Use flonum operations for float math (fp+, fp&lt;, etc.)</li>
<li>Avoid unnecessary string allocation</li>
<li>Prefer vectors over lists for random access</li>
<li>Use hash tables for lookup-heavy operations</li>
</ul>
<h3>11.3 Memory Profiling</h3>
<p>Track allocations:</p>
<pre class="language-scheme">
(gc #t)  ; Force GC and print statistics
(memory-statistics)  ; Show current memory use
</pre>
<p>For detailed profiling, compile with -profile flag.</p>
<h2>12. Module Conventions</h2>
<h3>12.1 File Structure</h3>
<pre class="language-scheme">
;;; module.scm - One line description
;;;
;;; Longer description of purpose, heritage, references.
;;;
;;; Copyright (c) 2026 Author. See LICENSE.

(module module-name
  (;; Exports grouped by category
   export1
   export2

   ;; Internal (for testing/debugging)
   internal-helper)

  (import scheme
          (chicken base)
          (chicken type)
          ...)

  ;;; ============================================================
  ;;; Type Declarations
  ;;; ============================================================

  (: export1 ...)
  (: export2 ...)

  ;;; ============================================================
  ;;; Section Name
  ;;; ============================================================

  (define (export1 ...) ...)

) ; end module
</pre>
<h3>12.2 Naming Conventions</h3>
<table>
<tr><th>Type</th><th>Convention</th><th>Example</th></tr>
<tr><td>Procedure</td><td>verb-noun</td><td>read-file, parse-cert</td></tr>
<tr><td>Predicate</td><td>noun?</td><td>empty?, valid-cert?</td></tr>
<tr><td>Conversion</td><td>x-&gt;y</td><td>string-&gt;blob, cert-&gt;sexp</td></tr>
<tr><td>Mutator</td><td>verb!</td><td>set-value!, init!</td></tr>
<tr><td>Constant</td><td>*name*</td><td>*default-port*, *max-retries*</td></tr>
<tr><td>Parameter</td><td>current-name</td><td>current-realm, current-principal</td></tr>
</table>
<h3>12.3 Documentation Strings</h3>
<p>All exported procedures should have docstrings:</p>
<pre class="language-scheme">
(define (read-file path)
  "Read entire file contents as string.
   Returns #f if file doesn't exist."
  ...)
</pre>
<h2>13. Testing Conventions</h2>
<h3>13.1 Test File Location</h3>
<p>Tests live alongside source:</p>
<pre>
module.scm       ; Source
module-test.scm  ; Tests
</pre>
<h3>13.2 Test Structure</h3>
<pre class="language-scheme">
(import module)
(import test)  ; SRFI-64 or similar

(test-begin "module")

(test-group "feature-name"
  (test-equal "description" expected (actual))
  (test-assert "predicate" (condition?)))

(test-end "module")
</pre>
<h3>13.3 Running Tests</h3>
<pre class="language-shell">
csi -s module-test.scm
</pre>
<h2>14. References</h2>
<ul>
<li>Chicken Scheme User's Manual: Types</li>
<li>Chicken Scheme User's Manual: Debugging</li>
<li>SRFI-12: Exception Handling</li>
<li>Ada Reference Manual: Type System</li>
<li>Dylan Reference Manual: Inspector</li>
<li>Memo-054 Terminal Interface Conventions</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
