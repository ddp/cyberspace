<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0006: Vault Architecture</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<p class="format-notice"><em>For pixel-perfect diagrams: <a href="memo-0006-vault-architecture.ps">PostScript</a> or <a href="memo-0006-vault-architecture.pdf">PDF</a></em></p>
<h1>Memo 0006: Vault Architecture</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies the Vault system for the Library of Cyberspace: cryptographically sealed version control with Simple Public Key Infrastructure (SPKI) authorization, progressive metadata, archival support, and integrated audit trails.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Git is powerful but lacks:</p>
<ul>
<li>Cryptographic sealing - GPG signing is optional and awkward</li>
<li>Authorization model - Anyone with access can commit</li>
<li>Archival features - No first-class backup/restore</li>
<li>Audit integration - History is mutable</li>
</ul>
<p>These gaps leave security as an afterthought rather than a foundation, requiring external tools and manual discipline to achieve what should be built-in.</p>
<p>The Vault wraps Git with:</p>
<ul>
<li>seal- commands that cryptographically sign operations</li>
<li>SPKI certificates for authorization</li>
<li>Three archive formats for different use cases</li>
<li>Integrated audit trail for non-repudiation</li>
</ul>
<p>The seal- prefix makes cryptographic operations explicit; security is not hidden behind flags or configuration but part of the command vocabulary.</p>
<pre class="diagram">
                    ╭────────────────────────────────╮
                    │         CYBERSPACE VAULT       │
                    ├────────────────────────────────┤
                    │  seal-commit    seal-release   │
                    │  seal-archive   seal-publish   │
                    │  seal-verify    seal-subscribe │
                    ├────────────────────────────────┤
                    │         Audit Trail            │
                    ├────────────────────────────────┤
                    │         SPKI Certs             │
                    ├────────────────────────────────┤
                    │            Git                 │
                    ╰────────────────────────────────╯
</pre>
</section>
<section>
<h2>Core Operations</h2>
<h3>seal-commit</h3>
<p>Stage and commit changes in one operation.</p>
<pre class="language-scheme">
(seal-commit message
  #!key files catalog subjects keywords description preserve)
</pre>
<p>Parameters: - message - Commit message (required) - files - Specific files to stage (optional) - catalog - Enable catalog metadata - subjects - Subject headings - keywords - Search keywords - description - Extended description - preserve - Enable preservation metadata</p>
<p>Process:</p>
<ul>
<li>Stage specified files (or all modified)</li>
<li>Create git commit</li>
<li>Save metadata (if catalog or preserve)</li>
<li>Record in audit trail (if signing key configured)</li>
</ul>
<p>Example:</p>
<pre class="language-scheme">
(seal-commit "Add authentication module"
  files: '("auth.scm" "auth-test.scm")
  catalog: #t
  subjects: '("security" "authentication")
  keywords: '("login" "oauth"))
</pre>
<h3>seal-update</h3>
<p>Pull latest changes from remote.</p>
<pre class="language-scheme">
(seal-update #!key branch)
</pre>
<p>Like svn update - fetches and fast-forwards.</p>
<h3>seal-undo</h3>
<p>Undo changes.</p>
<pre class="language-scheme">
(seal-undo #!key file hard)
</pre>
<ul>
<li>file</li>
<li>Restore specific file - hard</li>
<li>Discard all uncommitted changes</li>
</ul>
<h3>seal-history</h3>
<p>Show commit history.</p>
<pre class="language-scheme">
(seal-history #!key count)
</pre>
<p>Displays decorated graph log.</p>
<h3>seal-branch / seal-merge</h3>
<p>Branch and merge operations.</p>
<pre class="language-scheme">
(seal-branch "feature-auth" #!key from)
(seal-merge "feature-auth" #!key strategy)
</pre>
</section>
<section>
<h2>Version Management</h2>
<h3>seal-release</h3>
<p>Create cryptographically sealed release.</p>
<pre class="language-scheme">
(seal-release version #!key message migrate-from)
</pre>
<p>Parameters: - version - Semantic version (X.Y.Z required) - message - Release notes - migrate-from - Previous version for migration tracking</p>
<p>Process:</p>
<ul>
<li>Validate semantic version format</li>
<li>Get current commit hash</li>
<li>Create annotated git tag</li>
<li>Sign with SPKI (if configured)</li>
<li>Create migration marker (if migrate-from specified)</li>
</ul>
<p>Signature Storage:</p>
<pre class="language-scheme">
;; .vault/releases/1.0.0.sig
(signature
  (version "1.0.0")
  (hash "abc123...")
  (manifest "(release \"1.0.0\" \"abc123\" 1767685100)")
  (signature #${ed25519-signature}))
</pre>
<h3>seal-verify</h3>
<p>Verify release signature.</p>
<pre class="language-scheme">
(seal-verify version #!key verify-key)
</pre>
<p>Process:</p>
<ul>
<li>Load signature file</li>
<li>Recompute manifest hash</li>
<li>Verify Ed25519 signature</li>
</ul>
</section>
<section>
<h2>Archival System</h2>
<h3>seal-archive</h3>
<p>Create sealed archive of a version.</p>
<pre class="language-scheme">
(seal-archive version #!key format output)
</pre>
<p>Formats:</p>
<p>#### Tarball (default)</p>
<pre class="language-scheme">
(seal-archive "1.0.0" format: 'tarball)
</pre>
<ul>
<li>Standard gzipped tarball</li>
<li>No history included</li>
<li>Smallest size</li>
</ul>
<p>#### Git Bundle</p>
<pre class="language-scheme">
(seal-archive "1.0.0" format: 'bundle)
</pre>
<ul>
<li>Full git history</li>
<li>Can clone directly</li>
<li>Medium size</li>
</ul>
<p>#### Cryptographic (legacy)</p>
<pre class="language-scheme">
(seal-archive "1.0.0" format: 'cryptographic)
</pre>
<ul>
<li>Tarball + SHA-512 hash + Ed25519 signature</li>
<li>Tamper-evident</li>
<li>Manifest for verification</li>
</ul>
<p>#### Zstd+Age (preferred)</p>
<pre class="language-scheme">
(seal-archive "1.0.0" format: 'zstd-age)
</pre>
<ul>
<li>Zstd compression (faster, better ratio than gzip)</li>
<li>Age encryption (X25519/Ed25519 compatible)</li>
<li>SHA-512 hash + Ed25519 signature</li>
<li>Encrypted at rest</li>
</ul>
<p>Cryptographic Archive Structure:</p>
<pre>
vault-1.0.0.archive        # Manifest
vault-1.0.0.archive.tar.gz # Tarball (cryptographic)
</pre>
<p>Zstd+Age Archive Structure:</p>
<pre>
vault-1.0.0.archive            # Manifest
vault-1.0.0.archive.tar.zst.age # Encrypted archive
</pre>
<p>Manifest (cryptographic):</p>
<pre class="language-scheme">
(sealed-archive
  (version "1.0.0")
  (format cryptographic)
  (tarball "vault-1.0.0.archive.tar.gz")
  (hash "sha512:...")
  (signature "ed25519:..."))
</pre>
<p>Manifest (zstd-age):</p>
<pre class="language-scheme">
(sealed-archive
  (version "1.0.0")
  (format zstd-age)
  (archive "vault-1.0.0.archive.tar.zst.age")
  (compression zstd)
  (encryption age)
  (recipients ("age1..."))
  (hash "sha512:...")
  (signature "ed25519:..."))
</pre>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
