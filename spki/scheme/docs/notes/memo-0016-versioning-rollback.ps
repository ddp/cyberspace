%!PS-Adobe-3.0
%%Title: memo-0016-versioning-rollback
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0016: Versioning and Rollback) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This Memo specifies user-visible versioning and rollback semantics for) show newline
(Cyberspace vaults, providing clear mental models for version management,) show newline
(safe rollback operations, and recovery from mistakes.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Users need simple answers to simple questions:) show newline
() show newline
(  * What version am I on?) show newline
(  * What versions exist?) show newline
(  * How do I go back?) show newline
(  * What if I make a mistake?) show newline
() show newline
(Git provides mechanisms. Cyberspace provides semantics:) show newline
() show newline
() show newline
(    seal-version         > "2.1.0") show newline
(    seal-versions        > [1.0.0, 1.1.0, 2.0.0, 2.1.0]) show newline
(    seal-rollback 2.0.0  > Done. Now at 2.0.0.) show newline
(    seal-recover         > Here's what you can recover.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SPECIFICATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Version Model) show newline
(-------------) show newline
() show newline
() show newline
(                             HEAD) show newline
(                              v) show newline
(        1.0.0 --> 1.1.0 --> 2.0.0 --> 2.1.0) show newline
(          |                   |) show newline
(          |                   +-- seal-rollback target) show newline
(          |) show newline
(          +-- seal-archive snapshots) show newline
() show newline
(Versions are semantic \(X.Y.Z\), immutable, signed.) show newline
() show newline
(HEAD is current working state.) show newline
() show newline
(Rollback creates forward commit that restores past state.) show newline
() show newline
() show newline
(Core Operations) show newline
(---------------) show newline
() show newline
(#### seal-version) show newline
() show newline
(Report current version.) show newline
() show newline
() show newline
(    \(seal-version\)) show newline
(    ;; => "2.1.0" or "2.1.0+3" \(3 commits past release\)) show newline
() show newline
(Output format: - X.Y.Z - Exactly at release - X.Y.Z+N - N commits past) show newline
(release - X.Y.Z-dev - Development branch - unversioned - No releases yet) show newline
() show newline
(#### seal-versions) show newline
() show newline
(List all versions.) show newline
() show newline
() show newline
(    \(seal-versions\)) show newline
(    ;; => \("1.0.0" "1.1.0" "2.0.0" "2.1.0"\)) show newline
(    \(seal-versions verbose: #t\)) show newline
(    ;; =>) show newline
(    ;; 1.0.0  2026-01-01  "Initial release") show newline
(    ;; 1.1.0  2026-01-05  "Bug fixes") show newline
(    ;; 2.0.0  2026-01-10  "New governance model") show newline
(    ;; 2.1.0  2026-01-15  "Performance improvements") show newline
() show newline
(#### seal-rollback) show newline
() show newline
(Roll back to specific version.) show newline
() show newline
() show newline
(    \(seal-rollback "2.0.0"\)) show newline
() show newline
(Process: 1. Verify version exists 2. Check for uncommitted changes) show newline
(\(abort or stash\) 3. Create rollback commit with contents of target) show newline
(version 4. Record in audit trail 5. Optionally create rollback tag) show newline
() show newline
(Rollback commit message:) show newline
() show newline
() show newline
(    Rollback to 2.0.0) show newline
(    Restored vault state to version 2.0.0.) show newline
(    Previous HEAD was 2.1.0+3.) show newline
(    Reason: [user-provided or "Manual rollback"]) show newline
() show newline
(NOT a git reset. History preserved. Rollback is a forward operation.) show newline
() show newline
(#### seal-diff) show newline
() show newline
(Compare versions.) show newline
() show newline
() show newline
(    \(seal-diff "2.0.0" "2.1.0"\)) show newline
(    ;; Shows what changed between versions) show newline
(    \(seal-diff "2.0.0"\)) show newline
(    ;; Shows what changed since 2.0.0) show newline
() show newline
(#### seal-recover) show newline
() show newline
(Recovery options for mistakes.) show newline
() show newline
() show newline
(    \(seal-recover\)) show newline
(    ;; =>) show newline
(    ;; Recovery options:) show newline
(    ;;   1. Uncommitted changes \(stashed 5 minutes ago\)) show newline
(    ;;   2. Last commit \(seal-undo\)) show newline
(    ;;   3. Version 2.1.0 \(seal-rollback "2.1.0"\)) show newline
(    ;;   4. Archive vault-2.0.0.archive \(seal-restore\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(ROLLBACK SEMANTICS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Forward Rollback \(Default\)) show newline
(--------------------------) show newline
() show newline
() show newline
(    Before:  1.0.0 > 1.1.0 > 2.0.0 > 2.1.0 > HEAD) show newline
(                              ^) show newline
(                         rollback target) show newline
(    After:   1.0.0 > 1.1.0 > 2.0.0 > 2.1.0 > [rollback commit]) show newline
(                              |                      |) show newline
(                              +----------------------+) show newline
(                                  contents match) show newline
() show newline
(History preserved. Audit trail shows rollback.) show newline
() show newline
() show newline
(Hard Rollback \(Dangerous\)) show newline
(-------------------------) show newline
() show newline
() show newline
(    \(seal-rollback "2.0.0" hard: #t\)) show newline
() show newline
(Actually resets to version. Destroys history.) show newline
() show newline
(Requires: - Explicit hard: #t flag - Confirmation prompt - Audit entry) show newline
(before destruction) show newline
() show newline
() show newline
(Rollback with Stash) show newline
(-------------------) show newline
() show newline
() show newline
(    \(seal-rollback "2.0.0" stash: #t\)) show newline
() show newline
(Stashes uncommitted changes before rollback. Can recover with:) show newline
() show newline
() show newline
(    \(seal-stash-pop\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(VERSION TAGS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Automatic Tagging) show newline
(-----------------) show newline
() show newline
() show newline
(    \(seal-release "2.1.0"\)) show newline
(    ;; Creates:) show newline
(    ;;   - Git tag: 2.1.0) show newline
(    ;;   - Signature: .vault/releases/2.1.0.sig) show newline
(    ;;   - Audit entry) show newline
() show newline
() show newline
(Rollback Tags) show newline
(-------------) show newline
() show newline
() show newline
(    \(seal-rollback "2.0.0" tag: "rollback-2026-01-15"\)) show newline
(    ;; Creates additional tag marking rollback point) show newline
() show newline
() show newline
(Tag Listing) show newline
(-----------) show newline
() show newline
() show newline
(    \(seal-tags\)) show newline
(    ;; =>) show newline
(    ;; 1.0.0              2026-01-01  release) show newline
(    ;; 1.1.0              2026-01-05  release) show newline
(    ;; 2.0.0              2026-01-10  release) show newline
(    ;; 2.1.0              2026-01-15  release) show newline
(    ;; rollback-2026-01-15 2026-01-15  rollback) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(RECOVERY SCENARIOS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Scenario 1: Bad Commit) show newline
(----------------------) show newline
() show newline
() show newline
(    ;; Oops, committed broken code) show newline
(    \(seal-undo\)                    ; Undo last commit) show newline
(    ;; or) show newline
(    \(seal-rollback "2.1.0"\)        ; Back to last release) show newline
() show newline
() show newline
(Scenario 2: Bad Release) show newline
(-----------------------) show newline
() show newline
() show newline
(    ;; Released 2.2.0 but it's broken) show newline
(    \(seal-rollback "2.1.0"\)        ; Back to good version) show newline
(    \(seal-release "2.2.1"\)         ; Patch release) show newline
() show newline
() show newline
(Scenario 3: Lost Changes) show newline
(------------------------) show newline
() show newline
() show newline
(    ;; Accidentally discarded work) show newline
(    \(seal-recover\)                 ; See options) show newline
(    \(seal-stash-pop\)               ; If stashed) show newline
(    ;; or) show newline
(    \(seal-reflog\)                  ; Find lost commits) show newline
() show newline
() show newline
(Scenario 4: Corrupted Vault) show newline
(---------------------------) show newline
() show newline
() show newline
(    ;; Something went very wrong) show newline
(    \(seal-restore "vault-2.0.0.archive" verify-key: "alice.pub"\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(AUDIT INTEGRATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Every version operation recorded:) show newline
() show newline
() show newline
(    \(audit-entry) show newline
(      \(action) show newline
(        \(verb seal-rollback\)) show newline
(        \(object "2.0.0"\)) show newline
(        \(parameters) show newline
(          \(from "2.1.0+3"\)) show newline
(          \(method forward\)) show newline
(          \(reason "Production incident"\)\)\)) show newline
(      \(seal ...\)\)) show newline
() show newline
(Audit trail answers: - Who rolled back? - When? - From what version? -) show newline
(Why? \(if reason provided\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CLI INTERFACE) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(    # Current version) show newline
(    $ seal version) show newline
(    2.1.0+3) show newline
(    # List versions) show newline
(    $ seal versions) show newline
(    1.0.0   2026-01-01   Initial release) show newline
(    1.1.0   2026-01-05   Bug fixes) show newline
(    2.0.0   2026-01-10   New governance model) show newline
(    2.1.0   2026-01-15   Performance improvements) show newline
(    # Rollback) show newline
(    $ seal rollback 2.0.0) show newline
(    Rolling back to 2.0.0...) show newline
(    ✓ Rollback complete. Now at 2.0.0.) show newline
(    # Rollback with reason) show newline
(    $ seal rollback 2.0.0 --reason "Production incident #123") show newline
(    # Compare versions) show newline
(    $ seal diff 2.0.0 2.1.0) show newline
(     M config.scm) show newline
(     A new-feature.scm) show newline
(     D deprecated.scm) show newline
(    # Recovery options) show newline
(    $ seal recover) show newline
(    Recovery options:) show newline
(      1. seal undo          - Undo last commit) show newline
(      2. seal rollback 2.1.0 - Return to last release) show newline
(      3. seal stash pop     - Recover stashed changes) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SAFETY MECHANISMS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Uncommitted Changes) show newline
(-------------------) show newline
() show newline
() show newline
(    \(seal-rollback "2.0.0"\)) show newline
(    ;; Error: Uncommitted changes detected.) show newline
(    ;; Use --stash to save changes, or --force to discard.) show newline
() show newline
() show newline
(Protected Versions) show newline
(------------------) show newline
() show newline
() show newline
(    \(vault-config 'protected-versions '\("1.0.0" "2.0.0"\)\)) show newline
(    \(seal-rollback "0.9.0"\)) show newline
(    ;; Warning: Rolling back past protected version 1.0.0) show newline
(    ;; This may break compatibility. Continue? [y/N]) show newline
() show newline
() show newline
(Rollback Limits) show newline
(---------------) show newline
() show newline
() show newline
(    \(vault-config 'max-rollback-distance 10\)) show newline
(    \(seal-rollback "0.1.0"\)) show newline
(    ;; Error: Rollback distance \(20 versions\) exceeds limit \(10\).) show newline
(    ;; Use --force to override.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(IMPLEMENTATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(seal-rollback Implementation) show newline
(----------------------------) show newline
() show newline
() show newline
(    \(define \(seal-rollback version #!key hard stash force reason tag\)) show newline
(      "Roll back vault to specified version") show newline
(      ;; Validate version exists) show newline
(      \(unless \(tag-exists? version\)) show newline
(        \(error "Version not found" version\)\)) show newline
(      ;; Check for uncommitted changes) show newline
(      \(when \(uncommitted-changes?\)) show newline
(        \(cond) show newline
(          \(stash \(seal-stash\)\)) show newline
(          \(force \(void\)\)) show newline
(          \(else \(error "Uncommitted changes. Use stash: or force:"\)\)\)\)) show newline
(      ;; Record current state) show newline
(      \(let \(\(current \(seal-version\)\)\)) show newline
(        ;; Perform rollback) show newline
(        \(if hard) show newline
(            \(hard-rollback! version\)) show newline
(            \(forward-rollback! version reason\)\)) show newline
(        ;; Create tag if requested) show newline
(        \(when tag) show newline
(          \(run-command "git" "tag" tag\)\)) show newline
(        ;; Audit) show newline
(        \(audit-append) show newline
(          actor: \(get-vault-principal \(vault-config 'signing-key\)\)) show newline
(          action: \(list 'seal-rollback version\)) show newline
(          motivation: \(or reason \(sprintf "Rollback from ~a to ~a" current version\)\)\)) show newline
(        \(print "✓ Rolled back to " version\)\)\)) show newline
(    \(define \(forward-rollback! version reason\)) show newline
(      "Create rollback commit \(preserves history\)") show newline
(      \(run-command "git" "checkout" version "--" "."\)) show newline
(      \(run-command "git" "commit" "-m") show newline
(        \(sprintf "Rollback to ~a\\n\\n~a" version \(or reason ""\)\)\)\)) show newline
(    \(define \(hard-rollback! version\)) show newline
(      "Reset to version \(destroys history\)") show newline
(      \(print "WARNING: Hard rollback destroys history"\)) show newline
(      \(run-command "git" "reset" "--hard" version\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SECURITY CONSIDERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Rollback Attacks) show newline
(----------------) show newline
() show newline
(Attacker forces rollback to vulnerable version.) show newline
() show newline
(Mitigation: - Threshold signatures for rollback \(Memo-008\) - Protected) show newline
(version list - Audit trail detection) show newline
() show newline
() show newline
(History Manipulation) show newline
(--------------------) show newline
() show newline
(Hard rollback can hide evidence.) show newline
() show newline
(Mitigation: - Prefer forward rollback - Audit before hard rollback -) show newline
(Federation replication preserves history) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(1. Semantic Versioning 2.0.0 \(semver.org\) 2. Git Reset, Checkout, and) show newline
(Revert \(git-scm.com\) 3. Memo-003: Cryptographic Audit Trail 4. Memo-006:) show newline
(Vault System Architecture) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * 2026-01-06) show newline
(  * Initial specification) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
