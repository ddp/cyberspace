<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <title>Memo 0022: Content-Addressed Storage</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0022: Content-Addressed Storage</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies content-addressed storage (CAS) for the Library of Cyberspace: a storage model where data is addressed by its cryptographic hash rather than by location. Content addressing provides immutability guarantees, automatic deduplication, and tamper-evident storage.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Traditional storage systems use location-based addressing:</p>
<ul>
<li>DECtape: Physical position on magnetic tape</li>
<li>Filesystems: Path names (/home/ddp/file.txt)</li>
<li>Databases: Row IDs, primary keys</li>
<li>URLs: Server + path (https://example.com/doc.ps)</li>
</ul>
<p>Location-based addressing has fundamental problems:</p>
<p>1. Mutability - Same address can point to different content over time 2. Link rot - Addresses become invalid when content moves 3. Duplication - Identical content stored multiple times 4. No verification - Address doesn't prove content integrity</p>
<p>Content-addressed storage inverts this:</p>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 556.8 38.4" width="556.8" height="38.4" xmlns="http://www.w3.org/2000/svg">
<style>
  line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; }
  text { font-family: 'Hack', 'SF Mono', monospace; font-size: 16px; fill: currentColor; }
</style>

<text x="4.8" y="9.6" text-anchor="middle" dominant-baseline="central">L</text>
<text x="14.4" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="24.0" y="9.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="33.6" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="43.2" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="52.8" y="9.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="62.4" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="72.0" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="81.6" y="9.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="91.2" y="9.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="100.8" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="110.4" y="9.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="120.0" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="129.6" y="9.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="139.2" y="9.6" text-anchor="middle" dominant-baseline="central">:</text>
<text x="168.0" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="177.6" y="9.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="187.2" y="9.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="196.8" y="9.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="206.4" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="216.0" y="9.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="225.6" y="9.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="244.8" y="9.6" text-anchor="middle" dominant-baseline="central">→</text>
<text x="264.0" y="9.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="273.6" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="283.2" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="292.8" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="302.4" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="312.0" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="321.6" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="340.8" y="9.6" text-anchor="middle" dominant-baseline="central">(</text>
<text x="350.4" y="9.6" text-anchor="middle" dominant-baseline="central">m</text>
<text x="360.0" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="369.6" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="379.2" y="9.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="388.8" y="9.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="398.4" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="408.0" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="417.6" y="9.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="427.2" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="436.8" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="446.4" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="456.0" y="9.6" text-anchor="middle" dominant-baseline="central">,</text>
<text x="475.2" y="9.6" text-anchor="middle" dominant-baseline="central">m</text>
<text x="484.8" y="9.6" text-anchor="middle" dominant-baseline="central">u</text>
<text x="494.4" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="504.0" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="513.6" y="9.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="523.2" y="9.6" text-anchor="middle" dominant-baseline="central">l</text>
<text x="532.8" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="542.4" y="9.6" text-anchor="middle" dominant-baseline="central">)</text>
<text x="4.8" y="28.8" text-anchor="middle" dominant-baseline="central">C</text>
<text x="14.4" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="24.0" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="33.6" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="43.2" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="52.8" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="62.4" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="72.0" y="28.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="81.6" y="28.8" text-anchor="middle" dominant-baseline="central">b</text>
<text x="91.2" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="100.8" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="110.4" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="120.0" y="28.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="129.6" y="28.8" text-anchor="middle" dominant-baseline="central">:</text>
<text x="168.0" y="28.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="177.6" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="187.2" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="196.8" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="206.4" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="216.0" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="225.6" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="244.8" y="28.8" text-anchor="middle" dominant-baseline="central">→</text>
<text x="264.0" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="273.6" y="28.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="283.2" y="28.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="292.8" y="28.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="302.4" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="312.0" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="321.6" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="340.8" y="28.8" text-anchor="middle" dominant-baseline="central">(</text>
<text x="350.4" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="360.0" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="369.6" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="379.2" y="28.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="388.8" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="398.4" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="408.0" y="28.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="417.6" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="427.2" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="436.8" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="446.4" y="28.8" text-anchor="middle" dominant-baseline="central">,</text>
<text x="465.6" y="28.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="475.2" y="28.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="484.8" y="28.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="494.4" y="28.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="504.0" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="513.6" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="523.2" y="28.8" text-anchor="middle" dominant-baseline="central">b</text>
<text x="532.8" y="28.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="542.4" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="552.0" y="28.8" text-anchor="middle" dominant-baseline="central">)</text>
</svg>
</div>
<p>The address IS the content's cryptographic fingerprint. If the content changes, the address changes. If two files have the same address, they are byte-for-byte identical.</p>
</section>
<section>
<h2>Content Addressing Model</h2>
<h3>Hash as Address</h3>
<pre class="language-scheme">
;; Content determines address
(define (content-address data)
  (sha256 data))

;; Store by hash
(define (cas-store data)
  (let ((hash (content-address data)))
    (write-blob (hash-&gt;path hash) data)
    hash))

;; Retrieve by hash
(define (cas-retrieve hash)
  (let ((data (read-blob (hash-&gt;path hash))))
    (if (equal? hash (content-address data))
        data
        (error "Content tampered"))))
</pre>
<h3>Properties</h3>
<table>
<tr><th>Property </th><th>Location-Based </th><th>Content-Addressed </th></tr>
<tr><td>Address stability </td><td>Unstable </td><td>Permanent </td></tr>
<tr><td>Content verification </td><td>External </td><td>Intrinsic </td></tr>
<tr><td>Deduplication </td><td>Manual </td><td>Automatic </td></tr>
<tr><td>Mutability </td><td>Mutable </td><td>Immutable </td></tr>
<tr><td>Link rot </td><td>Common </td><td>Impossible </td></tr>
</table>
<h3>Hash Function Requirements</h3>
<p>The hash function MUST be:</p>
<p>1. Collision-resistant - Computationally infeasible to find two inputs with same hash 2. Preimage-resistant - Cannot derive content from hash 3. Deterministic - Same content always produces same hash 4. Fast - Practical for large objects</p>
<p>Specified hash: SHA-256 (32 bytes, 64 hex characters)</p>
<pre class="language-scheme">
;; Example content address
"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
;; This is the SHA-256 of the empty string
</pre>
</section>
<section>
<h2>Storage Architecture</h2>
<h3>Object Store</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 710.4 211.2" width="710.4" height="211.2" xmlns="http://www.w3.org/2000/svg">
<style>
  line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; }
  text { font-family: 'Hack', 'SF Mono', monospace; font-size: 16px; fill: currentColor; }
</style>
<line x1="4.8" y1="19.2" x2="4.8" y2="38.4"/>
<line x1="4.8" y1="28.8" x2="9.6" y2="28.8"/>
<line x1="9.6" y1="28.8" x2="19.2" y2="28.8"/>
<line x1="19.2" y1="28.8" x2="28.8" y2="28.8"/>
<line x1="4.8" y1="38.4" x2="4.8" y2="57.6"/>
<line x1="43.2" y1="38.4" x2="43.2" y2="57.6"/>
<line x1="43.2" y1="48.0" x2="48.0" y2="48.0"/>
<line x1="48.0" y1="48.0" x2="57.6" y2="48.0"/>
<line x1="57.6" y1="48.0" x2="67.2" y2="48.0"/>
<line x1="4.8" y1="57.6" x2="4.8" y2="76.8"/>
<line x1="43.2" y1="57.6" x2="43.2" y2="76.8"/>
<line x1="81.6" y1="67.2" x2="86.4" y2="67.2"/>
<line x1="81.6" y1="57.6" x2="81.6" y2="67.2"/>
<line x1="86.4" y1="67.2" x2="96.0" y2="67.2"/>
<line x1="96.0" y1="67.2" x2="105.6" y2="67.2"/>
<line x1="4.8" y1="76.8" x2="4.8" y2="96.0"/>
<line x1="43.2" y1="76.8" x2="43.2" y2="96.0"/>
<line x1="43.2" y1="86.4" x2="48.0" y2="86.4"/>
<line x1="48.0" y1="86.4" x2="57.6" y2="86.4"/>
<line x1="57.6" y1="86.4" x2="67.2" y2="86.4"/>
<line x1="4.8" y1="96.0" x2="4.8" y2="115.2"/>
<line x1="43.2" y1="96.0" x2="43.2" y2="115.2"/>
<line x1="81.6" y1="105.6" x2="86.4" y2="105.6"/>
<line x1="81.6" y1="96.0" x2="81.6" y2="105.6"/>
<line x1="86.4" y1="105.6" x2="96.0" y2="105.6"/>
<line x1="96.0" y1="105.6" x2="105.6" y2="105.6"/>
<line x1="4.8" y1="115.2" x2="4.8" y2="134.4"/>
<line x1="43.2" y1="124.8" x2="48.0" y2="124.8"/>
<line x1="43.2" y1="115.2" x2="43.2" y2="124.8"/>
<line x1="48.0" y1="124.8" x2="57.6" y2="124.8"/>
<line x1="57.6" y1="124.8" x2="67.2" y2="124.8"/>
<line x1="4.8" y1="134.4" x2="4.8" y2="153.6"/>
<line x1="4.8" y1="144.0" x2="9.6" y2="144.0"/>
<line x1="9.6" y1="144.0" x2="19.2" y2="144.0"/>
<line x1="19.2" y1="144.0" x2="28.8" y2="144.0"/>
<line x1="4.8" y1="153.6" x2="4.8" y2="172.8"/>
<line x1="43.2" y1="153.6" x2="43.2" y2="172.8"/>
<line x1="43.2" y1="163.2" x2="48.0" y2="163.2"/>
<line x1="48.0" y1="163.2" x2="57.6" y2="163.2"/>
<line x1="57.6" y1="163.2" x2="67.2" y2="163.2"/>
<line x1="4.8" y1="172.8" x2="4.8" y2="192.0"/>
<line x1="43.2" y1="182.4" x2="48.0" y2="182.4"/>
<line x1="43.2" y1="172.8" x2="43.2" y2="182.4"/>
<line x1="48.0" y1="182.4" x2="57.6" y2="182.4"/>
<line x1="57.6" y1="182.4" x2="67.2" y2="182.4"/>
<line x1="4.8" y1="201.6" x2="9.6" y2="201.6"/>
<line x1="4.8" y1="192.0" x2="4.8" y2="201.6"/>
<line x1="9.6" y1="201.6" x2="19.2" y2="201.6"/>
<line x1="19.2" y1="201.6" x2="28.8" y2="201.6"/>
<text x="4.8" y="9.6" text-anchor="middle" dominant-baseline="central">.</text>
<text x="14.4" y="9.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="24.0" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="33.6" y="9.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="43.2" y="9.6" text-anchor="middle" dominant-baseline="central">/</text>
<text x="43.2" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="52.8" y="28.8" text-anchor="middle" dominant-baseline="central">b</text>
<text x="62.4" y="28.8" text-anchor="middle" dominant-baseline="central">j</text>
<text x="72.0" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="81.6" y="28.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="91.2" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="100.8" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="110.4" y="28.8" text-anchor="middle" dominant-baseline="central">/</text>
<text x="81.6" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="91.2" y="48.0" text-anchor="middle" dominant-baseline="central">3</text>
<text x="100.8" y="48.0" text-anchor="middle" dominant-baseline="central">/</text>
<text x="120.0" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="129.6" y="67.2" text-anchor="middle" dominant-baseline="central">0</text>
<text x="139.2" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="148.8" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="158.4" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="168.0" y="67.2" text-anchor="middle" dominant-baseline="central">2</text>
<text x="177.6" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="187.2" y="67.2" text-anchor="middle" dominant-baseline="central">8</text>
<text x="196.8" y="67.2" text-anchor="middle" dominant-baseline="central">f</text>
<text x="206.4" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="216.0" y="67.2" text-anchor="middle" dominant-baseline="central">1</text>
<text x="225.6" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="235.2" y="67.2" text-anchor="middle" dominant-baseline="central">1</text>
<text x="244.8" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="254.4" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="264.0" y="67.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="273.6" y="67.2" text-anchor="middle" dominant-baseline="central">f</text>
<text x="283.2" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="292.8" y="67.2" text-anchor="middle" dominant-baseline="central">f</text>
<text x="302.4" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="312.0" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="321.6" y="67.2" text-anchor="middle" dominant-baseline="central">8</text>
<text x="331.2" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="340.8" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="350.4" y="67.2" text-anchor="middle" dominant-baseline="central">6</text>
<text x="360.0" y="67.2" text-anchor="middle" dominant-baseline="central">f</text>
<text x="369.6" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="379.2" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="388.8" y="67.2" text-anchor="middle" dominant-baseline="central">2</text>
<text x="398.4" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="408.0" y="67.2" text-anchor="middle" dominant-baseline="central">2</text>
<text x="417.6" y="67.2" text-anchor="middle" dominant-baseline="central">7</text>
<text x="427.2" y="67.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="436.8" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="446.4" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="456.0" y="67.2" text-anchor="middle" dominant-baseline="central">1</text>
<text x="465.6" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="475.2" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="484.8" y="67.2" text-anchor="middle" dominant-baseline="central">6</text>
<text x="494.4" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="504.0" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="513.6" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="523.2" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="532.8" y="67.2" text-anchor="middle" dominant-baseline="central">3</text>
<text x="542.4" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="552.0" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="561.6" y="67.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="571.2" y="67.2" text-anchor="middle" dominant-baseline="central">4</text>
<text x="580.8" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="590.4" y="67.2" text-anchor="middle" dominant-baseline="central">5</text>
<text x="600.0" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="609.6" y="67.2" text-anchor="middle" dominant-baseline="central">9</text>
<text x="619.2" y="67.2" text-anchor="middle" dominant-baseline="central">1</text>
<text x="628.8" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="638.4" y="67.2" text-anchor="middle" dominant-baseline="central">7</text>
<text x="648.0" y="67.2" text-anchor="middle" dominant-baseline="central">8</text>
<text x="657.6" y="67.2" text-anchor="middle" dominant-baseline="central">5</text>
<text x="667.2" y="67.2" text-anchor="middle" dominant-baseline="central">2</text>
<text x="676.8" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="686.4" y="67.2" text-anchor="middle" dominant-baseline="central">8</text>
<text x="696.0" y="67.2" text-anchor="middle" dominant-baseline="central">5</text>
<text x="705.6" y="67.2" text-anchor="middle" dominant-baseline="central">5</text>
<text x="81.6" y="86.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="91.2" y="86.4" text-anchor="middle" dominant-baseline="central">7</text>
<text x="100.8" y="86.4" text-anchor="middle" dominant-baseline="central">/</text>
<text x="120.0" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="129.6" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="139.2" y="105.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="148.8" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="158.4" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="168.0" y="105.6" text-anchor="middle" dominant-baseline="central">8</text>
<text x="177.6" y="105.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="187.2" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="196.8" y="105.6" text-anchor="middle" dominant-baseline="central">1</text>
<text x="206.4" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="216.0" y="105.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="225.6" y="105.6" text-anchor="middle" dominant-baseline="central">7</text>
<text x="235.2" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="244.8" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="254.4" y="105.6" text-anchor="middle" dominant-baseline="central">5</text>
<text x="264.0" y="105.6" text-anchor="middle" dominant-baseline="central">1</text>
<text x="273.6" y="105.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="283.2" y="105.6" text-anchor="middle" dominant-baseline="central">1</text>
<text x="292.8" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="302.4" y="105.6" text-anchor="middle" dominant-baseline="central">7</text>
<text x="312.0" y="105.6" text-anchor="middle" dominant-baseline="central">5</text>
<text x="321.6" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="331.2" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="340.8" y="105.6" text-anchor="middle" dominant-baseline="central">0</text>
<text x="350.4" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="360.0" y="105.6" text-anchor="middle" dominant-baseline="central">1</text>
<text x="369.6" y="105.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="379.2" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="388.8" y="105.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="398.4" y="105.6" text-anchor="middle" dominant-baseline="central">2</text>
<text x="408.0" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="417.6" y="105.6" text-anchor="middle" dominant-baseline="central">5</text>
<text x="427.2" y="105.6" text-anchor="middle" dominant-baseline="central">8</text>
<text x="436.8" y="105.6" text-anchor="middle" dominant-baseline="central">0</text>
<text x="446.4" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="456.0" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="465.6" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="475.2" y="105.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="484.8" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="494.4" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="504.0" y="105.6" text-anchor="middle" dominant-baseline="central">3</text>
<text x="513.6" y="105.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="523.2" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="532.8" y="105.6" text-anchor="middle" dominant-baseline="central">9</text>
<text x="542.4" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="552.0" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="561.6" y="105.6" text-anchor="middle" dominant-baseline="central">8</text>
<text x="571.2" y="105.6" text-anchor="middle" dominant-baseline="central">2</text>
<text x="580.8" y="105.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="590.4" y="105.6" text-anchor="middle" dominant-baseline="central">8</text>
<text x="600.0" y="105.6" text-anchor="middle" dominant-baseline="central">0</text>
<text x="609.6" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="619.2" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="628.8" y="105.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="638.4" y="105.6" text-anchor="middle" dominant-baseline="central">8</text>
<text x="648.0" y="105.6" text-anchor="middle" dominant-baseline="central">0</text>
<text x="657.6" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="667.2" y="105.6" text-anchor="middle" dominant-baseline="central">8</text>
<text x="676.8" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="686.4" y="105.6" text-anchor="middle" dominant-baseline="central">3</text>
<text x="696.0" y="105.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="705.6" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="81.6" y="124.8" text-anchor="middle" dominant-baseline="central">.</text>
<text x="91.2" y="124.8" text-anchor="middle" dominant-baseline="central">.</text>
<text x="100.8" y="124.8" text-anchor="middle" dominant-baseline="central">.</text>
<text x="43.2" y="144.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="52.8" y="144.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="62.4" y="144.0" text-anchor="middle" dominant-baseline="central">f</text>
<text x="72.0" y="144.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="81.6" y="144.0" text-anchor="middle" dominant-baseline="central">/</text>
<text x="81.6" y="163.2" text-anchor="middle" dominant-baseline="central">H</text>
<text x="91.2" y="163.2" text-anchor="middle" dominant-baseline="central">E</text>
<text x="100.8" y="163.2" text-anchor="middle" dominant-baseline="central">A</text>
<text x="110.4" y="163.2" text-anchor="middle" dominant-baseline="central">D</text>
<text x="81.6" y="182.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="91.2" y="182.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="100.8" y="182.4" text-anchor="middle" dominant-baseline="central">g</text>
<text x="110.4" y="182.4" text-anchor="middle" dominant-baseline="central">s</text>
<text x="120.0" y="182.4" text-anchor="middle" dominant-baseline="central">/</text>
<text x="43.2" y="201.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="52.8" y="201.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="62.4" y="201.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="72.0" y="201.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="81.6" y="201.6" text-anchor="middle" dominant-baseline="central">x</text>
</svg>
</div>
<p>Sharding: First two hex characters of hash form directory name (256 buckets).</p>
<h3>Object Types</h3>
<pre class="language-scheme">
;; Blob - raw data
(cas-blob
  (hash "sha256:...")
  (size 1024)
  (data #${...}))

;; Tree - directory structure
(cas-tree
  (hash "sha256:...")
  (entries
    (("README.md" blob "sha256:abc...")
     ("src" tree "sha256:def...")
     ("lib" tree "sha256:ghi..."))))

;; Commit - snapshot with metadata
(cas-commit
  (hash "sha256:...")
  (tree "sha256:...")
  (parent "sha256:..." | #f)
  (author "ddp@eludom.net")
  (timestamp 1767700000)
  (message "Initial commit"))
</pre>
<h3>Merkle Trees</h3>
<p>Directories are trees of hashes. The root hash commits to all content:</p>
<pre>
                    root: sha256:abc...
                         /          \
              src: sha256:def     lib: sha256:ghi
               /        \              |
        main.scm     test.scm      util.scm
        sha256:111   sha256:222    sha256:333
</pre>
<p>Changing ANY file changes ALL parent hashes up to root.</p>
</section>
<section>
<h2>Operations</h2>
<h3>Store</h3>
<pre class="language-scheme">
(define (cas-put content)
  "Store content, return hash"
  (let* ((hash (sha256 content))
         (path (hash-&gt;path hash)))
    (unless (file-exists? path)
      (write-blob path content))
    hash))
</pre>
<p>Deduplication: If hash already exists, storage is a no-op.</p>
<h3>Retrieve</h3>
<pre class="language-scheme">
(define (cas-get hash)
  "Retrieve content by hash, verify integrity"
  (let* ((path (hash-&gt;path hash))
         (content (read-blob path)))
    (unless (equal? hash (sha256 content))
      (error "Content integrity failure" hash))
    content))
</pre>
<p>Self-verifying: Every retrieval confirms integrity.</p>
<h3>Exists</h3>
<pre class="language-scheme">
(define (cas-exists? hash)
  "Check if content exists"
  (file-exists? (hash-&gt;path hash)))
</pre>
<h3>Delete</h3>
<pre class="language-scheme">
(define (cas-gc roots)
  "Garbage collect unreachable objects"
  (let ((reachable (trace-reachable roots)))
    (for-each
      (lambda (hash)
        (unless (set-member? reachable hash)
          (delete-file (hash-&gt;path hash))))
      (all-objects))))
</pre>
<p>Note: Deletion requires garbage collection from known roots.</p>
</section>
<section>
<h2>Naming Layer</h2>
<p>Content addresses are not human-friendly. A naming layer maps names to hashes:</p>
<h3>References</h3>
<pre class="language-scheme">
;; Mutable reference to immutable content
(define (ref-set name hash)
  (write-file (ref-path name) hash))

(define (ref-get name)
  (read-file (ref-path name)))

;; Example
(ref-set "HEAD" "sha256:abc123...")
(ref-get "HEAD") ; =&gt; "sha256:abc123..."
</pre>
<h3>Tags</h3>
<pre class="language-scheme">
;; Immutable named reference
(define (tag-create name hash #!key message signature)
  (let ((tag-content
         `(tag
           (name ,name)
           (object ,hash)
           (message ,message)
           (signature ,signature))))
    (cas-put (serialize tag-content))))
</pre>
<h3>Directory Entries</h3>
<pre class="language-scheme">
;; Human name -&gt; content hash
(define library-index
  '(("Memo-000" . "sha256:e3b0c44...")
    ("Memo-001" . "sha256:a7ffc6f...")
    ("Memo-002" . "sha256:b94d27b...")))
</pre>
</section>
<section>
<h2>The Soup: Object Directory</h2>
<p>Content-addressed storage provides retrieval by hash, but discovery requires an object directory. The Soup (inspired by NewtonOS) provides a unified view of all objects with rich metadata.</p>
<h3>Philosophy</h3>
<blockquote>
<p>"The soup is infinite." - Objects swim in a queryable sea of metadata.</p>
</blockquote>
<p>The Soup inverts the traditional filesystem model:</p>
<ul>
<li>Filesystem: Navigate hierarchy to find objects</li>
<li>Soup: Query attributes to discover objects</li>
</ul>
<h3>Object Enumeration</h3>
<pre class="language-scheme">
(define (soup)
  "List all objects in the vault with metadata"
  (append
    (soup-releases)      ; Signed releases
    (soup-archives)      ; Sealed archives
    (soup-keys)          ; Cryptographic keys
    (soup-audit-entries) ; Audit trail
    (soup-commits)))     ; Recent commits
</pre>
<h3>Rich Metadata</h3>
<p>Every object carries crypto metadata - the ciphers, hashes, and keys involved:</p>
<pre class="language-scheme">
;; Archive object
(soup-object
  (name "1.0.0")
  (type archive)
  (size "1.2MB")
  (crypto (zstd sha256 "fe378a78...")))

;; Key object
(soup-object
  (name "vault-signing")
  (type key)
  (size "64B")
  (crypto (ed25519/256 public sign
           "sha256:a1b2c3d4..."    ; fingerprint
           "id:ddp@eludom.net"     ; identity
           "2026-01-07")))         ; creation date

;; Release object
(soup-object
  (name "0.1.0")
  (type release)
  (size "313B")
  (crypto (ed25519 sha512 "abc123...")))
</pre>
<h3>Querying the Soup</h3>
<pre class="language-scheme">
;; Find all signed objects
(soup-query type: 'release)

;; Find objects using specific algorithm
(soup-query crypto: 'ed25519)

;; Find objects by size range
(soup-query min-size: 1000 max-size: 100000)

;; Find objects by content hash prefix
(soup-query hash-prefix: "fe378")
</pre>
<h3>Display Format</h3>
<p>The soup displays as a compact, human-readable listing:</p>
<pre>
$ seal-soup
vault-signing, 64B, ed25519/256, public, sign, sha256:a1b2c3d4...
0.1.0, 313B, signed, ed25519, sha512
1.0.0, 1.2MB, zstd, sha256, fe378a78...
audit/1, sealed, 2026-01-07T10:30:00Z
</pre>
<h3>Soup as Index</h3>
<p>The Soup can be serialized as a content-addressed index:</p>
<pre class="language-scheme">
(define (soup-snapshot)
  "Create content-addressed snapshot of current soup"
  (let* ((entries (soup))
         (serialized (serialize entries))
         (hash (cas-put serialized)))
    (ref-set "soup/HEAD" hash)
    hash))
</pre>
<p>This enables: - Time travel: Load historical soup snapshots - Replication: Sync soup indexes between vaults - Verification: Prove soup state at a point in time</p>
</section>
<section>
<h2>Integration with Library of Cyberspace</h2>
<h3>Vault Integration</h3>
<p>The Vault (Memo-006) uses content addressing internally via Git:</p>
<pre class="language-scheme">
;; Git objects ARE content-addressed
(define (git-hash-object content)
  (sha1 (string-append "blob " (number-&gt;string (blob-length content)) "\x00" content)))
</pre>
<p>CAS extends this with SHA-256 and Library-specific semantics.</p>
<h3>Archive Storage</h3>
<p>Sealed archives (Memo-018) can be stored by content address:</p>
<pre class="language-scheme">
(define (archive-to-cas archive-path)
  (let* ((content (read-blob archive-path))
         (hash (cas-put content)))
    (ref-set (string-append "archives/" (archive-version archive-path)) hash)
    hash))
</pre>
<h3>Replication</h3>
<p>Content addressing enables efficient replication (Memo-0002):</p>
<pre class="language-scheme">
;; Only transfer objects receiver doesn't have
(define (replicate-to remote root-hash)
  (for-each
    (lambda (hash)
      (unless (remote-has? remote hash)
        (remote-put remote hash (cas-get hash))))
    (trace-reachable root-hash)))
</pre>
<h3>SPKI Integration</h3>
<p>Content hashes can be Simple Public Key Infrastructure (SPKI) authorization subjects (Memo-004):</p>
<pre class="language-scheme">
;; Grant permission to specific content
(spki-cert
  (issuer publisher-key)
  (subject (hash sha256 "abc123..."))
  (permission read)
  (validity (not-after "2027-01-01")))
</pre>
</section>
<section>
<h2>Chunking for Large Objects</h2>
<p>Large files are split into chunks for:</p>
<p>1. Deduplication at sub-file granularity 2. Parallel transfer 3. Incremental updates</p>
<h3>Fixed-Size Chunking</h3>
<pre class="language-scheme">
(define chunk-size (* 64 1024))  ; 64KB

(define (chunk-fixed data)
  (let loop ((offset 0) (chunks '()))
    (if (&gt;= offset (blob-length data))
        (reverse chunks)
        (loop (+ offset chunk-size)
              (cons (blob-copy data offset (min chunk-size (- (blob-length data) offset)))
                    chunks)))))
</pre>
<h3>Content-Defined Chunking (Rabin fingerprinting)</h3>
<pre class="language-scheme">
;; Chunk boundaries determined by content
;; Survives insertions/deletions better than fixed-size
(define (chunk-rabin data)
  (let ((window-size 48)
        (min-chunk 2048)
        (max-chunk 65536)
        (mask #x0fff))  ; Average 4KB chunks
    ...))
</pre>
<h3>Chunk Tree</h3>
<pre class="language-scheme">
(cas-chunked
  (hash "sha256:...")      ; Root hash
  (size 10485760)          ; 10MB original
  (chunks
    ("sha256:aaa..." 65536)
    ("sha256:bbb..." 65536)
    ("sha256:ccc..." 32768)
    ...))
</pre>
</section>
<section>
<h2>Introspection</h2>
<p>The Library is fully introspective: it stores, addresses, and reasons about itself.</p>
<h3>Self-Hosting</h3>
<p>The system contains its own description:</p>
<pre class="language-scheme">
;; The RFCs are in the CAS
(cas-get (ref-get "rfc/020"))  ; =&gt; This document

;; The code is in the CAS
(cas-get (ref-get "src/vault.scm"))  ; =&gt; Implementation

;; The schema is in the CAS
(cas-get (ref-get "schema/soup-object"))  ; =&gt; Soup object definition
</pre>
<h3>Meta-Objects</h3>
<p>Objects that describe objects:</p>
<pre class="language-scheme">
;; Schema for soup objects (itself a soup object)
(soup-object
  (name "schema/soup-object")
  (type schema)
  (size "412B")
  (crypto (sha256 "def456..."))
  (describes soup-object))

;; The soup can enumerate itself
(soup-query type: 'schema)  ; =&gt; All schemas including this one
</pre>
<h3>Reflexive Queries</h3>
<p>The soup answers questions about itself:</p>
<pre class="language-scheme">
;; What types exist?
(soup-types)  ; =&gt; (archive release key audit commit schema ...)

;; What crypto algorithms are in use?
(soup-algorithms)  ; =&gt; (sha256 ed25519 zstd age ...)

;; What is the total size of the vault?
(soup-total-size)  ; =&gt; 47.3MB

;; How much deduplication?
(soup-dedup-ratio)  ; =&gt; 0.73 (27% space saved)
</pre>
<h3>Provenance</h3>
<p>Every object knows its origin:</p>
<pre class="language-scheme">
(soup-object
  (name "memo-020.ps")
  (type blob)
  (size "89KB")
  (crypto (sha256 "abc123..."))
  (provenance
    (created-by "ddp@eludom.net")
    (created-at 1767700000)
    (derived-from "sha256:fff888...")
    (tool "dvips")))
</pre>
<p>Provenance chains are themselves content-addressed:</p>
<pre class="language-scheme">
;; Trace full history
(define (provenance-chain hash)
  (let ((obj (soup-get hash)))
    (if (soup-object-derived-from obj)
        (cons obj (provenance-chain (soup-object-derived-from obj)))
        (list obj))))
</pre>
<h3>Audit of Audits</h3>
<p>The audit trail audits itself:</p>
<pre class="language-scheme">
;; Audit entry for an audit entry
(audit-entry
  (id 42)
  (actor vault-key)
  (action (audit-append 41))  ; Recorded adding entry 41
  (timestamp 1767700100))

;; The audit trail is in the soup
(soup-query type: 'audit)  ; =&gt; All audit entries as soup objects
</pre>
<h3>Bootstrapping</h3>
<p>The system can describe how to build itself:</p>
<pre class="language-scheme">
;; Bootstrap manifest - everything needed to reconstruct
(bootstrap-manifest
  (hash "sha256:bootstrap...")
  (contents
    (("src/" tree "sha256:src...")
     ("rfcs/" tree "sha256:rfcs...")
     ("keys/" tree "sha256:keys...")
     ("schema/" tree "sha256:schema...")))
  (build-instructions
    "Load src/boot.scm, call (bootstrap)"))

;; Verify bootstrap integrity
(define (verify-bootstrap)
  (let ((manifest (cas-get (ref-get "bootstrap"))))
    (for-each verify-tree (manifest-contents manifest))))
</pre>
<h3>The Library Contains Itself</h3>
<div class="diagram-container">
