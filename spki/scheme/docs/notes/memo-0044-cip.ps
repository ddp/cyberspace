%!PS-Adobe-3.0
%%Title: memo-0044-cip
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0044: Cryptographic Imprint Protocol) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(CIP establishes secure channels between Cyberspace nodes using stateless) show newline
(cookies for DoS resistance, ephemeral key exchange for forward secrecy,) show newline
(and capability attestation for authorization. Each imprint is an) show newline
(authoritative affirmation of trust - signed and sealed by the issuing) show newline
(principal in their realm. No X.509. No CA hierarchy. No algorithm) show newline
(negotiation.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(TLS is complex: - Certificate chains require PKI - Algorithm negotiation) show newline
(invites downgrade attacks - State allocated before client proven real -) show newline
(Identity exposed before encryption) show newline
() show newline
(PHOTURIS \(1995\) had better ideas: - Cookies before crypto - Identity) show newline
(under encryption - Simple state machine) show newline
() show newline
(CIP resurrects these ideas with modern primitives.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PROTOCOL OVERVIEW) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(    Initiator                          Responder) show newline
(        |                                   |) show newline
(        |-------- KNOCK \(version\) -------->|  Stateless) show newline
(        |<-------- COOKIE -----------------|  Stateless) show newline
(        |                                   |) show newline
(        |-------- EXCHANGE \(eph key\) ----->|  State committed) show newline
(        |<------- EXCHANGE \(eph key\) ------|) show newline
(        |                                   |) show newline
(        |========= encrypted below ========|) show newline
(        |                                   |) show newline
(        |-------- ATTEST \(identity\) ------>|) show newline
(        |<------- ATTEST \(identity\) -------|) show newline
(        |                                   |) show newline
(        |-------- OFFER \(capabilities\) --->|) show newline
(        |<------- OFFER \(capabilities\) ----|) show newline
(        |                                   |) show newline
(        |-------- CONFIRM \(transcript\) --->|) show newline
(        |<------- CONFIRM \(transcript\) ----|) show newline
(        |                                   |) show newline
(        |========= CHANNEL OPEN ===========|) show newline
(        |                                   |) show newline
(        |<----------- DATA -------------->|) show newline
() show newline
(10 messages to establish. Unlimited encrypted DATA after.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MESSAGE FORMAT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(All messages use TLV encoding:) show newline
() show newline
() show newline
(    +------+--------+------------------+) show newline
(    | Type | Length | Payload          |) show newline
(    | 1B   | 4B BE  | variable         |) show newline
(    +------+--------+------------------+) show newline
() show newline
() show newline
(Message Types) show newline
(-------------) show newline
() show newline
() show newline
(  Type   Name       Direction       ) show newline
(  0x01   KNOCK      I > R           ) show newline
(  0x02   COOKIE     R > I           ) show newline
(  0x03   EXCHANGE   bidirectional   ) show newline
(  0x04   ATTEST     bidirectional   ) show newline
(  0x05   OFFER      bidirectional   ) show newline
(  0x06   CONFIRM    bidirectional   ) show newline
(  0x10   DATA       bidirectional   ) show newline
(  0xFF   CLOSE      bidirectional   ) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PHASE 1: KNOCK) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Initiator announces intent and protocol version.) show newline
() show newline
() show newline
(    KNOCK payload:) show newline
(      "CIP/" VERSIONMAJOR "." VERSIONMINOR) show newline
(    Example: "CIP/1.0") show newline
() show newline
(Responder checks version compatibility: - Major mismatch: reject) show newline
(\(incompatible suites\) - Minor mismatch: accept \(backward compatible\)) show newline
() show newline
(Responder allocates no state.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PHASE 2: COOKIE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Responder returns stateless cookie.) show newline
() show newline
() show newline
(    \(define \(make-cookie remote-addr remote-port\)) show newline
(      \(let \(\(data \(string-append) show newline
(                    \(blob->string cookie-secret\)) show newline
(                    remote-addr) show newline
(                    \(number->string remote-port\)) show newline
(                    \(number->string cookie-epoch*\)\)\)) show newline
(             \(hash \(blake2b-hash \(string->blob data\)\)\)\)) show newline
(        \(substring hash 0 16\)\)\)) show newline
() show newline
(Cookie properties: - Stateless: Responder doesn't store it -) show newline
(Unforgeable: Requires server secret - Expiring: Epoch rotation) show newline
(invalidates old cookies - Address-bound: Different address = different) show newline
(cookie) show newline
() show newline
(Responder still allocates no state.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PHASE 3: EXCHANGE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Both parties exchange ephemeral public keys.) show newline
() show newline
(Initiator sends:) show newline
() show newline
() show newline
(    EXCHANGE payload:) show newline
(      cookie-r "|" cookie-i "|" ephemeral-public-hex) show newline
() show newline
(- cookie-r: Echo of responder's cookie \(proves receipt\) - cookie-i:) show newline
(Initiator's random cookie \(for key derivation\) - ephemeral-public:) show newline
(X25519 public key) show newline
() show newline
(Responder verifies cookie echo, then responds with same format.) show newline
() show newline
(State now committed. Keys derived.) show newline
() show newline
() show newline
(Key Derivation) show newline
(--------------) show newline
() show newline
() show newline
(    \(define \(derive-session-keys shared-secret cookie-i cookie-r\)) show newline
(      \(let* \(\(ikm \(blob-append shared-secret) show newline
(                               \(string->blob cookie-i\)) show newline
(                               \(string->blob cookie-r\)\)\)) show newline
(             \(prk \(blake2b-hash ikm\)\)) show newline
(             \(k-ir \(blake2b-hash \(blob-append prk "initiator->responder"\)\)\)) show newline
(             \(k-ri \(blake2b-hash \(blob-append prk "responder->initiator"\)\)\)\)) show newline
(        \(values \(take k-ir 32\) \(take k-ri 32\)\)\)\)) show newline
() show newline
(Directional keys prevent reflection attacks.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PHASE 4: ATTEST) show newline
(------------------------------------------------------------------------) show newline
() show newline
(All subsequent messages encrypted.) show newline
() show newline
(Both parties prove identity using Simple Public Key Infrastructure) show newline
(\(SPKI\) principals.) show newline
() show newline
() show newline
(    ATTEST payload \(encrypted\):) show newline
(      principal-hash "|" signature) show newline
() show newline
(- principal-hash: SPKI principal \(hex-encoded public key hash\) -) show newline
(signature: Ed25519 signature over transcript) show newline
() show newline
(Identity is cryptographic, not nominal. A principal is identified solely) show newline
(by its public key hash, never by a human-readable name. This is a prime) show newline
(directive.) show newline
() show newline
(The attestation is the principal's authoritative affirmation of their) show newline
(own trust: I vouch for this channel. This is not a bearer token - it is) show newline
(my sealed declaration, bound to my realm.) show newline
() show newline
(Transcript for signing:) show newline
() show newline
() show newline
(    cookie-i || cookie-r || ephemeral-public) show newline
() show newline
() show newline
(Anonymous Attestation \(Optional\)) show newline
(--------------------------------) show newline
() show newline
(For privacy, use Chaum-style blind signatures:) show newline
() show newline
() show newline
(    \(define \(blind-attest capability-hash\)) show newline
(      ;; Prove authorization without revealing identity) show newline
(      \(blind-sign capability-hash \(blind-factor\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PHASE 5: OFFER) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Exchange authorized capabilities as SPKI tags.) show newline
() show newline
() show newline
(    OFFER payload \(encrypted\):) show newline
(      \(tag \( set capability ...\)\)) show newline
(    Example: "\(tag \( set read write replicate\)\)") show newline
() show newline
(Capabilities follow Memo-021 \(Capability Delegation\): - Only offer what) show newline
(you hold - Attenuation only, no amplification - Explicit, not ambient -) show newline
(Expressed as SPKI tag s-expressions) show newline
() show newline
(Future: Full SPKI auth-certs with issuer signatures.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(PHASE 6: CONFIRM) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Bind entire transcript.) show newline
() show newline
() show newline
(    CONFIRM payload \(encrypted\):) show newline
(      BLAKE2b\(cookie-i || cookie-r || their-principal\)) show newline
() show newline
(Both parties must produce matching hashes. Any tampering detected.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DATA PHASE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Channel open. Encrypted messaging.) show newline
() show newline
() show newline
(    DATA payload:) show newline
(      ChaCha20-Poly1305\(key, nonce, plaintext\)) show newline
() show newline
(Nonce construction:) show newline
() show newline
() show newline
(    nonce = sequence-number \(8 bytes\) || 0x00000000 \(4 bytes\)) show newline
() show newline
(Sequence numbers: - Start at 0 - Increment per message - Prevent replay) show newline
(- Separate counters per direction) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(ALGORITHM SUITES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(No runtime negotiation. Version determines suite.) show newline
() show newline
() show newline
(CIP/1.x \(Current\)) show newline
(-----------------) show newline
() show newline
() show newline
(  Function       Algorithm           ) show newline
(  Key Exchange   X25519              ) show newline
(  Signatures     Ed25519             ) show newline
(  AEAD           ChaCha20-Poly1305   ) show newline
(  Hash           BLAKE2b             ) show newline
(  KDF            HKDF-BLAKE2b        ) show newline
() show newline
() show newline
(CIP/2.x \(Reserved: Post-Quantum\)) show newline
(--------------------------------) show newline
() show newline
() show newline
(  Function       Algorithm           ) show newline
(  Key Exchange   Kyber-1024          ) show newline
(  Signatures     Dilithium3          ) show newline
(  AEAD           ChaCha20-Poly1305   ) show newline
(  Hash           BLAKE2b             ) show newline
() show newline
() show newline
(CIP/3.x \(Reserved: Hybrid\)) show newline
(--------------------------) show newline
() show newline
() show newline
(  Function       Algorithm             ) show newline
(  Key Exchange   X25519 + Kyber        ) show newline
(  Signatures     Ed25519 + Dilithium   ) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SECURITY PROPERTIES) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(DoS Resistance) show newline
(--------------) show newline
() show newline
() show newline
(  Attack             Defense                         ) show newline
(  SYN flood          Cookie proves return path       ) show newline
(  Amplification      No response until cookie echo   ) show newline
(  State exhaustion   No state until Phase 3          ) show newline
() show newline
() show newline
(Forward Secrecy) show newline
(---------------) show newline
() show newline
(Ephemeral X25519 keys: - Generated per session - Destroyed after key) show newline
(derivation - Compromise of long-term key doesn't expose past sessions) show newline
() show newline
() show newline
(Identity Protection \(SPKI Native\)) show newline
(---------------------------------) show newline
() show newline
(Principal identity: - Is the public key hash \(not a name, not a) show newline
(certificate\) - Only revealed after encryption established - Only) show newline
(revealed to authenticated peer - Never in plaintext on wire -) show newline
(Self-certifying: principal = hash\(public_key\)) show newline
() show newline
() show newline
(Replay Protection) show newline
(-----------------) show newline
() show newline
(  * Sequence numbers per direction) show newline
(  * Nonce never reused \(fatal if violated\)) show newline
(  * AEAD authentication fails on replay) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(COMPARISON) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(  Property                TLS 1.3   IKEv2     CIP       ) show newline
(  Messages to establish   2-3       4+        10        ) show newline
(  DoS resistance          Limited   Cookies   Cookies   ) show newline
(  Algorithm negotiation   Yes       Yes       No        ) show newline
(  Certificate required    Yes       Yes       No        ) show newline
(  Identity protection     Partial   Yes       Yes       ) show newline
(  Capability binding      No        No        Yes       ) show newline
() show newline
(CIP trades fewer round-trips for simplicity and capability integration.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(IMPLEMENTATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(    ;; Initiator) show newline
(    \(define ch \(node-connect "remote.host" 4433\)\)) show newline
(    \(channel-send ch '\(request object-hash\)\)) show newline
(    \(channel-recv ch\)) show newline
(    ;; Responder) show newline
(    \(node-listen 4433 "my-node"\)) show newline
(    \(define ch \(node-accept\)\)) show newline
(    \(let \(\(msg \(channel-recv ch\)\)\)) show newline
(      \(channel-send ch \(process msg\)\)\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(1. Karn, P. & Simpson, W. \(1999\). PHOTURIS. RFC 2522. 2. Karn, P. &) show newline
(Simpson, W. \(1999\). PHOTURIS Extended Schemes. RFC 2523. 3. Bernstein,) show newline
(D.J. \(2006\). Curve25519. 4. Bernstein, D.J. \(2008\). ChaCha20. 5.) show newline
(Memo-021: Capability Delegation 6. Memo-040: Security Architecture) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(- 2026-01-07: Initial specification) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
