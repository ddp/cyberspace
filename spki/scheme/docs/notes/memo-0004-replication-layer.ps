%!PS-Adobe-3.0
%%Title: memo-0004-replication-layer
%%Creator: Library of Cyberspace Memo Pipeline
%%Pages: (atend)
%%EndComments

/Courier findfont 10 scalefont setfont
/margin 72 def
/pagewidth 612 def
/pageheight 792 def
/leading 12 def
/topmargin pageheight margin sub def
/bottommargin margin def
/linewidth pagewidth margin 2 mul sub def
/ypos topmargin def
/pagenum 1 def

/newline {
  /ypos ypos leading sub def
  ypos bottommargin lt {
    showpage
    /pagenum pagenum 1 add def
    /ypos topmargin def
  } if
  margin ypos moveto
} def

margin topmargin moveto
(Memo 0004: Replication Layer for Library of Cyberspace) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
() show newline
(------------------------------------------------------------------------) show newline
(ABSTRACT) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This Memo specifies a replication layer for the Library of Cyberspace) show newline
(preservation architecture, enabling cryptographically sealed releases to) show newline
(be published, subscribed to, and synchronized across distributed) show newline
(locations while maintaining tamper-evident audit trails.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(MOTIVATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(    "The network is the computer. â€” John Gage, Sun Microsystems") show newline
() show newline
() show newline
(Heritage: "Behave as One") show newline
(-------------------------) show newline
() show newline
(The VAXcluster principle \(1984\): N nodes must behave as one. Not) show newline
(eventually consistent. Not loosely coupled. Identical. One security) show newline
(domain, one namespace, one view of the world.) show newline
() show newline
(DECnet Phase IV's 24-bit addressing was fatal for internet scale.) show newline
(Cyberspace applies the same principle to IPv6's 128-bit address space.) show newline
(Federated nodes, behaving as one.) show newline
() show newline
(But unlike VAXcluster's tight coupling over CI bus, Cyberspace) show newline
(replication works over any transport: git pushes, HTTP posts, USB drives) show newline
(carried across air gaps. The cryptography travels with the data.) show newline
() show newline
() show newline
(Requirements) show newline
(------------) show newline
() show newline
(The Library of Cyberspace requires a distribution mechanism that:) show newline
() show newline
(  * Preserves cryptographic authenticity - Signatures travel with artifacts) show newline
(  * Enables offline verification - No centralized authority required) show newline
(  * Records provenance - All publication events are audited) show newline
(  * Supports multiple transports - Git, HTTP, filesystem) show newline
(  * Maintains loose coupling - Works for confederations of friends) show newline
() show newline
(These requirements reflect the reality of distributed archival: networks) show newline
(partition, authorities disappear, and trust must be verifiable without) show newline
(phoning home.) show newline
() show newline
(Traditional package managers and distribution systems assume centralized) show newline
(registries and online verification. This replication layer is designed) show newline
(for decentralized, long-term preservation where trust is established) show newline
(through Simple Public Key Infrastructure \(SPKI\) certificates and) show newline
(cryptographic seals.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(DESIGN PRINCIPLES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * Sealed Releases - Only cryptographically signed releases can be published) show newline
(  * Transport Agnostic - Same API works for git, HTTP, filesystem) show newline
(  * Audit Everything - All replication events are recorded in tamper-evident log) show newline
(  * Verify Before Trust - Subscribers must verify cryptographic seals) show newline
(  * Explicit Authorization - SPKI certificates determine who can publish) show newline
() show newline
(These principles ensure that trust is established cryptographically) show newline
(rather than administratively, and that the system works regardless of) show newline
(network topology or transport mechanism.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SPECIFICATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(seal-publish) show newline
(------------) show newline
() show newline
(Publish a sealed release to a remote location. The fundamental) show newline
(operation: take what's been cryptographically sealed locally and make it) show newline
(available elsewhere.) show newline
() show newline
() show newline
(    \(seal-publish version) show newline
(                  remote: target) show newline
(                  archive-format: format) show newline
(                  message: notes\)) show newline
() show newline
(Parameters:) show newline
() show newline
() show newline
(  Parameter        Description                                              ) show newline
(  version          Semantic version string \(e.g., "1.0.0"\)                  ) show newline
(  remote           Publication target: git remote, URL, or directory path   ) show newline
(  archive-format   'tarball, 'bundle, or 'cryptographic \(default\)           ) show newline
(  message          Release notes \(optional\)                                 ) show newline
() show newline
(Behavior:) show newline
() show newline
(  * Verify release exists \(creates if needed via seal-release\)) show newline
(  * Create cryptographic archive with: tarball of repository at version tag, SHA-512 hash of tarball, Ed25519 signature of hash, manifest with version, hash, signature) show newline
(  * Publish to remote based on type: Git remote \(push tag, optionally upload archive\), HTTP URL \(POST archive to endpoint\), Filesystem \(copy archive to directory\)) show newline
(  * Record publication in audit trail with: actor \(public key from signing key\), action \(seal-publish version remote\), motivation \(release notes\), cryptographic seal \(signature\)) show newline
() show newline
(Audit Entry Format:) show newline
() show newline
() show newline
(    \(audit-entry) show newline
(      \(id "sha512:..."\)) show newline
(      \(timestamp "Mon Jan 5 23:38:20 2026"\)) show newline
(      \(sequence 1\)) show newline
(      \(actor) show newline
(        \(principal #${public-key-blob}\)) show newline
(        \(authorization-chain\)\)) show newline
(      \(action) show newline
(        \(verb seal-publish\)) show newline
(        \(object "1.0.0"\)) show newline
(        \(parameters "/path/to/remote"\)\)) show newline
(      \(context) show newline
(        \(motivation "Published to filesystem"\)) show newline
(        \(language "en"\)\)) show newline
(      \(environment) show newline
(        \(platform "unknown"\)) show newline
(        \(timestamp 1767685100\)\)) show newline
(      \(seal) show newline
(        \(algorithm "ed25519-sha512"\)) show newline
(        \(content-hash "..."\)) show newline
(        \(signature "..."\)\)\)) show newline
() show newline
() show newline
(seal-subscribe) show newline
(--------------) show newline
() show newline
(Subscribe to sealed releases from a remote source. Pull what others have) show newline
(published, verify it cryptographically, trust nothing until proven.) show newline
() show newline
() show newline
(    \(seal-subscribe remote) show newline
(                    target: local-path) show newline
(                    verify-key: public-key\)) show newline
() show newline
(Parameters:) show newline
() show newline
() show newline
(  Parameter    Description                                        ) show newline
(  remote       Source location: git remote, URL, or directory     ) show newline
(  target       Local path for downloaded archives \(optional\)      ) show newline
(  verify-key   Public key for signature verification \(optional\)   ) show newline
() show newline
(Behavior:) show newline
() show newline
(  * Discover available releases from remote: Git remote \(list tags\), HTTP URL \(GET /releases endpoint\), Filesystem \(list .archive files\)) show newline
(  * Download cryptographic archives) show newline
(  * Verify each archive: check manifest structure, verify SHA-512 hash of tarball, verify Ed25519 signature \(if verify-key provided\)) show newline
(  * Extract verified archives to target directory) show newline
(  * Record subscription in audit trail: count of releases downloaded, source location, verification status) show newline
() show newline
(Security Consideration: Without verify-key, subscription downloads) show newline
(archives but cannot verify authenticity. SPKI certificate chains should) show newline
(be used to establish trust.) show newline
() show newline
() show newline
(seal-synchronize) show newline
(----------------) show newline
() show newline
(Bidirectional synchronization of sealed releases. For peers who trust) show newline
(each other: what you have that I don't, what I have that you don't,) show newline
(reconcile.) show newline
() show newline
() show newline
(    \(seal-synchronize remote) show newline
(                      direction: 'both) show newline
(                      verify-key: public-key\)) show newline
() show newline
(Parameters:) show newline
() show newline
() show newline
(  Parameter    Description                                        ) show newline
(  remote       Sync target: git remote, URL, or directory         ) show newline
(  direction    'both \(default\), 'push-only, or 'pull-only         ) show newline
(  verify-key   Public key for signature verification \(optional\)   ) show newline
() show newline
(Behavior:) show newline
() show newline
(  * Discover local and remote releases) show newline
(  * Compare versions to determine: releases to push \(local but not remote\), releases to pull \(remote but not local\)) show newline
(  * Execute publication for new local releases) show newline
(  * Execute subscription for new remote releases) show newline
(  * Record synchronization in audit trail: count pushed and pulled, remote location, direction) show newline
() show newline
(Use Case: Periodic sync between trusted peers in a confederation.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(ARCHIVE FORMAT) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Cryptographic Archive Structure) show newline
(-------------------------------) show newline
() show newline
() show newline
(    vault-1.0.0.archive          # Manifest file) show newline
(    vault-1.0.0.archive.tar.gz   # Actual tarball) show newline
() show newline
(Manifest S-expression:) show newline
() show newline
() show newline
(    \(sealed-archive) show newline
(      \(version "1.0.0"\)) show newline
(      \(format cryptographic\)) show newline
(      \(tarball "vault-1.0.0.archive.tar.gz"\)) show newline
(      \(hash "sha512:..."\)) show newline
(      \(signature "ed25519:..."\)) show newline
(      \(timestamp 1767685100\)) show newline
(      \(sealer #${public-key-blob}\)\)) show newline
() show newline
(Verification Steps:) show newline
() show newline
(  * Read manifest) show newline
(  * Hash tarball with SHA-512) show newline
(  * Verify hash matches manifest) show newline
(  * Verify Ed25519 signature on hash) show newline
(  * Check SPKI authorization \(optional\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(TRANSPORT IMPLEMENTATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Git Remote) show newline
(----------) show newline
() show newline
(  * Uses git push to share tags) show newline
(  * Optionally uploads archives as release assets \(GitHub, GitLab\)) show newline
(  * Fetch uses git fetch + git tag -l) show newline
() show newline
() show newline
(HTTP Endpoint) show newline
(-------------) show newline
() show newline
(  * POST to /releases/<version> for publication) show newline
(  * GET /releases for discovery) show newline
(  * Content-Type: application/x-sealed-archive) show newline
() show newline
() show newline
(Filesystem) show newline
(----------) show newline
() show newline
(  * Copy archives to shared directory) show newline
(  * Directory structure: <remote>/<archive-name>) show newline
(  * No network required, works with NFS, USB drives, etc.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(AUDIT INTEGRATION) show newline
(------------------------------------------------------------------------) show newline
() show newline
(Every replication operation creates an audit entry. No silent) show newline
(operations. No unattributed changes. See Memo-005 for the full audit) show newline
(trail specification.) show newline
() show newline
(Each entry contains:) show newline
() show newline
(  * Content-addressed ID: SHA-512 hash of entry) show newline
(  * Chained structure: References parent entry) show newline
(  * SPKI principal: Public key of actor) show newline
(  * Dual context: Human motivation + machine environment) show newline
(  * Cryptographic seal: Ed25519 signature) show newline
() show newline
(This provides:) show newline
() show newline
(  * Non-repudiation: Cannot deny publication) show newline
(  * Tamper evidence: Changes are detectable) show newline
(  * Causality: Chain shows temporal order) show newline
(  * Accountability: Know who published what, when, and why) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(SECURITY CONSIDERATIONS) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Threat Model) show newline
(------------) show newline
() show newline
(Trusted:) show newline
() show newline
(  * Local filesystem and vault) show newline
(  * SPKI private keys \(your responsibility\)) show newline
(  * Cryptographic primitives \(libsodium, audited\)) show newline
() show newline
(Untrusted:) show newline
() show newline
(  * Remote repositories \(anyone can host anything\)) show newline
(  * Network transport \(assume hostile\)) show newline
(  * Downloaded archives \(verify before use\)) show newline
(  * Remote publishers \(until SPKI chain verified\)) show newline
() show newline
(The key insight: trust the math, not the infrastructure. A verified) show newline
(signature is proof regardless of how it arrived.) show newline
() show newline
() show newline
(Attack Scenarios) show newline
(----------------) show newline
() show newline
(  * Malicious Archive Substitution - Attacker replaces archive on remote - Mitigation: Signature verification fails) show newline
(  * Version Rollback Attack - Attacker removes newer releases - Mitigation: Audit trail shows previous versions) show newline
(  * Unauthorized Publication - Attacker publishes fake release - Mitigation: SPKI authorization chain required) show newline
(  * Transport Tampering - Network attacker modifies download - Mitigation: Hash and signature verification) show newline
() show newline
(Each attack is addressed at the cryptographic layer rather than the) show newline
(transport layer, ensuring protection regardless of network conditions.) show newline
() show newline
() show newline
(Best Practices) show newline
(--------------) show newline
() show newline
(  * Always verify signatures - Use verify-key parameter) show newline
(  * Check SPKI certificates - Verify authorization chain) show newline
(  * Maintain audit trail - Detect suspicious patterns) show newline
(  * Use HTTPS for HTTP transport - Prevent network attacks) show newline
(  * Backup signing keys - Use Shamir secret sharing) show newline
() show newline
(Defense in depth: cryptographic verification is primary, but transport) show newline
(security and operational practices add additional layers.) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(IMPLEMENTATION NOTES) show newline
(------------------------------------------------------------------------) show newline
() show newline
() show newline
(Helper Functions) show newline
(----------------) show newline
() show newline
() show newline
(    \(tag-exists? tag-name\)        ; Check if git tag exists) show newline
(    \(git-remote? str\)             ; Detect git remote format) show newline
(    \(http-url? str\)               ; Detect HTTP/HTTPS URL) show newline
(    \(publish-filesystem remote version archive\)  ; Copy to directory) show newline
(    \(publish-http url version archive\)           ; POST to endpoint) show newline
() show newline
() show newline
(Dependencies) show newline
(------------) show newline
() show newline
(  * Git: Version control and tag management) show newline
(  * libsodium: Ed25519 signatures, SHA-512 hashing) show newline
(  * \(chicken process\): Run git commands) show newline
(  * \(chicken file\): Filesystem operations) show newline
(  * \(chicken irregex\): URL/remote detection) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(COMPATIBILITY) show newline
(------------------------------------------------------------------------) show newline
() show newline
(This specification builds on existing standards rather than inventing) show newline
(new ones:) show newline
() show newline
() show newline
(  Technology         Role                                  ) show newline
(  Git tags           Standard version control operations   ) show newline
(  Git bundles        Portable repository format            ) show newline
(  Tarball archives   Universal archive format              ) show newline
(  S-expressions      LISP/Scheme readable manifests        ) show newline
(  SDSI/SPKI          Authorization certificates            ) show newline
() show newline
(Future extensions may add:) show newline
() show newline
(  * IPFS transport: Content-addressed distribution) show newline
(  * Tor hidden services: Anonymous publication) show newline
(  * Encrypted archives: Confidential distribution) show newline
(  * Multi-signature releases: Threshold authorization) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(TEST COVERAGE) show newline
(------------------------------------------------------------------------) show newline
() show newline
(See test-replication.scm:) show newline
() show newline
() show newline
(    ;; Test seal-publish to filesystem) show newline
(    \(seal-publish "1.0.0") show newline
(                  remote: "/tmp/cyberspace-publish-test") show newline
(                  message: "Published to filesystem"\)) show newline
(    ;; Verify archive exists) show newline
(    \(file-exists? "/tmp/cyberspace-publish-test/vault-1.0.0.archive"\)) show newline
(    ;; Verify audit entry created) show newline
(    \(audit-read sequence: 1\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(REFERENCES) show newline
(------------------------------------------------------------------------) show newline
() show newline
(  * SDSI/SPKI: RFC 2693, RFC 2692) show newline
(  * Content-Addressed Storage: Git internals, IPFS) show newline
(  * Semantic Versioning: semver.org) show newline
(  * Ed25519: Bernstein et al., 2006) show newline
(  * Audit Trails: Memo-005 \(Cryptographic Audit Trail\)) show newline
() show newline
() show newline
(------------------------------------------------------------------------) show newline
(CHANGELOG) show newline
(------------------------------------------------------------------------) show newline
() show newline
(2026-01-19 - Expanded narrative, fixed formatting) show newline
() show newline
(2026-01-05 - Initial specification: seal-publish, seal-subscribe,) show newline
(seal-synchronize with full audit trail integration) show newline
() show newline
(------------------------------------------------------------------------) show newline

showpage
%%Trailer
%%Pages: pagenum
%%EOF
