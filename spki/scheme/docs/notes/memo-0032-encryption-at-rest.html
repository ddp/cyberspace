<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <title>Memo 0032: Encryption at Rest</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 0032: Encryption at Rest</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This Memo specifies encryption at rest for the Library of Cyberspace: how vaults protect stored data using modern cryptography while maintaining content-addressability, key management, and operational flexibility. All sensitive data is encrypted before touching persistent storage.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Data at rest faces threats:</p>
<ul>
<li>Physical theft</li>
<li>Disks, servers, backups stolen</li>
<li>Insider access</li>
<li>Unauthorized admin access</li>
<li>Legal compulsion</li>
<li>Forced disclosure orders</li>
<li>Decommissioning</li>
<li>Data remnants on old hardware</li>
</ul>
<p>Encryption must be:</p>
<ul>
<li>Transparent</li>
<li>Applications unaware of encryption</li>
<li>Performant</li>
<li>Minimal overhead</li>
<li>Recoverable</li>
<li>Key loss doesn't mean data loss</li>
<li>Auditable</li>
<li>All key operations logged</li>
</ul>
</section>
<section>
<h2>Encryption Model</h2>
<h3>Layered Encryption</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 390 260" width="390" height="260" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<line x1="5" y1="10" x2="10" y2="10"/>
<line x1="5" y1="10" x2="5" y2="20"/>
<line x1="10" y1="10" x2="20" y2="10"/>
<line x1="20" y1="10" x2="30" y2="10"/>
<line x1="30" y1="10" x2="40" y2="10"/>
<line x1="40" y1="10" x2="50" y2="10"/>
<line x1="50" y1="10" x2="60" y2="10"/>
<line x1="60" y1="10" x2="70" y2="10"/>
<line x1="70" y1="10" x2="80" y2="10"/>
<line x1="80" y1="10" x2="90" y2="10"/>
<line x1="90" y1="10" x2="100" y2="10"/>
<line x1="100" y1="10" x2="110" y2="10"/>
<line x1="110" y1="10" x2="120" y2="10"/>
<line x1="120" y1="10" x2="130" y2="10"/>
<line x1="130" y1="10" x2="140" y2="10"/>
<line x1="140" y1="10" x2="150" y2="10"/>
<line x1="150" y1="10" x2="160" y2="10"/>
<line x1="160" y1="10" x2="170" y2="10"/>
<line x1="170" y1="10" x2="180" y2="10"/>
<line x1="180" y1="10" x2="190" y2="10"/>
<line x1="190" y1="10" x2="200" y2="10"/>
<line x1="200" y1="10" x2="210" y2="10"/>
<line x1="210" y1="10" x2="220" y2="10"/>
<line x1="220" y1="10" x2="230" y2="10"/>
<line x1="230" y1="10" x2="240" y2="10"/>
<line x1="240" y1="10" x2="250" y2="10"/>
<line x1="250" y1="10" x2="260" y2="10"/>
<line x1="260" y1="10" x2="270" y2="10"/>
<line x1="270" y1="10" x2="280" y2="10"/>
<line x1="280" y1="10" x2="290" y2="10"/>
<line x1="290" y1="10" x2="300" y2="10"/>
<line x1="300" y1="10" x2="310" y2="10"/>
<line x1="310" y1="10" x2="320" y2="10"/>
<line x1="320" y1="10" x2="330" y2="10"/>
<line x1="330" y1="10" x2="340" y2="10"/>
<line x1="340" y1="10" x2="350" y2="10"/>
<line x1="350" y1="10" x2="360" y2="10"/>
<line x1="360" y1="10" x2="370" y2="10"/>
<line x1="370" y1="10" x2="380" y2="10"/>
<line x1="380" y1="10" x2="385" y2="10"/>
<line x1="385" y1="10" x2="385" y2="20"/>
<line x1="5" y1="20" x2="5" y2="40"/>
<text x="105" y="30">A</text>
<text x="115" y="30">p</text>
<text x="125" y="30">p</text>
<text x="135" y="30">l</text>
<text x="145" y="30">i</text>
<text x="155" y="30">c</text>
<text x="165" y="30">a</text>
<text x="175" y="30">t</text>
<text x="185" y="30">i</text>
<text x="195" y="30">o</text>
<text x="205" y="30">n</text>
<text x="225" y="30">L</text>
<text x="235" y="30">a</text>
<text x="245" y="30">y</text>
<text x="255" y="30">e</text>
<text x="265" y="30">r</text>
<line x1="385" y1="20" x2="385" y2="40"/>
<line x1="5" y1="40" x2="5" y2="60"/>
<text x="85" y="50">(</text>
<text x="95" y="50">p</text>
<text x="105" y="50">l</text>
<text x="115" y="50">a</text>
<text x="125" y="50">i</text>
<text x="135" y="50">n</text>
<text x="145" y="50">t</text>
<text x="155" y="50">e</text>
<text x="165" y="50">x</text>
<text x="175" y="50">t</text>
<text x="195" y="50">o</text>
<text x="205" y="50">b</text>
<text x="215" y="50">j</text>
<text x="225" y="50">e</text>
<text x="235" y="50">c</text>
<text x="245" y="50">t</text>
<text x="255" y="50">s</text>
<text x="265" y="50">)</text>
<line x1="385" y1="40" x2="385" y2="60"/>
<line x1="5" y1="60" x2="5" y2="80"/>
<line x1="5" y1="70" x2="10" y2="70"/>
<line x1="10" y1="70" x2="20" y2="70"/>
<line x1="20" y1="70" x2="30" y2="70"/>
<line x1="30" y1="70" x2="40" y2="70"/>
<line x1="40" y1="70" x2="50" y2="70"/>
<line x1="50" y1="70" x2="60" y2="70"/>
<line x1="60" y1="70" x2="70" y2="70"/>
<line x1="70" y1="70" x2="80" y2="70"/>
<line x1="80" y1="70" x2="90" y2="70"/>
<line x1="90" y1="70" x2="100" y2="70"/>
<line x1="100" y1="70" x2="110" y2="70"/>
<line x1="110" y1="70" x2="120" y2="70"/>
<line x1="120" y1="70" x2="130" y2="70"/>
<line x1="130" y1="70" x2="140" y2="70"/>
<line x1="140" y1="70" x2="150" y2="70"/>
<line x1="150" y1="70" x2="160" y2="70"/>
<line x1="160" y1="70" x2="170" y2="70"/>
<line x1="170" y1="70" x2="180" y2="70"/>
<line x1="180" y1="70" x2="190" y2="70"/>
<line x1="190" y1="70" x2="200" y2="70"/>
<line x1="200" y1="70" x2="210" y2="70"/>
<line x1="210" y1="70" x2="220" y2="70"/>
<line x1="220" y1="70" x2="230" y2="70"/>
<line x1="230" y1="70" x2="240" y2="70"/>
<line x1="240" y1="70" x2="250" y2="70"/>
<line x1="250" y1="70" x2="260" y2="70"/>
<line x1="260" y1="70" x2="270" y2="70"/>
<line x1="270" y1="70" x2="280" y2="70"/>
<line x1="280" y1="70" x2="290" y2="70"/>
<line x1="290" y1="70" x2="300" y2="70"/>
<line x1="300" y1="70" x2="310" y2="70"/>
<line x1="310" y1="70" x2="320" y2="70"/>
<line x1="320" y1="70" x2="330" y2="70"/>
<line x1="330" y1="70" x2="340" y2="70"/>
<line x1="340" y1="70" x2="350" y2="70"/>
<line x1="350" y1="70" x2="360" y2="70"/>
<line x1="360" y1="70" x2="370" y2="70"/>
<line x1="370" y1="70" x2="380" y2="70"/>
<line x1="385" y1="60" x2="385" y2="80"/>
<line x1="380" y1="70" x2="385" y2="70"/>
<line x1="5" y1="80" x2="5" y2="100"/>
<text x="75" y="90">O</text>
<text x="85" y="90">b</text>
<text x="95" y="90">j</text>
<text x="105" y="90">e</text>
<text x="115" y="90">c</text>
<text x="125" y="90">t</text>
<text x="135" y="90">-</text>
<text x="145" y="90">L</text>
<text x="155" y="90">e</text>
<text x="165" y="90">v</text>
<text x="175" y="90">e</text>
<text x="185" y="90">l</text>
<text x="205" y="90">E</text>
<text x="215" y="90">n</text>
<text x="225" y="90">c</text>
<text x="235" y="90">r</text>
<text x="245" y="90">y</text>
<text x="255" y="90">p</text>
<text x="265" y="90">t</text>
<text x="275" y="90">i</text>
<text x="285" y="90">o</text>
<text x="295" y="90">n</text>
<line x1="385" y1="80" x2="385" y2="100"/>
<line x1="5" y1="100" x2="5" y2="120"/>
<text x="55" y="110">(</text>
<text x="65" y="110">p</text>
<text x="75" y="110">e</text>
<text x="85" y="110">r</text>
<text x="95" y="110">-</text>
<text x="105" y="110">o</text>
<text x="115" y="110">b</text>
<text x="125" y="110">j</text>
<text x="135" y="110">e</text>
<text x="145" y="110">c</text>
<text x="155" y="110">t</text>
<text x="175" y="110">k</text>
<text x="185" y="110">e</text>
<text x="195" y="110">y</text>
<text x="205" y="110">s</text>
<text x="215" y="110">,</text>
<text x="235" y="110">a</text>
<text x="245" y="110">g</text>
<text x="255" y="110">e</text>
<text x="275" y="110">f</text>
<text x="285" y="110">o</text>
<text x="295" y="110">r</text>
<text x="305" y="110">m</text>
<text x="315" y="110">a</text>
<text x="325" y="110">t</text>
<text x="335" y="110">)</text>
<line x1="385" y1="100" x2="385" y2="120"/>
<line x1="5" y1="120" x2="5" y2="140"/>
<line x1="5" y1="130" x2="10" y2="130"/>
<line x1="10" y1="130" x2="20" y2="130"/>
<line x1="20" y1="130" x2="30" y2="130"/>
<line x1="30" y1="130" x2="40" y2="130"/>
<line x1="40" y1="130" x2="50" y2="130"/>
<line x1="50" y1="130" x2="60" y2="130"/>
<line x1="60" y1="130" x2="70" y2="130"/>
<line x1="70" y1="130" x2="80" y2="130"/>
<line x1="80" y1="130" x2="90" y2="130"/>
<line x1="90" y1="130" x2="100" y2="130"/>
<line x1="100" y1="130" x2="110" y2="130"/>
<line x1="110" y1="130" x2="120" y2="130"/>
<line x1="120" y1="130" x2="130" y2="130"/>
<line x1="130" y1="130" x2="140" y2="130"/>
<line x1="140" y1="130" x2="150" y2="130"/>
<line x1="150" y1="130" x2="160" y2="130"/>
<line x1="160" y1="130" x2="170" y2="130"/>
<line x1="170" y1="130" x2="180" y2="130"/>
<line x1="180" y1="130" x2="190" y2="130"/>
<line x1="190" y1="130" x2="200" y2="130"/>
<line x1="200" y1="130" x2="210" y2="130"/>
<line x1="210" y1="130" x2="220" y2="130"/>
<line x1="220" y1="130" x2="230" y2="130"/>
<line x1="230" y1="130" x2="240" y2="130"/>
<line x1="240" y1="130" x2="250" y2="130"/>
<line x1="250" y1="130" x2="260" y2="130"/>
<line x1="260" y1="130" x2="270" y2="130"/>
<line x1="270" y1="130" x2="280" y2="130"/>
<line x1="280" y1="130" x2="290" y2="130"/>
<line x1="290" y1="130" x2="300" y2="130"/>
<line x1="300" y1="130" x2="310" y2="130"/>
<line x1="310" y1="130" x2="320" y2="130"/>
<line x1="320" y1="130" x2="330" y2="130"/>
<line x1="330" y1="130" x2="340" y2="130"/>
<line x1="340" y1="130" x2="350" y2="130"/>
<line x1="350" y1="130" x2="360" y2="130"/>
<line x1="360" y1="130" x2="370" y2="130"/>
<line x1="370" y1="130" x2="380" y2="130"/>
<line x1="385" y1="120" x2="385" y2="140"/>
<line x1="380" y1="130" x2="385" y2="130"/>
<line x1="5" y1="140" x2="5" y2="160"/>
<text x="75" y="150">S</text>
<text x="85" y="150">t</text>
<text x="95" y="150">o</text>
<text x="105" y="150">r</text>
<text x="115" y="150">a</text>
<text x="125" y="150">g</text>
<text x="135" y="150">e</text>
<text x="145" y="150">-</text>
<text x="155" y="150">L</text>
<text x="165" y="150">e</text>
<text x="175" y="150">v</text>
<text x="185" y="150">e</text>
<text x="195" y="150">l</text>
<text x="215" y="150">E</text>
<text x="225" y="150">n</text>
<text x="235" y="150">c</text>
<text x="245" y="150">r</text>
<text x="255" y="150">y</text>
<text x="265" y="150">p</text>
<text x="275" y="150">t</text>
<text x="285" y="150">i</text>
<text x="295" y="150">o</text>
<text x="305" y="150">n</text>
<line x1="385" y1="140" x2="385" y2="160"/>
<line x1="5" y1="160" x2="5" y2="180"/>
<text x="55" y="170">(</text>
<text x="65" y="170">v</text>
<text x="75" y="170">o</text>
<text x="85" y="170">l</text>
<text x="95" y="170">u</text>
<text x="105" y="170">m</text>
<text x="115" y="170">e</text>
<text x="135" y="170">e</text>
<text x="145" y="170">n</text>
<text x="155" y="170">c</text>
<text x="165" y="170">r</text>
<text x="175" y="170">y</text>
<text x="185" y="170">p</text>
<text x="195" y="170">t</text>
<text x="205" y="170">i</text>
<text x="215" y="170">o</text>
<text x="225" y="170">n</text>
<text x="235" y="170">,</text>
<text x="255" y="170">L</text>
<text x="265" y="170">U</text>
<text x="275" y="170">K</text>
<text x="285" y="170">S</text>
<text x="295" y="170">/</text>
<text x="305" y="170">d</text>
<text x="315" y="170">m</text>
<text x="325" y="170">)</text>
<line x1="385" y1="160" x2="385" y2="180"/>
<line x1="5" y1="180" x2="5" y2="200"/>
<line x1="5" y1="190" x2="10" y2="190"/>
<line x1="10" y1="190" x2="20" y2="190"/>
<line x1="20" y1="190" x2="30" y2="190"/>
<line x1="30" y1="190" x2="40" y2="190"/>
<line x1="40" y1="190" x2="50" y2="190"/>
<line x1="50" y1="190" x2="60" y2="190"/>
<line x1="60" y1="190" x2="70" y2="190"/>
<line x1="70" y1="190" x2="80" y2="190"/>
<line x1="80" y1="190" x2="90" y2="190"/>
<line x1="90" y1="190" x2="100" y2="190"/>
<line x1="100" y1="190" x2="110" y2="190"/>
<line x1="110" y1="190" x2="120" y2="190"/>
<line x1="120" y1="190" x2="130" y2="190"/>
<line x1="130" y1="190" x2="140" y2="190"/>
<line x1="140" y1="190" x2="150" y2="190"/>
<line x1="150" y1="190" x2="160" y2="190"/>
<line x1="160" y1="190" x2="170" y2="190"/>
<line x1="170" y1="190" x2="180" y2="190"/>
<line x1="180" y1="190" x2="190" y2="190"/>
<line x1="190" y1="190" x2="200" y2="190"/>
<line x1="200" y1="190" x2="210" y2="190"/>
<line x1="210" y1="190" x2="220" y2="190"/>
<line x1="220" y1="190" x2="230" y2="190"/>
<line x1="230" y1="190" x2="240" y2="190"/>
<line x1="240" y1="190" x2="250" y2="190"/>
<line x1="250" y1="190" x2="260" y2="190"/>
<line x1="260" y1="190" x2="270" y2="190"/>
<line x1="270" y1="190" x2="280" y2="190"/>
<line x1="280" y1="190" x2="290" y2="190"/>
<line x1="290" y1="190" x2="300" y2="190"/>
<line x1="300" y1="190" x2="310" y2="190"/>
<line x1="310" y1="190" x2="320" y2="190"/>
<line x1="320" y1="190" x2="330" y2="190"/>
<line x1="330" y1="190" x2="340" y2="190"/>
<line x1="340" y1="190" x2="350" y2="190"/>
<line x1="350" y1="190" x2="360" y2="190"/>
<line x1="360" y1="190" x2="370" y2="190"/>
<line x1="370" y1="190" x2="380" y2="190"/>
<line x1="385" y1="180" x2="385" y2="200"/>
<line x1="380" y1="190" x2="385" y2="190"/>
<line x1="5" y1="200" x2="5" y2="220"/>
<text x="105" y="210">P</text>
<text x="115" y="210">h</text>
<text x="125" y="210">y</text>
<text x="135" y="210">s</text>
<text x="145" y="210">i</text>
<text x="155" y="210">c</text>
<text x="165" y="210">a</text>
<text x="175" y="210">l</text>
<text x="195" y="210">S</text>
<text x="205" y="210">t</text>
<text x="215" y="210">o</text>
<text x="225" y="210">r</text>
<text x="235" y="210">a</text>
<text x="245" y="210">g</text>
<text x="255" y="210">e</text>
<line x1="385" y1="200" x2="385" y2="220"/>
<line x1="5" y1="220" x2="5" y2="240"/>
<text x="95" y="230">(</text>
<text x="105" y="230">e</text>
<text x="115" y="230">n</text>
<text x="125" y="230">c</text>
<text x="135" y="230">r</text>
<text x="145" y="230">y</text>
<text x="155" y="230">p</text>
<text x="165" y="230">t</text>
<text x="175" y="230">e</text>
<text x="185" y="230">d</text>
<text x="205" y="230">a</text>
<text x="215" y="230">t</text>
<text x="235" y="230">r</text>
<text x="245" y="230">e</text>
<text x="255" y="230">s</text>
<text x="265" y="230">t</text>
<text x="275" y="230">)</text>
<line x1="385" y1="220" x2="385" y2="240"/>
<line x1="5" y1="250" x2="10" y2="250"/>
<line x1="5" y1="240" x2="5" y2="250"/>
<line x1="10" y1="250" x2="20" y2="250"/>
<line x1="20" y1="250" x2="30" y2="250"/>
<line x1="30" y1="250" x2="40" y2="250"/>
<line x1="40" y1="250" x2="50" y2="250"/>
<line x1="50" y1="250" x2="60" y2="250"/>
<line x1="60" y1="250" x2="70" y2="250"/>
<line x1="70" y1="250" x2="80" y2="250"/>
<line x1="80" y1="250" x2="90" y2="250"/>
<line x1="90" y1="250" x2="100" y2="250"/>
<line x1="100" y1="250" x2="110" y2="250"/>
<line x1="110" y1="250" x2="120" y2="250"/>
<line x1="120" y1="250" x2="130" y2="250"/>
<line x1="130" y1="250" x2="140" y2="250"/>
<line x1="140" y1="250" x2="150" y2="250"/>
<line x1="150" y1="250" x2="160" y2="250"/>
<line x1="160" y1="250" x2="170" y2="250"/>
<line x1="170" y1="250" x2="180" y2="250"/>
<line x1="180" y1="250" x2="190" y2="250"/>
<line x1="190" y1="250" x2="200" y2="250"/>
<line x1="200" y1="250" x2="210" y2="250"/>
<line x1="210" y1="250" x2="220" y2="250"/>
<line x1="220" y1="250" x2="230" y2="250"/>
<line x1="230" y1="250" x2="240" y2="250"/>
<line x1="240" y1="250" x2="250" y2="250"/>
<line x1="250" y1="250" x2="260" y2="250"/>
<line x1="260" y1="250" x2="270" y2="250"/>
<line x1="270" y1="250" x2="280" y2="250"/>
<line x1="280" y1="250" x2="290" y2="250"/>
<line x1="290" y1="250" x2="300" y2="250"/>
<line x1="300" y1="250" x2="310" y2="250"/>
<line x1="310" y1="250" x2="320" y2="250"/>
<line x1="320" y1="250" x2="330" y2="250"/>
<line x1="330" y1="250" x2="340" y2="250"/>
<line x1="340" y1="250" x2="350" y2="250"/>
<line x1="350" y1="250" x2="360" y2="250"/>
<line x1="360" y1="250" x2="370" y2="250"/>
<line x1="370" y1="250" x2="380" y2="250"/>
<line x1="380" y1="250" x2="385" y2="250"/>
<line x1="385" y1="240" x2="385" y2="250"/>
</svg>
</div>
<h3>Encryption Scope</h3>
<pre class="language-scheme">
;; What gets encrypted
(define encryption-policy
  `((content . always)           ; Object content - always encrypted
    (soup-metadata . optional)   ; Metadata - configurable
    (indexes . optional)         ; Search indexes - configurable
    (audit-log . always)         ; Audit trail - always encrypted
    (keys . never-plaintext)))   ; Keys never stored plaintext
</pre>
</section>
<section>
<h2>Key Hierarchy</h2>
<h3>Key Types</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 600 260" width="600" height="260" xmlns="http://www.w3.org/2000/svg">
<style>
  .diagram line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: square; }
  .diagram rect { fill: currentColor; }
  .diagram text { font-family: monospace; font-size: 14px; fill: currentColor; text-anchor: middle; dominant-baseline: central; }
</style>
<text x="5" y="10">(</text>
<text x="15" y="10">d</text>
<text x="25" y="10">e</text>
<text x="35" y="10">f</text>
<text x="45" y="10">i</text>
<text x="55" y="10">n</text>
<text x="65" y="10">e</text>
<text x="85" y="10">k</text>
<text x="95" y="10">e</text>
<text x="105" y="10">y</text>
<text x="115" y="10">-</text>
<text x="125" y="10">h</text>
<text x="135" y="10">i</text>
<text x="145" y="10">e</text>
<text x="155" y="10">r</text>
<text x="165" y="10">a</text>
<text x="175" y="10">r</text>
<text x="185" y="10">c</text>
<text x="195" y="10">h</text>
<text x="205" y="10">y</text>
<text x="25" y="30">'</text>
<text x="35" y="30">(</text>
<text x="45" y="30">m</text>
<text x="55" y="30">a</text>
<text x="65" y="30">s</text>
<text x="75" y="30">t</text>
<text x="85" y="30">e</text>
<text x="95" y="30">r</text>
<text x="105" y="30">-</text>
<text x="115" y="30">k</text>
<text x="125" y="30">e</text>
<text x="135" y="30">y</text>
<text x="345" y="30">;</text>
<text x="365" y="30">R</text>
<text x="375" y="30">o</text>
<text x="385" y="30">o</text>
<text x="395" y="30">t</text>
<text x="415" y="30">o</text>
<text x="425" y="30">f</text>
<text x="445" y="30">t</text>
<text x="455" y="30">r</text>
<text x="465" y="30">u</text>
<text x="475" y="30">s</text>
<text x="485" y="30">t</text>
<line x1="45" y1="50" x2="50" y2="50"/>
<line x1="45" y1="40" x2="45" y2="50"/>
<line x1="50" y1="50" x2="60" y2="50"/>
<line x1="60" y1="50" x2="70" y2="50"/>
<text x="85" y="50">v</text>
<text x="95" y="50">a</text>
<text x="105" y="50">u</text>
<text x="115" y="50">l</text>
<text x="125" y="50">t</text>
<text x="135" y="50">-</text>
<text x="145" y="50">k</text>
<text x="155" y="50">e</text>
<text x="165" y="50">y</text>
<text x="345" y="50">;</text>
<text x="365" y="50">P</text>
<text x="375" y="50">e</text>
<text x="385" y="50">r</text>
<text x="395" y="50">-</text>
<text x="405" y="50">v</text>
<text x="415" y="50">a</text>
<text x="425" y="50">u</text>
<text x="435" y="50">l</text>
<text x="445" y="50">t</text>
<text x="465" y="50">e</text>
<text x="475" y="50">n</text>
<text x="485" y="50">c</text>
<text x="495" y="50">r</text>
<text x="505" y="50">y</text>
<text x="515" y="50">p</text>
<text x="525" y="50">t</text>
<text x="535" y="50">i</text>
<text x="545" y="50">o</text>
<text x="555" y="50">n</text>
<line x1="85" y1="60" x2="85" y2="80"/>
<line x1="85" y1="70" x2="90" y2="70"/>
<line x1="90" y1="70" x2="100" y2="70"/>
<line x1="100" y1="70" x2="110" y2="70"/>
<text x="125" y="70">c</text>
<text x="135" y="70">o</text>
<text x="145" y="70">n</text>
<text x="155" y="70">t</text>
<text x="165" y="70">e</text>
<text x="175" y="70">n</text>
<text x="185" y="70">t</text>
<text x="195" y="70">-</text>
<text x="205" y="70">k</text>
<text x="215" y="70">e</text>
<text x="225" y="70">y</text>
<text x="345" y="70">;</text>
<text x="365" y="70">O</text>
<text x="375" y="70">b</text>
<text x="385" y="70">j</text>
<text x="395" y="70">e</text>
<text x="405" y="70">c</text>
<text x="415" y="70">t</text>
<text x="435" y="70">e</text>
<text x="445" y="70">n</text>
<text x="455" y="70">c</text>
<text x="465" y="70">r</text>
<text x="475" y="70">y</text>
<text x="485" y="70">p</text>
<text x="495" y="70">t</text>
<text x="505" y="70">i</text>
<text x="515" y="70">o</text>
<text x="525" y="70">n</text>
<line x1="85" y1="80" x2="85" y2="100"/>
<line x1="85" y1="90" x2="90" y2="90"/>
<line x1="90" y1="90" x2="100" y2="90"/>
<line x1="100" y1="90" x2="110" y2="90"/>
<text x="125" y="90">m</text>
<text x="135" y="90">e</text>
<text x="145" y="90">t</text>
<text x="155" y="90">a</text>
<text x="165" y="90">d</text>
<text x="175" y="90">a</text>
<text x="185" y="90">t</text>
<text x="195" y="90">a</text>
<text x="205" y="90">-</text>
<text x="215" y="90">k</text>
<text x="225" y="90">e</text>
<text x="235" y="90">y</text>
<text x="345" y="90">;</text>
<text x="365" y="90">S</text>
<text x="375" y="90">o</text>
<text x="385" y="90">u</text>
<text x="395" y="90">p</text>
<text x="415" y="90">e</text>
<text x="425" y="90">n</text>
<text x="435" y="90">c</text>
<text x="445" y="90">r</text>
<text x="455" y="90">y</text>
<text x="465" y="90">p</text>
<text x="475" y="90">t</text>
<text x="485" y="90">i</text>
<text x="495" y="90">o</text>
<text x="505" y="90">n</text>
<line x1="85" y1="100" x2="85" y2="120"/>
<line x1="85" y1="110" x2="90" y2="110"/>
<line x1="90" y1="110" x2="100" y2="110"/>
<line x1="100" y1="110" x2="110" y2="110"/>
<text x="125" y="110">i</text>
<text x="135" y="110">n</text>
<text x="145" y="110">d</text>
<text x="155" y="110">e</text>
<text x="165" y="110">x</text>
<text x="175" y="110">-</text>
<text x="185" y="110">k</text>
<text x="195" y="110">e</text>
<text x="205" y="110">y</text>
<text x="345" y="110">;</text>
<text x="365" y="110">I</text>
<text x="375" y="110">n</text>
<text x="385" y="110">d</text>
<text x="395" y="110">e</text>
<text x="405" y="110">x</text>
<text x="425" y="110">e</text>
<text x="435" y="110">n</text>
<text x="445" y="110">c</text>
<text x="455" y="110">r</text>
<text x="465" y="110">y</text>
<text x="475" y="110">p</text>
<text x="485" y="110">t</text>
<text x="495" y="110">i</text>
<text x="505" y="110">o</text>
<text x="515" y="110">n</text>
<line x1="85" y1="130" x2="90" y2="130"/>
<line x1="85" y1="120" x2="85" y2="130"/>
<line x1="90" y1="130" x2="100" y2="130"/>
<line x1="100" y1="130" x2="110" y2="130"/>
<text x="125" y="130">a</text>
<text x="135" y="130">u</text>
<text x="145" y="130">d</text>
<text x="155" y="130">i</text>
<text x="165" y="130">t</text>
<text x="175" y="130">-</text>
<text x="185" y="130">k</text>
<text x="195" y="130">e</text>
<text x="205" y="130">y</text>
<text x="215" y="130">)</text>
<text x="225" y="130">)</text>
<text x="345" y="130">;</text>
<text x="365" y="130">A</text>
<text x="375" y="130">u</text>
<text x="385" y="130">d</text>
<text x="395" y="130">i</text>
<text x="405" y="130">t</text>
<text x="425" y="130">l</text>
<text x="435" y="130">o</text>
<text x="445" y="130">g</text>
<text x="465" y="130">e</text>
<text x="475" y="130">n</text>
<text x="485" y="130">c</text>
<text x="495" y="130">r</text>
<text x="505" y="130">y</text>
<text x="515" y="130">p</text>
<text x="525" y="130">t</text>
<text x="535" y="130">i</text>
<text x="545" y="130">o</text>
<text x="555" y="130">n</text>
<text x="5" y="150">(</text>
<text x="15" y="150">d</text>
<text x="25" y="150">e</text>
<text x="35" y="150">f</text>
<text x="45" y="150">i</text>
<text x="55" y="150">n</text>
<text x="65" y="150">e</text>
<text x="85" y="150">(</text>
<text x="95" y="150">d</text>
<text x="105" y="150">e</text>
<text x="115" y="150">r</text>
<text x="125" y="150">i</text>
<text x="135" y="150">v</text>
<text x="145" y="150">e</text>
<text x="155" y="150">-</text>
<text x="165" y="150">k</text>
<text x="175" y="150">e</text>
<text x="185" y="150">y</text>
<text x="205" y="150">p</text>
<text x="215" y="150">a</text>
<text x="225" y="150">r</text>
<text x="235" y="150">e</text>
<text x="245" y="150">n</text>
<text x="255" y="150">t</text>
<text x="275" y="150">p</text>
<text x="285" y="150">u</text>
<text x="295" y="150">r</text>
<text x="305" y="150">p</text>
<text x="315" y="150">o</text>
<text x="325" y="150">s</text>
<text x="335" y="150">e</text>
<text x="345" y="150">)</text>
<text x="25" y="170">"</text>
<text x="35" y="170">D</text>
<text x="45" y="170">e</text>
<text x="55" y="170">r</text>
<text x="65" y="170">i</text>
<text x="75" y="170">v</text>
<text x="85" y="170">e</text>
<text x="105" y="170">c</text>
<text x="115" y="170">h</text>
<text x="125" y="170">i</text>
<text x="135" y="170">l</text>
<text x="145" y="170">d</text>
<text x="165" y="170">k</text>
<text x="175" y="170">e</text>
<text x="185" y="170">y</text>
<text x="205" y="170">f</text>
<text x="215" y="170">r</text>
<text x="225" y="170">o</text>
<text x="235" y="170">m</text>
<text x="255" y="170">p</text>
<text x="265" y="170">a</text>
<text x="275" y="170">r</text>
<text x="285" y="170">e</text>
<text x="295" y="170">n</text>
<text x="305" y="170">t</text>
<text x="315" y="170">"</text>
<text x="25" y="190">(</text>
<text x="35" y="190">h</text>
<text x="45" y="190">k</text>
<text x="55" y="190">d</text>
<text x="65" y="190">f</text>
<text x="75" y="190">-</text>
<text x="85" y="190">s</text>
<text x="95" y="190">h</text>
<text x="105" y="190">a</text>
<text x="115" y="190">2</text>
<text x="125" y="190">5</text>
<text x="135" y="190">6</text>
<text x="155" y="190">p</text>
<text x="165" y="190">a</text>
<text x="175" y="190">r</text>
<text x="185" y="190">e</text>
<text x="195" y="190">n</text>
<text x="205" y="190">t</text>
<text x="155" y="210">s</text>
<text x="165" y="210">a</text>
<text x="175" y="210">l</text>
<text x="185" y="210">t</text>
<text x="195" y="210">:</text>
<text x="215" y="210">(</text>
<text x="225" y="210">p</text>
<text x="235" y="210">u</text>
<text x="245" y="210">r</text>
<text x="255" y="210">p</text>
<text x="265" y="210">o</text>
<text x="275" y="210">s</text>
<text x="285" y="210">e</text>
<text x="295" y="210">-</text>
<text x="305" y="210">&gt;</text>
<text x="315" y="210">s</text>
<text x="325" y="210">a</text>
<text x="335" y="210">l</text>
<text x="345" y="210">t</text>
<text x="365" y="210">p</text>
<text x="375" y="210">u</text>
<text x="385" y="210">r</text>
<text x="395" y="210">p</text>
<text x="405" y="210">o</text>
<text x="415" y="210">s</text>
<text x="425" y="210">e</text>
<text x="435" y="210">)</text>
<text x="155" y="230">i</text>
<text x="165" y="230">n</text>
<text x="175" y="230">f</text>
<text x="185" y="230">o</text>
<text x="195" y="230">:</text>
<text x="215" y="230">(</text>
<text x="225" y="230">s</text>
<text x="235" y="230">t</text>
<text x="245" y="230">r</text>
<text x="255" y="230">i</text>
<text x="265" y="230">n</text>
<text x="275" y="230">g</text>
<text x="285" y="230">-</text>
<text x="295" y="230">&gt;</text>
<text x="305" y="230">u</text>
<text x="315" y="230">t</text>
<text x="325" y="230">f</text>
<text x="335" y="230">8</text>
<text x="355" y="230">(</text>
<text x="365" y="230">s</text>
<text x="375" y="230">y</text>
<text x="385" y="230">m</text>
<text x="395" y="230">b</text>
<text x="405" y="230">o</text>
<text x="415" y="230">l</text>
<text x="425" y="230">-</text>
<text x="435" y="230">&gt;</text>
<text x="445" y="230">s</text>
<text x="455" y="230">t</text>
<text x="465" y="230">r</text>
<text x="475" y="230">i</text>
<text x="485" y="230">n</text>
<text x="495" y="230">g</text>
<text x="515" y="230">p</text>
<text x="525" y="230">u</text>
<text x="535" y="230">r</text>
<text x="545" y="230">p</text>
<text x="555" y="230">o</text>
<text x="565" y="230">s</text>
<text x="575" y="230">e</text>
<text x="585" y="230">)</text>
<text x="595" y="230">)</text>
<text x="155" y="250">l</text>
<text x="165" y="250">e</text>
<text x="175" y="250">n</text>
<text x="185" y="250">g</text>
<text x="195" y="250">t</text>
<text x="205" y="250">h</text>
<text x="215" y="250">:</text>
<text x="235" y="250">3</text>
<text x="245" y="250">2</text>
<text x="255" y="250">)</text>
<text x="265" y="250">)</text>
</svg>
</div>
<h3>Master Key</h3>
<pre class="language-scheme">
;; Master key from key ceremony (Memo-022)
(define (initialize-master-key shares threshold)
  "Reconstruct master key from shares"
  (let ((master (shamir-combine shares threshold)))
    ;; Derive vault key
    (let ((vault-key (derive-key master 'vault)))
      ;; Store encrypted vault key
      (store-encrypted-vault-key vault-key master)
      ;; Clear master from memory
      (secure-clear! master)
      vault-key)))
</pre>
<h3>Key Derivation</h3>
<pre class="language-scheme">
(define (derive-content-key vault-key object-hash)
  "Derive unique key for each object"
  (hkdf-sha256 vault-key
               salt: (string-&gt;utf8 object-hash)
               info: #u8(99 111 110 116 101 110 116)  ; "content"
               length: 32))

(define (derive-chunk-key content-key chunk-index)
  "Derive key for each chunk within object"
  (hkdf-sha256 content-key
               salt: (integer-&gt;bytevector chunk-index)
               info: #u8(99 104 117 110 107)  ; "chunk"
               length: 32))
</pre>
</section>
<section>
<h2>Object Encryption</h2>
<h3>Age Format</h3>
<pre class="language-scheme">
;; Use age for object encryption (Memo-018)
(define (encrypt-object data recipient-keys)
  "Encrypt object using age format"
  (age-encrypt data recipient-keys))

(define (decrypt-object encrypted identity)
  "Decrypt object using age format"
  (age-decrypt encrypted identity))
</pre>
<h3>Symmetric Encryption</h3>
<pre class="language-scheme">
;; For internal encryption with derived keys
(define (encrypt-symmetric data key)
  "Encrypt with ChaCha20-Poly1305"
  (let ((nonce (generate-nonce 12)))
    (let ((ciphertext (chacha20-poly1305-encrypt data key nonce)))
      (bytevector-append nonce ciphertext))))

(define (decrypt-symmetric encrypted key)
  "Decrypt ChaCha20-Poly1305"
  (let ((nonce (subbytevector encrypted 0 12))
        (ciphertext (subbytevector encrypted 12)))
    (chacha20-poly1305-decrypt ciphertext key nonce)))
</pre>
<h3>Streaming Encryption</h3>
<pre class="language-scheme">
(define (encrypt-stream input-port output-port key)
  "Stream encryption for large objects"
  (let ((chunk-size 65536)
        (chunk-index 0))
    (let loop ()
      (let ((chunk (read-bytevector chunk-size input-port)))
        (unless (eof-object? chunk)
          (let ((chunk-key (derive-chunk-key key chunk-index)))
            (write-bytevector (encrypt-symmetric chunk chunk-key) output-port)
            (secure-clear! chunk-key))
          (set! chunk-index (+ chunk-index 1))
          (loop))))))
</pre>
</section>
<section>
<h2>Storage Integration</h2>
<h3>Encrypted CAS</h3>
<pre class="language-scheme">
(define (cas-put-encrypted data)
  "Store encrypted object in CAS"
  (let ((hash (content-hash data))            ; Hash plaintext
         (key (derive-content-key (vault-key) hash))
         (encrypted (encrypt-symmetric data key)))
    (secure-clear! key)
    (storage-put hash encrypted)               ; Store ciphertext
    (soup-put hash encrypted: #t)
    hash))

(define (cas-get-decrypted hash)
  "Retrieve and decrypt object from CAS"
  (let ((encrypted (storage-get hash))
         (key (derive-content-key (vault-key) hash))
         (data (decrypt-symmetric encrypted key)))
    (secure-clear! key)
    ;; Verify hash
    (unless (equal? hash (content-hash data))
      (error "Hash verification failed after decryption"))
    data))
</pre>
<h3>Encrypted Soup</h3>
<pre class="language-scheme">
(define (soup-put-encrypted hash metadata)
  "Store encrypted soup entry"
  (let ((serialized (serialize metadata))
         (key (derive-key (vault-key) 'metadata))
         (encrypted (encrypt-symmetric serialized key)))
    (secure-clear! key)
    (soup-storage-put hash encrypted)))

(define (soup-get-decrypted hash)
  "Retrieve and decrypt soup entry"
  (let ((encrypted (soup-storage-get hash))
         (key (derive-key (vault-key) 'metadata))
         (serialized (decrypt-symmetric encrypted key)))
    (secure-clear! key)
    (deserialize serialized)))
</pre>
<h3>Encrypted Indexes</h3>
<pre class="language-scheme">
;; Searchable encryption for indexes
(define (index-put-encrypted term hash)
  "Add encrypted index entry"
  (let* ((key (derive-key (vault-key) 'index))
         (encrypted-term (deterministic-encrypt term key))
         (encrypted-hash (encrypt-symmetric hash key)))
    (secure-clear! key)
    (index-storage-put encrypted-term encrypted-hash)))

;; Deterministic encryption enables equality search
(define (deterministic-encrypt data key)
  "Deterministic encryption for searchable indexes"
  (let ((derived-key (hkdf-sha256 key salt: data length: 32)))
    (siv-encrypt data derived-key)))
</pre>
</section>
<section>
<h2>Key Management</h2>
<h3>Key Storage</h3>
<pre class="language-scheme">
;; Keys encrypted with master key
(define (store-vault-key vault-key master-key)
  "Store vault key encrypted with master key"
  (let ((encrypted (encrypt-symmetric vault-key master-key)))
    (write-file (vault-key-path) encrypted)))

;; Keys can also be stored as SPKI-encrypted blobs
(define (store-key-for-principal key principal)
  "Store key encrypted for specific principal"
  (let* ((encrypted (age-encrypt key (list (principal-public-key principal))))
         (hash (cas-put encrypted)))
    (soup-put hash
      type: 'encrypted-key
      recipient: principal)
    hash))
</pre>
<h3>Key Rotation</h3>
<pre class="language-scheme">
(define (rotate-vault-key)
  "Rotate vault encryption key"
  (let ((old-key (vault-key))
        (new-key (generate-key 32)))

    (audit-append action: 'key-rotation-start)

    ;; Re-encrypt all objects
    (for-each (lambda (hash)
                (let* ((encrypted (storage-get hash))
                       (data (decrypt-symmetric encrypted old-key))
                       (new-encrypted (encrypt-symmetric data new-key)))
                  (storage-put hash new-encrypted)))
              (all-object-hashes))

    ;; Update vault key
    (set-vault-key! new-key)
    (secure-clear! old-key)

    (audit-append action: 'key-rotation-complete)))
</pre>
<h3>Key Escrow</h3>
<pre class="language-scheme">
;; Threshold key escrow for recovery
(define (escrow-vault-key vault-key custodians threshold)
  "Split vault key among custodians"
  (let ((shares (shamir-split vault-key (length custodians) threshold)))
    (for-each (lambda (custodian share)
                (let ((encrypted-share
                       (age-encrypt share (list (custodian-public-key custodian)))))
                  (send-to-custodian custodian encrypted-share)))
              custodians shares)))

(define (recover-vault-key custodian-shares)
  "Recover vault key from custodian shares"
  (let ((decrypted-shares
         (map (lambda (share custodian)
                (age-decrypt share (custodian-identity custodian)))
              custodian-shares custodians)))
    (shamir-combine decrypted-shares)))
</pre>
</section>
<section>
<h2>Access Control</h2>
<h3>Key Access</h3>
<pre class="language-scheme">
;; Keys protected by capabilities
(spki-cert
  (issuer vault-admin)
  (subject data-processor)
  (capability
    (action decrypt)
    (object (type 'content)))
  (validity (not-after "2027-01-01")))

(define (authorized-decrypt? principal hash)
  "Check if principal can decrypt object"
  (has-capability? principal 'decrypt hash))
</pre>
<h3>Envelope Encryption</h3>
<pre class="language-scheme">
;; Object encrypted with DEK, DEK encrypted with KEK
(define (envelope-encrypt data recipients)
  "Envelope encryption for multiple recipients"
  (let ((dek (generate-key 32))                      ; Data Encryption Key
         (encrypted-data (encrypt-symmetric data dek))
         (encrypted-deks                              ; KEK per recipient
          (map (lambda (recipient)
                 (age-encrypt dek (list recipient)))
               recipients)))
    `(envelope
      (encrypted-data . ,encrypted-data)
      (encrypted-keys . ,encrypted-deks))))

(define (envelope-decrypt envelope identity)
  "Decrypt envelope"
  (let ((encrypted-deks (assoc-ref envelope 'encrypted-keys))
         (dek (find-and-decrypt-dek encrypted-deks identity))
         (encrypted-data (assoc-ref envelope 'encrypted-data)))
    (decrypt-symmetric encrypted-data dek)))
</pre>
</section>
<section>
<h2>Secure Memory</h2>
<h3>Key Handling</h3>
<pre class="language-scheme">
;; Keys must be handled carefully in memory
(define (with-key key-source proc)
  "Use key with automatic cleanup"
  (let ((key (key-source)))
    (dynamic-wind
      (lambda () #t)
      (lambda () (proc key))
      (lambda () (secure-clear! key)))))

(define (secure-clear! bytevector)
  "Securely zero memory"
  (bytevector-fill! bytevector 0)
  ;; Prevent compiler optimization
  (memory-barrier))
</pre>
<h3>Memory Protection</h3>
<pre class="language-scheme">
;; Lock key pages in memory (prevent swap)
(define (allocate-secure-memory size)
  (let ((mem (allocate-memory size)))
    (mlock mem size)
    mem))

(define (free-secure-memory mem size)
  (secure-clear! mem)
  (munlock mem size)
  (free-memory mem))
</pre>
</section>
<section>
<h2>Volume Encryption</h2>
<h3>LUKS Integration</h3>
<pre class="language-scheme">
;; Storage volume encryption
(define (setup-encrypted-volume device passphrase)
  "Initialize LUKS encrypted volume"
  (run-command "cryptsetup" "luksFormat" device)
  (run-command "cryptsetup" "luksOpen" device "vault-storage"))

(define (mount-encrypted-volume passphrase)
  "Mount encrypted storage volume"
  (run-command "cryptsetup" "luksOpen"
               (storage-device)
               "vault-storage"
               stdin: passphrase)
  (run-command "mount" "/dev/mapper/vault-storage" (storage-path)))
</pre>
<h3>Hardware Security Modules</h3>
<pre class="language-scheme">
;; HSM for key protection
(define (hsm-generate-key hsm-slot)
  "Generate key in HSM"
  (pkcs11-generate-key
    session: (hsm-session)
    slot: hsm-slot
    mechanism: 'aes-256
    extractable: #f))

(define (hsm-encrypt data key-handle)
  "Encrypt using HSM-held key"
  (pkcs11-encrypt
    session: (hsm-session)
    key: key-handle
    mechanism: 'aes-gcm
    data: data))
</pre>
</section>
<section>
<h2>Audit</h2>
<h3>Encryption Audit</h3>
<pre class="language-scheme">
(define (audit-encryption-operation op hash principal)
  "Log encryption operation"
  (audit-append
    action: op
    hash: hash
    principal: principal
    timestamp: (current-time)
    ;; Never log keys or plaintext!
    ))

;; Audit all key operations
(define (audit-key-operation op key-id principal)
  (audit-append
    action: op
    key-id: key-id
    principal: principal
    timestamp: (current-time)))
</pre>
<h3>Compliance Reporting</h3>
<pre class="language-scheme">
(define (encryption-compliance-report)
  "Generate encryption compliance report"
  `((total-objects . ,(count-objects))
    (encrypted-objects . ,(count-encrypted-objects))
    (encryption-coverage . ,(/ (count-encrypted-objects) (count-objects)))
    (key-rotation-date . ,(last-key-rotation))
    (algorithm . "ChaCha20-Poly1305")
    (key-length . 256)))
</pre>
</section>
<section>
<h2>Performance</h2>
<h3>Encryption Overhead</h3>
<pre class="language-scheme">
;; Benchmark encryption overhead
(define (benchmark-encryption size iterations)
  (let ((data (generate-random-bytes size))
        (key (generate-key 32)))
    (time-iterations iterations
      (encrypt-symmetric data key))))
</pre>
<h3>Hardware Acceleration</h3>
<pre class="language-scheme">
;; Use AES-NI when available
(define (select-cipher)
  (if (cpu-supports-aes-ni?)
      'aes-256-gcm
      'chacha20-poly1305))
</pre>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Key Compromise</h3>
<pre class="language-scheme">
;; If key is compromised
(define (handle-key-compromise compromised-key-id)
  "Emergency response to key compromise"
  ;; Immediate key rotation
  (rotate-vault-key)

  ;; Audit trail
  (audit-append action: 'key-compromise
                key-id: compromised-key-id
                priority: 'critical)

  ;; Notify administrators
  (alert-key-compromise compromised-key-id)

  ;; Re-encrypt with new key
  (re-encrypt-all-objects))
</pre>
<h3>Side Channels</h3>
<pre class="language-scheme">
;; Constant-time operations
(define (constant-time-compare a b)
  "Compare without timing leaks"
  (let ((result 0))
    (do ((i 0 (+ i 1)))
        ((= i (bytevector-length a)) (= result 0))
      (set! result (bitwise-ior result
                    (bitwise-xor (bytevector-u8-ref a i)
                                 (bytevector-u8-ref b i)))))))
</pre>
</section>
<section>
<h2>References</h2>
<p>1. [age](https://age-encryption.org/) - Modern file encryption 2. [LUKS](https://gitlab.com/cryptsetup/cryptsetup) - Linux Unified Key Setup 3. [Memo-022: Key Ceremony Protocol](memo-022-key-ceremony.html) 4. [Memo-018: Sealed Archive Format](memo-018-sealed-archive.html)</p>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-07</li>
<li>Initial draft</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
