%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Sun Jan 11 10:41:56 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 9
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-041: W)183.864 123 Q
(ormholes \(FUSE Filesystem Lay)-.9 E(er\))-.12 E/F1 10/Times-Italic@0
SF(Libr)260.85 159 Q(ary of Cyber)-.15 E(space)-.1 E/F2 10/Times-Roman@0
SF(2026)296 177 Q F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3 10/Times-Bold@0 SF
2.5(1. Abstract)72 261 R F2 .52(This RFC speci\214es w)72 276.6 R .52(o\
rmholes\342FUSE-based bidirectional portals between the macOS \214lesys\
tem and the Library of)-.1 F .175(Cyberspace v)72 288.6 R .175(ault. W)
-.25 F .175(ormholes preserv)-.8 F 2.675(ef)-.15 G .175
(ull metadata including e)-2.675 F .175(xtended attrib)-.15 F .175
(utes, Finder tags, and A)-.2 F .175(CLs. All oper)-.4 F(-)-.2 E
(ations are auditable \(RFC-003\) and rate-limited \(RFC-032\).[^h1])72
300.6 Q .561([^h1]: Historical: FUSE originated in Linux 2.6 \(2005\), \
inspired by earlier userspace \214lesystem w)72 316.2 R .561
(ork in Plan 9 and)-.1 F(Hurd. macFUSE \(originally MacFUSE\) brought i\
t to macOS in 2007. The abstraction outli)72 328.2 Q -.15(ve)-.25 G 2.5
(dA).15 G(pple')-2.5 E 2.5(sh)-.55 G(ostility.)-2.5 E F3 2.5(2. Moti)72
352.2 R -.1(va)-.1 G(tion).1 E F2 .686(Users need seamless inte)72 367.8
R .686(gration between their e)-.15 F .686
(xisting \214lesystem and the v)-.15 F .687(ault. Manual import/e)-.25 F
.687(xport creates fric-)-.15 F(tion and risks metadata loss.)72 379.8 Q
2.5(Aw)72 395.4 S(ormhole pro)-2.6 E(vides:)-.15 E .412(1. T)72 411 R
(ransparenc)-.35 E 2.912(y\342F)-.15 G(inder)-2.912 E 2.912(,c)-.4 G
.412(p, rsync w)-2.912 F .412(ork unchanged 2. Bidirectionality \342 No\
 separate sync step; it IS the \214lesystem)-.1 F .41
(3. Metadata preserv)72 423 R .41(ation \342 Full macOS attrib)-.25 F
.41(utes captured automatically 4. Content addressing \342 Deduplicatio\
n and)-.2 F(inte)72 435 Q(grity b)-.15 E(uilt-in 5. Security \342 First\
-class SPKI object with audit and rate-limit)-.2 E .95
(The \214lesystem abstraction is the right boundary\342e)72 450.6 R -.15
(ve)-.25 G .949(rything abo).15 F 1.249 -.15(ve i)-.15 H 3.449(t\().15 G
.949(apps, shell, Finder\) w)-3.449 F .949(orks without modi\214ca-)-.1
F(tion.[^d1])72 462.6 Q 1.14([^d1]: Design: FUSE in)72 478.2 R -.15(ve)
-.4 G 1.14
(rts the usual model. Instead of teaching applications about v).15 F
1.14(aults, we teach the v)-.25 F 1.14(ault to)-.25 F
(speak \214lesystem. Unix got this right: e)72 490.2 Q -.15(ve)-.25 G
(rything is a \214le.).15 E F3 2.5(3. W)72 514.2 R
(ormhole as Security Object)-.75 E F2 2.5(Aw)72 529.8 S
(ormhole is a \214rst-class security object in c)-2.6 E
(yberspace, subject to:[^d2])-.15 E 3.443(-S)72 545.4 S .943
(PKI Authorization \(RFC-004\) \342 Opening requires v)-3.443 F .943
(alid certi\214cate - Capability Dele)-.25 F -.05(ga)-.15 G .942
(tion \(RFC-021\) \342 W).05 F(orm-)-.8 E .447(hole access can be dele)
72 557.4 R -.05(ga)-.15 G .447(ted - Audit T).05 F .447(rail \(RFC-003\
\) \342 All operations logged - Rate Limiting \(RFC-032\) \342 Con\214g\
-)-.35 F
(urable ops/minute - Sandboxing \(RFC-023\) \342 Agents access w)72
569.4 Q(ormholes through capabilities)-.1 E .497([^d2]: Design: W)72 585
R .497(ormholes are attack surf)-.8 F .497
(ace. Unrestricted \214lesystem access defeats v)-.1 F .497
(ault security. Ev)-.25 F .496(ery w)-.15 F(ormhole)-.1 E(must be e)72
597 Q(xplicitly authorized, continuously audited, and rate-limited ag)
-.15 E(ainst ab)-.05 E(use.)-.2 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. W)72 84 R(ormhole Certi\214cate)-.75 E/F2 8/Courier@0 SF
(\(define \(wormhole-cert issuer fs-path vault-path permissions\))108
102 Q("Create SPKI certificate authorizing wormhole")117.6 114 Q
(\(create-cert)117.6 126 Q(issuer)122.4 138 Q
(\(wormhole-principal fs-path vault-path\))122.4 150 Q
(`\(tag \(wormhole)122.4 162 Q(\(fs-path ,fs-path\))156 174 Q
(\(vault-path ,vault-path\))156 186 Q(\(permissions ,@permissions\))156
198 Q 4.8(;r)14.4 G(ead, write, delete)-4.8 E(\(rate-limit 1000\))156
210 Q 4.8(;o)62.4 G(ps/minute)-4.8 E
(\(expires ,\(+ \(current-seconds\) 86400\)\)\)\)\)\))156 222 Q F1 2.5
(3.2. Capability)72 240 R(Model)2.5 E F0 -.8(Wo)72 255.6 S
(rmholes support \214ne-grained capabilities:[^d3]).8 E 1.103
([^d3]: Design: Rich capabilities enable principle of least pri)72 271.2
R(vile)-.25 E 1.104(ge. A backup agent needs read-only; a sync agent)
-.15 F(needs read-write b)72 283.2 Q
(ut not delete. Capabilities compose\342grant e)-.2 E(xactly what')-.15
E 2.5(sn)-.55 G(eeded.)-2.5 E -.8(Ta)72 298.8 S(ble 0: W).8 E
(ormhole Capabilities)-.8 E .62(center box; l l l.)72 316.8 R 6.45
(Capability Allo)5.62 F .619(ws Data Access read)-.25 F .619
(Read \214le contents write)8.409 F .619
(Write/modify \214le contents create)5.069 F .02(Create ne)95.63 328.8 R
2.52<778c>-.25 G .02(les delete)-2.52 F(Remo)26.14 E .32 -.15(ve \214)
-.15 H .02(les rename).15 F(Rename/mo)20.59 E .32 -.15(ve \214)-.15 H
.02(les Metadata stat).15 F .02(Read POSIX attrib-)11.13 F 1.561
(utes chmod)72 340.8 R 1.561(Modify permissions cho)24.341 F 22.651
(wn Change)-.25 F -.25(ow)4.061 G 1.561(nership xattr).25 F 10.391
(-read Read)-.2 F -.15(ex)4.061 G 1.561(tended attrib).15 F 1.56
(utes xattr)-.2 F(-)-.2 E 13.924(write Modify)72 352.8 R -.15(ex)3.104 G
.604(tended attrib).15 F .604(utes acl-read)-.2 F .604(Read A)18.404 F
.604(CLs acl-write)-.4 F .604(Modify A)15.064 F .604
(CLs Directory readdir)-.4 F(List)22.285 E 1.173
(directory contents mkdir)72 364.8 R 1.173(Create directories rmdir)
27.283 F(Remo)3.953 E 1.473 -.15(ve d)-.15 H 1.173
(irectories Control admin).15 F 1.172(Con\214gure w)26.172 F(orm-)-.1 E
.337(hole dele)72 376.8 R -.05(ga)-.15 G 14.717(te Dele).05 F -.05(ga)
-.15 G .338(te capabilities to others audit-read).05 F .338(Read w)9.798
F .338(ormhole audit log rate-limit)-.1 F .338(Modify rate lim-)13.118 F
(its)72 388.8 Q F1 2.5(3.3. Capability)72 406.8 R(Composition)2.5 E F2
(;; Common capability sets \(long form for readability\))108 424.8 Q
(\(define capability:read-only)108 436.8 Q
('\(read stat readdir xattr-read acl-read\)\))117.6 448.8 Q
(\(define capability:read-write)108 472.8 Q('\(read write create stat c\
hmod readdir mkdir xattr-read xattr-write\)\))117.6 484.8 Q
(\(define capability:full)108 508.8 Q
('\(read write create delete rename)117.6 520.8 Q(stat chmod chown)127.2
532.8 Q(xattr-read xattr-write acl-read acl-write)127.2 544.8 Q
(readdir mkdir rmdir admin delegate audit-read rate-limit\)\))127.2
556.8 Q(\(define capability:backup)108 580.8 Q
('\(read stat readdir xattr-read acl-read\)\))117.6 592.8 Q
(\(define capability:synchronize)108 616.8 Q
('\(read write create delete rename)117.6 628.8 Q
(stat chmod readdir mkdir rmdir)127.2 640.8 Q
(xattr-read xattr-write\)\))127.2 652.8 Q F1 2.5(3.4. Capability)72
670.8 R(Attenuation)2.5 E F0(Capabilities can only be reduced, ne)72
686.4 Q -.15(ve)-.25 G 2.5(ra).15 G(mpli\214ed:[^r1])-2.5 E .329([^r1]:\
 Research: Capability attenuation is fundamental to the object-capabili\
ty model. See Miller)72 702 R 2.829(,")-.4 G(Rob)-2.829 E .329
(ust Composi-)-.2 F 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R(tion" \(2006\). Y)72 84
Q(ou cannot grant more authority than you possess.)-1.1 E/F1 8/Courier@0
SF(\(define \(wormhole-delegate wormhole new-caps recipient\))108 102 Q
("Delegate subset of wormhole capabilities")117.6 114 Q
(\(let \(\(my-caps \(wormhole-capabilities wormhole\)\)\))117.6 126 Q
(\(unless \(subset? new-caps my-caps\))127.2 138 Q
(\(error 'capability-amplification)136.8 150 Q
("Cannot delegate capabilities you don't have"\)\))170.4 162 Q
(\(wormhole-cert)127.2 174 Q(\(wormhole-issuer wormhole\))132 186 Q
(\(wormhole-fs-path wormhole\))132 198 Q
(\(wormhole-vault-path wormhole\))132 210 Q(new-caps)132 222 Q
(recipient: recipient\)\)\))132 234 Q/F2 10/Times-Bold@0 SF 2.5
(3.5. Opening)72 252 R 2.5(aW)2.5 G(ormhole)-3.25 E F1
(\(define \(wormhole-open fs-path #!key \(vault-path "/"\))108 270 Q
(\(capabilities capability:read-write\))285.6 282 Q(\(rate-limit 1000\))
285.6 294 Q(\(locked #f\))285.6 306 Q(\(auth-required '\(\)\))285.6 318
Q(\(certificate #f\)\))285.6 330 Q
("Open wormhole - requires valid certificate")117.6 342 Q
(\(unless certificate)117.6 354 Q
(\(error 'unauthorized "Wormhole requires SPKI certificate"\)\))127.2
366 Q(\(unless \(verify-wormhole-cert certificate fs-path vault-path\))
117.6 378 Q(\(error 'unauthorized "Invalid wormhole certificate"\)\))
127.2 390 Q(;; Audit the open)117.6 402 Q
(\(wormhole-audit 'wormhole-open fs-path)117.6 414 Q
(`\(\(vault ,vault-path\))194.4 426 Q
(\(capabilities ,\(length capabilities\)\)\)\))204 438 Q
(;; Proceed with FUSE mount)117.6 450 Q(...\))117.6 462 Q F2 2.5
(3.6. Usage)72 480 R(Examples)2.5 E F1(;; Basic read-write wormhole)108
498 Q(\(wormhole-open "~/Cyberspace"\))108 510 Q
(;; Read-only wormhole for browsing)108 534 Q
(\(wormhole-open "~/Archive" capabilities: capability:read-only\))108
546 Q(;; Sync wormhole with rate limiting)108 570 Q
(\(wormhole-open "~/Sync")108 582 Q
(capabilities: capability:synchronize)117.6 594 Q(rate-limit: 500\))
117.6 606 Q
(;; Locked wormhole requiring unlock for sensitive operations)108 630 Q
(\(wormhole-open "~/Secure")108 642 Q(capabilities: capability:full)
117.6 654 Q(locked: #t)117.6 666 Q(auth-required: '\(delete admin\)\))
117.6 678 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4. Ar)72 84 R(chitectur)-.18 E(e)-.18 E 2.5(4.1. Mount)72 108 R -.92
(To)2.5 G(pology).92 E/F2 8/Courier@0 SF 91.2(~/Cyberspace/ \342)108 126
R(FUSE mount point)4.8 E(\342\342\342 documents/)108 138 Q 14.4<e2e2>108
150 S(\342\342 paper.pdf)-14.4 E 4.8<e256>72 G
(irtual file \(content in vault\))-4.8 E 14.4<e2e2>108 162 S
(\342\342 notes.txt)-14.4 E(\342\342\342 projects/)108 174 Q 14.4<e2e2>
108 186 S(\342\342 cyberspace/)-14.4 E 33.6<e2e2>108 198 S(\342\342 ...)
-33.6 E(\342\342\342 .vault/)108 210 Q 4.8<e248>105.6 G
(idden, actual storage)-4.8 E(\342\342\342 objects/)127.2 222 Q 4.8
<e243>81.6 G(ontent-addressed blobs)-4.8 E 14.4<e2e2>127.2 234 S
(\342\342 sha256:abc123...)-14.4 E 14.4<e2e2>127.2 246 S
(\342\342 sha256:def456...)-14.4 E(\342\342\342 manifests/)127.2 258 Q
4.8<e244>72 G(irectory \342 file mappings)-4.8 E(\342\342\342 metadata/)
127.2 270 Q 4.8<e250>76.8 G(er-file metadata store)-4.8 E F1 2.5
(4.2. Component)72 288 R(Stack)2.5 E F2<e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2>108 306 Q 43.2<e241>108
318 S 72(pplications \342)-43.2 F 19.2<e228>108 330 S
(Finder, cp, rsync, etc.\))-19.2 E<e2>38.4 E<e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2a4>108 342 Q 43.2
<e256>108 354 S(FS \(kernel\))-43.2 E<e2>76.8 E<e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2a4>108 366 Q 28.8
<e246>108 378 S(USE-T / macFUSE)-28.8 E<e2>72 E<e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2a4>108 390 Q 19.2
<e263>108 402 S(yberspace-fuse daemon)-19.2 E 9.6<e2e2>52.8 G(Our code)
-4.8 E<e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2a4>108 414 Q 43.2<e256>108 426 S(ault layer)-43.2 E<e2>
81.6 E 14.4<e228>108 438 S(content-address, metadata\))-14.4 E<e2>33.6 E
<e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2>108 450 Q F1 2.5(5. Metadata)72 468 R(Pr)2.5 E(eser)-.18 E -.1
(va)-.1 G(tion).1 E 2.5(5.1. macOS)72 492 R(Metadata Captur)2.5 E(ed)
-.18 E F0 -.8(Ta)72 507.6 S(ble 1: Preserv).8 E(ed Metadata)-.15 E .706
(center box; l l l.)72 525.6 R(Cate)5.706 E 11.696(gory Attrib)-.15 F
8.406(utes Capture)-.2 F .706(Method POSIX)3.206 F .706
(mode, uid, gid, size)21.816 F .706(stat\(\) T)22.376 F(imestamps)-.35 E
1.36(mtime, atime, ctime, birthtime)95.96 537.6 R 1.359
(stat\(\) Extended attrs)21.599 F 1.359(Finder info, tags, quarantine)
18.869 F 1.359(listxattr\(\), getx-)13.319 F 1.617(attr\(\) Spotlight)72
549.6 R 1.617(kMDItem* metadata)14.937 F 1.617(mdls / MDItem API A)
18.577 F 25.628(CLs Access)-.4 F 1.618(control lists)4.118 F
(aclget\214le\(\))23.848 E 10.134(Flags hidden,)72 561.6 R(lock)3.713 E
1.213(ed, immutable)-.1 F 1.213(ch\215ags\(\) / stat\(\) Resource fork)
19.653 F(Le)19.843 E -.05(ga)-.15 G 1.513 -.15(cy r).05 H 1.213
(esource data).15 F 1.213(xattr com.ap-)16.603 F(ple.ResourceF)72 573.6
Q(ork)-.15 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.2. Inter)72 84 R(nal Repr)-.15 E(esentation)-.18 E/F2 8/Courier@0
SF(\(define-record-type <vault-file>)108 102 Q
(\(make-vault-file path content-hash metadata\))117.6 114 Q(vault-file?)
117.6 126 Q(\(path vault-file-path\))117.6 138 Q
(\(content-hash vault-file-hash\))117.6 150 Q
(\(metadata vault-file-metadata\)\))117.6 162 Q
(\(define \(capture-metadata path\))108 186 Q
("Capture all macOS metadata for a file")117.6 198 Q(`\(\(posix)117.6
210 Q(\(mode ,\(file-mode path\)\))132 222 Q(\(uid ,\(file-uid path\)\))
132 234 Q(\(gid ,\(file-gid path\)\))132 246 Q
(\(size ,\(file-size path\)\))132 258 Q(\(mtime ,\(file-mtime path\)\))
132 270 Q(\(atime ,\(file-atime path\)\))132 282 Q
(\(ctime ,\(file-ctime path\)\))132 294 Q
(\(birthtime ,\(file-birthtime path\)\)\))132 306 Q
(\(xattr ,\(capture-xattrs path\)\))127.2 318 Q
(\(flags ,\(capture-flags path\)\))127.2 330 Q
(\(acl ,\(capture-acl path\)\)\)\))127.2 342 Q F1 2.5(5.3. Restoration)
72 360 R F2(\(define \(restore-metadata path metadata\))108 378 Q
("Restore all metadata to a file")117.6 390 Q
(\(let \(\(posix \(alist-ref 'posix metadata\)\))117.6 402 Q
(\(xattr \(alist-ref 'xattr metadata\)\))146.4 414 Q
(\(flags \(alist-ref 'flags metadata\)\))146.4 426 Q
(\(acl \(alist-ref 'acl metadata\)\)\))146.4 438 Q
(\(restore-posix path posix\))127.2 450 Q(\(restore-xattrs path xattr\))
127.2 462 Q(\(restore-flags path flags\))127.2 474 Q
(\(restore-acl path acl\)\)\))127.2 486 Q F1 2.5(6. FUSE)72 504 R
(Operations)2.5 E 2.5(6.1. Requir)72 528 R(ed Operations)-.18 E F0 -.8
(Ta)72 543.6 S(ble 2: FUSE Operations).8 E .72(center box; l l l.)72
561.6 R 8.23(Operation Purpose)5.72 F -1.11(Va)18.5 G .72
(ult Action getattr)1.11 F 2.67(stat\(\) Return)25.17 F .72
(stored metadata readdir)3.22 F(List)22.4 E 11.084(directory Read)72
573.6 R 1.044(manifest open)3.544 F 1.044(Open \214le)6.604 F -1.11(Va)
14.103 G 1.043(lidate hash e)1.11 F 1.043(xists read)-.15 F 1.043
(Read content)8.833 F 1.043(Fetch by content hash)23.553 F 14.663
(write Write)72 585.6 R 18.653(content Content-address,)3.363 F .863
(update manifest create)3.363 F .863(Create \214le)26.993 F .864
(Allocate manifest entry un-)9.484 F 8.386(link Delete)72 597.6 R 6.256
(\214le Remo)2.636 F .436 -.15(ve f)-.15 H .136
(rom manifest \(GC later\) mkdir).15 F .136(Create directory)26.246 F
.136(Create manifest node rmdir)10.436 F(Re-)2.916 E(mo)72 609.6 Q 1.595
-.15(ve d)-.15 H 21.795(irectory Remo).15 F 1.595 -.15(ve m)-.15 H 1.295
(anifest node rename).15 F(Mo)21.865 E -.15(ve)-.15 G 18.556
(/rename Update).15 F 1.296(manifest path setxattr)3.796 F(Set)21.856 E
-.15(ex)72 621.6 S 1.453(tended attr).15 F 1.453
(Store in metadata getxattr)22.643 F 1.453(Get e)20.903 F 1.453
(xtended attr)-.15 F(Retrie)7.733 E 1.753 -.15(ve f)-.25 H 1.453
(rom metadata listxattr).15 F 1.452(List e)20.892 F(x-)-.15 E
(tended attrs)72 633.6 Q(Enumerate metadata)2.6 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.2. Implementation)72 84 R(Sk)2.5 E(etch)-.1 E/F2 8/Courier@0 SF
(\(define \(fuse-getattr path\))108 102 Q
("Return file attributes from vault metadata")117.6 114 Q
(\(let \(\(entry \(manifest-lookup path\)\)\))117.6 126 Q(\(if entry)
127.2 138 Q(\(let \(\(meta \(vault-file-metadata entry\)\)\))146.4 150 Q
(\(make-stat)156 162 Q(\(alist-ref 'mode \(alist-ref 'posix meta\)\))
160.8 174 Q(\(alist-ref 'size \(alist-ref 'posix meta\)\))160.8 186 Q
(\(alist-ref 'mtime \(alist-ref 'posix meta\)\))160.8 198 Q(...\)\))
160.8 210 Q(-ENOENT\)\)\))146.4 222 Q
(\(define \(fuse-read path size offset\))108 246 Q
("Read file content from vault")117.6 258 Q
(\(let \(\(entry \(manifest-lookup path\)\))117.6 270 Q
(\(hash \(vault-file-hash entry\)\))151.2 282 Q
(\(content \(vault-fetch hash\)\)\))151.2 294 Q
(\(subbytes content offset \(+ offset size\)\)\)\))127.2 306 Q
(\(define \(fuse-write path data offset\))108 330 Q
("Write to file, content-address the result")117.6 342 Q
(\(let \(\(entry \(manifest-lookup path\)\))117.6 354 Q
(\(current \(vault-fetch \(vault-file-hash entry\)\)\))151.2 366 Q
(\(updated \(bytes-splice current offset data\)\))151.2 378 Q
(\(new-hash \(content-address updated\)\)\))151.2 390 Q
(\(manifest-update! path new-hash\))127.2 402 Q
(\(string-length data\)\)\))127.2 414 Q
(\(define \(fuse-setxattr path name value\))108 438 Q
("Store extended attribute in vault metadata")117.6 450 Q
(\(let \(\(entry \(manifest-lookup path\)\)\))117.6 462 Q
(\(metadata-set-xattr! entry name value\))127.2 474 Q(0\)\))127.2 486 Q
F1 2.5(7. Content)72 504 R(Addr)2.5 E(essing)-.18 E F0
(Files are stored by content hash \(RFC-020\):)72 519.6 Q F2
(\(define \(content-address data\))108 537.6 Q
("Store data, return hash")117.6 549.6 Q
(\(let* \(\(hash \(sha256 data\)\))117.6 561.6 Q
(\(path \(vault-object-path hash\)\)\))151.2 573.6 Q
(\(unless \(file-exists? path\))127.2 585.6 Q
(\(write-blob path data\)\))136.8 597.6 Q(hash\)\))127.2 609.6 Q
(\(define \(vault-fetch hash\))108 633.6 Q("Retrieve data by hash")117.6
645.6 Q(\(read-blob \(vault-object-path hash\)\)\))117.6 657.6 Q F0 .827
(Bene\214ts: - Identical \214les stored once \(deduplication\) - Inte)72
675.6 R .827(grity v)-.15 F .827(eri\214cation on e)-.15 F -.15(ve)-.25
G .827(ry read - Immutable objects en-).15 F(able safe caching)72 687.6
Q 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(8. Synchr)72 84 R(onization)-.18 E 2.5(8.1. Change)72 108 R
(Detection)2.5 E F0(The FUSE layer captures all writes in real-time. No\
 separate sync needed for local changes.)72 123.6 Q -.15(Fo)72 139.2 S
2.5(rm).15 G(ulti-de)-2.5 E(vice sync, the manifest includes v)-.25 E
(ersion v)-.15 E(ectors \(RFC-012\):)-.15 E/F2 8/Courier@0 SF
(\(define \(manifest-entry path hash metadata\))108 157.2 Q(`\(entry)
117.6 169.2 Q(\(path ,path\))127.2 181.2 Q(\(hash ,hash\))127.2 193.2 Q
(\(metadata ,metadata\))127.2 205.2 Q
(\(version-vector ,local-node ,lamport-clock\)\)\))127.2 217.2 Q F1 2.5
(8.2. Con\215ict)72 235.2 R(Resolution)2.5 E F0(When mer)72 250.8 Q
(ging manifests from dif)-.18 E(ferent de)-.25 E
(vices \(RFC-016 lazy clustering\):)-.25 E .48
(1. Same hash \342 No con\215ict \(identical content\) 2. Dif)72 266.4 R
.48(ferent hash, one ne)-.25 F .48(wer \342 T)-.25 F(ak)-.8 E 2.98(en)
-.1 G -.25(ew)-2.98 G .48(er 3. Dif).25 F .48(ferent hash, concur)-.25 F
(-)-.2 E(rent \342 Con\215ict, apply lazy-resolv)72 278.4 Q(e)-.15 E F2
(\(define \(merge-manifests local remote\))108 296.4 Q(\(for-each)117.6
308.4 Q(\(lambda \(path\))122.4 320.4 Q
(\(let \(\(l \(manifest-lookup local path\)\))132 332.4 Q
(\(r \(manifest-lookup remote path\)\)\))160.8 344.4 Q(\(cond)141.6
356.4 Q(\(\(not l\) \(manifest-add! local r\)\))146.4 368.4 Q
(\(\(not r\) 'keep-local\))146.4 380.4 Q
(\(\(equal? \(vault-file-hash l\) \(vault-file-hash r\)\) 'identical\))
146.4 392.4 Q(\(\(version-newer? r l\) \(manifest-update! local r\)\))
146.4 404.4 Q(\(\(version-newer? l r\) 'keep-local\))146.4 416.4 Q
(\(else \(queue-conflict! path l r\)\)\)\)\))146.4 428.4 Q
(\(union \(manifest-paths local\) \(manifest-paths remote\)\)\)\))122.4
440.4 Q F1 2.5(9. Mount)72 458.4 R(Commands)2.5 E 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.1. REPL)72 84 R(Interface)2.5 E/F2 8/Courier@0 SF
(\(define \(vault-mount point\))108 102 Q
("Mount vault at filesystem path")117.6 114 Q(\(fuse-main point)117.6
126 Q(`\(\(getattr . ,fuse-getattr\))127.2 138 Q
(\(readdir . ,fuse-readdir\))136.8 150 Q(\(open . ,fuse-open\))136.8 162
Q(\(read . ,fuse-read\))136.8 174 Q(\(write . ,fuse-write\))136.8 186 Q
(\(create . ,fuse-create\))136.8 198 Q(\(unlink . ,fuse-unlink\))136.8
210 Q(\(mkdir . ,fuse-mkdir\))136.8 222 Q(\(rmdir . ,fuse-rmdir\))136.8
234 Q(\(rename . ,fuse-rename\))136.8 246 Q
(\(setxattr . ,fuse-setxattr\))136.8 258 Q
(\(getxattr . ,fuse-getxattr\))136.8 270 Q
(\(listxattr . ,fuse-listxattr\)\)\)\))136.8 282 Q
(\(define \(vault-unmount point\))108 306 Q("Unmount vault filesystem")
117.6 318 Q(\(fuse-unmount point\)\))117.6 330 Q F1 2.5(9.2. Command)72
348 R(Line)2.5 E F2 4.8(#M)108 366 S(ount)-4.8 E
(cyberspace mount ~/Cyberspace)108 378 Q 4.8(#U)108 402 S(nmount)-4.8 E
(cyberspace unmount ~/Cyberspace)108 414 Q 4.8(#O)108 438 S 4.8(rv)-4.8
G(ia REPL)-4.8 E 4.8($.)108 450 S(/cyberspace-repl)-4.8 E 4.8(>\()108
462 S(vault-mount "~/Cyberspace"\))-4.8 E
(Mounted vault at /Users/ddp/Cyberspace)108 474 Q F1 2.5(10. macOS)72
492 R(Integration)2.5 E 2.5(10.1. FUSE-T)72 516 R(vs macFUSE)2.5 E F0
-.8(Ta)72 531.6 S(ble 3: FUSE Implementation Options).8 E .552
(center box; l l l.)72 549.6 R 18.063(Feature macFUSE)5.552 F .553
(FUSE-T K)9.443 F .553(ernel e)-.25 F 5.413(xtension Y)-.15 F .553
(es \(deprecated\))-1 F .553(No System e)8.533 F 2.923(xtension Op-)-.15
F 2.202(tional Uses)72 561.6 R 1.322(NFS SIP compatible)3.822 F 1.322
(Requires disable)14.932 F -1(Ye)9.942 G 3.822(sP)1 G 22.732
(erformance Better)-3.822 F 1.321(Adequate Maintenance)26.881 F(Acti)
92.85 573.6 Q 9.5 -.15(ve A)-.25 H(cti).15 E -.15(ve)-.25 G
(FUSE-T recommended for ne)72 591.6 Q 2.5(wi)-.25 G
(nstallations\342no k)-2.5 E(ernel e)-.1 E(xtension required.[^i1])-.15
E .746([^i1]: Implementation: FUSE-T implements FUSE API o)72 607.2 R
-.15(ve)-.15 G 3.246(rN).15 G .747(FS loopback. Slightly higher latenc)
-3.246 F 3.247(yb)-.15 G .747(ut a)-3.447 F -.2(vo)-.2 G .747(ids Ap-).2
F(ple')72 619.2 Q 2.5(sk)-.55 G(ernel e)-2.6 E(xtension hostility.)-.15
E F1 2.5(10.2. Installation)72 643.2 R F2 4.8(#F)108 661.2 S
(USE-T \(recommended\))-4.8 E(brew install fuse-t)108 673.2 Q 4.8(#O)108
697.2 S 4.8(rm)-4.8 G(acFUSE \(if kernel ext acceptable\))-4.8 E
(brew install macfuse)108 709.2 Q 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(10.3. Finder)72 84 R(Integration)2.5 E F0(The mount appears as a re)
72 99.6 Q(gular v)-.15 E(olume in Finder. Optional .V)-.2 E
(olumeIcon.icns for custom icon.)-1.29 E .951(Spotlight inde)72 115.2 R
.951(xing can be enabled by implementing getxattr for com.apple.FinderI\
nfo and related Spotlight attrib-)-.15 F(utes.)72 127.2 Q F1 2.5
(11. Security)72 151.2 R(Considerations)2.5 E 2.5(11.1. P)72 175.2 R
(ermissions)-.2 E F0(FUSE daemon runs as user)72 190.8 Q 2.5(,n)-.4 G
(ot root. Respects v)-2.5 E(ault A)-.25 E(CLs.)-.4 E F1 2.5
(11.2. Content)72 214.8 R(Integrity)2.5 E F0(Ev)72 230.4 Q(ery read v)
-.15 E(eri\214es content hash. Corruption detected immediately.)-.15 E
F1 2.5(11.3. Metadata)72 254.4 R -.74(Tr)2.5 G(ust).74 E F0 .632(Metada\
ta is stored separately from content. A compromised metadata store cann\
ot alter \214le contents \(hashes w)72 270 R(on')-.1 E(t)-.18 E
(match\).)72 282 Q F1 2.5(11.4. Mount)72 306 R(Security)2.5 E/F2 8
/Courier@0 SF(\(define \(vault-mount point #!key \(allow-other #f\)\))
108 324 Q(;; allow-other permits other users to access mount)117.6 336 Q
(;; Default: owner only)117.6 348 Q(...\))117.6 360 Q F1 2.5
(12. Dependencies)72 378 R .521(center box; l l l.)72 396 R 23.021
(Component Pur)5.521 F .521(pose FUSE-T or macFUSE)-.1 F .52
(Userspace \214lesystem libfuse)7.191 F .52(FUSE li-)22.18 F
(brary Scheme FFI)72 408 Q(Bindings to libfuse)23.62 E 2.5(13. Refer)72
426 R(ences)-.18 E F0 .294(1. RFC-012: Lamport Clocks 2. RFC-016: Lazy \
Clustering 3. RFC-020: Content-Addressed Storage 4. FUSE docu-)72 441.6
R(mentation: https://libfuse.github.io/ 5. FUSE-T)72 453.6 Q 2.5(:h)-.5
G(ttps://github.com/macos-fuse-t/fuse-t)-2.5 E F1 2.5(14. Changelog)72
477.6 R F0 2.5(-2)72 493.2 S(026-01-07 - Initial speci\214cation)-2.5 E
0 Cg EP
%%Trailer
end
%%EOF
