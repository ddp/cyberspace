%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Tue Jan 13 01:55:36 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 10
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-041: W)183.864 123 Q
(ormholes \(FUSE Filesystem Lay)-.9 E(er\))-.12 E/F1 10/Times-Italic@0
SF(Libr)260.85 159 Q(ary of Cyber)-.15 E(space)-.1 E/F2 10/Times-Roman@0
SF(2026)296 177 Q F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3 10/Times-Bold@0 SF
2.5(1. Abstract)72 261 R F2 .52(This RFC speci\214es w)72 276.6 R .52(o\
rmholes\342FUSE-based bidirectional portals between the macOS \214lesys\
tem and the Library of)-.1 F .175(Cyberspace v)72 288.6 R .175(ault. W)
-.25 F .175(ormholes preserv)-.8 F 2.675(ef)-.15 G .175
(ull metadata including e)-2.675 F .175(xtended attrib)-.15 F .175
(utes, Finder tags, and A)-.2 F .175(CLs. All oper)-.4 F(-)-.2 E
(ations are auditable \(RFC-003\) and rate-limited \(RFC-032\).[^h1])72
300.6 Q .561([^h1]: Historical: FUSE originated in Linux 2.6 \(2005\), \
inspired by earlier userspace \214lesystem w)72 316.2 R .561
(ork in Plan 9 and)-.1 F(Hurd. macFUSE \(originally MacFUSE\) brought i\
t to macOS in 2007. The abstraction outli)72 328.2 Q -.15(ve)-.25 G 2.5
(dA).15 G(pple')-2.5 E 2.5(sh)-.55 G(ostility.)-2.5 E F3 2.5(2. Moti)72
352.2 R -.1(va)-.1 G(tion).1 E F2 .686(Users need seamless inte)72 367.8
R .686(gration between their e)-.15 F .686
(xisting \214lesystem and the v)-.15 F .687(ault. Manual import/e)-.25 F
.687(xport creates fric-)-.15 F(tion and risks metadata loss.)72 379.8 Q
2.5(Aw)72 395.4 S(ormhole pro)-2.6 E(vides:)-.15 E .412(1. T)72 411 R
(ransparenc)-.35 E 2.912(y\342F)-.15 G(inder)-2.912 E 2.912(,c)-.4 G
.412(p, rsync w)-2.912 F .412(ork unchanged 2. Bidirectionality \342 No\
 separate sync step; it IS the \214lesystem)-.1 F .41
(3. Metadata preserv)72 423 R .41(ation \342 Full macOS attrib)-.25 F
.41(utes captured automatically 4. Content addressing \342 Deduplicatio\
n and)-.2 F(inte)72 435 Q(grity b)-.15 E(uilt-in 5. Security \342 First\
-class SPKI object with audit and rate-limit)-.2 E .95
(The \214lesystem abstraction is the right boundary\342e)72 450.6 R -.15
(ve)-.25 G .949(rything abo).15 F 1.249 -.15(ve i)-.15 H 3.449(t\().15 G
.949(apps, shell, Finder\) w)-3.449 F .949(orks without modi\214ca-)-.1
F(tion.[^d1])72 462.6 Q 1.14([^d1]: Design: FUSE in)72 478.2 R -.15(ve)
-.4 G 1.14
(rts the usual model. Instead of teaching applications about v).15 F
1.14(aults, we teach the v)-.25 F 1.14(ault to)-.25 F
(speak \214lesystem. Unix got this right: e)72 490.2 Q -.15(ve)-.25 G
(rything is a \214le.).15 E F3 2.5(3. W)72 514.2 R
(ormhole as Security Object)-.75 E F2 2.5(Aw)72 529.8 S
(ormhole is a \214rst-class security object in c)-2.6 E
(yberspace, subject to:[^d2])-.15 E 6.5<8353>72 545.4 S
(PKI Authorization \(RFC-004\) \342 Opening requires v)-6.5 E
(alid certi\214cate)-.25 E 6.5<8343>72 561 S(apability Dele)-6.5 E -.05
(ga)-.15 G(tion \(RFC-021\) \342 W).05 E(ormhole access can be dele)-.8
E -.05(ga)-.15 G(ted).05 E 6.5<8341>72 576.6 S(udit T)-6.5 E
(rail \(RFC-003\) \342 All operations logged)-.35 E 6.5<8352>72 592.2 S
(ate Limiting \(RFC-032\) \342 Con\214gurable ops/minute)-6.5 E 6.5
<8353>72 607.8 S(andboxing \(RFC-023\) \342 Agents access w)-6.5 E
(ormholes through capabilities)-.1 E .497([^d2]: Design: W)72 627 R .497
(ormholes are attack surf)-.8 F .497
(ace. Unrestricted \214lesystem access defeats v)-.1 F .497
(ault security. Ev)-.25 F .496(ery w)-.15 F(ormhole)-.1 E(must be e)72
639 Q(xplicitly authorized, continuously audited, and rate-limited ag)
-.15 E(ainst ab)-.05 E(use.)-.2 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. W)72 84 R(ormhole Certi\214cate)-.75 E/F2 8/Courier@0 SF
(\(define \(wormhole-cert issuer fs-path vault-path permissions\))108
102 Q("Create SPKI certificate authorizing wormhole")117.6 114 Q
(\(create-cert)117.6 126 Q(issuer)122.4 138 Q
(\(wormhole-principal fs-path vault-path\))122.4 150 Q
(`\(tag \(wormhole)122.4 162 Q(\(fs-path ,fs-path\))156 174 Q
(\(vault-path ,vault-path\))156 186 Q(\(permissions ,@permissions\))156
198 Q 4.8(;r)14.4 G(ead, write, delete)-4.8 E(\(rate-limit 1000\))156
210 Q 4.8(;o)62.4 G(ps/minute)-4.8 E
(\(expires ,\(+ \(current-seconds\) 86400\)\)\)\)\)\))156 222 Q F1 2.5
(3.2. Capability)72 240 R(Model)2.5 E F0 -.8(Wo)72 255.6 S
(rmholes support \214ne-grained capabilities:[^d3]).8 E 1.103
([^d3]: Design: Rich capabilities enable principle of least pri)72 271.2
R(vile)-.25 E 1.104(ge. A backup agent needs read-only; a sync agent)
-.15 F(needs read-write b)72 283.2 Q
(ut not delete. Capabilities compose\342grant e)-.2 E(xactly what')-.15
E 2.5(sn)-.55 G(eeded.)-2.5 E -.8(Ta)72 298.8 S(ble 0: W).8 E
(ormhole Capabilities)-.8 E .4 LW 406.155 309.3 205.845 309.3 DL F1
63.255(Capability Allo)213.19 318.8 R(ws)-.1 E F0(Data Access)210.845
330.8 Q 47.49(read Read)210.845 342.8 R(\214le contents)2.5 E 44.15
(write Write/modify)210.845 354.8 R(\214le contents)2.5 E 40.83
(create Create)210.845 366.8 R(ne)2.5 E 2.5<778c>-.25 G(les)-2.5 E 40.82
(delete Remo)210.845 378.8 R .3 -.15(ve \214)-.15 H(les).15 E 35.27
(rename Rename/mo)210.845 390.8 R .3 -.15(ve \214)-.15 H(les).15 E
(Metadata)210.845 402.8 Q 50.81(stat Read)210.845 414.8 R(POSIX attrib)
2.5 E(utes)-.2 E 37.48(chmod Modify)210.845 426.8 R(permissions)2.5 E
(cho)210.845 438.8 Q 38.29(wn Change)-.25 F -.25(ow)2.5 G(nership).25 E
(xattr)210.845 450.8 Q 26.03(-read Read)-.2 F -.15(ex)2.5 G
(tended attrib).15 E(utes)-.2 E(xattr)210.845 462.8 Q 22.69
(-write Modify)-.2 F -.15(ex)2.5 G(tended attrib).15 E(utes)-.2 E 32.5
(acl-read Read)210.845 474.8 R -.4(AC)2.5 G(Ls).4 E 29.16
(acl-write Modify)210.845 486.8 R -.4(AC)2.5 G(Ls).4 E(Directory)210.845
498.8 Q 36.38(readdir List)210.845 510.8 R(directory contents)2.5 E
40.81(mkdir Create)210.845 522.8 R(directories)2.5 E 42.48(rmdir Remo)
210.845 534.8 R .3 -.15(ve d)-.15 H(irectories).15 E(Control)210.845
546.8 Q 39.7(admin Con\214gure)210.845 558.8 R -.1(wo)2.5 G(rmhole).1 E
(dele)210.845 570.8 Q -.05(ga)-.15 G 31.58(te Dele).05 F -.05(ga)-.15 G
(te capabilities to others).05 E 24.16(audit-read Read)210.845 582.8 R
-.1(wo)2.5 G(rmhole audit log).1 E 27.48(rate-limit Modify)210.845 594.8
R(rate limits)2.5 E 406.155 599.3 205.845 599.3 DL 406.155 309.3 406.155
599.3 DL 205.845 309.3 205.845 599.3 DL 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.3. Capability)72 84 R(Composition)2.5 E/F2 8/Courier@0 SF
(;; Common capability sets \(long form for readability\))108 102 Q
(\(define capability:read-only)108 114 Q
('\(read stat readdir xattr-read acl-read\)\))117.6 126 Q
(\(define capability:read-write)108 150 Q('\(read write create stat chm\
od readdir mkdir xattr-read xattr-write\)\))117.6 162 Q
(\(define capability:full)108 186 Q('\(read write create delete rename)
117.6 198 Q(stat chmod chown)127.2 210 Q
(xattr-read xattr-write acl-read acl-write)127.2 222 Q
(readdir mkdir rmdir admin delegate audit-read rate-limit\)\))127.2 234
Q(\(define capability:backup)108 258 Q
('\(read stat readdir xattr-read acl-read\)\))117.6 270 Q
(\(define capability:synchronize)108 294 Q
('\(read write create delete rename)117.6 306 Q
(stat chmod readdir mkdir rmdir)127.2 318 Q(xattr-read xattr-write\)\))
127.2 330 Q F1 2.5(3.4. Capability)72 348 R(Attenuation)2.5 E F0
(Capabilities can only be reduced, ne)72 363.6 Q -.15(ve)-.25 G 2.5(ra)
.15 G(mpli\214ed:[^r1])-2.5 E .329([^r1]: Research: Capability attenuat\
ion is fundamental to the object-capability model. See Miller)72 379.2 R
2.829(,")-.4 G(Rob)-2.829 E .329(ust Composi-)-.2 F(tion" \(2006\). Y)72
391.2 Q(ou cannot grant more authority than you possess.)-1.1 E F2
(\(define \(wormhole-delegate wormhole new-caps recipient\))108 409.2 Q
("Delegate subset of wormhole capabilities")117.6 421.2 Q
(\(let \(\(my-caps \(wormhole-capabilities wormhole\)\)\))117.6 433.2 Q
(\(unless \(subset? new-caps my-caps\))127.2 445.2 Q
(\(error 'capability-amplification)136.8 457.2 Q
("Cannot delegate capabilities you don't have"\)\))170.4 469.2 Q
(\(wormhole-cert)127.2 481.2 Q(\(wormhole-issuer wormhole\))132 493.2 Q
(\(wormhole-fs-path wormhole\))132 505.2 Q
(\(wormhole-vault-path wormhole\))132 517.2 Q(new-caps)132 529.2 Q
(recipient: recipient\)\)\))132 541.2 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.5. Opening)72 84 R 2.5(aW)2.5 G(ormhole)-3.25 E/F2 8/Courier@0 SF
(\(define \(wormhole-open fs-path #!key \(vault-path "/"\))108 102 Q
(\(capabilities capability:read-write\))285.6 114 Q(\(rate-limit 1000\))
285.6 126 Q(\(locked #f\))285.6 138 Q(\(auth-required '\(\)\))285.6 150
Q(\(certificate #f\)\))285.6 162 Q
("Open wormhole - requires valid certificate")117.6 174 Q
(\(unless certificate)117.6 186 Q
(\(error 'unauthorized "Wormhole requires SPKI certificate"\)\))127.2
198 Q(\(unless \(verify-wormhole-cert certificate fs-path vault-path\))
117.6 210 Q(\(error 'unauthorized "Invalid wormhole certificate"\)\))
127.2 222 Q(;; Audit the open)117.6 234 Q
(\(wormhole-audit 'wormhole-open fs-path)117.6 246 Q
(`\(\(vault ,vault-path\))194.4 258 Q
(\(capabilities ,\(length capabilities\)\)\)\))204 270 Q
(;; Proceed with FUSE mount)117.6 282 Q(...\))117.6 294 Q F1 2.5
(3.6. Usage)72 312 R(Examples)2.5 E F2(;; Basic read-write wormhole)108
330 Q(\(wormhole-open "~/Cyberspace"\))108 342 Q
(;; Read-only wormhole for browsing)108 366 Q
(\(wormhole-open "~/Archive" capabilities: capability:read-only\))108
378 Q(;; Sync wormhole with rate limiting)108 402 Q
(\(wormhole-open "~/Sync")108 414 Q
(capabilities: capability:synchronize)117.6 426 Q(rate-limit: 500\))
117.6 438 Q
(;; Locked wormhole requiring unlock for sensitive operations)108 462 Q
(\(wormhole-open "~/Secure")108 474 Q(capabilities: capability:full)
117.6 486 Q(locked: #t)117.6 498 Q(auth-required: '\(delete admin\)\))
117.6 510 Q F1 2.5(4. Ar)72 528 R(chitectur)-.18 E(e)-.18 E 2.5
(4.1. Mount)72 552 R -.92(To)2.5 G(pology).92 E F2 91.2(~/Cyberspace/ <)
108 570 R(FUSE mount point)4.8 E(+-- documents/)108 582 Q 14.4(|+)108
594 S(-- paper.pdf)-14.4 E 4.8(<V)72 G(irtual file \(content in vault\))
-4.8 E 14.4(|+)108 606 S(-- notes.txt)-14.4 E(+-- projects/)108 618 Q
14.4(|+)108 630 S(-- cyberspace/)-14.4 E 33.6(|+)108 642 S(-- ...)-33.6
E(+-- .vault/)108 654 Q 4.8(<H)105.6 G(idden, actual storage)-4.8 E
(+-- objects/)127.2 666 Q 4.8(<C)81.6 G(ontent-addressed blobs)-4.8 E
14.4(|+)127.2 678 S(-- sha256:abc123...)-14.4 E 14.4(|+)127.2 690 S
(-- sha256:def456...)-14.4 E(+-- manifests/)127.2 702 Q 4.8(<D)72 G
(irectory > file mappings)-4.8 E(+-- metadata/)127.2 714 Q 4.8(<P)76.8 G
(er-file metadata store)-4.8 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.2. Component)72 84 R(Stack)2.5 E/F2 8/Courier@0 SF
(+-------------------------------------+)108 102 Q 43.2(|A)108 114 S 72
(pplications |)-43.2 F 19.2(|\()108 126 S(Finder, cp, rsync, etc.\))
-19.2 E(|)38.4 E(+-------------------------------------+)108 138 Q 43.2
(|V)108 150 S(FS \(kernel\))-43.2 E(|)76.8 E
(+-------------------------------------+)108 162 Q 28.8(|F)108 174 S
(USE-T / macFUSE)-28.8 E(|)72 E(+-------------------------------------+)
108 186 Q 19.2(|c)108 198 S(yberspace-fuse daemon)-19.2 E 9.6(|<)52.8 G
(Our code)-4.8 E(+-------------------------------------+)108 210 Q 43.2
(|V)108 222 S(ault layer)-43.2 E(|)81.6 E 14.4(|\()108 234 S
(content-address, metadata\))-14.4 E(|)33.6 E
(+-------------------------------------+)108 246 Q F1 2.5(5. Metadata)72
264 R(Pr)2.5 E(eser)-.18 E -.1(va)-.1 G(tion).1 E 2.5(5.1. macOS)72 288
R(Metadata Captur)2.5 E(ed)-.18 E F0 -.8(Ta)72 303.6 S(ble 1: Preserv).8
E(ed Metadata)-.15 E .4 LW 479.66 314.1 132.34 314.1 DL F1 63.025
(Category Attrib)146.37 323.6 R 78.725(utes Captur)-.2 F 2.5(eM)-.18 G
(ethod)-2.5 E F0 43.6(POSIX mode,)137.34 335.6 R(uid, gid, size)2.5 E
(stat\(\))60.84 E -.35(Ti)137.34 347.6 S 23.95(mestamps mtime,).35 F
(atime, ctime, birthtime)2.5 E(stat\(\))17.5 E(Extended attrs)137.34
359.6 Q(Finder info, tags, quarantine)17.5 E
(listxattr\(\), getxattr\(\))26.13 E 35.81(Spotlight kMDItem*)137.34
371.6 R 53.63(metadata mdls)2.5 F 2.5(/M)2.5 G(DItem API)-2.5 E -.4(AC)
137.34 383.6 S 49(Ls Access).4 F(control lists)2.5 E(aclget\214le\(\))
61.4 E 50.82(Flags hidden,)137.34 395.6 R(lock)2.5 E(ed, immutable)-.1 E
(ch\215ags\(\) / stat\(\))32.61 E(Resource fork)137.34 407.6 Q(Le)18.62
E -.05(ga)-.15 G .3 -.15(cy r).05 H(esource data).15 E
(xattr com.apple.ResourceF)54.56 E(ork)-.15 E 479.66 412.1 132.34 412.1
DL 479.66 314.1 479.66 412.1 DL 132.34 314.1 132.34 412.1 DL F1 2.5
(5.2. Inter)72 425.6 R(nal Repr)-.15 E(esentation)-.18 E F2
(\(define-record-type <vault-file>)108 443.6 Q
(\(make-vault-file path content-hash metadata\))117.6 455.6 Q
(vault-file?)117.6 467.6 Q(\(path vault-file-path\))117.6 479.6 Q
(\(content-hash vault-file-hash\))117.6 491.6 Q
(\(metadata vault-file-metadata\)\))117.6 503.6 Q
(\(define \(capture-metadata path\))108 527.6 Q
("Capture all macOS metadata for a file")117.6 539.6 Q(`\(\(posix)117.6
551.6 Q(\(mode ,\(file-mode path\)\))132 563.6 Q
(\(uid ,\(file-uid path\)\))132 575.6 Q(\(gid ,\(file-gid path\)\))132
587.6 Q(\(size ,\(file-size path\)\))132 599.6 Q
(\(mtime ,\(file-mtime path\)\))132 611.6 Q
(\(atime ,\(file-atime path\)\))132 623.6 Q
(\(ctime ,\(file-ctime path\)\))132 635.6 Q
(\(birthtime ,\(file-birthtime path\)\)\))132 647.6 Q
(\(xattr ,\(capture-xattrs path\)\))127.2 659.6 Q
(\(flags ,\(capture-flags path\)\))127.2 671.6 Q
(\(acl ,\(capture-acl path\)\)\)\))127.2 683.6 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.3. Restoration)72 84 R/F2 8/Courier@0 SF
(\(define \(restore-metadata path metadata\))108 102 Q
("Restore all metadata to a file")117.6 114 Q
(\(let \(\(posix \(alist-ref 'posix metadata\)\))117.6 126 Q
(\(xattr \(alist-ref 'xattr metadata\)\))146.4 138 Q
(\(flags \(alist-ref 'flags metadata\)\))146.4 150 Q
(\(acl \(alist-ref 'acl metadata\)\)\))146.4 162 Q
(\(restore-posix path posix\))127.2 174 Q(\(restore-xattrs path xattr\))
127.2 186 Q(\(restore-flags path flags\))127.2 198 Q
(\(restore-acl path acl\)\)\))127.2 210 Q F1 2.5(6. FUSE)72 228 R
(Operations)2.5 E 2.5(6.1. Requir)72 252 R(ed Operations)-.18 E F0 -.8
(Ta)72 267.6 S(ble 2: FUSE Operations).8 E .4 LW 456.175 278.1 155.825
278.1 DL F1 34.415(Operation Pur)160.825 287.6 R 75.13(pose V)-.1 F
(ault Action)-.92 E F0 33.34(getattr stat\(\))160.825 299.6 R
(Return stored metadata)70.68 E 30.57(readdir List)160.825 311.6 R 34.57
(directory Read)2.5 F(manifest)2.5 E 39.45(open Open)160.825 323.6 R
51.79(\214le V)2.5 F(alidate hash e)-1.11 E(xists)-.15 E 41.68
(read Read)160.825 335.6 R 36.24(content Fetch)2.5 F(by content hash)2.5
E 38.34(write Write)160.825 347.6 R 34.02(content Content-address,)2.5 F
(update manifest)2.5 E 35.02(create Create)160.825 359.6 R 47.35
(\214le Allocate)2.5 F(manifest entry)2.5 E 33.33(unlink Delete)160.825
371.6 R 47.35(\214le Remo)2.5 F .3 -.15(ve f)-.15 H
(rom manifest \(GC later\)).15 E 35(mkdir Create)160.825 383.6 R 24.03
(directory Create)2.5 F(manifest node)2.5 E 36.67(rmdir Remo)160.825
395.6 R .3 -.15(ve d)-.15 H 17.1(irectory Remo).15 F .3 -.15(ve m)-.15 H
(anifest node).15 E 29.46(rename Mo)160.825 407.6 R -.15(ve)-.15 G 33.49
(/rename Update).15 F(manifest path)2.5 E 29.45(setxattr Set)160.825
419.6 R -.15(ex)2.5 G(tended attr).15 E(Store in metadata)24.17 E 28.34
(getxattr Get)160.825 431.6 R -.15(ex)2.5 G(tended attr).15 E(Retrie)
22.51 E .3 -.15(ve f)-.25 H(rom metadata).15 E 28.33(listxattr List)
160.825 443.6 R -.15(ex)2.5 G(tended attrs).15 E(Enumerate metadata)17.5
E 456.175 448.1 155.825 448.1 DL 456.175 278.1 456.175 448.1 DL 155.825
278.1 155.825 448.1 DL 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.2. Implementation)72 84 R(Sk)2.5 E(etch)-.1 E/F2 8/Courier@0 SF
(\(define \(fuse-getattr path\))108 102 Q
("Return file attributes from vault metadata")117.6 114 Q
(\(let \(\(entry \(manifest-lookup path\)\)\))117.6 126 Q(\(if entry)
127.2 138 Q(\(let \(\(meta \(vault-file-metadata entry\)\)\))146.4 150 Q
(\(make-stat)156 162 Q(\(alist-ref 'mode \(alist-ref 'posix meta\)\))
160.8 174 Q(\(alist-ref 'size \(alist-ref 'posix meta\)\))160.8 186 Q
(\(alist-ref 'mtime \(alist-ref 'posix meta\)\))160.8 198 Q(...\)\))
160.8 210 Q(-ENOENT\)\)\))146.4 222 Q
(\(define \(fuse-read path size offset\))108 246 Q
("Read file content from vault")117.6 258 Q
(\(let \(\(entry \(manifest-lookup path\)\))117.6 270 Q
(\(hash \(vault-file-hash entry\)\))151.2 282 Q
(\(content \(vault-fetch hash\)\)\))151.2 294 Q
(\(subbytes content offset \(+ offset size\)\)\)\))127.2 306 Q
(\(define \(fuse-write path data offset\))108 330 Q
("Write to file, content-address the result")117.6 342 Q
(\(let \(\(entry \(manifest-lookup path\)\))117.6 354 Q
(\(current \(vault-fetch \(vault-file-hash entry\)\)\))151.2 366 Q
(\(updated \(bytes-splice current offset data\)\))151.2 378 Q
(\(new-hash \(content-address updated\)\)\))151.2 390 Q
(\(manifest-update! path new-hash\))127.2 402 Q
(\(string-length data\)\)\))127.2 414 Q
(\(define \(fuse-setxattr path name value\))108 438 Q
("Store extended attribute in vault metadata")117.6 450 Q
(\(let \(\(entry \(manifest-lookup path\)\)\))117.6 462 Q
(\(metadata-set-xattr! entry name value\))127.2 474 Q(0\)\))127.2 486 Q
F1 2.5(7. Content)72 504 R(Addr)2.5 E(essing)-.18 E F0
(Files are stored by content hash \(RFC-020\):)72 519.6 Q F2
(\(define \(content-address data\))108 537.6 Q
("Store data, return hash")117.6 549.6 Q
(\(let* \(\(hash \(sha256 data\)\))117.6 561.6 Q
(\(path \(vault-object-path hash\)\)\))151.2 573.6 Q
(\(unless \(file-exists? path\))127.2 585.6 Q
(\(write-blob path data\)\))136.8 597.6 Q(hash\)\))127.2 609.6 Q
(\(define \(vault-fetch hash\))108 633.6 Q("Retrieve data by hash")117.6
645.6 Q(\(read-blob \(vault-object-path hash\)\)\))117.6 657.6 Q F0 .827
(Bene\214ts: - Identical \214les stored once \(deduplication\) - Inte)72
675.6 R .827(grity v)-.15 F .827(eri\214cation on e)-.15 F -.15(ve)-.25
G .827(ry read - Immutable objects en-).15 F(able safe caching)72 687.6
Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(8. Synchr)72 84 R(onization)-.18 E 2.5(8.1. Change)72 108 R
(Detection)2.5 E F0(The FUSE layer captures all writes in real-time. No\
 separate sync needed for local changes.)72 123.6 Q -.15(Fo)72 139.2 S
2.5(rm).15 G(ulti-de)-2.5 E(vice sync, the manifest includes v)-.25 E
(ersion v)-.15 E(ectors \(RFC-012\):)-.15 E/F2 8/Courier@0 SF
(\(define \(manifest-entry path hash metadata\))108 157.2 Q(`\(entry)
117.6 169.2 Q(\(path ,path\))127.2 181.2 Q(\(hash ,hash\))127.2 193.2 Q
(\(metadata ,metadata\))127.2 205.2 Q
(\(version-vector ,local-node ,lamport-clock\)\)\))127.2 217.2 Q F1 2.5
(8.2. Con\215ict)72 235.2 R(Resolution)2.5 E F0(When mer)72 250.8 Q
(ging manifests from dif)-.18 E(ferent de)-.25 E
(vices \(RFC-016 lazy clustering\):)-.25 E .48
(1. Same hash \342 No con\215ict \(identical content\) 2. Dif)72 266.4 R
.48(ferent hash, one ne)-.25 F .48(wer \342 T)-.25 F(ak)-.8 E 2.98(en)
-.1 G -.25(ew)-2.98 G .48(er 3. Dif).25 F .48(ferent hash, concur)-.25 F
(-)-.2 E(rent \342 Con\215ict, apply lazy-resolv)72 278.4 Q(e)-.15 E F2
(\(define \(merge-manifests local remote\))108 296.4 Q(\(for-each)117.6
308.4 Q(\(lambda \(path\))122.4 320.4 Q
(\(let \(\(l \(manifest-lookup local path\)\))132 332.4 Q
(\(r \(manifest-lookup remote path\)\)\))160.8 344.4 Q(\(cond)141.6
356.4 Q(\(\(not l\) \(manifest-add! local r\)\))146.4 368.4 Q
(\(\(not r\) 'keep-local\))146.4 380.4 Q
(\(\(equal? \(vault-file-hash l\) \(vault-file-hash r\)\) 'identical\))
146.4 392.4 Q(\(\(version-newer? r l\) \(manifest-update! local r\)\))
146.4 404.4 Q(\(\(version-newer? l r\) 'keep-local\))146.4 416.4 Q
(\(else \(queue-conflict! path l r\)\)\)\)\))146.4 428.4 Q
(\(union \(manifest-paths local\) \(manifest-paths remote\)\)\)\))122.4
440.4 Q F1 2.5(9. Mount)72 458.4 R(Commands)2.5 E 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.1. REPL)72 84 R(Interface)2.5 E/F2 8/Courier@0 SF
(\(define \(vault-mount point\))108 102 Q
("Mount vault at filesystem path")117.6 114 Q(\(fuse-main point)117.6
126 Q(`\(\(getattr . ,fuse-getattr\))127.2 138 Q
(\(readdir . ,fuse-readdir\))136.8 150 Q(\(open . ,fuse-open\))136.8 162
Q(\(read . ,fuse-read\))136.8 174 Q(\(write . ,fuse-write\))136.8 186 Q
(\(create . ,fuse-create\))136.8 198 Q(\(unlink . ,fuse-unlink\))136.8
210 Q(\(mkdir . ,fuse-mkdir\))136.8 222 Q(\(rmdir . ,fuse-rmdir\))136.8
234 Q(\(rename . ,fuse-rename\))136.8 246 Q
(\(setxattr . ,fuse-setxattr\))136.8 258 Q
(\(getxattr . ,fuse-getxattr\))136.8 270 Q
(\(listxattr . ,fuse-listxattr\)\)\)\))136.8 282 Q
(\(define \(vault-unmount point\))108 306 Q("Unmount vault filesystem")
117.6 318 Q(\(fuse-unmount point\)\))117.6 330 Q F1 2.5(9.2. Command)72
348 R(Line)2.5 E F2 4.8(#M)108 366 S(ount)-4.8 E
(cyberspace mount ~/Cyberspace)108 378 Q 4.8(#U)108 402 S(nmount)-4.8 E
(cyberspace unmount ~/Cyberspace)108 414 Q 4.8(#O)108 438 S 4.8(rv)-4.8
G(ia REPL)-4.8 E 4.8($.)108 450 S(/cyberspace-repl)-4.8 E 4.8(>\()108
462 S(vault-mount "~/Cyberspace"\))-4.8 E
(Mounted vault at /Users/ddp/Cyberspace)108 474 Q F1 2.5(10. macOS)72
492 R(Integration)2.5 E 2.5(10.1. FUSE-T)72 516 R(vs macFUSE)2.5 E F0
-.8(Ta)72 531.6 S(ble 3: FUSE Implementation Options).8 E .4 LW 418.465
542.1 193.535 542.1 DL F1 -.25(Fe)217.155 551.6 S(atur).25 E 47.965(em)
-.18 G 29.205(acFUSE FUSE-T)-47.965 F F0 -.25(Ke)198.535 563.6 S(rnel e)
.25 E 17.49(xtension Y)-.15 F(es \(deprecated\))-1 E(No)17.5 E(System e)
198.535 575.6 Q 15(xtension Optional)-.15 F(Uses NFS)49.52 E
(SIP compatible)198.535 587.6 Q(Requires disable)26.24 E -1(Ye)18.14 G
(s)1 E 34.04(Performance Better)198.535 599.6 R(Adequate)60.08 E 33.48
(Maintenance Acti)198.535 611.6 R 56.06 -.15(ve A)-.25 H(cti).15 E -.15
(ve)-.25 G 418.465 616.1 193.535 616.1 DL 418.465 542.1 418.465 616.1 DL
193.535 542.1 193.535 616.1 DL(FUSE-T recommended for ne)72 629.6 Q 2.5
(wi)-.25 G(nstallations\342no k)-2.5 E(ernel e)-.1 E
(xtension required.[^i1])-.15 E .746
([^i1]: Implementation: FUSE-T implements FUSE API o)72 645.2 R -.15(ve)
-.15 G 3.246(rN).15 G .747(FS loopback. Slightly higher latenc)-3.246 F
3.247(yb)-.15 G .747(ut a)-3.447 F -.2(vo)-.2 G .747(ids Ap-).2 F(ple')
72 657.2 Q 2.5(sk)-.55 G(ernel e)-2.6 E(xtension hostility.)-.15 E 0 Cg
EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-041 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(10.2. Installation)72 84 R/F2 8/Courier@0 SF 4.8(#F)108 102 S
(USE-T \(recommended\))-4.8 E(brew install fuse-t)108 114 Q 4.8(#O)108
138 S 4.8(rm)-4.8 G(acFUSE \(if kernel ext acceptable\))-4.8 E
(brew install macfuse)108 150 Q F1 2.5(10.3. Finder)72 168 R
(Integration)2.5 E F0(The mount appears as a re)72 183.6 Q(gular v)-.15
E(olume in Finder. Optional .V)-.2 E(olumeIcon.icns for custom icon.)
-1.29 E .951(Spotlight inde)72 199.2 R .951(xing can be enabled by impl\
ementing getxattr for com.apple.FinderInfo and related Spotlight attrib\
-)-.15 F(utes.)72 211.2 Q F1 2.5(11. Security)72 235.2 R(Considerations)
2.5 E 2.5(11.1. P)72 259.2 R(ermissions)-.2 E F0
(FUSE daemon runs as user)72 274.8 Q 2.5(,n)-.4 G(ot root. Respects v)
-2.5 E(ault A)-.25 E(CLs.)-.4 E F1 2.5(11.2. Content)72 298.8 R
(Integrity)2.5 E F0(Ev)72 314.4 Q(ery read v)-.15 E
(eri\214es content hash. Corruption detected immediately.)-.15 E F1 2.5
(11.3. Metadata)72 338.4 R -.74(Tr)2.5 G(ust).74 E F0 .632(Metadata is \
stored separately from content. A compromised metadata store cannot alt\
er \214le contents \(hashes w)72 354 R(on')-.1 E(t)-.18 E(match\).)72
366 Q F1 2.5(11.4. Mount)72 390 R(Security)2.5 E F2
(\(define \(vault-mount point #!key \(allow-other #f\)\))108 408 Q
(;; allow-other permits other users to access mount)117.6 420 Q
(;; Default: owner only)117.6 432 Q(...\))117.6 444 Q F1 2.5
(12. Dependencies)72 462 R .4 LW 411.405 472.5 200.595 472.5 DL 62.955
(Component Pur)227.26 482 R(pose)-.1 E(FUSE-T or macFUSE)205.595 494 Q
(Userspace \214lesystem)17.5 E 79.99(libfuse FUSE)205.595 506 R(library)
2.5 E(Scheme FFI)205.595 518 Q(Bindings to libfuse)59.45 E 411.405 522.5
200.595 522.5 DL 411.405 472.5 411.405 522.5 DL 200.595 472.5 200.595
522.5 DL 2.5(13. Refer)72 536 R(ences)-.18 E F0 .294(1. RFC-012: Lampor\
t Clocks 2. RFC-016: Lazy Clustering 3. RFC-020: Content-Addressed Stor\
age 4. FUSE docu-)72 551.6 R
(mentation: https://libfuse.github.io/ 5. FUSE-T)72 563.6 Q 2.5(:h)-.5 G
(ttps://github.com/macos-fuse-t/fuse-t)-2.5 E F1 2.5(14. Changelog)72
587.6 R F0 6.5<8332>72 603.2 S(026-01-07)-6.5 E 6.5<8349>72 618.8 S
(nitial speci\214cation)-6.5 E 0 Cg EP
%%Trailer
end
%%EOF
