%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 9
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-026: Garbage Collection)72 12 Q 1.95(**Stat\
us:** Draft **Date:** January 2026 **Author:** Derrell Piper <ddp@eludo\
m.net> **Implementation:**)72 36 R(Proposed)72 48 Q(---)72 72 Q
(Abstract)72 96 Q .608(This RFC speci\214es g)72 120 R .609
(arbage collection for the Library of Cyberspace: ho)-.05 F 3.109(wv)
-.25 G .609(aults identify and reclaim storage from)-3.359 F .418(unref\
erenced objects while preserving pinned content, respecting tombstones,\
 and maintaining audit trails. Content-)72 132 R
(addressed storage requires careful GC to a)72 144 Q -.2(vo)-.2 G
(id data loss.).2 E(---)72 168 Q(Moti)72 192 Q -.25(va)-.25 G(tion).25 E
(Content-addressed storage accumulates objects fore)72 216 Q -.15(ve)
-.25 G 2.5(ru).15 G(nless acti)-2.5 E -.15(ve)-.25 G(ly pruned:).15 E
2.605(-*)72 240 S .105(*Orphaned objects** - No longer referenced by an)
-2.605 F 2.606(yr)-.15 G .106(oot - **Superseded v)-2.606 F .106
(ersions** - Old v)-.15 F .106(ersions after updates -)-.15 F(**F)72 252
Q(ailed uploads** - P)-.15 E(artial or abandoned writes - **T)-.15 E
(emporary objects** - Intermediate computation results)-.7 E
(But deletion is dangerous:)72 276 Q 3.166(-*)72 300 S .666(*Hash as ca\
pability** - Someone may hold the hash - **Lazy replication** - Remote \
v)-3.166 F .666(aults may need it later -)-.25 F(**Audit requirements**\
 - May need historical data - **Resurrection** - Deleted objects may be\
 re-added)72 312 Q(GC must be conserv)72 336 Q(ati)-.25 E .3 -.15(ve a)
-.25 H(nd auditable.).15 E(---)72 360 Q(Object Lifec)72 384 Q(ycle)-.15
E(States)72 408 Q -.74(```)72 432 S<e2e2e2e2e2e2e2e2e2e2e2>122 444 Q 10
(write \342)97 456 R<e2>22.5 E 2.5<e2e2e2e2e2e2e2e2e2e2ba20e2204c495645>
92 468 R<e2>7.5 E 22.5<e2e2>122 480 S<e2e2e2e2e2e2ace2e2e2e2e2>122 492 Q
<e2>134.5 504 Q<e2e2e2e2e2e2e2e2e2e2e2e2bce2e2e2e2e2e2e2e2e2e2e2>107 516
Q 25<e2e2e2>107 528 S 22.5<e2bc20e2bc20e2bc>107 540 R
<e2e2e2e2e2e2e2e2e2e220e2e2e2e2e2e2e2e2e2e220e2e2e2e2e2e2e2e2e2e2>94.5
552 Q 2.5(\342PINNED \342)94.5 564 R<e254>2.5 E(OMBST)-.18 E
(ONE\342 \342ORPHANED\342)-.18 E
<e2e2e2e2e2e2e2e2e2e220e2e2e2e2e2e2e2e2e2e220e2e2e2e2e2ace2e2e2e2e2>94.5
576 Q<e2>159.5 588 Q 2.5<e247>159.5 600 S(C)-2.5 E<e2bc>159.5 612 Q
<e2e2e2e2e2e2e2e2e2e2>147 624 Q(\342COLLECTED\342)147 636 Q
<e2e2e2e2e2e2e2e2e2e22060>147 648 Q -.74(``)-.74 G(State T)72 672 Q
(ransitions)-.35 E -.74(```)72 696 S
(scheme \(de\214ne \(object-state hash\)).74 E(\(cond)77 708 Q
(\(\(pinned? hash\) 'pinned\))82 720 Q(\(\(tombstoned? hash\) ')82 732 Q
(tombstone\))-.18 E(\(\(referenced? hash\) ')82 744 Q(li)-.1 E -.15(ve)
-.25 G(\)).15 E(\(else 'orphaned\)\)\))82 756 Q
(\(de\214ne \(can-collect? hash\))72 780 Q
(\(and \(eq? \(object-state hash\) 'orphaned\))77 792 Q 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(not \(in-grace-period? hash\)\))89.5 12 Q
(\(not \(pending-replication? hash\)\)\)\) `)89.5 24 Q -.74(``)-.74 G
(---)72 48 Q(Reference Counting)72 72 Q(Direct References)72 96 Q -.74
(```)72 120 S(scheme ;; T).74 E
(rack incoming references \(de\214ne ref-counts \(mak)-.35 E
(e-hash-table\)\))-.1 E(\(de\214ne \(add-reference from-hash to-hash\))
72 144 Q(\(let \(\(count \(hash-table-ref ref-counts to-hash 0\)\)\))77
156 Q(\(hash-table-set! ref-counts to-hash \(+ count 1\)\))82 168 Q
(\(audit-append action: `\(add-ref ,from-hash ,to-hash\)\)\)\))82 180 Q
(\(de\214ne \(remo)72 204 Q -.15(ve)-.15 G
(-reference from-hash to-hash\)).15 E
(\(let \(\(count \(hash-table-ref ref-counts to-hash 0\)\)\))77 216 Q
(\(hash-table-set! ref-counts to-hash \(max 0 \(- count 1\)\)\))82 228 Q
(\(audit-append action: `\(remo)82 240 Q -.15(ve)-.15 G
(-ref ,from-hash ,to-hash\)\)\)\)).15 E
(\(de\214ne \(reference-count hash\))72 264 Q
(\(hash-table-ref ref-counts hash 0\)\) `)77 276 Q -.74(``)-.74 G
(Root References)72 300 Q -.74(```)72 324 S
(scheme ;; GC roots - objects that are al).74 E -.1(wa)-.1 G
(ys reachable \(de\214ne gc-roots \(mak).1 E(e-hash-set\)\))-.1 E
(\(de\214ne \(add-gc-root hash reason\))72 348 Q
(\(hash-set-add! gc-roots hash\))77 360 Q
(\(audit-append action: `\(add-root ,hash ,reason\)\)\))77 372 Q
(\(de\214ne \(remo)72 396 Q -.15(ve)-.15 G(-gc-root hash\)).15 E
(\(hash-set-remo)77 408 Q -.15(ve)-.15 G 2.5(!g).15 G(c-roots hash\))
-2.5 E(\(audit-append action: `\(remo)77 420 Q -.15(ve)-.15 G
(-root ,hash\)\)\)).15 E(\(de\214ne \(gc-root? hash\))72 444 Q
(\(hash-set-member? gc-roots hash\)\) `)77 456 Q -.74(``)-.74 G
(Implicit Roots)72 480 Q -.74(```)72 504 S(scheme ;; Some objects are i\
mplicitly rooted \(de\214ne \(implicit-root? hash\)).74 E
(\(or \(pinned? hash\))77 516 Q
(\(soup-object-type? hash 'certi\214cate\))87 528 Q 2.5(;C)5 G
(erts are roots)-2.5 E(\(soup-object-type? hash 'audit-entry\))87 540 Q
2.5(;A)5 G(udit is sacred)-2.5 E(\(recent-write? hash\)\)\))87 552 Q 2.5
(;G)42.5 G(race period `)-2.5 E -.74(``)-.74 G(---)72 576 Q
(Mark and Sweep)72 600 Q(Mark Phase)72 624 Q -.74(```)72 648 S
(scheme \(de\214ne \(mark-reachable\)).74 E
("Mark all objects reachable from roots")77 660 Q(\(let \(\(mark)77 672
Q(ed \(mak)-.1 E(e-hash-set\)\)\))-.1 E(\(de\214ne \(mark hash\))82 684
Q(\(unless \(hash-set-member? mark)87 696 Q(ed hash\))-.1 E
(\(hash-set-add! mark)92 708 Q(ed hash\))-.1 E(\(for)92 720 Q
(-each mark \(object-references hash\)\)\)\))-.2 E(;; Mark from e)82 744
Q(xplicit roots)-.15 E(\(for)82 756 Q
(-each mark \(hash-set->list gc-roots\)\))-.2 E
(;; Mark from implicit roots)82 780 Q(\(for)82 792 Q
(-each \(lambda \(hash\))-.2 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(when \(implicit-root? hash\))112 12 Q
(\(mark hash\)\)\))117 24 Q(\(all-object-hashes\)\))107 36 Q(mark)82 60
Q(ed\)\) `)-.1 E -.74(``)-.74 G(Sweep Phase)72 84 Q -.74(```)72 108 S
(scheme \(de\214ne \(sweep mark).74 E(ed\))-.1 E("Collect unmark)77 120
Q(ed objects")-.1 E(\(let \(\(collected '\(\)\)\))77 132 Q(\(for)82 144
Q(-each)-.2 E(\(lambda \(hash\))87 156 Q
(\(unless \(hash-set-member? mark)92 168 Q(ed hash\))-.1 E
(\(when \(can-collect? hash\))97 180 Q
(\(set! collected \(cons hash collected\)\))102 192 Q
(\(collect-object! hash\)\)\)\))102 204 Q(\(all-object-hashes\)\))87 216
Q(collected\)\))82 228 Q(\(de\214ne \(collect-object! hash\))72 252 Q
("Remo)77 264 Q .3 -.15(ve o)-.15 H(bject from storage").15 E
(\(let \(\(obj \(cas-get hash\)\)\))77 276 Q(\(audit-append)82 288 Q
(action: 'gc-collect)87 300 Q(hash: hash)87 312 Q
(size: \(object-size obj\))87 324 Q(age: \(object-age obj\)\))87 336 Q
(\(cas-delete! hash\)\)\) `)82 348 Q -.74(``)-.74 G(Full GC)72 372 Q
-.74(```)72 396 S(scheme \(de\214ne \(gc-full\)).74 E("Perform full g)77
408 Q(arbage collection")-.05 E(\(let \(\(start \(current-time\)\)\))77
420 Q(\(audit-append action: 'gc-start type: 'full\))82 432 Q
(\(let* \(\(mark)82 456 Q(ed \(mark-reachable\)\))-.1 E
(\(collected \(sweep mark)99.5 468 Q(ed\)\)\))-.1 E(\(audit-append)87
492 Q(action: 'gc-complete)92 504 Q(type: 'full)92 516 Q
(duration: \(- \(current-time\) start\))92 528 Q(mark)92 540 Q
(ed: \(hash-set-size mark)-.1 E(ed\))-.1 E
(collected: \(length collected\))92 552 Q
(bytes-freed: \(sum \(map object-size collected\)\)\))92 564 Q
(collected\)\)\) `)87 588 Q -.74(``)-.74 G(---)72 612 Q(Incremental GC)
72 636 Q(Generational Collection)72 660 Q -.74(```)72 684 S
(scheme ;; Objects partitioned by age \(de\214ne generations).74 E
('\(\(young . 86400\))77 696 Q 2.5(;<1d)15 G(ay)-2.5 E
(\(middle . 2592000\))82 708 Q 2.5(;<3)7.5 G 2.5(0d)-2.5 G(ays)-2.5 E
(\(old . #f\)\)\))82 720 Q 2.5(;>)22.5 G 2.5(=3)-2.5 G 2.5(0d)-2.5 G
(ays)-2.5 E(\(de\214ne \(object-generation hash\))72 744 Q
(\(let \(\(age \(object-age hash\)\)\))77 756 Q(\(cond)82 768 Q
(\(\(< age 86400\) 'young\))87 780 Q(\(\(< age 2592000\) 'middle\))87
792 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(else 'old\)\)\)\))87 12 Q
(\(de\214ne \(gc-generation gen\))72 36 Q
("Collect only speci\214ed generation")77 48 Q
(\(let \(\(candidates \(\214lter \(lambda \(h\))77 60 Q
(\(eq? \(object-generation h\) gen\)\))147 72 Q
(\(all-object-hashes\)\)\)\))142 84 Q
(\(gc-candidates candidates\)\)\) `)82 96 Q -.74(``)-.74 G
(Write Barrier)72 120 Q -.74(```)72 144 S(scheme ;; T).74 E(rack modi\
\214ed objects for incremental GC \(de\214ne modi\214ed-set \(mak)-.35 E
(e-hash-set\)\))-.1 E(\(de\214ne \(cas-put-with-barrier data\))72 168 Q
(\(let \(\(hash \(cas-put data\)\)\))77 180 Q
(\(hash-set-add! modi\214ed-set hash\))82 192 Q(hash\)\))82 204 Q
(\(de\214ne \(gc-incremental\))72 228 Q
("Collect recently modi\214ed objects if orphaned")77 240 Q
(\(let \(\(candidates \(hash-set->list modi\214ed-set\)\)\))77 252 Q
(\(hash-set-clear! modi\214ed-set\))82 264 Q
(\(gc-candidates candidates\)\)\) `)82 276 Q -.74(``)-.74 G
(Concurrent GC)72 300 Q -.74(```)72 324 S
(scheme ;; GC runs concurrently with mutations \(de\214ne gc-lock \(mak)
.74 E(e-mute)-.1 E(x\)\) \(de\214ne gc-running? #f\))-.15 E
(\(de\214ne \(gc-concurrent\))72 348 Q("Run GC without stopping the w)77
360 Q(orld")-.1 E(\(when \(mute)77 372 Q(x-try-lock! gc-lock\))-.15 E
(\(set! gc-running? #t\))82 384 Q
(\(let \(\(snapshot \(snapshot-roots\)\)\))82 396 Q
(;; Mark phase uses snapshot)87 408 Q(\(let \(\(mark)87 420 Q
(ed \(mark-from-snapshot snapshot\)\)\))-.1 E
(;; Sweep only clearly dead objects)92 432 Q(\(sweep-conserv)92 444 Q
(ati)-.25 E .3 -.15(ve m)-.25 H(ark).15 E(ed\)\)\))-.1 E
(\(set! gc-running? #f\))82 456 Q(\(mute)82 468 Q
(x-unlock! gc-lock\)\)\) `)-.15 E -.74(``)-.74 G(---)72 492 Q(Pinning)72
516 Q(Pin Management)72 540 Q -.74(```)72 564 S
(scheme \(de\214ne pins \(mak).74 E(e-hash-table\)\))-.1 E
(\(de\214ne \(pin! hash reason #!k)72 588 Q .3 -.15(ey d)-.1 H
(uration\)).15 E("Protect object from GC")77 600 Q
(\(hash-table-set! pins hash)77 612 Q(`\(\(reason . ,reason\))82 624 Q
(\(pinned-at . ,\(current-time\)\))87 636 Q(\(e)87 648 Q
(xpires . ,\(and duration \(+ \(current-time\) duration\)\)\))-.15 E
(\(pinned-by . ,\(current-principal\)\)\)\))87 660 Q
(\(audit-append action: `\(pin ,hash ,reason\)\)\))77 672 Q
(\(de\214ne \(unpin! hash\))72 696 Q("Allo)77 708 Q 2.5(wo)-.25 G
(bject to be collected")-2.5 E(\(hash-table-delete! pins hash\))77 720 Q
(\(audit-append action: `\(unpin ,hash\)\)\))77 732 Q
(\(de\214ne \(pinned? hash\))72 756 Q
(\(let \(\(pin \(hash-table-ref pins hash #f\)\)\))77 768 Q(\(and pin)82
780 Q(\(or \(not \(assoc-ref pin 'e)94.5 792 Q(xpires\)\))-.15 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(> \(assoc-ref pin 'e)104.5 12 Q
(xpires\) \(current-time\)\)\)\)\)\) `)-.15 E -.74(``)-.74 G -.35(Tr)72
36 S(ansiti).35 E .3 -.15(ve P)-.25 H(inning).15 E -.74(```)72 60 S
(scheme \(de\214ne \(pin-tree! root-hash reason\)).74 E
("Pin object and all objects it references")77 72 Q
(\(let \(\(visited \(mak)77 84 Q(e-hash-set\)\)\))-.1 E
(\(de\214ne \(pin-recursi)82 96 Q .3 -.15(ve h)-.25 H(ash\)).15 E
(\(unless \(hash-set-member? visited hash\))87 108 Q
(\(hash-set-add! visited hash\))92 120 Q(\(pin! hash reason\))92 132 Q
(\(for)92 144 Q(-each pin-recursi)-.2 E .3 -.15(ve \()-.25 H
(object-references hash\)\)\)\)).15 E(\(pin-recursi)82 156 Q .3 -.15
(ve r)-.25 H(oot-hash\)\)\) `).15 E -.74(``)-.74 G(---)72 180 Q -.8(To)
72 204 S(mbstones).8 E -.8(To)72 228 S(mbstone Handling).8 E -.74(```)72
252 S(scheme ;; T).74 E(ombstones are ne)-.8 E -.15(ve)-.25 G 2.5(rc).15
G(ollected \(de\214ne \(tombstoned? hash\))-2.5 E
(\(let \(\(obj \(soup-get hash\)\)\))77 264 Q
(\(and obj \(eq? \(soup-object-type obj\) ')82 276 Q(tombstone\)\)\)\))
-.18 E(;; T)72 300 Q(ombstones pre)-.8 E -.15(ve)-.25 G
(nt resurrection \(de\214ne \(cas-put-check).15 E(ed data\))-.1 E
(\(let \(\(hash \(content-hash data\)\)\))77 312 Q
(\(when \(tombstoned? hash\))82 324 Q
(\(error "Cannot resurrect tombstoned object" hash\)\))87 336 Q
(\(cas-put data\)\)\) `)82 348 Q -.74(``)-.74 G -.8(To)72 372 S
(mbstone Expiry).8 E -.74(```)72 396 S
(scheme ;; Optional: tombstones can e).74 E
(xpire \(de\214ne \(tombstone-e)-.15 E(xpired? hash\))-.15 E
(\(let \(\(tomb \(soup-get hash\)\)\))77 408 Q(\(and tomb)82 420 Q
(\(assoc-ref \(soup-object-metadata tomb\) 'e)94.5 432 Q(xpires\))-.15 E
(\(< \(assoc-ref \(soup-object-metadata tomb\) 'e)94.5 444 Q(xpires\))
-.15 E(\(current-time\)\)\)\)\))102 456 Q(\(de\214ne \(gc-e)72 480 Q
(xpired-tombstones\))-.15 E("Remo)77 492 Q .3 -.15(ve ex)-.15 H
(pired tombstones").15 E(\(for)77 504 Q(-each)-.2 E(\(lambda \(hash\))82
516 Q(\(when \(and \(tombstoned? hash\) \(tombstone-e)87 528 Q
(xpired? hash\)\))-.15 E(\(collect-object! hash\)\)\))92 540 Q
(\(all-object-hashes\)\)\) `)82 552 Q -.74(``)-.74 G(---)72 576 Q
(Grace Periods)72 600 Q(Write Grace Period)72 624 Q -.74(```)72 648 S(s\
cheme ;; Recently written objects are protected \(de\214ne *write-grace\
-period* 86400\)).74 E 2.5(;2)5 G 2.5(4h)-2.5 G(ours)-2.5 E
(\(de\214ne \(recent-write? hash\))72 672 Q
(\(let \(\(obj \(soup-get hash\)\)\))77 684 Q(\(and obj)82 696 Q
(\(< \(- \(current-time\) \(soup-object-created obj\)\))94.5 708 Q
(*write-grace-period*\)\)\)\) `)102 720 Q -.74(``)-.74 G
(Replication Grace Period)72 744 Q -.74(```)72 768 S(scheme ;; Objects \
pending replication are protected \(de\214ne pending-replication \(mak)
.74 E(e-hash-set\)\))-.1 E(\(de\214ne \(mark-pending-replication hash v)
72 792 Q(aults\))-.25 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(hash-set-add! pending-replication hash\))77 12
Q(\(audit-append action: `\(pending-replication ,hash ,v)77 24 Q
(aults\)\)\))-.25 E(\(de\214ne \(clear)72 48 Q
(-pending-replication hash\))-.2 E(\(hash-set-remo)77 60 Q -.15(ve)-.15
G 2.5(!p).15 G(ending-replication hash\)\))-2.5 E
(\(de\214ne \(pending-replication? hash\))72 84 Q
(\(hash-set-member? pending-replication hash\)\) `)77 96 Q -.74(``)-.74
G(---)72 120 Q(Distrib)72 144 Q(uted GC)-.2 E(Coordinated Collection)72
168 Q -.74(```)72 192 S(scheme ;; Multi-v).74 E
(ault GC requires coordination \(de\214ne \(distrib)-.25 E(uted-gc v)-.2
E(aults\))-.25 E("Coordinate GC across v)77 204 Q(ault federation")-.25
E(;; Phase 1: Gather root sets)77 216 Q(\(let \(\(root-sets \(map v)77
228 Q(ault-roots v)-.25 E(aults\)\)\))-.25 E
(;; Phase 2: Compute global reachability)82 240 Q(\(let \(\(global-mark)
82 252 Q(ed \(union-all root-sets\)\)\))-.1 E
(;; Phase 3: Local sweep \(conserv)87 264 Q(ati)-.25 E -.15(ve)-.25 G
(\)).15 E(\(for)87 276 Q(-each \(lambda \(v)-.2 E(ault\))-.25 E(\(v)117
288 Q(ault-sweep v)-.25 E(ault global-mark)-.25 E(ed\)\))-.1 E -.25(va)
112 300 S(ults\)\)\)\) `).25 E -.74(``)-.74 G(Remote Reference T)72 324
Q(racking)-.35 E -.74(```)72 348 S(scheme ;; T).74 E
(rack references from remote v)-.35 E
(aults \(de\214ne remote-refs \(mak)-.25 E(e-hash-table\)\))-.1 E
(\(de\214ne \(add-remote-reference v)72 372 Q(ault-id hash\))-.25 E
(\(let \(\(refs \(hash-table-ref remote-refs hash '\(\)\)\)\))77 384 Q
(\(hash-table-set! remote-refs hash \(cons v)82 396 Q
(ault-id refs\)\)\)\))-.25 E(\(de\214ne \(remo)72 420 Q -.15(ve)-.15 G
(-remote-reference v).15 E(ault-id hash\))-.25 E
(\(let \(\(refs \(hash-table-ref remote-refs hash '\(\)\)\)\))77 432 Q
(\(hash-table-set! remote-refs hash \(delete v)82 444 Q
(ault-id refs\)\)\)\))-.25 E(\(de\214ne \(has-remote-references? hash\))
72 468 Q
(\(not \(null? \(hash-table-ref remote-refs hash '\(\)\)\)\)\) `)77 480
Q -.74(``)-.74 G(Lease-Based Collection)72 504 Q -.74(```)72 528 S
(scheme ;; Remote v).74 E(aults lease objects \(de\214ne leases \(mak)
-.25 E(e-hash-table\)\))-.1 E(\(de\214ne \(grant-lease hash v)72 552 Q
(ault-id duration\))-.25 E(\(let \(\(e)77 564 Q
(xpires \(+ \(current-time\) duration\)\)\))-.15 E
(\(hash-table-set! leases hash)82 576 Q(\(cons \(cons v)87 588 Q
(ault-id e)-.25 E(xpires\))-.15 E
(\(hash-table-ref leases hash '\(\)\)\)\)\)\))102 600 Q
(\(de\214ne \(lease-acti)72 624 Q -.15(ve)-.25 G 2.5(?h).15 G(ash\))-2.5
E(\(let \(\(hash-leases \(hash-table-ref leases hash '\(\)\)\)\))77 636
Q(\(an)82 648 Q 2.5(y\()-.15 G(lambda \(lease\))-2.5 E
(\(> \(cdr lease\) \(current-time\)\)\))99.5 660 Q(hash-leases\)\)\) `)
94.5 672 Q -.74(``)-.74 G(---)72 696 Q(GC Scheduling)72 720 Q -.35(Tr)72
744 S(iggers).35 E -.74(```)72 768 S(scheme ;; GC triggered by v).74 E
(arious conditions \(de\214ne \(should-gc?\))-.25 E
(\(or \(> \(storage-usage-percent\) 80\))77 780 Q 2.5(;D)15 G
(isk pressure)-2.5 E(\(> \(orphan-estimate\) 10000\))87 792 Q 2.5(;M)
22.5 G(an)-2.5 E 2.5(yo)-.15 G(rphans)-2.5 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(> \(time-since-last-gc\) 86400\)\)\))87 12 Q
2.5(;D)10 G(aily minimum)-2.5 E(\(de\214ne \(gc-schedule\))72 36 Q
("Run appropriate GC based on conditions")77 48 Q(\(cond)77 60 Q
(\(\(> \(storage-usage-percent\) 95\))82 72 Q 62.5(\(gc-full\)\) ;)87 84
R(Emer)2.5 E(genc)-.18 E(y: full GC)-.15 E
(\(\(> \(storage-usage-percent\) 80\))82 96 Q
(\(gc-generation 'young\)\))87 108 Q 2.5(;P)32.5 G(ressure: young gen)
-2.5 E(\(else)82 120 Q 40(\(gc-incremental\)\)\)\) ;)87 132 R
(Normal: incremental `)2.5 E -.74(``)-.74 G(Background GC)72 156 Q -.74
(```)72 180 S(scheme \(de\214ne gc-thread #f\)).74 E
(\(de\214ne \(start-gc-daemon interv)72 204 Q(al\))-.25 E
(\(set! gc-thread)77 216 Q(\(thread-start!)82 228 Q(\(mak)87 240 Q
(e-thread)-.1 E(\(lambda \(\))92 252 Q(\(let loop \(\))97 264 Q
(\(thread-sleep! interv)102 276 Q(al\))-.25 E(\(when \(should-gc?\))102
288 Q(\(gc-schedule\)\))107 300 Q(\(loop\)\)\)\)\)\)\) `)102 312 Q -.74
(``)-.74 G(---)72 336 Q(Safety Mechanisms)72 360 Q(Dry Run)72 384 Q -.74
(```)72 408 S(scheme \(de\214ne \(gc-dry-run\)).74 E("Report what w)77
420 Q(ould be collected without collecting")-.1 E(\(let* \(\(mark)77 432
Q(ed \(mark-reachable\)\))-.1 E(\(w)94.5 444 Q
(ould-collect \(\214lter \(lambda \(h\))-.1 E
(\(not \(hash-set-member? mark)157 456 Q(ed h\)\)\))-.1 E
(\(all-object-hashes\)\)\)\))152 468 Q(`\(\(w)82 480 Q
(ould-collect . ,\(length w)-.1 E(ould-collect\)\))-.1 E
(\(bytes . ,\(sum \(map object-size w)87 492 Q(ould-collect\)\)\))-.1 E
(\(samples . ,\(tak)87 504 Q 2.5(ew)-.1 G(ould-collect 10\)\)\)\)\) `)
-2.6 E -.74(``)-.74 G(Collection Log)72 528 Q -.74(```)72 552 S
(scheme ;; Ev).74 E(ery collection is logged with reco)-.15 E -.15(ve)
-.15 G(ry info \(de\214ne \(collect-with-log! hash\)).15 E
(\(let \(\(obj \(cas-get hash\)\)\))77 564 Q
(;; Log enough to reconstruct if needed)82 576 Q(\(audit-append)82 588 Q
(action: 'gc-collect)87 600 Q(hash: hash)87 612 Q
(size: \(object-size obj\))87 624 Q(type: \(soup-object-type obj\))87
636 Q(references: \(object-references hash\))87 648 Q
(metadata: \(soup-object-metadata obj\)\))87 660 Q
(\(cas-delete! hash\)\)\) `)82 672 Q -.74(``)-.74 G(Reco)72 696 Q -.15
(ve)-.15 G(ry).15 E -.74(```)72 720 S(scheme ;; Reco).74 E -.15(ve)-.15
G 2.5(rr).15 G
(ecently collected object from audit log \(de\214ne \(gc-reco)-2.5 E
-.15(ve)-.15 G 2.5(rh).15 G(ash\))-2.5 E("Attempt to reco)77 732 Q -.15
(ve)-.15 G 2.5(rc).15 G(ollected object")-2.5 E
(\(let \(\(entry \(\214nd \(lambda \(e\))77 744 Q
(\(and \(eq? \(audit-action e\) 'gc-collect\))129.5 756 Q
(\(equal? \(audit-hash e\) hash\)\)\))142 768 Q
(\(recent-audit-entries\)\)\)\))124.5 780 Q(\(if entry)82 792 Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(error "Object collected, metadata preserv)92
12 Q(ed in audit")-.15 E(\(audit-metadata entry\)\))109.5 24 Q
(\(error "Object not found in recent collections"\)\)\)\) `)92 36 Q -.74
(``)-.74 G(---)72 60 Q(Metrics)72 84 Q(GC Statistics)72 108 Q -.74(```)
72 132 S(scheme \(de\214ne gc-stats).74 E(`\(\(collections . 0\))77 144
Q(\(bytes-freed . 0\))82 156 Q(\(objects-freed . 0\))82 168 Q
(\(total-time . 0\))82 180 Q(\(last-gc . #f\)\)\))82 192 Q
(\(de\214ne \(update-gc-stats collected duration\))72 216 Q
(\(set! gc-stats)77 228 Q
(`\(\(collections . ,\(+ 1 \(assoc-ref gc-stats 'collections\)\)\))82
240 Q(\(bytes-freed . ,\(+ \(sum \(map object-size collected\)\))87 252
Q(\(assoc-ref gc-stats 'bytes-freed\)\)\))134.5 264 Q
(\(objects-freed . ,\(+ \(length collected\))87 276 Q
(\(assoc-ref gc-stats 'objects-freed\)\)\))139.5 288 Q
(\(total-time . ,\(+ duration \(assoc-ref gc-stats ')87 300 Q
(total-time\)\)\))-.18 E(\(last-gc . ,\(current-time\)\)\)\)\) `)87 312
Q -.74(``)-.74 G(Monitoring)72 336 Q -.74(```)72 360 S
(scheme ;; Expose GC metrics \(de\214ne \(gc-metrics\)).74 E
(`\(\(storage-used . ,\(storage-used\)\))77 372 Q
(\(storage-total . ,\(storage-total\)\))82 384 Q
(\(object-count . ,\(object-count\)\))82 396 Q
(\(orphan-estimate . ,\(orphan-estimate\)\))82 408 Q
(\(pinned-count . ,\(hash-table-size pins\)\))82 420 Q
(\(gc-stats . ,gc-stats\)\)\) `)82 432 Q -.74(``)-.74 G(---)72 456 Q
(Security Considerations)72 480 Q(GC as Side Channel)72 504 Q -.74(```)
72 528 S .434(scheme ;; GC timing can leak information about object ref\
erences ;; Use constant-time operations where possible).74 F
(\(de\214ne \(constant-time-mark hash\))72 540 Q
(\(let \(\(refs \(object-references hash\)\)\))77 552 Q(;; Al)82 564 Q
-.1(wa)-.1 G(ys process same number of refs).1 E(\(for)82 576 Q
(-each mark \(pad-list refs *max-refs*\)\)\)\) `)-.2 E -.74(``)-.74 G
(Denial of Service)72 600 Q -.74(```)72 624 S(scheme ;; Pre).74 E -.15
(ve)-.25 G(nt GC starv).15 E(ation attacks \(de\214ne *max-pins-per)-.25
E(-principal* 10000\))-.2 E(\(de\214ne \(pin-with-limit! hash reason\))
72 648 Q
(\(let \(\(count \(principal-pin-count \(current-principal\)\)\)\))77
660 Q(\(when \(> count *max-pins-per)82 672 Q(-principal*\))-.2 E
(\(error "Pin limit e)87 684 Q(xceeded"\)\))-.15 E
(\(pin! hash reason\)\)\) `)82 696 Q -.74(``)-.74 G(---)72 720 Q
(References)72 744 Q 1.508
(1. [The Garbage Collection Handbook]\(https://gchandbook.or)72 768 R
1.507(g/\) - Jones, Hosking, Moss 2. [On-the-Fly Garbage)-.18 F
(Collection]\(https://dl.acm.or)72 780 Q .875
(g/doi/10.1145/359642.359655\) - Dijkstra et al.)-.18 F .875
(3. [RFC-020: Content-Addressed Stor)5.875 F(-)-.2 E(age]\(rfc-020-cont\
ent-addressed-storage.md\) 4. [RFC-003: Cryptographic Audit T)72 792 Q
(rail]\(rfc-003-audit-trail.md\))-.35 E 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(---)72 24 Q(Changelog)72 48 Q 2.5(-*)72 72 S
(*2026-01-07** - Initial draft)-2.5 E(---)72 96 Q .349(**Implementation\
 Status:** Draft **Dependencies:** cas, soup, audit **Inte)72 120 R .349
(gration:** Storage management, repli-)-.15 F(cation, v)72 132 Q
(ault maintenance)-.25 E 0 Cg EP
%%Trailer
end
%%EOF
