<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <title>Memo 041: Wormholes (FUSE Filesystem Layer)</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27%230f0%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>">
  <script>
(function(){
  var h=new Date().getHours(),c;
  if(h>=4&&h<6)c='%23845EC2';       // brahma muhurta - violet
  else if(h>=6&&h<8)c='%23ffd700';  // dawn - gold
  else if(h>=8&&h<11)c='%2300d4aa'; // morning - teal
  else if(h>=11&&h<14)c='%230f0';   // midday - phosphor
  else if(h>=14&&h<17)c='%2339ff14';// afternoon - neon
  else if(h>=17&&h<19)c='%23ff6600';// sunset - orange
  else if(h>=19&&h<22)c='%23ff3366';// evening - coral
  else c='%2300ffff';               // night - cyan
  document.getElementById('favicon').href='data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 32 32%27><text x=%2716%27 y=%2725%27 font-family=%27serif%27 font-size=%2728%27 fill=%27'+c+'%27 text-anchor=%27middle%27 font-weight=%27bold%27>λ</text></svg>';
})();
</script>
  <link rel="stylesheet" href="memo.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>Memo 041: Wormholes (FUSE Filesystem Layer)</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This RFC specifies wormholes—FUSE-based bidirectional portals between the macOS filesystem and the Library of Cyberspace vault. Wormholes preserve full metadata including extended attributes, Finder tags, and ACLs. All operations are auditable (RFC-003) and rate-limited (RFC-032).[^h1]</p>
<p>[^h1]: Historical: FUSE originated in Linux 2.6 (2005), inspired by earlier userspace filesystem work in Plan 9 and Hurd. macFUSE (originally MacFUSE) brought it to macOS in 2007. The abstraction outlived Apple's hostility.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Users need seamless integration between their existing filesystem and the vault. Manual import/export creates friction and risks metadata loss.</p>
<p>A wormhole provides:</p>
<p>1. Transparency — Finder, cp, rsync work unchanged 2. Bidirectionality — No separate sync step; it IS the filesystem 3. Metadata preservation — Full macOS attributes captured automatically 4. Content addressing — Deduplication and integrity built-in 5. Security — First-class SPKI object with audit and rate-limit</p>
<p>The filesystem abstraction is the right boundary—everything above it (apps, shell, Finder) works without modification.[^d1]</p>
<p>[^d1]: Design: FUSE inverts the usual model. Instead of teaching applications about vaults, we teach the vault to speak filesystem. Unix got this right: everything is a file.</p>
</section>
<section>
<h2>Wormhole as Security Object</h2>
<p>A wormhole is a first-class security object in cyberspace, subject to:[^d2]</p>
<ul>
<li>SPKI Authorization (RFC-004) — Opening requires valid certificate</li>
<li>Capability Delegation (RFC-021) — Wormhole access can be delegated</li>
<li>Audit Trail (RFC-003) — All operations logged</li>
<li>Rate Limiting (RFC-032) — Configurable ops/minute</li>
<li>Sandboxing (RFC-023) — Agents access wormholes through capabilities</li>
</ul>
<p>[^d2]: Design: Wormholes are attack surface. Unrestricted filesystem access defeats vault security. Every wormhole must be explicitly authorized, continuously audited, and rate-limited against abuse.</p>
<h3>Wormhole Certificate</h3>
<pre class="language-scheme">
(define (wormhole-cert issuer fs-path vault-path permissions)
  "Create SPKI certificate authorizing wormhole"
  (create-cert
   issuer
   (wormhole-principal fs-path vault-path)
   `(tag (wormhole
          (fs-path ,fs-path)
          (vault-path ,vault-path)
          (permissions ,@permissions)   ; read, write, delete
          (rate-limit 1000)             ; ops/minute
          (expires ,(+ (current-seconds) 86400))))))
</pre>
<h3>Capability Model</h3>
<p>Wormholes support fine-grained capabilities:[^d3]</p>
<p>[^d3]: Design: Rich capabilities enable principle of least privilege. A backup agent needs read-only; a sync agent needs read-write but not delete. Capabilities compose—grant exactly what's needed.</p>
<p>Table 0: Wormhole Capabilities</p>
<table>
<tr><th>Capability </th><th>Allows </th></tr>
<tr><td>Data Access </td></tr>
<tr><td>read </td><td>Read file contents </td></tr>
<tr><td>write </td><td>Write/modify file contents </td></tr>
<tr><td>create </td><td>Create new files </td></tr>
<tr><td>delete </td><td>Remove files </td></tr>
<tr><td>rename </td><td>Rename/move files </td></tr>
<tr><td>Metadata </td></tr>
<tr><td>stat </td><td>Read POSIX attributes </td></tr>
<tr><td>chmod </td><td>Modify permissions </td></tr>
<tr><td>chown </td><td>Change ownership </td></tr>
<tr><td>xattr-read </td><td>Read extended attributes </td></tr>
<tr><td>xattr-write </td><td>Modify extended attributes </td></tr>
<tr><td>acl-read </td><td>Read ACLs </td></tr>
<tr><td>acl-write </td><td>Modify ACLs </td></tr>
<tr><td>Directory </td></tr>
<tr><td>readdir </td><td>List directory contents </td></tr>
<tr><td>mkdir </td><td>Create directories </td></tr>
<tr><td>rmdir </td><td>Remove directories </td></tr>
<tr><td>Control </td></tr>
<tr><td>admin </td><td>Configure wormhole </td></tr>
<tr><td>delegate </td><td>Delegate capabilities to others </td></tr>
<tr><td>audit-read </td><td>Read wormhole audit log </td></tr>
<tr><td>rate-limit </td><td>Modify rate limits </td></tr>
</table>
<h3>Capability Composition</h3>
<pre class="language-scheme">
;; Common capability sets (long form for readability)
(define capability:read-only
  '(read stat readdir xattr-read acl-read))

(define capability:read-write
  '(read write create stat chmod readdir mkdir xattr-read xattr-write))

(define capability:full
  '(read write create delete rename
    stat chmod chown
    xattr-read xattr-write acl-read acl-write
    readdir mkdir rmdir admin delegate audit-read rate-limit))

(define capability:backup
  '(read stat readdir xattr-read acl-read))

(define capability:synchronize
  '(read write create delete rename
    stat chmod readdir mkdir rmdir
    xattr-read xattr-write))
</pre>
<h3>Capability Attenuation</h3>
<p>Capabilities can only be reduced, never amplified:[^r1]</p>
<p>[^r1]: Research: Capability attenuation is fundamental to the object-capability model. See Miller, "Robust Composition" (2006). You cannot grant more authority than you possess.</p>
<pre class="language-scheme">
(define (wormhole-delegate wormhole new-caps recipient)
  "Delegate subset of wormhole capabilities"
  (let ((my-caps (wormhole-capabilities wormhole)))
    (unless (subset? new-caps my-caps)
      (error 'capability-amplification
             "Cannot delegate capabilities you don't have"))
    (wormhole-cert
     (wormhole-issuer wormhole)
     (wormhole-fs-path wormhole)
     (wormhole-vault-path wormhole)
     new-caps
     recipient: recipient)))
</pre>
<h3>Opening a Wormhole</h3>
<pre class="language-scheme">
(define (wormhole-open fs-path #!key (vault-path "/")
                                     (capabilities capability:read-write)
                                     (rate-limit 1000)
                                     (locked #f)
                                     (auth-required '())
                                     (certificate #f))
  "Open wormhole - requires valid certificate"
  (unless certificate
    (error 'unauthorized "Wormhole requires SPKI certificate"))
  (unless (verify-wormhole-cert certificate fs-path vault-path)
    (error 'unauthorized "Invalid wormhole certificate"))
  ;; Audit the open
  (wormhole-audit 'wormhole-open fs-path
                  `((vault ,vault-path)
                    (capabilities ,(length capabilities))))
  ;; Proceed with FUSE mount
  ...)
</pre>
<h3>Usage Examples</h3>
<pre class="language-scheme">
;; Basic read-write wormhole
(wormhole-open "~/Cyberspace")

;; Read-only wormhole for browsing
(wormhole-open "~/Archive" capabilities: capability:read-only)

;; Sync wormhole with rate limiting
(wormhole-open "~/Sync"
  capabilities: capability:synchronize
  rate-limit: 500)

;; Locked wormhole requiring unlock for sensitive operations
(wormhole-open "~/Secure"
  capabilities: capability:full
  locked: #t
  auth-required: '(delete admin))
</pre>
</section>
<section>
<h2>Architecture</h2>
<h3>Mount Topology</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 624.0 249.6" width="624.0" height="249.6" xmlns="http://www.w3.org/2000/svg">
<style>
  line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; }
  text { font-family: 'Hack', 'SF Mono', monospace; font-size: 14px; fill: currentColor; }
</style>
<line x1="4.8" y1="19.2" x2="4.8" y2="38.4"/>
<line x1="4.8" y1="28.8" x2="9.6" y2="28.8"/>
<line x1="9.6" y1="28.8" x2="19.2" y2="28.8"/>
<line x1="19.2" y1="28.8" x2="28.8" y2="28.8"/>
<line x1="4.8" y1="38.4" x2="4.8" y2="57.6"/>
<line x1="43.2" y1="38.4" x2="43.2" y2="57.6"/>
<line x1="43.2" y1="48.0" x2="48.0" y2="48.0"/>
<line x1="48.0" y1="48.0" x2="57.6" y2="48.0"/>
<line x1="57.6" y1="48.0" x2="67.2" y2="48.0"/>
<line x1="4.8" y1="57.6" x2="4.8" y2="76.8"/>
<line x1="43.2" y1="67.2" x2="48.0" y2="67.2"/>
<line x1="43.2" y1="57.6" x2="43.2" y2="67.2"/>
<line x1="48.0" y1="67.2" x2="57.6" y2="67.2"/>
<line x1="57.6" y1="67.2" x2="67.2" y2="67.2"/>
<line x1="4.8" y1="76.8" x2="4.8" y2="96.0"/>
<line x1="4.8" y1="86.4" x2="9.6" y2="86.4"/>
<line x1="9.6" y1="86.4" x2="19.2" y2="86.4"/>
<line x1="19.2" y1="86.4" x2="28.8" y2="86.4"/>
<line x1="4.8" y1="96.0" x2="4.8" y2="115.2"/>
<line x1="43.2" y1="105.6" x2="48.0" y2="105.6"/>
<line x1="43.2" y1="96.0" x2="43.2" y2="105.6"/>
<line x1="48.0" y1="105.6" x2="57.6" y2="105.6"/>
<line x1="57.6" y1="105.6" x2="67.2" y2="105.6"/>
<line x1="4.8" y1="115.2" x2="4.8" y2="134.4"/>
<line x1="81.6" y1="124.8" x2="86.4" y2="124.8"/>
<line x1="81.6" y1="115.2" x2="81.6" y2="124.8"/>
<line x1="86.4" y1="124.8" x2="96.0" y2="124.8"/>
<line x1="96.0" y1="124.8" x2="105.6" y2="124.8"/>
<line x1="4.8" y1="144.0" x2="9.6" y2="144.0"/>
<line x1="4.8" y1="134.4" x2="4.8" y2="144.0"/>
<line x1="9.6" y1="144.0" x2="19.2" y2="144.0"/>
<line x1="19.2" y1="144.0" x2="28.8" y2="144.0"/>
<line x1="43.2" y1="153.6" x2="43.2" y2="172.8"/>
<line x1="43.2" y1="163.2" x2="48.0" y2="163.2"/>
<line x1="48.0" y1="163.2" x2="57.6" y2="163.2"/>
<line x1="57.6" y1="163.2" x2="67.2" y2="163.2"/>
<line x1="43.2" y1="172.8" x2="43.2" y2="192.0"/>
<line x1="81.6" y1="172.8" x2="81.6" y2="192.0"/>
<line x1="81.6" y1="182.4" x2="86.4" y2="182.4"/>
<line x1="86.4" y1="182.4" x2="96.0" y2="182.4"/>
<line x1="96.0" y1="182.4" x2="105.6" y2="182.4"/>
<line x1="43.2" y1="192.0" x2="43.2" y2="211.2"/>
<line x1="81.6" y1="201.6" x2="86.4" y2="201.6"/>
<line x1="81.6" y1="192.0" x2="81.6" y2="201.6"/>
<line x1="86.4" y1="201.6" x2="96.0" y2="201.6"/>
<line x1="96.0" y1="201.6" x2="105.6" y2="201.6"/>
<line x1="43.2" y1="211.2" x2="43.2" y2="230.4"/>
<line x1="43.2" y1="220.8" x2="48.0" y2="220.8"/>
<line x1="48.0" y1="220.8" x2="57.6" y2="220.8"/>
<line x1="57.6" y1="220.8" x2="67.2" y2="220.8"/>
<line x1="43.2" y1="240.0" x2="48.0" y2="240.0"/>
<line x1="43.2" y1="230.4" x2="43.2" y2="240.0"/>
<line x1="48.0" y1="240.0" x2="57.6" y2="240.0"/>
<line x1="57.6" y1="240.0" x2="67.2" y2="240.0"/>
<text x="4.8" y="9.6" text-anchor="middle" dominant-baseline="central">~</text>
<text x="14.4" y="9.6" text-anchor="middle" dominant-baseline="central">/</text>
<text x="24.0" y="9.6" text-anchor="middle" dominant-baseline="central">C</text>
<text x="33.6" y="9.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="43.2" y="9.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="52.8" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="62.4" y="9.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="72.0" y="9.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="81.6" y="9.6" text-anchor="middle" dominant-baseline="central">p</text>
<text x="91.2" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="100.8" y="9.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="110.4" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="120.0" y="9.6" text-anchor="middle" dominant-baseline="central">/</text>
<text x="321.6" y="9.6" text-anchor="middle" dominant-baseline="central">←</text>
<text x="340.8" y="9.6" text-anchor="middle" dominant-baseline="central">F</text>
<text x="350.4" y="9.6" text-anchor="middle" dominant-baseline="central">U</text>
<text x="360.0" y="9.6" text-anchor="middle" dominant-baseline="central">S</text>
<text x="369.6" y="9.6" text-anchor="middle" dominant-baseline="central">E</text>
<text x="388.8" y="9.6" text-anchor="middle" dominant-baseline="central">m</text>
<text x="398.4" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="408.0" y="9.6" text-anchor="middle" dominant-baseline="central">u</text>
<text x="417.6" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="427.2" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="446.4" y="9.6" text-anchor="middle" dominant-baseline="central">p</text>
<text x="456.0" y="9.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="465.6" y="9.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="475.2" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="484.8" y="9.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="43.2" y="28.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="52.8" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="62.4" y="28.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="72.0" y="28.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="81.6" y="28.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="91.2" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="100.8" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="110.4" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="120.0" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="129.6" y="28.8" text-anchor="middle" dominant-baseline="central">/</text>
<text x="81.6" y="48.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="91.2" y="48.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="100.8" y="48.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="110.4" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="120.0" y="48.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="129.6" y="48.0" text-anchor="middle" dominant-baseline="central">.</text>
<text x="139.2" y="48.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="148.8" y="48.0" text-anchor="middle" dominant-baseline="central">d</text>
<text x="158.4" y="48.0" text-anchor="middle" dominant-baseline="central">f</text>
<text x="312.0" y="48.0" text-anchor="middle" dominant-baseline="central">←</text>
<text x="331.2" y="48.0" text-anchor="middle" dominant-baseline="central">V</text>
<text x="340.8" y="48.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="350.4" y="48.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="360.0" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="369.6" y="48.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="379.2" y="48.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="388.8" y="48.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="408.0" y="48.0" text-anchor="middle" dominant-baseline="central">f</text>
<text x="417.6" y="48.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="427.2" y="48.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="436.8" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="456.0" y="48.0" text-anchor="middle" dominant-baseline="central">(</text>
<text x="465.6" y="48.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="475.2" y="48.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="484.8" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="494.4" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="504.0" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="513.6" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="523.2" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="542.4" y="48.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="552.0" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="571.2" y="48.0" text-anchor="middle" dominant-baseline="central">v</text>
<text x="580.8" y="48.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="590.4" y="48.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="600.0" y="48.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="609.6" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="619.2" y="48.0" text-anchor="middle" dominant-baseline="central">)</text>
<text x="81.6" y="67.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="91.2" y="67.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="100.8" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="110.4" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="120.0" y="67.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="129.6" y="67.2" text-anchor="middle" dominant-baseline="central">.</text>
<text x="139.2" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="148.8" y="67.2" text-anchor="middle" dominant-baseline="central">x</text>
<text x="158.4" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="43.2" y="86.4" text-anchor="middle" dominant-baseline="central">p</text>
<text x="52.8" y="86.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="62.4" y="86.4" text-anchor="middle" dominant-baseline="central">o</text>
<text x="72.0" y="86.4" text-anchor="middle" dominant-baseline="central">j</text>
<text x="81.6" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="91.2" y="86.4" text-anchor="middle" dominant-baseline="central">c</text>
<text x="100.8" y="86.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="110.4" y="86.4" text-anchor="middle" dominant-baseline="central">s</text>
<text x="120.0" y="86.4" text-anchor="middle" dominant-baseline="central">/</text>
<text x="81.6" y="105.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="91.2" y="105.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="100.8" y="105.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="110.4" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="120.0" y="105.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="129.6" y="105.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="139.2" y="105.6" text-anchor="middle" dominant-baseline="central">p</text>
<text x="148.8" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="158.4" y="105.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="168.0" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="177.6" y="105.6" text-anchor="middle" dominant-baseline="central">/</text>
<text x="120.0" y="124.8" text-anchor="middle" dominant-baseline="central">.</text>
<text x="129.6" y="124.8" text-anchor="middle" dominant-baseline="central">.</text>
<text x="139.2" y="124.8" text-anchor="middle" dominant-baseline="central">.</text>
<text x="43.2" y="144.0" text-anchor="middle" dominant-baseline="central">.</text>
<text x="52.8" y="144.0" text-anchor="middle" dominant-baseline="central">v</text>
<text x="62.4" y="144.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="72.0" y="144.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="81.6" y="144.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="91.2" y="144.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="100.8" y="144.0" text-anchor="middle" dominant-baseline="central">/</text>
<text x="321.6" y="144.0" text-anchor="middle" dominant-baseline="central">←</text>
<text x="340.8" y="144.0" text-anchor="middle" dominant-baseline="central">H</text>
<text x="350.4" y="144.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="360.0" y="144.0" text-anchor="middle" dominant-baseline="central">d</text>
<text x="369.6" y="144.0" text-anchor="middle" dominant-baseline="central">d</text>
<text x="379.2" y="144.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="388.8" y="144.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="398.4" y="144.0" text-anchor="middle" dominant-baseline="central">,</text>
<text x="417.6" y="144.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="427.2" y="144.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="436.8" y="144.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="446.4" y="144.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="456.0" y="144.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="465.6" y="144.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="484.8" y="144.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="494.4" y="144.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="504.0" y="144.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="513.6" y="144.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="523.2" y="144.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="532.8" y="144.0" text-anchor="middle" dominant-baseline="central">g</text>
<text x="542.4" y="144.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="81.6" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="91.2" y="163.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="100.8" y="163.2" text-anchor="middle" dominant-baseline="central">j</text>
<text x="110.4" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="120.0" y="163.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="129.6" y="163.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="139.2" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="148.8" y="163.2" text-anchor="middle" dominant-baseline="central">/</text>
<text x="321.6" y="163.2" text-anchor="middle" dominant-baseline="central">←</text>
<text x="340.8" y="163.2" text-anchor="middle" dominant-baseline="central">C</text>
<text x="350.4" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="360.0" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="369.6" y="163.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="379.2" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="388.8" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="398.4" y="163.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="408.0" y="163.2" text-anchor="middle" dominant-baseline="central">-</text>
<text x="417.6" y="163.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="427.2" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="436.8" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="446.4" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="456.0" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="465.6" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="475.2" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="484.8" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="494.4" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="513.6" y="163.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="523.2" y="163.2" text-anchor="middle" dominant-baseline="central">l</text>
<text x="532.8" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="542.4" y="163.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="552.0" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="120.0" y="182.4" text-anchor="middle" dominant-baseline="central">s</text>
<text x="129.6" y="182.4" text-anchor="middle" dominant-baseline="central">h</text>
<text x="139.2" y="182.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="148.8" y="182.4" text-anchor="middle" dominant-baseline="central">2</text>
<text x="158.4" y="182.4" text-anchor="middle" dominant-baseline="central">5</text>
<text x="168.0" y="182.4" text-anchor="middle" dominant-baseline="central">6</text>
<text x="177.6" y="182.4" text-anchor="middle" dominant-baseline="central">:</text>
<text x="187.2" y="182.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="196.8" y="182.4" text-anchor="middle" dominant-baseline="central">b</text>
<text x="206.4" y="182.4" text-anchor="middle" dominant-baseline="central">c</text>
<text x="216.0" y="182.4" text-anchor="middle" dominant-baseline="central">1</text>
<text x="225.6" y="182.4" text-anchor="middle" dominant-baseline="central">2</text>
<text x="235.2" y="182.4" text-anchor="middle" dominant-baseline="central">3</text>
<text x="244.8" y="182.4" text-anchor="middle" dominant-baseline="central">.</text>
<text x="254.4" y="182.4" text-anchor="middle" dominant-baseline="central">.</text>
<text x="264.0" y="182.4" text-anchor="middle" dominant-baseline="central">.</text>
<text x="120.0" y="201.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="129.6" y="201.6" text-anchor="middle" dominant-baseline="central">h</text>
<text x="139.2" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="148.8" y="201.6" text-anchor="middle" dominant-baseline="central">2</text>
<text x="158.4" y="201.6" text-anchor="middle" dominant-baseline="central">5</text>
<text x="168.0" y="201.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="177.6" y="201.6" text-anchor="middle" dominant-baseline="central">:</text>
<text x="187.2" y="201.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="196.8" y="201.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="206.4" y="201.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="216.0" y="201.6" text-anchor="middle" dominant-baseline="central">4</text>
<text x="225.6" y="201.6" text-anchor="middle" dominant-baseline="central">5</text>
<text x="235.2" y="201.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="244.8" y="201.6" text-anchor="middle" dominant-baseline="central">.</text>
<text x="254.4" y="201.6" text-anchor="middle" dominant-baseline="central">.</text>
<text x="264.0" y="201.6" text-anchor="middle" dominant-baseline="central">.</text>
<text x="81.6" y="220.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="91.2" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="100.8" y="220.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="110.4" y="220.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="120.0" y="220.8" text-anchor="middle" dominant-baseline="central">f</text>
<text x="129.6" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="139.2" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="148.8" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="158.4" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="168.0" y="220.8" text-anchor="middle" dominant-baseline="central">/</text>
<text x="321.6" y="220.8" text-anchor="middle" dominant-baseline="central">←</text>
<text x="340.8" y="220.8" text-anchor="middle" dominant-baseline="central">D</text>
<text x="350.4" y="220.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="360.0" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="369.6" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="379.2" y="220.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="388.8" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="398.4" y="220.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="408.0" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="417.6" y="220.8" text-anchor="middle" dominant-baseline="central">y</text>
<text x="436.8" y="220.8" text-anchor="middle" dominant-baseline="central">→</text>
<text x="456.0" y="220.8" text-anchor="middle" dominant-baseline="central">f</text>
<text x="465.6" y="220.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="475.2" y="220.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="484.8" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="504.0" y="220.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="513.6" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="523.2" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="532.8" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="542.4" y="220.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="552.0" y="220.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="561.6" y="220.8" text-anchor="middle" dominant-baseline="central">g</text>
<text x="571.2" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="81.6" y="240.0" text-anchor="middle" dominant-baseline="central">m</text>
<text x="91.2" y="240.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="100.8" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="110.4" y="240.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="120.0" y="240.0" text-anchor="middle" dominant-baseline="central">d</text>
<text x="129.6" y="240.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="139.2" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="148.8" y="240.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="158.4" y="240.0" text-anchor="middle" dominant-baseline="central">/</text>
<text x="321.6" y="240.0" text-anchor="middle" dominant-baseline="central">←</text>
<text x="340.8" y="240.0" text-anchor="middle" dominant-baseline="central">P</text>
<text x="350.4" y="240.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="360.0" y="240.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="369.6" y="240.0" text-anchor="middle" dominant-baseline="central">-</text>
<text x="379.2" y="240.0" text-anchor="middle" dominant-baseline="central">f</text>
<text x="388.8" y="240.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="398.4" y="240.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="408.0" y="240.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="427.2" y="240.0" text-anchor="middle" dominant-baseline="central">m</text>
<text x="436.8" y="240.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="446.4" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="456.0" y="240.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="465.6" y="240.0" text-anchor="middle" dominant-baseline="central">d</text>
<text x="475.2" y="240.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="484.8" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="494.4" y="240.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="513.6" y="240.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="523.2" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="532.8" y="240.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="542.4" y="240.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="552.0" y="240.0" text-anchor="middle" dominant-baseline="central">e</text>
</svg>
</div>
<h3>Component Stack</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 489.6 249.6" width="489.6" height="249.6" xmlns="http://www.w3.org/2000/svg">
<style>
  line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; }
  text { font-family: 'Hack', 'SF Mono', monospace; font-size: 14px; fill: currentColor; }
</style>
<line x1="4.8" y1="9.6" x2="9.6" y2="9.6"/>
<line x1="4.8" y1="9.6" x2="4.8" y2="19.2"/>
<line x1="9.6" y1="9.6" x2="19.2" y2="9.6"/>
<line x1="19.2" y1="9.6" x2="28.8" y2="9.6"/>
<line x1="28.8" y1="9.6" x2="38.4" y2="9.6"/>
<line x1="38.4" y1="9.6" x2="48.0" y2="9.6"/>
<line x1="48.0" y1="9.6" x2="57.6" y2="9.6"/>
<line x1="57.6" y1="9.6" x2="67.2" y2="9.6"/>
<line x1="67.2" y1="9.6" x2="76.8" y2="9.6"/>
<line x1="76.8" y1="9.6" x2="86.4" y2="9.6"/>
<line x1="86.4" y1="9.6" x2="96.0" y2="9.6"/>
<line x1="96.0" y1="9.6" x2="105.6" y2="9.6"/>
<line x1="105.6" y1="9.6" x2="115.2" y2="9.6"/>
<line x1="115.2" y1="9.6" x2="124.8" y2="9.6"/>
<line x1="124.8" y1="9.6" x2="134.4" y2="9.6"/>
<line x1="134.4" y1="9.6" x2="144.0" y2="9.6"/>
<line x1="144.0" y1="9.6" x2="153.6" y2="9.6"/>
<line x1="153.6" y1="9.6" x2="163.2" y2="9.6"/>
<line x1="163.2" y1="9.6" x2="172.8" y2="9.6"/>
<line x1="172.8" y1="9.6" x2="182.4" y2="9.6"/>
<line x1="182.4" y1="9.6" x2="192.0" y2="9.6"/>
<line x1="192.0" y1="9.6" x2="201.6" y2="9.6"/>
<line x1="201.6" y1="9.6" x2="211.2" y2="9.6"/>
<line x1="211.2" y1="9.6" x2="220.8" y2="9.6"/>
<line x1="220.8" y1="9.6" x2="230.4" y2="9.6"/>
<line x1="230.4" y1="9.6" x2="240.0" y2="9.6"/>
<line x1="240.0" y1="9.6" x2="249.6" y2="9.6"/>
<line x1="249.6" y1="9.6" x2="259.2" y2="9.6"/>
<line x1="259.2" y1="9.6" x2="268.8" y2="9.6"/>
<line x1="268.8" y1="9.6" x2="278.4" y2="9.6"/>
<line x1="278.4" y1="9.6" x2="288.0" y2="9.6"/>
<line x1="288.0" y1="9.6" x2="297.6" y2="9.6"/>
<line x1="297.6" y1="9.6" x2="307.2" y2="9.6"/>
<line x1="307.2" y1="9.6" x2="316.8" y2="9.6"/>
<line x1="316.8" y1="9.6" x2="326.4" y2="9.6"/>
<line x1="326.4" y1="9.6" x2="336.0" y2="9.6"/>
<line x1="336.0" y1="9.6" x2="345.6" y2="9.6"/>
<line x1="345.6" y1="9.6" x2="355.2" y2="9.6"/>
<line x1="355.2" y1="9.6" x2="364.8" y2="9.6"/>
<line x1="364.8" y1="9.6" x2="369.6" y2="9.6"/>
<line x1="369.6" y1="9.6" x2="369.6" y2="19.2"/>
<line x1="4.8" y1="19.2" x2="4.8" y2="38.4"/>
<line x1="369.6" y1="19.2" x2="369.6" y2="38.4"/>
<line x1="4.8" y1="38.4" x2="4.8" y2="57.6"/>
<line x1="369.6" y1="38.4" x2="369.6" y2="57.6"/>
<line x1="4.8" y1="57.6" x2="4.8" y2="76.8"/>
<line x1="4.8" y1="67.2" x2="9.6" y2="67.2"/>
<line x1="9.6" y1="67.2" x2="19.2" y2="67.2"/>
<line x1="19.2" y1="67.2" x2="28.8" y2="67.2"/>
<line x1="28.8" y1="67.2" x2="38.4" y2="67.2"/>
<line x1="38.4" y1="67.2" x2="48.0" y2="67.2"/>
<line x1="48.0" y1="67.2" x2="57.6" y2="67.2"/>
<line x1="57.6" y1="67.2" x2="67.2" y2="67.2"/>
<line x1="67.2" y1="67.2" x2="76.8" y2="67.2"/>
<line x1="76.8" y1="67.2" x2="86.4" y2="67.2"/>
<line x1="86.4" y1="67.2" x2="96.0" y2="67.2"/>
<line x1="96.0" y1="67.2" x2="105.6" y2="67.2"/>
<line x1="105.6" y1="67.2" x2="115.2" y2="67.2"/>
<line x1="115.2" y1="67.2" x2="124.8" y2="67.2"/>
<line x1="124.8" y1="67.2" x2="134.4" y2="67.2"/>
<line x1="134.4" y1="67.2" x2="144.0" y2="67.2"/>
<line x1="144.0" y1="67.2" x2="153.6" y2="67.2"/>
<line x1="153.6" y1="67.2" x2="163.2" y2="67.2"/>
<line x1="163.2" y1="67.2" x2="172.8" y2="67.2"/>
<line x1="172.8" y1="67.2" x2="182.4" y2="67.2"/>
<line x1="182.4" y1="67.2" x2="192.0" y2="67.2"/>
<line x1="192.0" y1="67.2" x2="201.6" y2="67.2"/>
<line x1="201.6" y1="67.2" x2="211.2" y2="67.2"/>
<line x1="211.2" y1="67.2" x2="220.8" y2="67.2"/>
<line x1="220.8" y1="67.2" x2="230.4" y2="67.2"/>
<line x1="230.4" y1="67.2" x2="240.0" y2="67.2"/>
<line x1="240.0" y1="67.2" x2="249.6" y2="67.2"/>
<line x1="249.6" y1="67.2" x2="259.2" y2="67.2"/>
<line x1="259.2" y1="67.2" x2="268.8" y2="67.2"/>
<line x1="268.8" y1="67.2" x2="278.4" y2="67.2"/>
<line x1="278.4" y1="67.2" x2="288.0" y2="67.2"/>
<line x1="288.0" y1="67.2" x2="297.6" y2="67.2"/>
<line x1="297.6" y1="67.2" x2="307.2" y2="67.2"/>
<line x1="307.2" y1="67.2" x2="316.8" y2="67.2"/>
<line x1="316.8" y1="67.2" x2="326.4" y2="67.2"/>
<line x1="326.4" y1="67.2" x2="336.0" y2="67.2"/>
<line x1="336.0" y1="67.2" x2="345.6" y2="67.2"/>
<line x1="345.6" y1="67.2" x2="355.2" y2="67.2"/>
<line x1="355.2" y1="67.2" x2="364.8" y2="67.2"/>
<line x1="369.6" y1="57.6" x2="369.6" y2="76.8"/>
<line x1="364.8" y1="67.2" x2="369.6" y2="67.2"/>
<line x1="4.8" y1="76.8" x2="4.8" y2="96.0"/>
<line x1="369.6" y1="76.8" x2="369.6" y2="96.0"/>
<line x1="4.8" y1="96.0" x2="4.8" y2="115.2"/>
<line x1="4.8" y1="105.6" x2="9.6" y2="105.6"/>
<line x1="9.6" y1="105.6" x2="19.2" y2="105.6"/>
<line x1="19.2" y1="105.6" x2="28.8" y2="105.6"/>
<line x1="28.8" y1="105.6" x2="38.4" y2="105.6"/>
<line x1="38.4" y1="105.6" x2="48.0" y2="105.6"/>
<line x1="48.0" y1="105.6" x2="57.6" y2="105.6"/>
<line x1="57.6" y1="105.6" x2="67.2" y2="105.6"/>
<line x1="67.2" y1="105.6" x2="76.8" y2="105.6"/>
<line x1="76.8" y1="105.6" x2="86.4" y2="105.6"/>
<line x1="86.4" y1="105.6" x2="96.0" y2="105.6"/>
<line x1="96.0" y1="105.6" x2="105.6" y2="105.6"/>
<line x1="105.6" y1="105.6" x2="115.2" y2="105.6"/>
<line x1="115.2" y1="105.6" x2="124.8" y2="105.6"/>
<line x1="124.8" y1="105.6" x2="134.4" y2="105.6"/>
<line x1="134.4" y1="105.6" x2="144.0" y2="105.6"/>
<line x1="144.0" y1="105.6" x2="153.6" y2="105.6"/>
<line x1="153.6" y1="105.6" x2="163.2" y2="105.6"/>
<line x1="163.2" y1="105.6" x2="172.8" y2="105.6"/>
<line x1="172.8" y1="105.6" x2="182.4" y2="105.6"/>
<line x1="182.4" y1="105.6" x2="192.0" y2="105.6"/>
<line x1="192.0" y1="105.6" x2="201.6" y2="105.6"/>
<line x1="201.6" y1="105.6" x2="211.2" y2="105.6"/>
<line x1="211.2" y1="105.6" x2="220.8" y2="105.6"/>
<line x1="220.8" y1="105.6" x2="230.4" y2="105.6"/>
<line x1="230.4" y1="105.6" x2="240.0" y2="105.6"/>
<line x1="240.0" y1="105.6" x2="249.6" y2="105.6"/>
<line x1="249.6" y1="105.6" x2="259.2" y2="105.6"/>
<line x1="259.2" y1="105.6" x2="268.8" y2="105.6"/>
<line x1="268.8" y1="105.6" x2="278.4" y2="105.6"/>
<line x1="278.4" y1="105.6" x2="288.0" y2="105.6"/>
<line x1="288.0" y1="105.6" x2="297.6" y2="105.6"/>
<line x1="297.6" y1="105.6" x2="307.2" y2="105.6"/>
<line x1="307.2" y1="105.6" x2="316.8" y2="105.6"/>
<line x1="316.8" y1="105.6" x2="326.4" y2="105.6"/>
<line x1="326.4" y1="105.6" x2="336.0" y2="105.6"/>
<line x1="336.0" y1="105.6" x2="345.6" y2="105.6"/>
<line x1="345.6" y1="105.6" x2="355.2" y2="105.6"/>
<line x1="355.2" y1="105.6" x2="364.8" y2="105.6"/>
<line x1="369.6" y1="96.0" x2="369.6" y2="115.2"/>
<line x1="364.8" y1="105.6" x2="369.6" y2="105.6"/>
<line x1="4.8" y1="115.2" x2="4.8" y2="134.4"/>
<line x1="369.6" y1="115.2" x2="369.6" y2="134.4"/>
<line x1="4.8" y1="134.4" x2="4.8" y2="153.6"/>
<line x1="4.8" y1="144.0" x2="9.6" y2="144.0"/>
<line x1="9.6" y1="144.0" x2="19.2" y2="144.0"/>
<line x1="19.2" y1="144.0" x2="28.8" y2="144.0"/>
<line x1="28.8" y1="144.0" x2="38.4" y2="144.0"/>
<line x1="38.4" y1="144.0" x2="48.0" y2="144.0"/>
<line x1="48.0" y1="144.0" x2="57.6" y2="144.0"/>
<line x1="57.6" y1="144.0" x2="67.2" y2="144.0"/>
<line x1="67.2" y1="144.0" x2="76.8" y2="144.0"/>
<line x1="76.8" y1="144.0" x2="86.4" y2="144.0"/>
<line x1="86.4" y1="144.0" x2="96.0" y2="144.0"/>
<line x1="96.0" y1="144.0" x2="105.6" y2="144.0"/>
<line x1="105.6" y1="144.0" x2="115.2" y2="144.0"/>
<line x1="115.2" y1="144.0" x2="124.8" y2="144.0"/>
<line x1="124.8" y1="144.0" x2="134.4" y2="144.0"/>
<line x1="134.4" y1="144.0" x2="144.0" y2="144.0"/>
<line x1="144.0" y1="144.0" x2="153.6" y2="144.0"/>
<line x1="153.6" y1="144.0" x2="163.2" y2="144.0"/>
<line x1="163.2" y1="144.0" x2="172.8" y2="144.0"/>
<line x1="172.8" y1="144.0" x2="182.4" y2="144.0"/>
<line x1="182.4" y1="144.0" x2="192.0" y2="144.0"/>
<line x1="192.0" y1="144.0" x2="201.6" y2="144.0"/>
<line x1="201.6" y1="144.0" x2="211.2" y2="144.0"/>
<line x1="211.2" y1="144.0" x2="220.8" y2="144.0"/>
<line x1="220.8" y1="144.0" x2="230.4" y2="144.0"/>
<line x1="230.4" y1="144.0" x2="240.0" y2="144.0"/>
<line x1="240.0" y1="144.0" x2="249.6" y2="144.0"/>
<line x1="249.6" y1="144.0" x2="259.2" y2="144.0"/>
<line x1="259.2" y1="144.0" x2="268.8" y2="144.0"/>
<line x1="268.8" y1="144.0" x2="278.4" y2="144.0"/>
<line x1="278.4" y1="144.0" x2="288.0" y2="144.0"/>
<line x1="288.0" y1="144.0" x2="297.6" y2="144.0"/>
<line x1="297.6" y1="144.0" x2="307.2" y2="144.0"/>
<line x1="307.2" y1="144.0" x2="316.8" y2="144.0"/>
<line x1="316.8" y1="144.0" x2="326.4" y2="144.0"/>
<line x1="326.4" y1="144.0" x2="336.0" y2="144.0"/>
<line x1="336.0" y1="144.0" x2="345.6" y2="144.0"/>
<line x1="345.6" y1="144.0" x2="355.2" y2="144.0"/>
<line x1="355.2" y1="144.0" x2="364.8" y2="144.0"/>
<line x1="369.6" y1="134.4" x2="369.6" y2="153.6"/>
<line x1="364.8" y1="144.0" x2="369.6" y2="144.0"/>
<line x1="4.8" y1="153.6" x2="4.8" y2="172.8"/>
<line x1="369.6" y1="153.6" x2="369.6" y2="172.8"/>
<line x1="4.8" y1="172.8" x2="4.8" y2="192.0"/>
<line x1="4.8" y1="182.4" x2="9.6" y2="182.4"/>
<line x1="9.6" y1="182.4" x2="19.2" y2="182.4"/>
<line x1="19.2" y1="182.4" x2="28.8" y2="182.4"/>
<line x1="28.8" y1="182.4" x2="38.4" y2="182.4"/>
<line x1="38.4" y1="182.4" x2="48.0" y2="182.4"/>
<line x1="48.0" y1="182.4" x2="57.6" y2="182.4"/>
<line x1="57.6" y1="182.4" x2="67.2" y2="182.4"/>
<line x1="67.2" y1="182.4" x2="76.8" y2="182.4"/>
<line x1="76.8" y1="182.4" x2="86.4" y2="182.4"/>
<line x1="86.4" y1="182.4" x2="96.0" y2="182.4"/>
<line x1="96.0" y1="182.4" x2="105.6" y2="182.4"/>
<line x1="105.6" y1="182.4" x2="115.2" y2="182.4"/>
<line x1="115.2" y1="182.4" x2="124.8" y2="182.4"/>
<line x1="124.8" y1="182.4" x2="134.4" y2="182.4"/>
<line x1="134.4" y1="182.4" x2="144.0" y2="182.4"/>
<line x1="144.0" y1="182.4" x2="153.6" y2="182.4"/>
<line x1="153.6" y1="182.4" x2="163.2" y2="182.4"/>
<line x1="163.2" y1="182.4" x2="172.8" y2="182.4"/>
<line x1="172.8" y1="182.4" x2="182.4" y2="182.4"/>
<line x1="182.4" y1="182.4" x2="192.0" y2="182.4"/>
<line x1="192.0" y1="182.4" x2="201.6" y2="182.4"/>
<line x1="201.6" y1="182.4" x2="211.2" y2="182.4"/>
<line x1="211.2" y1="182.4" x2="220.8" y2="182.4"/>
<line x1="220.8" y1="182.4" x2="230.4" y2="182.4"/>
<line x1="230.4" y1="182.4" x2="240.0" y2="182.4"/>
<line x1="240.0" y1="182.4" x2="249.6" y2="182.4"/>
<line x1="249.6" y1="182.4" x2="259.2" y2="182.4"/>
<line x1="259.2" y1="182.4" x2="268.8" y2="182.4"/>
<line x1="268.8" y1="182.4" x2="278.4" y2="182.4"/>
<line x1="278.4" y1="182.4" x2="288.0" y2="182.4"/>
<line x1="288.0" y1="182.4" x2="297.6" y2="182.4"/>
<line x1="297.6" y1="182.4" x2="307.2" y2="182.4"/>
<line x1="307.2" y1="182.4" x2="316.8" y2="182.4"/>
<line x1="316.8" y1="182.4" x2="326.4" y2="182.4"/>
<line x1="326.4" y1="182.4" x2="336.0" y2="182.4"/>
<line x1="336.0" y1="182.4" x2="345.6" y2="182.4"/>
<line x1="345.6" y1="182.4" x2="355.2" y2="182.4"/>
<line x1="355.2" y1="182.4" x2="364.8" y2="182.4"/>
<line x1="369.6" y1="172.8" x2="369.6" y2="192.0"/>
<line x1="364.8" y1="182.4" x2="369.6" y2="182.4"/>
<line x1="4.8" y1="192.0" x2="4.8" y2="211.2"/>
<line x1="369.6" y1="192.0" x2="369.6" y2="211.2"/>
<line x1="4.8" y1="211.2" x2="4.8" y2="230.4"/>
<line x1="369.6" y1="211.2" x2="369.6" y2="230.4"/>
<line x1="4.8" y1="240.0" x2="9.6" y2="240.0"/>
<line x1="4.8" y1="230.4" x2="4.8" y2="240.0"/>
<line x1="9.6" y1="240.0" x2="19.2" y2="240.0"/>
<line x1="19.2" y1="240.0" x2="28.8" y2="240.0"/>
<line x1="28.8" y1="240.0" x2="38.4" y2="240.0"/>
<line x1="38.4" y1="240.0" x2="48.0" y2="240.0"/>
<line x1="48.0" y1="240.0" x2="57.6" y2="240.0"/>
<line x1="57.6" y1="240.0" x2="67.2" y2="240.0"/>
<line x1="67.2" y1="240.0" x2="76.8" y2="240.0"/>
<line x1="76.8" y1="240.0" x2="86.4" y2="240.0"/>
<line x1="86.4" y1="240.0" x2="96.0" y2="240.0"/>
<line x1="96.0" y1="240.0" x2="105.6" y2="240.0"/>
<line x1="105.6" y1="240.0" x2="115.2" y2="240.0"/>
<line x1="115.2" y1="240.0" x2="124.8" y2="240.0"/>
<line x1="124.8" y1="240.0" x2="134.4" y2="240.0"/>
<line x1="134.4" y1="240.0" x2="144.0" y2="240.0"/>
<line x1="144.0" y1="240.0" x2="153.6" y2="240.0"/>
<line x1="153.6" y1="240.0" x2="163.2" y2="240.0"/>
<line x1="163.2" y1="240.0" x2="172.8" y2="240.0"/>
<line x1="172.8" y1="240.0" x2="182.4" y2="240.0"/>
<line x1="182.4" y1="240.0" x2="192.0" y2="240.0"/>
<line x1="192.0" y1="240.0" x2="201.6" y2="240.0"/>
<line x1="201.6" y1="240.0" x2="211.2" y2="240.0"/>
<line x1="211.2" y1="240.0" x2="220.8" y2="240.0"/>
<line x1="220.8" y1="240.0" x2="230.4" y2="240.0"/>
<line x1="230.4" y1="240.0" x2="240.0" y2="240.0"/>
<line x1="240.0" y1="240.0" x2="249.6" y2="240.0"/>
<line x1="249.6" y1="240.0" x2="259.2" y2="240.0"/>
<line x1="259.2" y1="240.0" x2="268.8" y2="240.0"/>
<line x1="268.8" y1="240.0" x2="278.4" y2="240.0"/>
<line x1="278.4" y1="240.0" x2="288.0" y2="240.0"/>
<line x1="288.0" y1="240.0" x2="297.6" y2="240.0"/>
<line x1="297.6" y1="240.0" x2="307.2" y2="240.0"/>
<line x1="307.2" y1="240.0" x2="316.8" y2="240.0"/>
<line x1="316.8" y1="240.0" x2="326.4" y2="240.0"/>
<line x1="326.4" y1="240.0" x2="336.0" y2="240.0"/>
<line x1="336.0" y1="240.0" x2="345.6" y2="240.0"/>
<line x1="345.6" y1="240.0" x2="355.2" y2="240.0"/>
<line x1="355.2" y1="240.0" x2="364.8" y2="240.0"/>
<line x1="364.8" y1="240.0" x2="369.6" y2="240.0"/>
<line x1="369.6" y1="230.4" x2="369.6" y2="240.0"/>
<text x="100.8" y="28.8" text-anchor="middle" dominant-baseline="central">A</text>
<text x="110.4" y="28.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="120.0" y="28.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="129.6" y="28.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="139.2" y="28.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="148.8" y="28.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="158.4" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="168.0" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="177.6" y="28.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="187.2" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="196.8" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="206.4" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="52.8" y="48.0" text-anchor="middle" dominant-baseline="central">(</text>
<text x="62.4" y="48.0" text-anchor="middle" dominant-baseline="central">F</text>
<text x="72.0" y="48.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="81.6" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="91.2" y="48.0" text-anchor="middle" dominant-baseline="central">d</text>
<text x="100.8" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="110.4" y="48.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="120.0" y="48.0" text-anchor="middle" dominant-baseline="central">,</text>
<text x="139.2" y="48.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="148.8" y="48.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="158.4" y="48.0" text-anchor="middle" dominant-baseline="central">,</text>
<text x="177.6" y="48.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="187.2" y="48.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="196.8" y="48.0" text-anchor="middle" dominant-baseline="central">y</text>
<text x="206.4" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="216.0" y="48.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="225.6" y="48.0" text-anchor="middle" dominant-baseline="central">,</text>
<text x="244.8" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="254.4" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="264.0" y="48.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="273.6" y="48.0" text-anchor="middle" dominant-baseline="central">.</text>
<text x="283.2" y="48.0" text-anchor="middle" dominant-baseline="central">)</text>
<text x="100.8" y="86.4" text-anchor="middle" dominant-baseline="central">V</text>
<text x="110.4" y="86.4" text-anchor="middle" dominant-baseline="central">F</text>
<text x="120.0" y="86.4" text-anchor="middle" dominant-baseline="central">S</text>
<text x="139.2" y="86.4" text-anchor="middle" dominant-baseline="central">(</text>
<text x="148.8" y="86.4" text-anchor="middle" dominant-baseline="central">k</text>
<text x="158.4" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="168.0" y="86.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="177.6" y="86.4" text-anchor="middle" dominant-baseline="central">n</text>
<text x="187.2" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="196.8" y="86.4" text-anchor="middle" dominant-baseline="central">l</text>
<text x="206.4" y="86.4" text-anchor="middle" dominant-baseline="central">)</text>
<text x="72.0" y="124.8" text-anchor="middle" dominant-baseline="central">F</text>
<text x="81.6" y="124.8" text-anchor="middle" dominant-baseline="central">U</text>
<text x="91.2" y="124.8" text-anchor="middle" dominant-baseline="central">S</text>
<text x="100.8" y="124.8" text-anchor="middle" dominant-baseline="central">E</text>
<text x="110.4" y="124.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="120.0" y="124.8" text-anchor="middle" dominant-baseline="central">T</text>
<text x="139.2" y="124.8" text-anchor="middle" dominant-baseline="central">/</text>
<text x="158.4" y="124.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="168.0" y="124.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="177.6" y="124.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="187.2" y="124.8" text-anchor="middle" dominant-baseline="central">F</text>
<text x="196.8" y="124.8" text-anchor="middle" dominant-baseline="central">U</text>
<text x="206.4" y="124.8" text-anchor="middle" dominant-baseline="central">S</text>
<text x="216.0" y="124.8" text-anchor="middle" dominant-baseline="central">E</text>
<text x="52.8" y="163.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="62.4" y="163.2" text-anchor="middle" dominant-baseline="central">y</text>
<text x="72.0" y="163.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="81.6" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="91.2" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="100.8" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="110.4" y="163.2" text-anchor="middle" dominant-baseline="central">p</text>
<text x="120.0" y="163.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="129.6" y="163.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="139.2" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="148.8" y="163.2" text-anchor="middle" dominant-baseline="central">-</text>
<text x="158.4" y="163.2" text-anchor="middle" dominant-baseline="central">f</text>
<text x="168.0" y="163.2" text-anchor="middle" dominant-baseline="central">u</text>
<text x="177.6" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="187.2" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="206.4" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="216.0" y="163.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="225.6" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="235.2" y="163.2" text-anchor="middle" dominant-baseline="central">m</text>
<text x="244.8" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="254.4" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="398.4" y="163.2" text-anchor="middle" dominant-baseline="central">←</text>
<text x="417.6" y="163.2" text-anchor="middle" dominant-baseline="central">O</text>
<text x="427.2" y="163.2" text-anchor="middle" dominant-baseline="central">u</text>
<text x="436.8" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="456.0" y="163.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="465.6" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="475.2" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="484.8" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="100.8" y="201.6" text-anchor="middle" dominant-baseline="central">V</text>
<text x="110.4" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="120.0" y="201.6" text-anchor="middle" dominant-baseline="central">u</text>
<text x="129.6" y="201.6" text-anchor="middle" dominant-baseline="central">l</text>
<text x="139.2" y="201.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="158.4" y="201.6" text-anchor="middle" dominant-baseline="central">l</text>
<text x="168.0" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="177.6" y="201.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="187.2" y="201.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="196.8" y="201.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="43.2" y="220.8" text-anchor="middle" dominant-baseline="central">(</text>
<text x="52.8" y="220.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="62.4" y="220.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="72.0" y="220.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="81.6" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="91.2" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="100.8" y="220.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="110.4" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="120.0" y="220.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="129.6" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="139.2" y="220.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="148.8" y="220.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="158.4" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="168.0" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="177.6" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="187.2" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="196.8" y="220.8" text-anchor="middle" dominant-baseline="central">,</text>
<text x="216.0" y="220.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="225.6" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="235.2" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="244.8" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="254.4" y="220.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="264.0" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="273.6" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="283.2" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="292.8" y="220.8" text-anchor="middle" dominant-baseline="central">)</text>
</svg>
</div>
</section>
<section>
<h2>Metadata Preservation</h2>
<h3>macOS Metadata Captured</h3>
<p>Table 1: Preserved Metadata</p>
<table>
<tr><th>Category </th><th>Attributes </th><th>Capture Method </th></tr>
<tr><td>POSIX </td><td>mode, uid, gid, size </td><td>stat() </td></tr>
<tr><td>Timestamps </td><td>mtime, atime, ctime, birthtime </td><td>stat() </td></tr>
<tr><td>Extended attrs </td><td>Finder info, tags, quarantine </td><td>listxattr(), getxattr() </td></tr>
<tr><td>Spotlight </td><td>kMDItem* metadata </td><td>mdls / MDItem API </td></tr>
<tr><td>ACLs </td><td>Access control lists </td><td>aclgetfile() </td></tr>
<tr><td>Flags </td><td>hidden, locked, immutable </td><td>chflags() / stat() </td></tr>
<tr><td>Resource fork </td><td>Legacy resource data </td><td>xattr com.apple.ResourceFork </td></tr>
</table>
<h3>Internal Representation</h3>
<pre class="language-scheme">
(define-record-type &lt;vault-file&gt;
  (make-vault-file path content-hash metadata)
  vault-file?
  (path vault-file-path)
  (content-hash vault-file-hash)
  (metadata vault-file-metadata))

(define (capture-metadata path)
  "Capture all macOS metadata for a file"
  `((posix
     (mode ,(file-mode path))
     (uid ,(file-uid path))
     (gid ,(file-gid path))
     (size ,(file-size path))
     (mtime ,(file-mtime path))
     (atime ,(file-atime path))
     (ctime ,(file-ctime path))
     (birthtime ,(file-birthtime path)))
    (xattr ,(capture-xattrs path))
    (flags ,(capture-flags path))
    (acl ,(capture-acl path))))
</pre>
<h3>Restoration</h3>
<pre class="language-scheme">
(define (restore-metadata path metadata)
  "Restore all metadata to a file"
  (let ((posix (alist-ref 'posix metadata))
        (xattr (alist-ref 'xattr metadata))
        (flags (alist-ref 'flags metadata))
        (acl (alist-ref 'acl metadata)))
    (restore-posix path posix)
    (restore-xattrs path xattr)
    (restore-flags path flags)
    (restore-acl path acl)))
</pre>
</section>
<section>
<h2>FUSE Operations</h2>
<h3>Required Operations</h3>
<p>Table 2: FUSE Operations</p>
<table>
<tr><th>Operation </th><th>Purpose </th><th>Vault Action </th></tr>
<tr><td>getattr </td><td>stat() </td><td>Return stored metadata </td></tr>
<tr><td>readdir </td><td>List directory </td><td>Read manifest </td></tr>
<tr><td>open </td><td>Open file </td><td>Validate hash exists </td></tr>
<tr><td>read </td><td>Read content </td><td>Fetch by content hash </td></tr>
<tr><td>write </td><td>Write content </td><td>Content-address, update manifest </td></tr>
<tr><td>create </td><td>Create file </td><td>Allocate manifest entry </td></tr>
<tr><td>unlink </td><td>Delete file </td><td>Remove from manifest (GC later) </td></tr>
<tr><td>mkdir </td><td>Create directory </td><td>Create manifest node </td></tr>
<tr><td>rmdir </td><td>Remove directory </td><td>Remove manifest node </td></tr>
<tr><td>rename </td><td>Move/rename </td><td>Update manifest path </td></tr>
<tr><td>setxattr </td><td>Set extended attr </td><td>Store in metadata </td></tr>
<tr><td>getxattr </td><td>Get extended attr </td><td>Retrieve from metadata </td></tr>
<tr><td>listxattr </td><td>List extended attrs </td><td>Enumerate metadata </td></tr>
</table>
<h3>Implementation Sketch</h3>
<pre class="language-scheme">
(define (fuse-getattr path)
  "Return file attributes from vault metadata"
  (let ((entry (manifest-lookup path)))
    (if entry
        (let ((meta (vault-file-metadata entry)))
          (make-stat
           (alist-ref 'mode (alist-ref 'posix meta))
           (alist-ref 'size (alist-ref 'posix meta))
           (alist-ref 'mtime (alist-ref 'posix meta))
           ...))
        -ENOENT)))

(define (fuse-read path size offset)
  "Read file content from vault"
  (let ((entry (manifest-lookup path))
         (hash (vault-file-hash entry))
         (content (vault-fetch hash)))
    (subbytes content offset (+ offset size))))

(define (fuse-write path data offset)
  "Write to file, content-address the result"
  (let ((entry (manifest-lookup path))
         (current (vault-fetch (vault-file-hash entry)))
         (updated (bytes-splice current offset data))
         (new-hash (content-address updated)))
    (manifest-update! path new-hash)
    (string-length data)))

(define (fuse-setxattr path name value)
  "Store extended attribute in vault metadata"
  (let ((entry (manifest-lookup path)))
    (metadata-set-xattr! entry name value)
    0))
</pre>
</section>
<section>
<h2>Content Addressing</h2>
<p>Files are stored by content hash (RFC-020):</p>
<pre class="language-scheme">
(define (content-address data)
  "Store data, return hash"
  (let* ((hash (sha256 data))
         (path (vault-object-path hash)))
    (unless (file-exists? path)
      (write-blob path data))
    hash))

(define (vault-fetch hash)
  "Retrieve data by hash"
  (read-blob (vault-object-path hash)))
</pre>
<p>Benefits: - Identical files stored once (deduplication) - Integrity verification on every read - Immutable objects enable safe caching</p>
</section>
<section>
<h2>Synchronization</h2>
<h3>Change Detection</h3>
<p>The FUSE layer captures all writes in real-time. No separate sync needed for local changes.</p>
<p>For multi-device sync, the manifest includes version vectors (RFC-012):</p>
<pre class="language-scheme">
(define (manifest-entry path hash metadata)
  `(entry
    (path ,path)
    (hash ,hash)
    (metadata ,metadata)
    (version-vector ,local-node ,lamport-clock)))
</pre>
<h3>Conflict Resolution</h3>
<p>When merging manifests from different devices (RFC-016 lazy clustering):</p>
<p>1. Same hash → No conflict (identical content) 2. Different hash, one newer → Take newer 3. Different hash, concurrent → Conflict, apply lazy-resolve</p>
<pre class="language-scheme">
(define (merge-manifests local remote)
  (for-each
   (lambda (path)
     (let ((l (manifest-lookup local path))
           (r (manifest-lookup remote path)))
       (cond
        ((not l) (manifest-add! local r))
        ((not r) 'keep-local)
        ((equal? (vault-file-hash l) (vault-file-hash r)) 'identical)
        ((version-newer? r l) (manifest-update! local r))
        ((version-newer? l r) 'keep-local)
        (else (queue-conflict! path l r)))))
   (union (manifest-paths local) (manifest-paths remote))))
</pre>
</section>
<section>
<h2>Mount Commands</h2>
<h3>REPL Interface</h3>
<pre class="language-scheme">
(define (vault-mount point)
  "Mount vault at filesystem path"
  (fuse-main point
    `((getattr . ,fuse-getattr)
      (readdir . ,fuse-readdir)
      (open . ,fuse-open)
      (read . ,fuse-read)
      (write . ,fuse-write)
      (create . ,fuse-create)
      (unlink . ,fuse-unlink)
      (mkdir . ,fuse-mkdir)
      (rmdir . ,fuse-rmdir)
      (rename . ,fuse-rename)
      (setxattr . ,fuse-setxattr)
      (getxattr . ,fuse-getxattr)
      (listxattr . ,fuse-listxattr))))

(define (vault-unmount point)
  "Unmount vault filesystem"
  (fuse-unmount point))
</pre>
<h3>Command Line</h3>
<pre class="language-bash">
# Mount
cyberspace mount ~/Cyberspace

# Unmount
cyberspace unmount ~/Cyberspace

# Or via REPL
$ ./cyberspace-repl
&gt; (vault-mount "~/Cyberspace")
Mounted vault at /Users/ddp/Cyberspace
</pre>
</section>
<section>
<h2>macOS Integration</h2>
<h3>FUSE-T vs macFUSE</h3>
<p>Table 3: FUSE Implementation Options</p>
<table>
<tr><th>Feature </th><th>macFUSE </th><th>FUSE-T </th></tr>
<tr><td>Kernel extension </td><td>Yes (deprecated) </td><td>No </td></tr>
<tr><td>System extension </td><td>Optional </td><td>Uses NFS </td></tr>
<tr><td>SIP compatible </td><td>Requires disable </td><td>Yes </td></tr>
<tr><td>Performance </td><td>Better </td><td>Adequate </td></tr>
<tr><td>Maintenance </td><td>Active </td><td>Active </td></tr>
</table>
<p>FUSE-T recommended for new installations—no kernel extension required.[^i1]</p>
<p>[^i1]: Implementation: FUSE-T implements FUSE API over NFS loopback. Slightly higher latency but avoids Apple's kernel extension hostility.</p>
<h3>Installation</h3>
<pre class="language-bash">
# FUSE-T (recommended)
brew install fuse-t

# Or macFUSE (if kernel ext acceptable)
brew install macfuse
</pre>
<h3>Finder Integration</h3>
<p>The mount appears as a regular volume in Finder. Optional .VolumeIcon.icns for custom icon.</p>
<p>Spotlight indexing can be enabled by implementing getxattr for com.apple.FinderInfo and related Spotlight attributes.</p>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Permissions</h3>
<p>FUSE daemon runs as user, not root. Respects vault ACLs.</p>
<h3>Content Integrity</h3>
<p>Every read verifies content hash. Corruption detected immediately.</p>
<h3>Metadata Trust</h3>
<p>Metadata is stored separately from content. A compromised metadata store cannot alter file contents (hashes won't match).</p>
<h3>Mount Security</h3>
<pre class="language-scheme">
(define (vault-mount point #!key (allow-other #f))
  ;; allow-other permits other users to access mount
  ;; Default: owner only
  ...)
</pre>
</section>
<section>
<h2>Dependencies</h2>
<table>
<tr><th>Component </th><th>Purpose </th></tr>
<tr><td>FUSE-T or macFUSE </td><td>Userspace filesystem </td></tr>
<tr><td>libfuse </td><td>FUSE library </td></tr>
<tr><td>Scheme FFI </td><td>Bindings to libfuse </td></tr>
</table>
</section>
<section>
<h2>References</h2>
<p>1. RFC-012: Lamport Clocks 2. RFC-016: Lazy Clustering 3. RFC-020: Content-Addressed Storage 4. FUSE documentation: https://libfuse.github.io/ 5. FUSE-T: https://github.com/macos-fuse-t/fuse-t</p>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-07</li>
<li>Initial specification</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  // Query param override (for REPL: ?theme=dark or ?theme=light)
  const params = new URLSearchParams(window.location.search);
  const param = params.get('theme');
  if (param === 'dark' || param === 'light') {
    document.documentElement.setAttribute('data-theme', param);
    localStorage.setItem('theme', param);
    return;
  }
  // localStorage preference
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
