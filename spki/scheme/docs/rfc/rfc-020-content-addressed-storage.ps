%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Mon Jan 12 10:28:47 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 21
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-020: Content-Addr)208.458 123 Q
(essed Storage)-.216 E/F1 10/Times-Italic@0 SF(Libr)260.85 159 Q
(ary of Cyber)-.15 E(space)-.1 E/F2 10/Times-Roman@0 SF(2026)296 177 Q
F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3 10/Times-Bold@0 SF 2.5(1. Abstract)
72 261 R F2 .749(This RFC speci\214es content-addressed storage \(CAS\)\
 for the Library of Cyberspace: a storage model where data is)72 276.6 R
.909(addressed by its cryptographic hash rather than by location. Conte\
nt addressing pro)72 288.6 R .91(vides immutability guarantees,)-.15 F
(automatic deduplication, and tamper)72 300.6 Q(-e)-.2 E
(vident storage.)-.25 E F3 2.5(2. Moti)72 324.6 R -.1(va)-.1 G(tion).1 E
F2 -.35(Tr)72 340.2 S
(aditional storage systems use location-based addressing:).35 E 6.5
<8344>72 355.8 S(ECtape: Ph)-6.5 E(ysical position on magnetic tape)-.05
E 6.5<8346>72 371.4 S(ilesystems: P)-6.5 E
(ath names \(/home/ddp/\214le.txt\))-.15 E 6.5<8344>72 387 S
(atabases: Ro)-6.5 E 2.5(wI)-.25 G(Ds, primary k)-2.5 E -.15(ey)-.1 G(s)
.15 E 6.5<8355>72 402.6 S(RLs: Serv)-6.5 E(er + path \(https://e)-.15 E
(xample.com/doc.ps\))-.15 E
(Location-based addressing has fundamental problems:)72 421.8 Q .649
(1. Mutability - Same address can point to dif)72 437.4 R .648
(ferent content o)-.25 F -.15(ve)-.15 G 3.148(rt).15 G .648
(ime 2. Link rot - Addresses become in)-3.148 F -.25(va)-.4 G .648
(lid when).25 F 1.116(content mo)72 449.4 R -.15(ve)-.15 G 3.616(s3).15
G 3.617(.D)-3.616 G 1.117
(uplication - Identical content stored multiple times 4. No v)-3.617 F
1.117(eri\214cation - Address doesn')-.15 F 3.617(tp)-.18 G(ro)-3.617 E
-.15(ve)-.15 G(content inte)72 461.4 Q(grity)-.15 E
(Content-addressed storage in)72 477 Q -.15(ve)-.4 G(rts this:).15 E/F4
8/Courier@0 SF 4.8(Location-based: address)108 495 R 4.8(>c)4.8 G
(ontent \(many-to-one, mutable\))-4.8 E 9.6(Content-based: content)108
507 R 4.8(>a)4.8 G(ddress \(one-to-one, immutable\))-4.8 E F2 .34
(The address IS the content')72 525 R 2.84(sc)-.55 G .339(ryptographic \
\214ngerprint. If the content changes, the address changes. If tw)-2.84
F 2.839<6f8c>-.1 G .339(les ha)-2.839 F -.15(ve)-.2 G
(the same address, the)72 537 Q 2.5(ya)-.15 G(re byte-for)-2.5 E
(-byte identical.)-.2 E F3 2.5(3. Content)72 561 R(Addr)2.5 E
(essing Model)-.18 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. Hash)72 84 R(as Addr)2.5 E(ess)-.18 E/F2 8/Courier@0 SF
(;; Content determines address)108 102 Q
(\(define \(content-address data\))108 114 Q(\(sha256 data\)\))117.6 126
Q(;; Store by hash)108 150 Q(\(define \(cas-store data\))108 162 Q
(\(let \(\(hash \(content-address data\)\)\))117.6 174 Q
(\(write-blob \(hash->path hash\) data\))127.2 186 Q(hash\)\))127.2 198
Q(;; Retrieve by hash)108 222 Q(\(define \(cas-retrieve hash\))108 234 Q
(\(let \(\(data \(read-blob \(hash->path hash\)\)\)\))117.6 246 Q
(\(if \(equal? hash \(content-address data\)\))127.2 258 Q(data)146.4
270 Q(\(error "Content tampered"\)\)\)\))146.4 282 Q F1 2.5(3.2. Pr)72
300 R(operties)-.18 E .4 LW 446.965 310.5 165.035 310.5 DL(Pr)193.55 320
Q 38.515(operty Location-Based)-.18 F(Content-Addr)17.5 E(essed)-.18 E
(Addr)170.035 332 Q(ess stability)-.18 E 43.89(Unstable P)30.9 F
(ermanent)-.2 E(Content v)170.035 344 Q 15(eri\214cation Exter)-.1 F
44.6(nal Intrinsic)-.15 F 40.16(Deduplication Manual)170.035 356 R -.5
(Au)50.83 G(tomatic).5 E 54.61(Mutability Mutable)170.035 368 R
(Immutable)48.06 E(Link r)170.035 380 Q 64.51(ot Common)-.18 F
(Impossible)44.73 E 446.965 384.5 165.035 384.5 DL 446.965 310.5 446.965
384.5 DL 165.035 310.5 165.035 384.5 DL 2.5(3.3. Hash)72 398 R
(Function Requir)2.5 E(ements)-.18 E F0(The hash function MUST be:)72
413.6 Q .448
(1. Collision-resistant - Computationally infeasible to \214nd tw)72
429.2 R 2.948(oi)-.1 G .448
(nputs with same hash 2. Preimage-resistant - Cannot)-2.948 F(deri)72
441.2 Q .41 -.15(ve c)-.25 H .11
(ontent from hash 3. Deterministic - Same content al).15 F -.1(wa)-.1 G
.109(ys produces same hash 4. F).1 F .109(ast - Practical for lar)-.15 F
.109(ge ob-)-.18 F(jects)72 453.2 Q
(Speci\214ed hash: SHA-256 \(32 bytes, 64 he)72 468.8 Q 2.5(xc)-.15 G
(haracters\))-2.5 E F2(;; Example content address)108 486.8 Q
("e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855")108
498.8 Q(;; This is the SHA-256 of the empty string)108 510.8 Q F1 2.5
(4. Storage)72 528.8 R(Ar)2.5 E(chitectur)-.18 E(e)-.18 E 2.5
(4.1. Object)72 552.8 R(Stor)2.5 E(e)-.18 E F2(.cas/)108 570.8 Q
(+-- objects/)108 582.8 Q 14.4(|+)108 594.8 S(-- e3/)-14.4 E 14.4(||+)
108 606.8 S
(-- b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855)-14.4
E 14.4(|+)108 618.8 S(-- a7/)-14.4 E 14.4(||+)108 630.8 S
(-- ffc6f8bf1ed76651c14756a061d662f580ff4de43b49fa82d80a4b80f8434a)-14.4
E 14.4(|+)108 642.8 S(-- ...)-14.4 E(+-- refs/)108 654.8 Q 14.4(|+)108
666.8 S(-- HEAD)-14.4 E 14.4(|+)108 678.8 S(-- tags/)-14.4 E(+-- index)
108 690.8 Q F0(Sharding: First tw)72 708.8 Q 2.5(oh)-.1 G .3 -.15(ex c)
-2.5 H(haracters of hash form directory name \(256 b).15 E(uck)-.2 E
(ets\).)-.1 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.2. Object)72 84 R -.34(Ty)2.5 G(pes).34 E/F2 8/Courier@0 SF
(;; Blob - raw data)108 102 Q(\(cas-blob)108 114 Q
(\(hash "sha256:..."\))117.6 126 Q(\(size 1024\))117.6 138 Q
(\(data #${...}\)\))117.6 150 Q(;; Tree - directory structure)108 174 Q
(\(cas-tree)108 186 Q(\(hash "sha256:..."\))117.6 198 Q(\(entries)117.6
210 Q(\(\("README.md" blob "sha256:abc..."\))127.2 222 Q
(\("src" tree "sha256:def..."\))132 234 Q
(\("lib" tree "sha256:ghi..."\)\)\)\))132 246 Q
(;; Commit - snapshot with metadata)108 270 Q(\(cas-commit)108 282 Q
(\(hash "sha256:..."\))117.6 294 Q(\(tree "sha256:..."\))117.6 306 Q
(\(parent "sha256:..." | #f\))117.6 318 Q(\(author "ddp@eludom.net"\))
117.6 330 Q(\(timestamp 1767700000\))117.6 342 Q
(\(message "Initial commit"\)\))117.6 354 Q F1 2.5(4.3. Merkle)72 372 R
-1.2 -.74(Tr e)2.5 H(es).74 E F0
(Directories are trees of hashes. The root hash commits to all content:)
72 387.6 Q F2(root: sha256:abc...)204 405.6 Q 48(/\\)228 417.6 S
(src: sha256:def)175.2 429.6 Q(lib: sha256:ghi)24 E -14.4 38.4(/\\ |)180
441.6 T 19.2(main.scm test.scm)146.4 453.6 R(util.scm)28.8 E 9.6
(sha256:111 sha256:222)146.4 465.6 R(sha256:333)19.2 E F0
(Changing ANY \214le changes ALL parent hashes up to root.)72 483.6 Q F1
2.5(5. Operations)72 507.6 R 2.5(5.1. Stor)72 531.6 R(e)-.18 E F2
(\(define \(cas-put content\))108 549.6 Q("Store content, return hash")
117.6 561.6 Q(\(let* \(\(hash \(sha256 content\)\))117.6 573.6 Q
(\(path \(hash->path hash\)\)\))151.2 585.6 Q
(\(unless \(file-exists? path\))127.2 597.6 Q
(\(write-blob path content\)\))136.8 609.6 Q(hash\)\))127.2 621.6 Q F0
(Deduplication: If hash already e)72 639.6 Q(xists, storage is a no-op.)
-.15 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.2. Retrie)72 84 R -.1(ve)-.15 G/F2 8/Courier@0 SF
(\(define \(cas-get hash\))108 102 Q
("Retrieve content by hash, verify integrity")117.6 114 Q
(\(let* \(\(path \(hash->path hash\)\))117.6 126 Q
(\(content \(read-blob path\)\)\))151.2 138 Q
(\(unless \(equal? hash \(sha256 content\)\))127.2 150 Q
(\(error "Content integrity failure" hash\)\))136.8 162 Q(content\)\))
127.2 174 Q F0(Self-v)72 192 Q(erifying: Ev)-.15 E(ery retrie)-.15 E
-.25(va)-.25 G 2.5(lc).25 G(on\214rms inte)-2.5 E(grity.)-.15 E F1 2.5
(5.3. Exists)72 216 R F2(\(define \(cas-exists? hash\))108 234 Q
("Check if content exists")117.6 246 Q
(\(file-exists? \(hash->path hash\)\)\))117.6 258 Q F1 2.5(5.4. Delete)
72 276 R F2(\(define \(cas-gc roots\))108 294 Q
("Garbage collect unreachable objects")117.6 306 Q
(\(let \(\(reachable \(trace-reachable roots\)\)\))117.6 318 Q
(\(for-each)127.2 330 Q(\(lambda \(hash\))136.8 342 Q
(\(unless \(set-member? reachable hash\))146.4 354 Q
(\(delete-file \(hash->path hash\)\)\)\))156 366 Q
(\(all-objects\)\)\)\))136.8 378 Q F0(Note: Deletion requires g)72 396 Q
(arbage collection from kno)-.05 E(wn roots.)-.25 E F1 2.5(6. Naming)72
420 R(Lay)2.5 E(er)-.1 E F0(Content addresses are not human-friendly. A\
 naming layer maps names to hashes:)72 435.6 Q F1 2.5(6.1. Refer)72
459.6 R(ences)-.18 E F2(;; Mutable reference to immutable content)108
477.6 Q(\(define \(ref-set name hash\))108 489.6 Q
(\(write-file \(ref-path name\) hash\)\))117.6 501.6 Q
(\(define \(ref-get name\))108 525.6 Q
(\(read-file \(ref-path name\)\)\))117.6 537.6 Q(;; Example)108 561.6 Q
(\(ref-set "HEAD" "sha256:abc123..."\))108 573.6 Q
(\(ref-get "HEAD"\) ; => "sha256:abc123...")108 585.6 Q F1 2.5(6.2. T)72
603.6 R(ags)-.92 E F2(;; Immutable named reference)108 621.6 Q
(\(define \(tag-create name hash #!key message signature\))108 633.6 Q
(\(let \(\(tag-content)117.6 645.6 Q(`\(tag)151.2 657.6 Q
(\(name ,name\))160.8 669.6 Q(\(object ,hash\))160.8 681.6 Q
(\(message ,message\))160.8 693.6 Q(\(signature ,signature\)\)\)\))160.8
705.6 Q(\(cas-put \(serialize tag-content\)\)\)\))127.2 717.6 Q 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.3. Dir)72 84 R(ectory Entries)-.18 E/F2 8/Courier@0 SF
(;; Human name -> content hash)108 102 Q(\(define library-index)108 114
Q('\(\("RFC-000" . "sha256:e3b0c44..."\))117.6 126 Q
(\("RFC-001" . "sha256:a7ffc6f..."\))127.2 138 Q
(\("RFC-002" . "sha256:b94d27b..."\)\)\))127.2 150 Q F1 2.5(7. The)72
168 R(Soup: Object Dir)2.5 E(ectory)-.18 E F0 .302
(Content-addressed storage pro)72 183.6 R .303(vides retrie)-.15 F -.25
(va)-.25 G 2.803(lb).25 G 2.803(yh)-2.803 G .303(ash, b)-2.803 F .303
(ut disco)-.2 F -.15(ve)-.15 G .303
(ry requires an object directory. The Soup \(inspired).15 F(by Ne)72
195.6 Q(wtonOS\) pro)-.25 E(vides a uni\214ed vie)-.15 E 2.5(wo)-.25 G
2.5(fa)-2.5 G(ll objects with rich metadata.)-2.5 E F1 2.5
(7.1. Philosoph)72 219.6 R(y)-.15 E F0("The soup is in\214nite." - Obje\
cts swim in a queryable sea of metadata.)97 235.2 Q(The Soup in)72 254.4
Q -.15(ve)-.4 G(rts the traditional \214lesystem model:).15 E 6.5<8346>
72 270 S(ilesystem: Na)-6.5 E(vig)-.2 E(ate hierarch)-.05 E 2.5(yt)-.05
G 2.5<6f8c>-2.5 G(nd objects)-2.5 E 6.5<8353>72 285.6 S
(oup: Query attrib)-6.5 E(utes to disco)-.2 E -.15(ve)-.15 G 2.5(ro).15
G(bjects)-2.5 E F1 2.5(7.2. Object)72 313.2 R(Enumeration)2.5 E F2
(\(define \(soup\))108 331.2 Q
("List all objects in the vault with metadata")117.6 343.2 Q(\(append)
117.6 355.2 Q 24(\(soup-releases\) ;)127.2 367.2 R(Signed releases)4.8 E
24(\(soup-archives\) ;)127.2 379.2 R(Sealed archives)4.8 E 43.2
(\(soup-keys\) ;)127.2 391.2 R(Cryptographic keys)4.8 E
(\(soup-audit-entries\) ; Audit trail)127.2 403.2 Q 19.2
(\(soup-commits\)\)\) ;)127.2 415.2 R(Recent commits)4.8 E F1 2.5
(7.3. Rich)72 433.2 R(Metadata)2.5 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R(Ev)72 84 Q
(ery object carries crypto metadata - the ciphers, hashes, and k)-.15 E
-.15(ey)-.1 G 2.5(si).15 G -1.9 -.4(nv o)-2.5 H(lv).4 E(ed:)-.15 E/F1 8
/Courier@0 SF(;; Archive object)108 102 Q(\(soup-object)108 114 Q
(\(name "1.0.0"\))117.6 126 Q(\(type archive\))117.6 138 Q
(\(size "1.2MB"\))117.6 150 Q
(\(crypto \(zstd sha256 "fe378a78..."\)\)\))117.6 162 Q(;; Key object)
108 186 Q(\(soup-object)108 198 Q(\(name "vault-signing"\))117.6 210 Q
(\(type key\))117.6 222 Q(\(size "64B"\))117.6 234 Q
(\(crypto \(ed25519/256 public sign)117.6 246 Q 14.4
("sha256:a1b2c3d4..." ;)160.8 258 R(fingerprint)4.8 E 19.2
("id:ddp@eludom.net" ;)160.8 270 R(identity)4.8 E 38.4
("2026-01-07"\)\)\) ;)160.8 282 R(creation date)4.8 E(;; Release object)
108 306 Q(\(soup-object)108 318 Q(\(name "0.1.0"\))117.6 330 Q
(\(type release\))117.6 342 Q(\(size "313B"\))117.6 354 Q
(\(crypto \(ed25519 sha512 "abc123..."\)\)\))117.6 366 Q/F2 10
/Times-Bold@0 SF 2.5(7.4. Querying)72 384 R(the Soup)2.5 E F1
(;; Find all signed objects)108 402 Q(\(soup-query type: 'release\))108
414 Q(;; Find objects using specific algorithm)108 438 Q
(\(soup-query crypto: 'ed25519\))108 450 Q
(;; Find objects by size range)108 474 Q
(\(soup-query min-size: 1000 max-size: 100000\))108 486 Q
(;; Find objects by content hash prefix)108 510 Q
(\(soup-query hash-prefix: "fe378"\))108 522 Q F2 2.5(7.5. Display)72
540 R -.25(Fo)2.5 G(rmat).25 E F0
(The soup displays as a compact, human-readable listing:)72 555.6 Q F1
4.8($s)108 573.6 S(eal-soup)-4.8 E
(vault-signing, 64B, ed25519/256, public, sign, sha256:a1b2c3d4...)108
585.6 Q(0.1.0, 313B, signed, ed25519, sha512)108 597.6 Q
(1.0.0, 1.2MB, zstd, sha256, fe378a78...)108 609.6 Q
(audit/1, sealed, 2026-01-07T10:30:00Z)108 621.6 Q F2 2.5(7.6. Soup)72
639.6 R(as Index)2.5 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R
(The Soup can be serialized as a content-addressed inde)72 84 Q(x:)-.15
E/F1 8/Courier@0 SF(\(define \(soup-snapshot\))108 102 Q
("Create content-addressed snapshot of current soup")117.6 114 Q
(\(let* \(\(entries \(soup\)\))117.6 126 Q
(\(serialized \(serialize entries\)\))151.2 138 Q
(\(hash \(cas-put serialized\)\)\))151.2 150 Q
(\(ref-set "soup/HEAD" hash\))127.2 162 Q(hash\)\))127.2 174 Q F0 .172
(This enables: - T)72 192 R .171(ime tra)-.35 F -.15(ve)-.2 G .171
(l: Load historical soup snapshots - Replication: Sync soup inde).15 F
-.15(xe)-.15 G 2.671(sb).15 G .171(etween v)-2.671 F .171(aults - V)-.25
F(eri\214-)-1.11 E(cation: Pro)72 204 Q .3 -.15(ve s)-.15 H
(oup state at a point in time).15 E/F2 10/Times-Bold@0 SF 2.5
(8. Integration)72 228 R(with Library of Cyberspace)2.5 E 2.5(8.1. V)72
252 R(ault Integration)-.92 E F0(The V)72 267.6 Q
(ault \(RFC-006\) uses content addressing internally via Git:)-1.11 E F1
(;; Git objects ARE content-addressed)108 285.6 Q
(\(define \(git-hash-object content\))108 297.6 Q(\(sha1 \(string-appen\
d "blob " \(number->string \(blob-length content\)\) "\\x00" content\)\
\)\))117.6 309.6 Q F0(CAS e)72 327.6 Q
(xtends this with SHA-256 and Library-speci\214c semantics.)-.15 E F2
2.5(8.2. Ar)72 351.6 R(chi)-.18 E .2 -.1(ve S)-.1 H(torage).1 E F0
(Sealed archi)72 367.2 Q -.15(ve)-.25 G 2.5(s\().15 G
(RFC-018\) can be stored by content address:)-2.5 E F1
(\(define \(archive-to-cas archive-path\))108 385.2 Q
(\(let* \(\(content \(read-blob archive-path\)\))117.6 397.2 Q
(\(hash \(cas-put content\)\)\))151.2 409.2 Q(\(ref-set \(string-append\
 "archives/" \(archive-version archive-path\)\) hash\))127.2 421.2 Q
(hash\)\))127.2 433.2 Q F2 2.5(8.3. Replication)72 451.2 R F0
(Content addressing enables ef)72 466.8 Q
(\214cient replication \(RFC-001\):)-.25 E F1
(;; Only transfer objects receiver doesn't have)108 484.8 Q
(\(define \(replicate-to remote root-hash\))108 496.8 Q(\(for-each)117.6
508.8 Q(\(lambda \(hash\))127.2 520.8 Q
(\(unless \(remote-has? remote hash\))136.8 532.8 Q
(\(remote-put remote hash \(cas-get hash\)\)\)\))146.4 544.8 Q
(\(trace-reachable root-hash\)\)\))127.2 556.8 Q F2 2.5(8.4. SPKI)72
574.8 R(Integration)2.5 E F0
(Content hashes can be authorization subjects \(RFC-004\):)72 590.4 Q F1
(;; Grant permission to specific content)108 608.4 Q(\(spki-cert)108
620.4 Q(\(issuer publisher-key\))117.6 632.4 Q
(\(subject \(hash sha256 "abc123..."\)\))117.6 644.4 Q
(\(permission read\))117.6 656.4 Q
(\(validity \(not-after "2027-01-01"\)\)\))117.6 668.4 Q F2 2.5
(9. Chunking)72 686.4 R -.25(fo)2.5 G 2.5(rL).25 G(ar)-2.5 E(ge Objects)
-.1 E F0(Lar)72 702 Q(ge \214les are split into chunks for:)-.18 E
(1. Deduplication at sub-\214le granularity 2. P)72 717.6 Q
(arallel transfer 3. Incremental updates)-.15 E 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.1. Fixed-Size)72 84 R(Chunking)2.5 E/F2 8/Courier@0 SF
(\(define chunk-size \(* 64 1024\)\))108 102 Q 4.8(;6)9.6 G(4KB)-4.8 E
(\(define \(chunk-fixed data\))108 126 Q
(\(let loop \(\(offset 0\) \(chunks '\(\)\)\))117.6 138 Q
(\(if \(>= offset \(blob-length data\)\))127.2 150 Q(\(reverse chunks\))
146.4 162 Q(\(loop \(+ offset chunk-size\))146.4 174 Q(\(cons \(blob-co\
py data offset \(min chunk-size \(- \(blob-length data\) offset\)\)\))
175.2 186 Q(chunks\)\)\)\)\))204 198 Q F1 2.5(9.2. Content-De\214ned)72
216 R(Chunking \(Rabin \214nger)2.5 E(printing\))-.1 E F2
(;; Chunk boundaries determined by content)108 234 Q
(;; Survives insertions/deletions better than fixed-size)108 246 Q
(\(define \(chunk-rabin data\))108 258 Q(\(let \(\(window-size 48\))
117.6 270 Q(\(min-chunk 2048\))146.4 282 Q(\(max-chunk 65536\))146.4 294
Q(\(mask #x0fff\)\))146.4 306 Q 4.8(;A)9.6 G(verage 4KB chunks)-4.8 E
(...\)\))127.2 318 Q F1 2.5(9.3. Chunk)72 336 R -1.2 -.74(Tr e)2.5 H(e)
.74 E F2(\(cas-chunked)108 354 Q(\(hash "sha256:..."\))117.6 366 Q 4.8
(;R)28.8 G(oot hash)-4.8 E(\(size 10485760\))117.6 378 Q 4.8(;1)48 G
(0MB original)-4.8 E(\(chunks)117.6 390 Q(\("sha256:aaa..." 65536\))
127.2 402 Q(\("sha256:bbb..." 65536\))127.2 414 Q
(\("sha256:ccc..." 32768\))127.2 426 Q(...\)\))127.2 438 Q F1 2.5
(10. Intr)72 456 R(ospection)-.18 E F0(The Library is fully introspecti)
72 471.6 Q -.15(ve)-.25 G 2.5(:i).15 G 2.5(ts)-2.5 G
(tores, addresses, and reasons about itself.)-2.5 E F1 2.5
(10.1. Self-Hosting)72 495.6 R F0(The system contains its o)72 511.2 Q
(wn description:)-.25 E F2(;; The RFCs are in the CAS)108 529.2 Q
(\(cas-get \(ref-get "rfc/020"\)\))108 541.2 Q 4.8(;=)9.6 G 4.8(>T)-4.8
G(his document)-4.8 E(;; The code is in the CAS)108 565.2 Q
(\(cas-get \(ref-get "src/vault.scm"\)\))108 577.2 Q 4.8(;=)9.6 G 4.8
(>I)-4.8 G(mplementation)-4.8 E(;; The schema is in the CAS)108 601.2 Q
(\(cas-get \(ref-get "schema/soup-object"\)\))108 613.2 Q 4.8(;=)9.6 G
4.8(>S)-4.8 G(oup object definition)-4.8 E F1 2.5(10.2. Meta-Objects)72
631.2 R 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R
(Objects that describe objects:)72 84 Q/F1 8/Courier@0 SF
(;; Schema for soup objects \(itself a soup object\))108 102 Q
(\(soup-object)108 114 Q(\(name "schema/soup-object"\))117.6 126 Q
(\(type schema\))117.6 138 Q(\(size "412B"\))117.6 150 Q
(\(crypto \(sha256 "def456..."\)\))117.6 162 Q
(\(describes soup-object\)\))117.6 174 Q
(;; The soup can enumerate itself)108 198 Q
(\(soup-query type: 'schema\))108 210 Q 4.8(;=)9.6 G 4.8(>A)-4.8 G
(ll schemas including this one)-4.8 E/F2 10/Times-Bold@0 SF 2.5
(10.3. Re\215exi)72 228 R .2 -.1(ve Q)-.1 H(ueries).1 E F0
(The soup answers questions about itself:)72 243.6 Q F1
(;; What types exist?)108 261.6 Q 4.8(\(soup-types\) ;)108 273.6 R
(=> \(archive release key audit commit schema ...\))4.8 E
(;; What crypto algorithms are in use?)108 297.6 Q 4.8
(\(soup-algorithms\) ;)108 309.6 R(=> \(sha256 ed25519 zstd age ...\))
4.8 E(;; What is the total size of the vault?)108 333.6 Q 4.8
(\(soup-total-size\) ;)108 345.6 R(=> 47.3MB)4.8 E
(;; How much deduplication?)108 369.6 Q 4.8(\(soup-dedup-ratio\) ;)108
381.6 R(=> 0.73 \(27% space saved\))4.8 E F2 2.5(10.4. Pr)72 399.6 R -.1
(ove)-.18 G(nance).1 E F0(Ev)72 415.2 Q(ery object kno)-.15 E
(ws its origin:)-.25 E F1(\(soup-object)108 433.2 Q
(\(name "rfc-020.ps"\))117.6 445.2 Q(\(type blob\))117.6 457.2 Q
(\(size "89KB"\))117.6 469.2 Q(\(crypto \(sha256 "abc123..."\)\))117.6
481.2 Q(\(provenance)117.6 493.2 Q(\(created-by "ddp@eludom.net"\))127.2
505.2 Q(\(created-at 1767700000\))127.2 517.2 Q
(\(derived-from "sha256:fff888..."\))127.2 529.2 Q(\(tool "dvips"\)\)\))
127.2 541.2 Q F0(Pro)72 559.2 Q -.15(ve)-.15 G
(nance chains are themselv).15 E(es content-addressed:)-.15 E F1
(;; Trace full history)108 577.2 Q(\(define \(provenance-chain hash\))
108 589.2 Q(\(let \(\(obj \(soup-get hash\)\)\))117.6 601.2 Q
(\(if \(soup-object-derived-from obj\))127.2 613.2 Q
(\(cons obj \(provenance-chain \(soup-object-derived-from obj\)\)\))
146.4 625.2 Q(\(list obj\)\)\)\))146.4 637.2 Q F2 2.5(10.5. A)72 655.2 R
(udit of A)-.5 E(udits)-.5 E 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R
(The audit trail audits itself:)72 84 Q/F1 8/Courier@0 SF
(;; Audit entry for an audit entry)108 102 Q(\(audit-entry)108 114 Q
(\(id 42\))117.6 126 Q(\(actor vault-key\))117.6 138 Q
(\(action \(audit-append 41\)\))117.6 150 Q 4.8(;R)9.6 G
(ecorded adding entry 41)-4.8 E(\(timestamp 1767700100\)\))117.6 162 Q
(;; The audit trail is in the soup)108 186 Q
(\(soup-query type: 'audit\))108 198 Q 4.8(;=)9.6 G 4.8(>A)-4.8 G
(ll audit entries as soup objects)-4.8 E/F2 10/Times-Bold@0 SF 2.5
(10.6. Bootstrapping)72 216 R F0(The system can describe ho)72 231.6 Q
2.5(wt)-.25 G 2.5(ob)-2.5 G(uild itself:)-2.7 E F1
(;; Bootstrap manifest - everything needed to reconstruct)108 249.6 Q
(\(bootstrap-manifest)108 261.6 Q(\(hash "sha256:bootstrap..."\))117.6
273.6 Q(\(contents)117.6 285.6 Q(\(\("src/" tree "sha256:src..."\))127.2
297.6 Q(\("rfcs/" tree "sha256:rfcs..."\))132 309.6 Q
(\("keys/" tree "sha256:keys..."\))132 321.6 Q
(\("schema/" tree "sha256:schema..."\)\)\))132 333.6 Q
(\(build-instructions)117.6 345.6 Q
("Load src/boot.scm, call \(bootstrap\)"\)\))127.2 357.6 Q
(;; Verify bootstrap integrity)108 381.6 Q
(\(define \(verify-bootstrap\))108 393.6 Q
(\(let \(\(manifest \(cas-get \(ref-get "bootstrap"\)\)\)\))117.6 405.6
Q(\(for-each verify-tree \(manifest-contents manifest\)\)\)\))127.2
417.6 Q F2 2.5(10.7. The)72 435.6 R(Library Contains Itself)2.5 E F1
(+-----------------------------------------+)108 453.6 Q 57.6(|L)108
465.6 S(IBRARY OF CYBERSPACE)-57.6 E(|)38.4 E 9.6(|+)108 477.6 S 4.8
(-----------------------------------+ |)-9.6 F 9.6(|| C)108 489.6 S
(ontent-Addressed Storage)-9.6 E 9.6(||)24 G 9.6(||+)108 501.6 S 4.8
(-----------------------------+ | |)-9.6 F -4.8 9.6(||| R)108 513.6 T
(FC-020 \(this document\))-9.6 E 9.6(|||)9.6 G -4.8 9.6(||| d)108 525.6
T(escribing CAS)-9.6 E 9.6(|||)52.8 G -4.8 9.6(||| s)108 537.6 T
(tored in CAS)-9.6 E 9.6(|||)57.6 G 9.6(||+)108 549.6 S 4.8
(-----------------------------+ | |)-9.6 F 9.6(|+)108 561.6 S 4.8
(-----------------------------------+ |)-9.6 F
(+-----------------------------------------+)108 573.6 Q F0
(Homoiconic storage: the description is the thing.)72 591.6 Q F2 2.5
(11. T)72 615.6 R(ombstones)-.92 E F0(Objects are ne)72 631.2 Q -.15(ve)
-.25 G 2.5(rt).15 G(ruly deleted - the)-2.5 E 2.5(ya)-.15 G(re mark)-2.5
E(ed with tombstones.)-.1 E 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(11.1. Soft)72 84 R(Deletion)2.5 E/F2 8/Courier@0 SF
(\(define \(cas-tombstone hash #!key reason actor\))108 102 Q
("Mark object as deleted without removing it")117.6 114 Q
(\(let \(\(tombstone)117.6 126 Q(\(tombstone)151.2 138 Q
(\(object ,hash\))160.8 150 Q(\(deleted-at ,\(current-seconds\)\))160.8
162 Q(\(deleted-by ,actor\))160.8 174 Q(\(reason ,reason\)\)\)\))160.8
186 Q(\(audit-append action: \(tombstone ,hash\) motivation: reason\))
127.2 198 Q(\(cas-put \(serialize tombstone\)\)\)\))127.2 210 Q F1 2.5
(11.2. T)72 228 R(ombstone Pr)-.92 E(operties)-.18 E F2(\(soup-object)
108 246 Q(\(name "sha256:deadbeef..."\))117.6 258 Q(\(type tombstone\))
117.6 270 Q(\(size "0B"\))117.6 282 Q 4.8(;L)9.6 G(ogical size is zero)
-4.8 E(\(status deleted\))117.6 294 Q
(\(reason "Superseded by sha256:newversion..."\))117.6 306 Q
(\(recoverable #t\)\))117.6 318 Q F1 2.5(11.3. Reco)72 336 R -.1(ve)-.1
G(ry).1 E F2(\(define \(cas-resurrect hash\))108 354 Q
("Remove tombstone, restore object visibility")117.6 366 Q
(\(let \(\(tombstone \(find-tombstone hash\)\)\))117.6 378 Q
(\(when tombstone)127.2 390 Q
(\(audit-append action: `\(resurrect ,hash\)\))136.8 402 Q
(\(cas-delete \(tombstone-hash tombstone\)\)\)\)\))136.8 414 Q F1 2.5
(11.4. Garbage)72 432 R(Collection with T)2.5 E(ombstones)-.92 E F2
(\(define \(cas-gc roots #!key preserve-tombstones\))108 450 Q
("GC respects tombstones by default")117.6 462 Q
(\(let \(\(reachable \(trace-reachable roots\)\))117.6 474 Q
(\(tombstoned \(all-tombstoned-hashes\)\)\))146.4 486 Q(\(for-each)127.2
498 Q(\(lambda \(hash\))136.8 510 Q
(\(unless \(or \(set-member? reachable hash\))146.4 522 Q
(\(and preserve-tombstones)204 534 Q
(\(set-member? tombstoned hash\)\)\))228 546 Q
(\(delete-file \(hash->path hash\)\)\)\))156 558 Q
(\(all-objects\)\)\)\))136.8 570 Q F1 2.5(12. Pinning)72 588 R F0
(Pinned objects are protected from g)72 603.6 Q(arbage collection.)-.05
E 0 Cg EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(12.1. Pin)72 84 R(Operations)2.5 E/F2 8/Courier@0 SF
(\(define \(cas-pin hash #!key recursive reason\))108 102 Q
("Pin object \(and optionally its references\)")117.6 114 Q
(\(let \(\(pin `\(pin)117.6 126 Q(\(object ,hash\))180 138 Q
(\(pinned-at ,\(current-seconds\)\))180 150 Q(\(recursive ,recursive\))
180 162 Q(\(reason ,reason\)\)\)\))180 174 Q
(\(write-file \(pin-path hash\) \(serialize pin\)\))127.2 186 Q
(\(when recursive)127.2 198 Q
(\(for-each \(lambda \(ref\) \(cas-pin ref recursive: #t\)\))136.8 210 Q
(\(object-references hash\)\)\)\)\))184.8 222 Q
(\(define \(cas-unpin hash\))108 246 Q("Remove pin, allow GC")117.6 258
Q(\(delete-file \(pin-path hash\)\)\))117.6 270 Q
(\(define \(cas-pinned? hash\))108 294 Q("Check if object is pinned")
117.6 306 Q(\(file-exists? \(pin-path hash\)\)\))117.6 318 Q F1 2.5
(12.2. Pin)72 336 R(Manifest)2.5 E F2(;; All pins as soup objects)108
354 Q(\(soup-query type: 'pin\))108 366 Q(;; Pin statistics)108 390 Q 24
(\(soup-pin-count\) ;)108 402 R(=> 142 objects pinned)4.8 E 14.4
(\(soup-pinned-size\) ;)108 414 R(=> 23.4MB)4.8 E F1 2.5(12.3. Root)72
432 R(Pins)2.5 E F0(Certain objects are implicitly pinned:)72 447.6 Q F2
(\(define implicit-roots)108 465.6 Q 48('\("HEAD" ;)117.6 477.6 R
(Current commit)4.8 E 14.4("refs/tags/" ;)127.2 489.6 R(All tags)4.8 E
24("bootstrap" ;)127.2 501.6 R(System bootstrap)4.8 E 19.2
("schema/"\)\) ;)127.2 513.6 R(All schemas)4.8 E F1 2.5(13. Bloom)72
531.6 R(Filters)2.5 E F0(Compact probabilistic set membership for ef)72
547.2 Q(\214cient replication.)-.25 E F1 2.5(13.1. Multi-Le)72 571.2 R
-.1(ve)-.15 G 2.5(lE).1 G(xistence Check)-2.5 E F0 -.15(Fo)72 586.8 S
2.5(rt).15 G(he distrib)-2.5 E(uted soup, e)-.2 E
(xistence checks dominate replication o)-.15 E -.15(ve)-.15 G
(rhead. A tiered approach minimizes latenc).15 E(y:)-.15 E F2
(+---------------------------------------------------------+)108 604.8 Q
4.8(|L)108 616.8 S
(1: Hot Set Cache \(1000 items, O\(1\), microseconds\))-4.8 E(|)24 E
(+---------------------------------------------------------+)108 628.8 Q
4.8(|L)108 640.8 S(2: Blocked Bloom Filter \(100K items, O\(k\), cache-)
-4.8 E(|)24 E 24(|f)108 652.8 S(riendly memory layout\))-24 E(|)139.2 E
(+---------------------------------------------------------+)108 664.8 Q
4.8(|L)108 676.8 S(3: Quotient Filter \(1M items, supports deletion\))
-4.8 E(|)28.8 E
(+---------------------------------------------------------+)108 688.8 Q
4.8(|L)108 700.8 S(4: Disk/Network \(authoritative, milliseconds\))-4.8
E(|)43.2 E(+---------------------------------------------------------+)
108 712.8 Q 0 Cg EP
%%Page: 13 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(13.2. Block)72 84 R(ed Bloom Filters)-.1 E F0
(Cache-line aligned blocks for 10x f)72 99.6 Q(aster lookups:)-.1 E/F2 8
/Courier@0 SF(;; Blocked Bloom: each block fits in CPU cache line \(64 \
bytes = 512 bits\))108 117.6 Q(\(define block-bits 512\))108 129.6 Q
(\(define cache-line 64\))108 141.6 Q
(\(define \(make-blocked-bloom capacity error-rate\))108 165.6 Q
("Cache-friendly blocked Bloom filter")117.6 177.6 Q
(\(let \(\(bits \(bloom-optimal-bits capacity error-rate\)\))117.6 189.6
Q(\(num-blocks \(ceiling \(/ bits block-bits\)\)\))151.2 201.6 Q
(\(hashes \(bloom-optimal-hashes capacity bits\)\)\))151.2 213.6 Q
(\(blocked-bloom)127.2 225.6 Q
(\(blocks \(make-vector num-blocks \(make-u8vector cache-line 0\)\)\))
136.8 237.6 Q(\(hash-count hashes\))136.8 249.6 Q(\(block-selector \(la\
mbda \(hash\) \(modulo \(hash-part-1 hash\) num-blocks\)\)\)\)\)\))136.8
261.6 Q(\(define \(blocked-bloom-add! filter hash\))108 285.6 Q
("Add to block - all bits within same cache line")117.6 297.6 Q
(\(let \(\(block-idx \(block-select filter hash\)\))117.6 309.6 Q
(\(block \(vector-ref \(bloom-blocks filter\) block-idx\)\)\))151.2
321.6 Q(\(for-each)127.2 333.6 Q(\(lambda \(i\))136.8 345.6 Q(\(let \(\
\(bit-idx \(modulo \(bloom-hash filter hash i\) block-bits\)\)\))146.4
357.6 Q(\(u8vector-bit-set! block bit-idx 1\)\)\))156 369.6 Q
(\(iota \(bloom-hash-count filter\)\)\)\)\))136.8 381.6 Q
(\(define \(blocked-bloom-contains? filter hash\))108 405.6 Q
("Check within single cache line - no cache misses")117.6 417.6 Q
(\(let \(\(block-idx \(block-select filter hash\)\))117.6 429.6 Q
(\(block \(vector-ref \(bloom-blocks filter\) block-idx\)\)\))151.2
441.6 Q(\(every)127.2 453.6 Q(\(lambda \(i\))136.8 465.6 Q(\(let \(\(bi\
t-idx \(modulo \(bloom-hash filter hash i\) block-bits*\)\)\))146.4
477.6 Q(\(= 1 \(u8vector-bit-ref block bit-idx\)\)\)\))156 489.6 Q
(\(iota \(bloom-hash-count filter\)\)\)\)\))136.8 501.6 Q F1 2.5
(13.3. Counting)72 519.6 R(Bloom Filters)2.5 E 0 Cg EP
%%Page: 14 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R -.15(Fo)72 84 S 2.5(rt)
.15 G(he soup, objects can be tombstoned \(soft-deleted\). Counting \
\214lters support remo)-2.5 E -.25(va)-.15 G(l:).25 E/F1 8/Courier@0 SF
(;; Counting Bloom: 4-bit counters instead of single bits)108 102 Q
(\(define \(make-counting-bloom capacity error-rate\))108 114 Q
("Counting Bloom filter supporting deletions")117.6 126 Q
(\(let* \(\(slots \(bloom-optimal-bits capacity error-rate\)\))117.6 138
Q(\(nibbles \(make-u8vector \(ceiling \(/ slots 2\)\) 0\)\))151.2 150 Q
(\(hashes \(bloom-optimal-hashes capacity slots\)\)\))151.2 162 Q
(\(counting-bloom nibbles hashes slots\)\)\))127.2 174 Q
(\(define \(counting-bloom-add! filter hash\))108 198 Q
("Increment counters \(saturate at 15\)")117.6 210 Q(\(for-each)117.6
222 Q(\(lambda \(i\))127.2 234 Q
(\(let \(\(slot \(bloom-slot filter hash i\)\)\))136.8 246 Q
(\(nibble-increment! \(bloom-nibbles filter\) slot\)\)\))146.4 258 Q
(\(iota \(bloom-hash-count filter\)\)\)\))127.2 270 Q
(\(define \(counting-bloom-remove! filter hash\))108 294 Q
("Decrement counters \(only if present\)")117.6 306 Q
(\(when \(counting-bloom-contains? filter hash\))117.6 318 Q(\(for-each)
127.2 330 Q(\(lambda \(i\))136.8 342 Q
(\(let \(\(slot \(bloom-slot filter hash i\)\)\))146.4 354 Q
(\(nibble-decrement! \(bloom-nibbles filter\) slot\)\)\))156 366 Q
(\(iota \(bloom-hash-count filter\)\)\)\)\))136.8 378 Q
(;; Integration with tombstones)108 402 Q
(\(define \(cas-tombstone/bloom hash reason\))108 414 Q
("Tombstone with Bloom filter update")117.6 426 Q
(\(counting-bloom-remove! existence-filter hash\))117.6 438 Q
(\(cas-tombstone hash reason: reason\)\))117.6 450 Q/F2 10/Times-Bold@0
SF 2.5(13.4. Quotient)72 468 R(Filters)2.5 E 0 Cg EP
%%Page: 15 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R(Better space ef)72 84 Q
(\214cienc)-.25 E 2.5(yt)-.15 G
(han Bloom, supports deletion, and can be resized:)-2.5 E/F1 8/Courier@0
SF(;; Quotient filter: fingerprint stored in quotient/remainder form)108
102 Q(\(define \(make-quotient-filter capacity\))108 114 Q
("Space-efficient filter with deletion support")117.6 126 Q
(\(let* \(\(slots \(next-power-of-2 capacity\)\))117.6 138 Q
(\(q-bits \(integer-log2 slots\)\))151.2 150 Q
(\(r-bits \(- 64 q-bits\)\)\))151.2 162 Q 4.8(;6)9.6 G
(4-bit fingerprints)-4.8 E(\(quotient-filter)127.2 174 Q
(\(table \(make-vector slots #f\)\))136.8 186 Q(\(q-bits q-bits\))136.8
198 Q(\(r-bits r-bits\))136.8 210 Q(\(count 0\)\)\)\))136.8 222 Q
(\(define \(qf-fingerprint hash q-bits r-bits\))108 246 Q
("Split hash into quotient and remainder")117.6 258 Q
(\(let \(\(fp \(hash->u64 hash\)\)\))117.6 270 Q
(\(values \(arithmetic-shift fp \(- r-bits\)\))127.2 282 Q 4.8(;q)9.6 G
(uotient)-4.8 E
(\(bitwise-and fp \(- \(arithmetic-shift 1 r-bits\) 1\)\)\)\)\))165.6
294 Q 4.8(;r)9.6 G(emainder)-4.8 E(\(define \(qf-insert! qf hash\))108
318 Q("Insert with Robin Hood linear probing")117.6 330 Q(\(let-values \
\(\(\(q r\) \(qf-fingerprint hash \(qf-q-bits qf\) \(qf-r-bits qf\)\)\)\
\))117.6 342 Q(\(qf-insert-slot! qf q r\)\)\))127.2 354 Q
(\(define \(qf-delete! qf hash\))108 378 Q("Delete fingerprint")117.6
390 Q(\(let-values \(\(\(q r\) \(qf-fingerprint hash \(qf-q-bits qf\) \
\(qf-r-bits qf\)\)\)\))117.6 402 Q(\(qf-delete-slot! qf q r\)\)\))127.2
414 Q/F2 10/Times-Bold@0 SF 2.5(13.5. Replication)72 432 R(Pr)2.5 E
(otocol)-.18 E F1(;; Sender: "Here's what I have" \(compressed Bloom\))
108 450 Q(\(define \(bloom-inventory\))108 462 Q
(\(let \(\(filter \(make-blocked-bloom 100000 0.01\)\)\))117.6 474 Q
(\(for-each \(lambda \(hash\) \(blocked-bloom-add! filter hash\)\))127.2
486 Q(\(all-object-hashes\)\))175.2 498 Q(filter\)\))127.2 510 Q
(;; Receiver: "Send me what I'm missing")108 534 Q
(\(define \(bloom-diff local-filter remote-filter\))108 546 Q
(\(filter \(lambda \(hash\))117.6 558 Q
(\(and \(blocked-bloom-contains? remote-filter hash\))165.6 570 Q
(\(not \(cas-exists? hash\)\)\)\))189.6 582 Q(\(all-object-hashes\)\)\))
156 594 Q(;; Exchange is O\(bloom-size\) not O\(object-count\))108 618 Q
(;; Blocked Bloom: 10-100x faster due to cache locality)108 630 Q 0 Cg
EP
%%Page: 16 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(13.6. Hierar)72 84 R(chical Existence Check)-.18 E/F2 8/Courier@0 SF
(\(define \(cas-exists?/fast hash\))108 102 Q
("Tiered existence check - fast path for common case")117.6 114 Q
(\(or \(lru-get hot-set hash\))117.6 126 Q 4.8(;L)67.2 G
(1: O\(1\) in-memory)-4.8 E
(\(and \(blocked-bloom-contains? l2-bloom hash\))136.8 138 Q 4.8(;L)9.6
G(2: O\(k\) cache-friendly)-4.8 E(\(or \(qf-contains? l3-qf hash\))160.8
150 Q 4.8(;L)9.6 G(3: O\(1\) amortized)-4.8 E
(\(cas-exists? hash\)\)\)\)\))180 162 Q 4.8(;L)28.8 G(4: authoritative)
-4.8 E(;; 99% of checks hit L1/L2, avoiding disk/network entirely)108
186 Q F1 2.5(13.7. Soup)72 204 R(Integration)2.5 E F2
(;; Bloom filter itself is a soup object)108 222 Q(\(soup-object)108 234
Q(\(name "bloom/2026-01-09"\))117.6 246 Q(\(type bloom-filter\))117.6
258 Q(\(variant blocked\))117.6 270 Q 4.8(;b)52.8 G
(locked, counting, or quotient)-4.8 E(\(size "12KB"\))117.6 282 Q
(\(crypto \(sha256 "bloom-hash..."\)\))117.6 294 Q(\(capacity 100000\))
117.6 306 Q(\(error-rate 0.01\))117.6 318 Q(\(population 47230\))117.6
330 Q(\(load-factor 0.47\)\))117.6 342 Q F1 2.5(14. Content)72 360 R
-.34(Ty)2.5 G(pes).34 E F0 -.8(Ty)72 375.6 S(ped objects with schema v)
.8 E(alidation.)-.25 E F1 2.5(14.1. T)72 399.6 R(ype Registry)-.34 E F2
(\(define content-types)108 417.6 Q 33.6('\(\(blob .)117.6 429.6 R
("application/octet-stream"\))4.8 E 33.6(\(text .)127.2 441.6 R
("text/plain"\))4.8 E 14.4(\(markdown .)127.2 453.6 R("text/markdown"\))
4.8 E 24(\(scheme .)127.2 465.6 R("text/x-scheme"\))4.8 E 33.6(\(sexp .)
127.2 477.6 R("application/x-sexp"\))4.8 E 33.6(\(json .)127.2 489.6 R
("application/json"\))4.8 E 38.4(\(pdf .)127.2 501.6 R
("application/pdf"\))4.8 E 19.2(\(archive .)127.2 513.6 R
("application/x-sealed-archive"\))4.8 E 38.4(\(key .)127.2 525.6 R
("application/x-spki-key"\))4.8 E
(\(certificate . "application/x-spki-cert"\)\)\))127.2 537.6 Q F1 2.5
(14.2. T)72 555.6 R(yped Storage)-.34 E F2
(\(define \(cas-put/typed content type #!key schema\))108 573.6 Q
("Store with type metadata")117.6 585.6 Q
(\(let* \(\(hash \(sha256 content\)\))117.6 597.6 Q
(\(meta `\(typed-object)151.2 609.6 Q(\(hash ,hash\))189.6 621.6 Q
(\(type ,type\))189.6 633.6 Q(\(size ,\(blob-length content\)\))189.6
645.6 Q(\(schema ,schema\)\)\)\))189.6 657.6 Q(\(cas-put content\))127.2
669.6 Q(\(cas-put \(serialize meta\)\))127.2 681.6 Q(hash\)\))127.2
693.6 Q 0 Cg EP
%%Page: 17 17
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(14.3. Schema)72 84 R -.92(Va)2.5 G(lidation).92 E/F2 8/Courier@0 SF
(\(define \(cas-validate hash\))108 102 Q
("Validate object against its schema")117.6 114 Q
(\(let* \(\(meta \(cas-get-meta hash\)\))117.6 126 Q
(\(schema-hash \(typed-object-schema meta\)\))151.2 138 Q
(\(schema \(cas-get schema-hash\)\))151.2 150 Q
(\(content \(cas-get hash\)\)\))151.2 162 Q
(\(schema-validate schema content\)\)\))127.2 174 Q
(;; Schema is itself content-addressed)108 198 Q(\(soup-object)108 210 Q
(\(name "schema/soup-object"\))117.6 222 Q(\(type schema\))117.6 234 Q
(\(validates soup-object\))117.6 246 Q
(\(crypto \(sha256 "schema-hash..."\)\)\))117.6 258 Q F1 2.5(14.4. MIME)
72 276 R(Detection)2.5 E F2(\(define \(cas-detect-type content\))108 294
Q("Detect content type from magic bytes")117.6 306 Q(\(cond)117.6 318 Q
(\(\(pdf-magic? content\) 'pdf\))127.2 330 Q
(\(\(gzip-magic? content\) 'archive\))127.2 342 Q
(\(\(utf8-text? content\))127.2 354 Q(\(cond)132 366 Q
(\(\(sexp-syntax? content\) 'sexp\))141.6 378 Q
(\(\(markdown-syntax? content\) 'markdown\))141.6 390 Q
(\(else 'text\)\)\))141.6 402 Q(\(else 'blob\)\)\))127.2 414 Q F1 2.5
(15. Object)72 432 R(Capabilities)2.5 E F0
(Content addresses as capabilities: if you kno)72 447.6 Q 2.5(wt)-.25 G
(he hash, you can retrie)-2.5 E .3 -.15(ve i)-.25 H(t.).15 E F1 2.5
(15.1. Hash)72 471.6 R(as Capability)2.5 E F2
(;; Knowledge of hash grants read access)108 489.6 Q
(\(define \(cas-get-if-known hash\))108 501.6 Q
("Capability-based retrieval")117.6 513.6 Q(\(if \(valid-hash? hash\))
117.6 525.6 Q(\(cas-get hash\))136.8 537.6 Q
(\(error "Invalid capability"\)\)\))136.8 549.6 Q
(;; Hashes are unguessable \(256-bit entropy\))108 573.6 Q
(;; Sharing a hash = sharing read access)108 585.6 Q 0 Cg EP
%%Page: 18 18
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(15.2. Capability)72 84 R(Attenuation)2.5 E/F2 8/Courier@0 SF
(;; SPKI certificate granting access to specific content)108 102 Q
(\(spki-cert)108 114 Q(\(issuer vault-key\))117.6 126 Q
(\(subject reader-key\))117.6 138 Q
(\(permission \(read \(hash sha256 "specific-content..."\)\)\))117.6 150
Q(\(validity \(not-after "2027-01-01"\)\)\))117.6 162 Q
(;; Grant access to a subtree)108 186 Q(\(spki-cert)108 198 Q
(\(issuer vault-key\))117.6 210 Q(\(subject reader-key\))117.6 222 Q
(\(permission \(read \(tree sha256 "subtree-root..."\)\)\))117.6 234 Q
(\(propagate #t\)\))117.6 246 Q 4.8(;A)9.6 G
(ccess to all referenced objects)-4.8 E F1 2.5(15.3. Sealed)72 264 R
(Capabilities)2.5 E F2
(;; Encrypted capability - only holder of key can use)108 282 Q
(\(define \(seal-capability hash recipient-key\))108 294 Q
(\(let \(\(cap `\(capability)117.6 306 Q(\(object ,hash\))180 318 Q
(\(granted-at ,\(current-seconds\)\)\)\)\))180 330 Q
(\(age-encrypt \(serialize cap\) recipient-key\)\)\))127.2 342 Q
(;; Recipient decrypts to obtain hash)108 366 Q
(\(define \(unseal-capability sealed-cap identity\))108 378 Q
(\(let \(\(cap \(deserialize \(age-decrypt sealed-cap identity\)\)\)\))
117.6 390 Q(\(capability-object cap\)\)\))127.2 402 Q F1 2.5
(15.4. Capability)72 420 R(Re)2.5 E -.1(vo)-.15 G(cation).1 E F2
(;; Revocation via tombstone)108 438 Q
(\(define \(revoke-capability hash\))108 450 Q
(\(cas-tombstone hash reason: "Capability revoked"\)\))117.6 462 Q
(;; Or via SPKI CRL)108 486 Q(\(spki-crl)108 498 Q(\(issuer vault-key\))
117.6 510 Q(\(revoked)117.6 522 Q
(\(\(hash sha256 "revoked-content..."\))127.2 534 Q
(\(reason "Superseded"\))132 546 Q(\(revoked-at 1767700000\)\)\)\))132
558 Q F1 2.5(16. Hash)72 576 R(Migration)2.5 E F0
(When cryptographic algorithms weak)72 591.6 Q
(en, the system must migrate.)-.1 E 0 Cg EP
%%Page: 19 19
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(16.1. Multihash)72 84 R/F2 8/Courier@0 SF
(;; Self-describing hash format)108 102 Q
(\(define \(multihash algo data\))108 114 Q(\(let \(\(hash \(case algo)
117.6 126 Q(\(\(sha256\) \(sha256 data\)\))184.8 138 Q
(\(\(sha384\) \(sha384 data\)\))184.8 150 Q
(\(\(sha512\) \(sha512 data\)\))184.8 162 Q
(\(\(blake3\) \(blake3 data\)\)\)\)\))184.8 174 Q
(\(list algo \(blob-length hash\) hash\)\)\))127.2 186 Q
(;; Parse multihash)108 210 Q
(\(define \(multihash-algorithm mh\) \(car mh\)\))108 222 Q
(\(define \(multihash-digest mh\) \(caddr mh\)\))108 234 Q F1 2.5
(16.2. Dual-Hash)72 252 R -.2(Pe)2.5 G(riod).2 E F2
(;; During migration, store under both hashes)108 270 Q
(\(define \(cas-put/migrate content old-algo new-algo\))108 282 Q
(\(let \(\(old-hash \(hash-with old-algo content\)\))117.6 294 Q
(\(new-hash \(hash-with new-algo content\)\)\))146.4 306 Q
(\(cas-put-raw old-hash content\))127.2 318 Q
(\(cas-put-raw new-hash content\))127.2 330 Q(;; Link old to new)127.2
342 Q(\(ref-set \(string-append "migrate/" old-hash\) new-hash\))127.2
354 Q(new-hash\)\))127.2 366 Q(;; Lookup follows migration links)108 390
Q(\(define \(cas-get/migrate hash\))108 402 Q
(\(let \(\(migrated \(ref-get \(string-append "migrate/" hash\)\)\)\))
117.6 414 Q(\(cas-get \(or migrated hash\)\)\)\))127.2 426 Q F1 2.5
(16.3. Migration)72 444 R(Manifest)2.5 E F2(\(migration-manifest)108 462
Q(\(from-algorithm sha256\))117.6 474 Q(\(to-algorithm sha384\))117.6
486 Q(\(started-at 1767700000\))117.6 498 Q(\(status in-progress\))117.6
510 Q(\(migrated 4723\))117.6 522 Q(\(remaining 1892\))117.6 534 Q
(\(mappings)117.6 546 Q(\(\("sha256:abc..." . "sha384:def..."\))127.2
558 Q(\("sha256:123..." . "sha384:456..."\))132 570 Q(...\)\)\))132 582
Q F1 2.5(16.4. V)72 600 R(eri\214cation During Migration)-1 E F2
(\(define \(verify-migration hash\))108 618 Q
("Verify object under both old and new hash")117.6 630 Q
(\(let* \(\(content \(cas-get hash\)\))117.6 642 Q
(\(old-hash \(sha256 content\)\))151.2 654 Q
(\(new-hash \(sha384 content\)\)\))151.2 666 Q
(\(and \(or \(equal? hash old-hash\))127.2 678 Q
(\(equal? hash new-hash\)\))170.4 690 Q
(\(equal? \(ref-get \(string-append "migrate/" old-hash\)\))151.2 702 Q
(new-hash\)\)\)\))189.6 714 Q 0 Cg EP
%%Page: 20 20
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(17. Comparison)72 84 R(with Related Systems)2.5 E .4 LW 471.16 94.5
140.84 94.5 DL 59.035(System Hash)158.76 104 R 38.89(Chunking Naming)
55.275 F 57.5(Git SHA-1)145.84 116 R -.1(Pa)73.07 G(ck \214les).1 E -.18
(re)33.44 G(fs/branches).18 E 49.72(IPFS SHA-256/multihash)145.84 128 R
45(Rabin IPNS,)17.5 F(DNSLink)2.5 E -.2(Pe)145.84 140 S(rk).2 E 36.7
(eep SHA-224)-.1 F(Rolling hash)63.07 E -.2(Pe)19.99 G(rmanodes).2 E
(Library CAS)145.84 152 Q 60.57(SHA-256 Con\214gurable)17.5 F -.92(Va)
17.5 G(ult r).92 E(efs)-.18 E 471.16 156.5 140.84 156.5 DL 471.16 94.5
471.16 156.5 DL 140.84 94.5 140.84 156.5 DL 2.5(18. Security)72 170 R
(Considerations)2.5 E 2.5(18.1. Hash)72 194 R(Collision Attacks)2.5 E F0
(SHA-256 pro)72 209.6 Q
(vides 128-bit collision resistance. No practical attacks kno)-.15 E
(wn.)-.25 E(If SHA-256 is e)72 225.2 Q -.15(ve)-.25 G 2.5(rb).15 G(rok)
-2.5 E(en:)-.1 E/F2 8/Courier@0 SF(;; Multihash for algorithm agility)
108 243.2 Q(\(define \(multihash algo data\))108 255.2 Q(\(case algo)
117.6 267.2 Q(\(\(sha256\) \(cons 'sha256 \(sha256 data\)\)\))127.2
279.2 Q(\(\(sha384\) \(cons 'sha384 \(sha384 data\)\)\))127.2 291.2 Q
(\(\(blake3\) \(cons 'blake3 \(blake3 data\)\)\)\)\))127.2 303.2 Q F1
2.5(18.2. Length)72 321.2 R(Extension Attacks)2.5 E F0
(SHA-256 is vulnerable to length e)72 336.8 Q(xtension. F)-.15 E
(or authentication, use HMA)-.15 E(C:)-.4 E F2
(\(define \(cas-mac key hash\))108 354.8 Q(\(hmac-sha256 key hash\)\))
117.6 366.8 Q F1 2.5(18.3. T)72 384.8 R(iming Attacks)-.18 E F0
(Hash comparison MUST be constant-time:)72 400.4 Q F2
(\(define \(hash-equal? a b\))108 418.4 Q(\(let \(\(result 0\)\))117.6
430.4 Q(\(do \(\(i 0 \(+ i 1\)\)\))127.2 442.4 Q
(\(\(= i 32\) \(zero? result\)\))146.4 454.4 Q
(\(set! result \(bitwise-ior result)136.8 466.4 Q
(\(bitwise-xor \(blob-ref a i\) \(blob-ref b i\)\)\)\)\)\)\))204 478.4 Q
F1 2.5(19. P)72 496.4 R(erf)-.2 E(ormance Considerations)-.25 E 2.5
(19.1. Caching)72 520.4 R F2(;; LRU cache for hot objects)108 538.4 Q
(\(define cas-cache \(make-lru-cache 1000\)\))108 550.4 Q
(\(define \(cas-get/cached hash\))108 574.4 Q
(\(or \(lru-get cas-cache hash\))117.6 586.4 Q
(\(let \(\(content \(cas-get hash\)\)\))136.8 598.4 Q
(\(lru-put! cas-cache hash content\))146.4 610.4 Q(content\)\)\))146.4
622.4 Q F1 2.5(19.2. P)72 640.4 R(arallel Hashing)-.1 E F0(Lar)72 656 Q
(ge \214les bene\214t from parallel hashing of chunks.)-.18 E F1 2.5
(19.3. SSD)72 680 R(Optimization)2.5 E 0 Cg EP
%%Page: 21 21
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-020 0)72 48 R
(Random access pattern. Use write-ahead log for durability:)72 84 Q/F1 8
/Courier@0 SF(\(define \(cas-put/durable content\))108 102 Q
(\(let \(\(hash \(sha256 content\)\)\))117.6 114 Q
(\(wal-append hash content\))127.2 126 Q
(\(write-blob \(hash->path hash\) content\))127.2 138 Q
(\(wal-commit hash\))127.2 150 Q(hash\)\))127.2 162 Q/F2 10/Times-Bold@0
SF 2.5(20. Implementation)72 180 R(Notes)2.5 E 2.5(20.1. Dependencies)72
204 R .4 LW 389.885 214.5 222.115 214.5 DL 41.94(Component Library)
227.115 224 R 26.11(SHA-256 message-digest,)227.115 236 R(sha2)2.5 E
(Blob I/O)227.115 248 Q(CHICKEN I/O)30.54 E 22.2(Chunking Custom)227.115
260 R 389.885 264.5 222.115 264.5 DL 389.885 214.5 389.885 264.5 DL
222.115 214.5 222.115 264.5 DL 2.5(20.2. Err)72 278 R(or Handling)-.18 E
F1(\(define-condition-type &cas-error &error)108 296 Q(cas-error?)117.6
308 Q(\(hash cas-error-hash\)\))117.6 320 Q
(\(define-condition-type &cas-not-found &cas-error)108 344 Q
(cas-not-found?\))117.6 356 Q
(\(define-condition-type &cas-corrupt &cas-error)108 380 Q
(cas-corrupt?\))117.6 392 Q F2 2.5(21. Refer)72 410 R(ences)-.18 E F0
.286(1. Merkle, R. \(1987\), "A Digital Signature Based on a Con)72
425.6 R -.15(ve)-.4 G .286
(ntional Encryption Function" 2. Git Internals - Git Ob-).15 F .281(jec\
ts 3. IPFS Content Addressing 4. Putze, Sanders, Singler \(2007\), "Cac\
he-, Hash-, and Space-Ef)72 437.6 R .28(\214cient Bloom Fil-)-.25 F .518
(ters" 5. Bender et al. \(2012\), "Don')72 449.6 R 3.018(tT)-.18 G .518
(hrash: Ho)-3.018 F 3.018(wt)-.25 G 3.018(oC)-3.018 G .518(ache Y)-3.018
F .518(our Hash on Flash" 6. RFC-006: V)-1.1 F .518(ault System Archi-)
-1.11 F(tecture 7. RFC-018: Sealed Archi)72 461.6 Q .3 -.15(ve Fo)-.25 H
(rmat).15 E F2 2.5(22. Changelog)72 485.6 R F0 6.5<8332>72 501.2 S
(026-01-09)-6.5 E 6.5<8341>72 516.8 S(dv)-6.5 E .213
(anced probabilistic data structures: block)-.25 F .212(ed Bloom \214lt\
ers, counting Bloom \214lters, quotient \214lters, hierarchical)-.1 F
-.15(ex)82 528.8 S(istence checking - 2026-01-07).15 E 6.5<8349>72 544.4
S(nitial draft)-6.5 E 0 Cg EP
%%Trailer
end
%%EOF
