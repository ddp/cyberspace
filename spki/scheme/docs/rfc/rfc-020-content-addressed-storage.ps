%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:12:23 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 16
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-020: Content-Addressed Storage)72 12 Q(Stat\
us: Draft Date: January 2026 Author: Derrell Piper ddp@eludom.net Imple\
mentation: Proposed)72 36 Q(-------------------------------------------\
-----------------------------------)72 60 Q(Abstract)72 84 Q .749(This \
RFC speci\214es content-addressed storage \(CAS\) for the Library of Cy\
berspace: a storage model where data is)72 108 R .909(addressed by its \
cryptographic hash rather than by location. Content addressing pro)72
120 R .91(vides immutability guarantees,)-.15 F
(automatic deduplication, and tamper)72 132 Q(-e)-.2 E(vident storage.)
-.25 E(----------------------------------------------------------------\
--------------)72 156 Q(Moti)72 180 Q -.25(va)-.25 G(tion).25 E -.35(Tr)
72 204 S(aditional storage systems use location-based addressing:).35 E
2.602(-D)72 228 S .102(ECtape: Ph)-2.602 F .102
(ysical position on magnetic tape - Filesystems: P)-.05 F .102
(ath names \(/home/ddp/\214le.txt\) - Databases: Ro)-.15 F 2.602(wI)-.25
G(Ds,)-2.602 E(primary k)72 240 Q -.15(ey)-.1 G 2.5(s-U).15 G(RLs: Serv)
-2.5 E(er + path \(https://e)-.15 E(xample.com/doc.ps\))-.15 E
(Location-based addressing has fundamental problems:)72 264 Q 2.885
(1. Mutability)72 288 R 2.885(-S)2.885 G .385
(ame address can point to dif)-2.885 F .385(ferent content o)-.25 F -.15
(ve)-.15 G 2.885(rt).15 G .385(ime 2.)-2.885 F .386
(Link rot - Addresses become in)5.385 F -.25(va)-.4 G .386(lid when).25
F .724(content mo)72 300 R -.15(ve)-.15 G 3.224(s3).15 G 5.724(.D)-3.224
G .724(uplication - Identical content stored multiple times 4.)-5.724 F
.724(No v)5.724 F .723(eri\214cation - Address doesn\342t pro)-.15 F
-.15(ve)-.15 G(content inte)72 312 Q(grity)-.15 E
(Content-addressed storage in)72 336 Q -.15(ve)-.4 G(rts this:).15 E 2.5
(Location-based: address)82 360 R 2.5<e263>2.5 G(ontent \(man)-2.5 E
(y-to-one, mutable\))-.15 E 5(Content-based: content)82 372 R 2.5<e261>
2.5 G(ddress \(one-to-one, immutable\))-2.5 E .242(The address IS the c\
ontent\342s cryptographic \214ngerprint. If the content changes, the ad\
dress changes. If tw)72 396 R 2.742<6f8c>-.1 G .242(les ha)-2.742 F -.15
(ve)-.2 G(the same address, the)72 408 Q 2.5(ya)-.15 G(re byte-for)-2.5
E(-byte identical.)-.2 E(----------------------------------------------\
--------------------------------)72 432 Q(Content Addressing Model)72
456 Q(Hash as Address)72 480 Q(;; Content determines address)82 504 Q
(\(de\214ne \(content-address data\))82 516 Q(\(sha256 data\)\))87 528 Q
(;; Store by hash)82 552 Q(\(de\214ne \(cas-store data\))82 564 Q
(\(let \(\(hash \(content-address data\)\)\))87 576 Q
(\(write-blob \(hash->path hash\) data\))92 588 Q(hash\)\))92 600 Q
(;; Retrie)82 624 Q .3 -.15(ve b)-.25 H 2.5(yh).15 G(ash)-2.5 E
(\(de\214ne \(cas-retrie)82 636 Q .3 -.15(ve h)-.25 H(ash\)).15 E
(\(let \(\(data \(read-blob \(hash->path hash\)\)\)\))87 648 Q
(\(if \(equal? hash \(content-address data\)\))92 660 Q(data)102 672 Q
(\(error "Content tampered"\)\)\)\))102 684 Q(Properties)72 708 Q 35
(Property Location-Based)77 732 R(Content-Addressed)7.5 E
(---------------------- ---------------- -------------------)77 744 Q
(Address stability)77 756 Q 20(Unstable Permanent)15 F(Content v)77 768
Q 5(eri\214cation External)-.15 F(Intrinsic)22.5 E 22.5
(Deduplication Manual)77 780 R(Automatic)27.5 E 30(Mutability Mutable)77
792 R(Immutable)25 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Link rot)77 12 Q 25(Common Impossible)37.5 F
(Hash Function Requirements)72 36 Q(The hash function MUST be:)72 60 Q
2.5(1. Collision-resistant)72 84 R 2.5(-C)2.5 G
(omputationally infeasible to \214nd tw)-2.5 E 2.5(oi)-.1 G(nputs with)
-2.5 E .439(same hash 2.)82 96 R .438(Preimage-resistant - Cannot deri)
5.438 F .738 -.15(ve c)-.25 H .438(ontent from hash 3.).15 F .438
(Deterministic - Same content al)5.438 F -.1(wa)-.1 G .438(ys pro-).1 F
(duces same hash 4.)72 108 Q -.15(Fa)5 G(st - Practical for lar).15 E
(ge objects)-.18 E(Speci\214ed hash: SHA-256 \(32 bytes, 64 he)72 132 Q
2.5(xc)-.15 G(haracters\))-2.5 E(;; Example content address)82 156 Q
("e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855")82
168 Q(;; This is the SHA-256 of the empty string)82 180 Q(-------------\
-----------------------------------------------------------------)72 204
Q(Storage Architecture)72 228 Q(Object Store)72 252 Q(.cas/)82 276 Q
(\342\342\342 objects/)82 288 Q 7.5<e2e2>82 300 S(\342\342 e3/)-7.5 E
7.5<e2e2e2>82 312 S(\342\342 b0c44298fc1c149afbf4c8996fb92427ae41e4649b\
934ca495991b7852b855)-7.5 E 7.5<e2e2>82 324 S(\342\342 a7/)-7.5 E 7.5
<e2e2e2>82 336 S<e2e22066>-7.5 E(fc6f8bf1ed76651c14756a061d662f580f)-.25
E(f4de43b49f)-.25 E(a82d80a4b80f8434a)-.1 E 7.5<e2e2>82 348 S
(\342\342 ...)-7.5 E(\342\342\342 refs/)82 360 Q 7.5<e2e2>82 372 S
(\342\342 HEAD)-7.5 E 7.5<e2e2>82 384 S(\342\342 tags/)-7.5 E
<e2e2e220696e6465>82 396 Q(x)-.15 E(Sharding: First tw)72 420 Q 2.5(oh)
-.1 G .3 -.15(ex c)-2.5 H(haracters of hash form directory name \(256 b)
.15 E(uck)-.2 E(ets\).)-.1 E(Object T)72 444 Q(ypes)-.8 E(;; Blob - ra)
82 468 Q 2.5(wd)-.15 G(ata)-2.5 E(\(cas-blob)82 480 Q
(\(hash "sha256:..."\))87 492 Q(\(size 1024\))87 504 Q
(\(data #${...}\)\))87 516 Q(;; T)82 540 Q(ree - directory structure)
-.35 E(\(cas-tree)82 552 Q(\(hash "sha256:..."\))87 564 Q(\(entries)87
576 Q(\(\("README.md" blob "sha256:abc..."\))92 588 Q
(\("src" tree "sha256:def..."\))94.5 600 Q
(\("lib" tree "sha256:ghi..."\)\)\)\))94.5 612 Q
(;; Commit - snapshot with metadata)82 636 Q(\(cas-commit)82 648 Q
(\(hash "sha256:..."\))87 660 Q(\(tree "sha256:..."\))87 672 Q
(\(parent "sha256:..." | #f\))87 684 Q(\(author "ddp@eludom.net"\))87
696 Q(\(timestamp 1767700000\))87 708 Q(\(message "Initial commit"\)\))
87 720 Q(Merkle T)72 744 Q(rees)-.35 E
(Directories are trees of hashes. The root hash commits to all content:)
72 768 Q(root: sha256:abc...)132 792 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 70(/s)144.5 12 S(rc: sha256:def)-70 E
(lib: sha256:ghi)12.5 E 55(/|)119.5 24 S 10(main.scm test.scm)102 36 R
(util.scm)15 E 5(sha256:111 sha256:222)102 48 R(sha256:333)10 E
(Changing ANY \214le changes ALL parent hashes up to root.)72 72 Q(----\
-----------------------------------------------------------------------\
---)72 96 Q(Operations)72 120 Q(Store)72 144 Q
(\(de\214ne \(cas-put content\))82 168 Q("Store content, return hash")87
180 Q(\(let* \(\(hash \(sha256 content\)\))87 192 Q
(\(path \(hash->path hash\)\)\))104.5 204 Q(\(unless \(\214le-e)92 216 Q
(xists? path\))-.15 E(\(write-blob path content\)\))97 228 Q(hash\)\))92
240 Q(Deduplication: If hash already e)72 264 Q
(xists, storage is a no-op.)-.15 E(Retrie)72 288 Q -.15(ve)-.25 G
(\(de\214ne \(cas-get hash\))82 312 Q("Retrie)87 324 Q .3 -.15(ve c)-.25
H(ontent by hash, v).15 E(erify inte)-.15 E(grity")-.15 E
(\(let* \(\(path \(hash->path hash\)\))87 336 Q
(\(content \(read-blob path\)\)\))104.5 348 Q
(\(unless \(equal? hash \(sha256 content\)\))92 360 Q
(\(error "Content inte)97 372 Q(grity f)-.15 E(ailure" hash\)\))-.1 E
(content\)\))92 384 Q(Self-v)72 408 Q(erifying: Ev)-.15 E(ery retrie)
-.15 E -.25(va)-.25 G 2.5(lc).25 G(on\214rms inte)-2.5 E(grity)-.15 E(.)
-.65 E(Exists)72 432 Q(\(de\214ne \(cas-e)82 456 Q(xists? hash\))-.15 E
("Check if content e)87 468 Q(xists")-.15 E(\(\214le-e)87 480 Q
(xists? \(hash->path hash\)\)\))-.15 E(Delete)72 504 Q
(\(de\214ne \(cas-gc roots\))82 528 Q
("Garbage collect unreachable objects")87 540 Q
(\(let \(\(reachable \(trace-reachable roots\)\)\))87 552 Q(\(for)92 564
Q(-each)-.2 E(\(lambda \(hash\))97 576 Q
(\(unless \(set-member? reachable hash\))102 588 Q
(\(delete-\214le \(hash->path hash\)\)\)\))107 600 Q
(\(all-objects\)\)\)\))97 612 Q(Note: Deletion requires g)72 636 Q
(arbage collection from kno)-.05 E(wn roots.)-.25 E(-------------------\
-----------------------------------------------------------)72 660 Q
(Naming Layer)72 684 Q(Content addresses are not human-friendly)72 708 Q
2.5(.An)-.65 G(aming layer maps names to hashes:)-2.5 E(References)72
732 Q(;; Mutable reference to immutable content)82 756 Q
(\(de\214ne \(ref-set name hash\))82 768 Q
(\(write-\214le \(ref-path name\) hash\)\))87 780 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne \(ref-get name\))82 12 Q
(\(read-\214le \(ref-path name\)\)\))87 24 Q(;; Example)82 48 Q
(\(ref-set "HEAD" "sha256:abc123..."\))82 60 Q
(\(ref-get "HEAD"\) ; => "sha256:abc123...")82 72 Q -.8(Ta)72 96 S(gs).8
E(;; Immutable named reference)82 120 Q
(\(de\214ne \(tag-create name hash #!k)82 132 Q .3 -.15(ey m)-.1 H
(essage signature\)).15 E(\(let \(\(tag-content)87 144 Q(`\(tag)104.5
156 Q(\(name ,name\))109.5 168 Q(\(object ,hash\))109.5 180 Q
(\(message ,message\))109.5 192 Q(\(signature ,signature\)\)\)\))109.5
204 Q(\(cas-put \(serialize tag-content\)\)\)\))92 216 Q
(Directory Entries)72 240 Q(;; Human name -> content hash)82 264 Q
(\(de\214ne library-inde)82 276 Q(x)-.15 E
('\(\("RFC-000" . "sha256:e3b0c44..."\))87 288 Q
(\("RFC-001" . "sha256:a7f)92 300 Q(fc6f..."\))-.25 E
(\("RFC-002" . "sha256:b94d27b)92 312 Q(..."\)\)\))-.4 E(--------------\
----------------------------------------------------------------)72 336
Q(The Soup: Object Directory)72 360 Q .349
(Content-addressed storage pro)72 384 R .349(vides retrie)-.15 F -.25
(va)-.25 G 2.849(lb).25 G 2.849(yh)-2.849 G .349(ash, b)-2.849 F .349
(ut disco)-.2 F -.15(ve)-.15 G .349(ry requires an object directory).15
F 2.85(.T)-.65 G .35(he Soup \(inspired)-2.85 F(by Ne)72 396 Q
(wtonOS\) pro)-.25 E(vides a uni\214ed vie)-.15 E 2.5(wo)-.25 G 2.5(fa)
-2.5 G(ll objects with rich metadata.)-2.5 E(Philosoph)72 420 Q(y)-.05 E
(\342The soup is in\214nite.\342 - Objects swim in a queryable sea of m\
etadata.)77 444 Q(The Soup in)72 468 Q -.15(ve)-.4 G
(rts the traditional \214lesystem model:).15 E 2.5(-F)72 492 S
(ilesystem: Na)-2.5 E(vig)-.2 E(ate hierarch)-.05 E 2.5(yt)-.05 G 2.5
<6f8c>-2.5 G(nd objects - Soup: Query attrib)-2.5 E(utes to disco)-.2 E
-.15(ve)-.15 G 2.5(ro).15 G(bjects)-2.5 E(Object Enumeration)72 516 Q
(\(de\214ne \(soup\))82 540 Q("List all objects in the v)87 552 Q
(ault with metadata")-.25 E(\(append)87 564 Q 12.5(\(soup-releases\) ;)
92 576 R(Signed releases)2.5 E(\(soup-archi)92 588 Q -.15(ve)-.25 G 12.5
(s\) ;).15 F(Sealed archi)2.5 E -.15(ve)-.25 G(s).15 E(\(soup-k)92 600 Q
-.15(ey)-.1 G 22.5(s\) ;).15 F(Cryptographic k)2.5 E -.15(ey)-.1 G(s).15
E(\(soup-audit-entries\) ; Audit trail)92 612 Q 10
(\(soup-commits\)\)\) ;)92 624 R(Recent commits)2.5 E(Rich Metadata)72
648 Q(Ev)72 672 Q
(ery object carries crypto metadata - the ciphers, hashes, and k)-.15 E
-.15(ey)-.1 G 2.5(si).15 G -1.9 -.4(nv o)-2.5 H(lv).4 E(ed:)-.15 E
(;; Archi)82 696 Q .3 -.15(ve o)-.25 H(bject).15 E(\(soup-object)82 708
Q(\(name "1.0.0"\))87 720 Q(\(type archi)87 732 Q -.15(ve)-.25 G(\)).15
E(\(size "1.2MB"\))87 744 Q(\(crypto \(zstd sha256 "fe378a78..."\)\)\))
87 756 Q(;; K)82 780 Q .3 -.15(ey o)-.25 H(bject).15 E(\(soup-object)82
792 Q 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(name "v)87 12 Q(ault-signing"\))-.25 E
(\(type k)87 24 Q -.15(ey)-.1 G(\)).15 E(\(size "64B"\))87 36 Q
(\(crypto \(ed25519/256 public sign)87 48 Q 7.5("sha256:a1b2c3d4..." ;)
109.5 60 R(\214ngerprint)2.5 E 10("id:ddp@eludom.net" ;)109.5 72 R
(identity)2.5 E 20("2026-01-07"\)\)\) ;)109.5 84 R(creation date)2.5 E
(;; Release object)82 108 Q(\(soup-object)82 120 Q(\(name "0.1.0"\))87
132 Q(\(type release\))87 144 Q(\(size "313B"\))87 156 Q
(\(crypto \(ed25519 sha512 "abc123..."\)\)\))87 168 Q(Querying the Soup)
72 192 Q(;; Find all signed objects)82 216 Q(\(soup-query type: ')82 228
Q(release\))-.5 E(;; Find objects using speci\214c algorithm)82 252 Q
(\(soup-query crypto: 'ed25519\))82 264 Q(;; Find objects by size range)
82 288 Q(\(soup-query min-size: 1000 max-size: 100000\))82 300 Q
(;; Find objects by content hash pre\214x)82 324 Q
(\(soup-query hash-pre\214x: "fe378"\))82 336 Q(Display F)72 360 Q
(ormat)-.15 E(The soup displays as a compact, human-readable listing:)72
384 Q 2.5($s)82 408 S(eal-soup)-2.5 E -.25(va)82 420 S
(ult-signing, 64B, ed25519/256, public, sign, sha256:a1b2c3d4...).25 E
(0.1.0, 313B, signed, ed25519, sha512)82 432 Q
(1.0.0, 1.2MB, zstd, sha256, fe378a78...)82 444 Q
(audit/1, sealed, 2026-01-07T10:30:00Z)82 456 Q(Soup as Inde)72 480 Q(x)
-.15 E(The Soup can be serialized as a content-addressed inde)72 504 Q
(x:)-.15 E(\(de\214ne \(soup-snapshot\))82 528 Q
("Create content-addressed snapshot of current soup")87 540 Q
(\(let* \(\(entries \(soup\)\))87 552 Q
(\(serialized \(serialize entries\)\))104.5 564 Q
(\(hash \(cas-put serialized\)\)\))104.5 576 Q
(\(ref-set "soup/HEAD" hash\))92 588 Q(hash\)\))92 600 Q .172
(This enables: - T)72 624 R .171(ime tra)-.35 F -.15(ve)-.2 G .171
(l: Load historical soup snapshots - Replication: Sync soup inde).15 F
-.15(xe)-.15 G 2.671(sb).15 G .171(etween v)-2.671 F .171(aults - V)-.25
F(eri\214-)-1.11 E(cation: Pro)72 636 Q .3 -.15(ve s)-.15 H
(oup state at a point in time).15 E(-----------------------------------\
-------------------------------------------)72 660 Q(Inte)72 684 Q
(gration with Library of Cyberspace)-.15 E -1.11(Va)72 708 S(ult Inte)
1.11 E(gration)-.15 E(The V)72 732 Q
(ault \(RFC-006\) uses content addressing internally via Git:)-1.11 E
(;; Git objects ARE content-addressed)82 756 Q
(\(de\214ne \(git-hash-object content\))82 768 Q
(\(sha1 \(string-append "blob " \(number)87 780 Q
(->string \(blob-length content\)\) "0" content\)\)\))-.2 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(CAS e)72 12 Q
(xtends this with SHA-256 and Library-speci\214c semantics.)-.15 E
(Archi)72 36 Q .3 -.15(ve S)-.25 H(torage).15 E(Sealed archi)72 60 Q
-.15(ve)-.25 G 2.5(s\().15 G
(RFC-018\) can be stored by content address:)-2.5 E(\(de\214ne \(archi)
82 84 Q -.15(ve)-.25 G(-to-cas archi).15 E -.15(ve)-.25 G(-path\)).15 E
(\(let* \(\(content \(read-blob archi)87 96 Q -.15(ve)-.25 G(-path\)\))
.15 E(\(hash \(cas-put content\)\)\))104.5 108 Q
(\(ref-set \(string-append "archi)92 120 Q -.15(ve)-.25 G(s/" \(archi)
.15 E -.15(ve)-.25 G(-v).15 E(ersion archi)-.15 E -.15(ve)-.25 G
(-path\)\) hash\)).15 E(hash\)\))92 132 Q(Replication)72 156 Q
(Content addressing enables ef)72 180 Q
(\214cient replication \(RFC-001\):)-.25 E
(;; Only transfer objects recei)82 204 Q -.15(ve)-.25 G 2.5(rd).15 G
(oesn')-2.5 E 2.5(th)-.18 G -2.25 -.2(av e)-2.5 H
(\(de\214ne \(replicate-to remote root-hash\))82 216 Q(\(for)87 228 Q
(-each)-.2 E(\(lambda \(hash\))92 240 Q
(\(unless \(remote-has? remote hash\))97 252 Q
(\(remote-put remote hash \(cas-get hash\)\)\)\))102 264 Q
(\(trace-reachable root-hash\)\)\))92 276 Q(SPKI Inte)72 300 Q(gration)
-.15 E(Content hashes can be authorization subjects \(RFC-004\):)72 324
Q(;; Grant permission to speci\214c content)82 348 Q(\(spki-cert)82 360
Q(\(issuer publisher)87 372 Q(-k)-.2 E -.15(ey)-.1 G(\)).15 E
(\(subject \(hash sha256 "abc123..."\)\))87 384 Q(\(permission read\))87
396 Q(\(v)87 408 Q(alidity \(not-after "2027-01-01"\)\)\))-.25 E(------\
-----------------------------------------------------------------------\
-)72 432 Q(Chunking for Lar)72 456 Q(ge Objects)-.18 E(Lar)72 480 Q
(ge \214les are split into chunks for:)-.18 E 2.5(1. Deduplication)72
504 R(at sub-\214le granularity 2.)2.5 E -.15(Pa)5 G(rallel transfer 3.)
.15 E(Incremental updates)5 E(Fix)72 528 Q(ed-Size Chunking)-.15 E
(\(de\214ne chunk-size \(* 64 1024\)\))82 552 Q 2.5(;6)5 G(4KB)-2.5 E
(\(de\214ne \(chunk-\214x)82 576 Q(ed data\))-.15 E(\(let loop \(\(of)87
588 Q(fset 0\) \(chunks '\(\)\)\))-.25 E(\(if \(>= of)92 600 Q
(fset \(blob-length data\)\))-.25 E(\(re)102 612 Q -.15(ve)-.25 G
(rse chunks\)).15 E(\(loop \(+ of)102 624 Q(fset chunk-size\))-.25 E
(\(cons \(blob-cop)117 636 Q 2.5(yd)-.1 G(ata of)-2.5 E
(fset \(min chunk-size \(- \(blob-length data\) of)-.25 E(fset\)\)\))
-.25 E(chunks\)\)\)\)\))132 648 Q
(Content-De\214ned Chunking \(Rabin \214ngerprinting\))72 672 Q
(;; Chunk boundaries determined by content)82 696 Q(;; Survi)82 708 Q
-.15(ve)-.25 G 2.5(si).15 G(nsertions/deletions better than \214x)-2.5 E
(ed-size)-.15 E(\(de\214ne \(chunk-rabin data\))82 720 Q
(\(let \(\(windo)87 732 Q(w-size 48\))-.25 E(\(min-chunk 2048\))102 744
Q(\(max-chunk 65536\))102 756 Q(\(mask #x0f)102 768 Q -.25(ff)-.25 G 2.5
(\)\) ;).25 F -1.17 -.74(Av e)2.5 H(rage 4KB chunks).74 E(...\)\))92 780
Q 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Chunk T)72 12 Q(ree)-.35 E(\(cas-chunk)82 36 Q
(ed)-.1 E(\(hash "sha256:..."\))87 48 Q 2.5(;R)15 G(oot hash)-2.5 E
(\(size 10485760\))87 60 Q 2.5(;1)25 G(0MB original)-2.5 E(\(chunks)87
72 Q(\("sha256:aaa..." 65536\))92 84 Q(\("sha256:bbb)92 96 Q
(..." 65536\))-.4 E(\("sha256:ccc..." 32768\))92 108 Q(...\)\))92 120 Q
(----------------------------------------------------------------------\
--------)72 144 Q(Introspection)72 168 Q
(The Library is fully introspecti)72 192 Q -.15(ve)-.25 G 2.5(:i).15 G
2.5(ts)-2.5 G(tores, addresses, and reasons about itself.)-2.5 E
(Self-Hosting)72 216 Q(The system contains its o)72 240 Q
(wn description:)-.25 E(;; The RFCs are in the CAS)82 264 Q
(\(cas-get \(ref-get "rfc/020"\)\))82 276 Q 2.5(;=)5 G 2.5(>T)-2.5 G
(his document)-2.5 E(;; The code is in the CAS)82 300 Q
(\(cas-get \(ref-get "src/v)82 312 Q 2.5(ault.scm"\)\) ;)-.25 F
(=> Implementation)2.5 E(;; The schema is in the CAS)82 336 Q
(\(cas-get \(ref-get "schema/soup-object"\)\))82 348 Q 2.5(;=)5 G 2.5
(>S)-2.5 G(oup object de\214nition)-2.5 E(Meta-Objects)72 372 Q
(Objects that describe objects:)72 396 Q
(;; Schema for soup objects \(itself a soup object\))82 420 Q
(\(soup-object)82 432 Q(\(name "schema/soup-object"\))87 444 Q
(\(type schema\))87 456 Q(\(size "412B"\))87 468 Q
(\(crypto \(sha256 "def456..."\)\))87 480 Q(\(describes soup-object\)\))
87 492 Q(;; The soup can enumerate itself)82 516 Q(\(soup-query type: ')
82 528 Q 2.5(schema\) ;)-.55 F(=> All schemas including this one)2.5 E
(Re\215e)72 552 Q(xi)-.15 E .3 -.15(ve Q)-.25 H(ueries).15 E
(The soup answers questions about itself:)72 576 Q(;; What types e)82
600 Q(xist?)-.15 E 2.5(\(soup-types\) ;)82 612 R(=> \(archi)2.5 E .3
-.15(ve r)-.25 H(elease k).15 E .3 -.15(ey a)-.1 H
(udit commit schema ...\)).15 E(;; What crypto algorithms are in use?)82
636 Q 2.5(\(soup-algorithms\) ;)82 648 R
(=> \(sha256 ed25519 zstd age ...\))2.5 E
(;; What is the total size of the v)82 672 Q(ault?)-.25 E 2.5
(\(soup-total-size\) ;)82 684 R(=> 47.3MB)2.5 E(;; Ho)82 708 Q 2.5(wm)
-.25 G(uch deduplication?)-2.5 E 2.5(\(soup-dedup-ratio\) ;)82 720 R
(=> 0.73 \(27% space sa)2.5 E -.15(ve)-.2 G(d\)).15 E(Pro)72 744 Q -.15
(ve)-.15 G(nance).15 E(Ev)72 768 Q(ery object kno)-.15 E(ws its origin:)
-.25 E(\(soup-object)82 792 Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(name "rfc-020.ps"\))87 12 Q(\(type blob\))87
24 Q(\(size "89KB"\))87 36 Q(\(crypto \(sha256 "abc123..."\)\))87 48 Q
(\(pro)87 60 Q -.15(ve)-.15 G(nance).15 E
(\(created-by "ddp@eludom.net"\))92 72 Q(\(created-at 1767700000\))92 84
Q(\(deri)92 96 Q -.15(ve)-.25 G(d-from "sha256:f).15 E -.25(ff)-.25 G
(888..."\)).25 E(\(tool "dvips"\)\)\))92 108 Q(Pro)72 132 Q -.15(ve)-.15
G(nance chains are themselv).15 E(es content-addressed:)-.15 E(;; T)82
156 Q(race full history)-.35 E(\(de\214ne \(pro)82 168 Q -.15(ve)-.15 G
(nance-chain hash\)).15 E(\(let \(\(obj \(soup-get hash\)\)\))87 180 Q
(\(if \(soup-object-deri)92 192 Q -.15(ve)-.25 G(d-from obj\)).15 E
(\(cons obj \(pro)102 204 Q -.15(ve)-.15 G
(nance-chain \(soup-object-deri).15 E -.15(ve)-.25 G(d-from obj\)\)\))
.15 E(\(list obj\)\)\)\))102 216 Q(Audit of Audits)72 240 Q
(The audit trail audits itself:)72 264 Q
(;; Audit entry for an audit entry)82 288 Q(\(audit-entry)82 300 Q
(\(id 42\))87 312 Q(\(actor v)87 324 Q(ault-k)-.25 E -.15(ey)-.1 G(\))
.15 E(\(action \(audit-append 41\)\))87 336 Q 2.5(;R)5 G
(ecorded adding entry 41)-2.5 E(\(timestamp 1767700100\)\))87 348 Q
(;; The audit trail is in the soup)82 372 Q(\(soup-query type: 'audit\))
82 384 Q 2.5(;=)5 G 2.5(>A)-2.5 G(ll audit entries as soup objects)-2.5
E(Bootstrapping)72 408 Q(The system can describe ho)72 432 Q 2.5(wt)-.25
G 2.5(ob)-2.5 G(uild itself:)-2.7 E(;; Bootstrap manifest - e)82 456 Q
-.15(ve)-.25 G(rything needed to reconstruct).15 E(\(bootstrap-manifest)
82 468 Q(\(hash "sha256:bootstrap..."\))87 480 Q(\(contents)87 492 Q
(\(\("src/" tree "sha256:src..."\))92 504 Q
(\("rfcs/" tree "sha256:rfcs..."\))94.5 516 Q(\("k)94.5 528 Q -.15(ey)
-.1 G(s/" tree "sha256:k).15 E -.15(ey)-.1 G(s..."\)).15 E
(\("schema/" tree "sha256:schema..."\)\)\))94.5 540 Q(\(b)87 552 Q
(uild-instructions)-.2 E("Load src/boot.scm, call \(bootstrap\)"\)\))92
564 Q(;; V)82 588 Q(erify bootstrap inte)-1.11 E(grity)-.15 E
(\(de\214ne \(v)82 600 Q(erify-bootstrap\))-.15 E
(\(let \(\(manifest \(cas-get \(ref-get "bootstrap"\)\)\)\))87 612 Q
(\(for)92 624 Q(-each v)-.2 E
(erify-tree \(manifest-contents manifest\)\)\)\))-.15 E
(The Library Contains Itself)72 648 Q<e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2ae>82 672 Q 30<e24c>
82 684 S(IBRAR)-30 E 2.5(YO)-.65 G 2.5(FC)-2.5 G(YBERSP)-2.5 E -.4(AC)
-.92 G 20<45e2>.4 G 5<e2e2>82 696 S 2.5<e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2ae20e2>-5 F 5<e2e22043>82 708 S
(ontent-Addressed Storage)-5 E 5<e2e2>12.5 G 5<e2e2e2>82 720 S 2.5
<e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2ae20e220e2>
-5 F -2.5 5<e2e2e22052>82 732 T(FC-020 \(this document\))-5 E 5<e2e2e2>5
G -2.5 5<e2e2e22064>82 744 T(escribing CAS)-5 E 5<e2e2e2>27.5 G -2.5 5
<e2e2e22073>82 756 T(tored in CAS)-5 E 5<e2e2e2>30 G 5<e2e2e2>82 768 S
2.5<b0e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2af20e2
20e2>-5 F 5<e2e2>82 780 S 2.5<b0e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2af20e2>-5 F<e2b0e2e2e2e2e2e2e2e2e2e2e2e2
e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2af>82 792 Q
0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF
(Homoiconic storage: the description is the thing.)72 24 Q(------------\
------------------------------------------------------------------)72 48
Q -.8(To)72 72 S(mbstones).8 E(Objects are ne)72 96 Q -.15(ve)-.25 G 2.5
(rt).15 G(ruly deleted - the)-2.5 E 2.5(ya)-.15 G(re mark)-2.5 E
(ed with tombstones.)-.1 E(Soft Deletion)72 120 Q
(\(de\214ne \(cas-tombstone hash #!k)82 144 Q .3 -.15(ey r)-.1 H
(eason actor\)).15 E("Mark object as deleted without remo)87 156 Q
(ving it")-.15 E(\(let \(\(tombstone)87 168 Q(`\(tombstone)104.5 180 Q
(\(object ,hash\))109.5 192 Q(\(deleted-at ,\(current-seconds\)\))109.5
204 Q(\(deleted-by ,actor\))109.5 216 Q(\(reason ,reason\)\)\)\))109.5
228 Q(\(audit-append action: `\(tombstone ,hash\) moti)92 240 Q -.25(va)
-.25 G(tion: reason\)).25 E(\(cas-put \(serialize tombstone\)\)\)\))92
252 Q -.8(To)72 276 S(mbstone Properties).8 E(\(soup-object)82 300 Q
(\(name "sha256:deadbeef..."\))87 312 Q(\(type tombstone\))87 324 Q
(\(size "0B"\))87 336 Q 2.5(;L)5 G(ogical size is zero)-2.5 E
(\(status deleted\))87 348 Q(\(reason "Superseded by sha256:ne)87 360 Q
(wv)-.25 E(ersion..."\))-.15 E(\(reco)87 372 Q -.15(ve)-.15 G
(rable #t\)\)).15 E(Reco)72 396 Q -.15(ve)-.15 G(ry).15 E
(\(de\214ne \(cas-resurrect hash\))82 420 Q("Remo)87 432 Q .3 -.15(ve t)
-.15 H(ombstone, restore object visibility").15 E
(\(let \(\(tombstone \(\214nd-tombstone hash\)\)\))87 444 Q
(\(when tombstone)92 456 Q
(\(audit-append action: `\(resurrect ,hash\)\))97 468 Q
(\(cas-delete \(tombstone-hash tombstone\)\)\)\)\))97 480 Q
(Garbage Collection with T)72 504 Q(ombstones)-.8 E
(\(de\214ne \(cas-gc roots #!k)82 528 Q .3 -.15(ey p)-.1 H(reserv).15 E
(e-tombstones\))-.15 E("GC respects tombstones by def)87 540 Q(ault")-.1
E(\(let \(\(reachable \(trace-reachable roots\)\))87 552 Q
(\(tombstoned \(all-tombstoned-hashes\)\)\))102 564 Q(\(for)92 576 Q
(-each)-.2 E(\(lambda \(hash\))97 588 Q
(\(unless \(or \(set-member? reachable hash\))102 600 Q(\(and preserv)
132 612 Q(e-tombstones)-.15 E(\(set-member? tombstoned hash\)\)\))144.5
624 Q(\(delete-\214le \(hash->path hash\)\)\)\))107 636 Q
(\(all-objects\)\)\)\))97 648 Q(---------------------------------------\
---------------------------------------)72 672 Q(Pinning)72 696 Q
(Pinned objects are protected from g)72 720 Q(arbage collection.)-.05 E
(Pin Operations)72 744 Q(\(de\214ne \(cas-pin hash #!k)82 768 Q .3 -.15
(ey r)-.1 H(ecursi).15 E .3 -.15(ve r)-.25 H(eason\)).15 E
("Pin object \(and optionally its references\)")87 780 Q
(\(let \(\(pin `\(pin)87 792 Q 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(object ,hash\))119.5 12 Q
(\(pinned-at ,\(current-seconds\)\))119.5 24 Q(\(recursi)119.5 36 Q .3
-.15(ve ,)-.25 H(recursi).15 E -.15(ve)-.25 G(\)).15 E
(\(reason ,reason\)\)\)\))119.5 48 Q
(\(write-\214le \(pin-path hash\) \(serialize pin\)\))92 60 Q
(\(when recursi)92 72 Q -.15(ve)-.25 G(\(for)97 84 Q
(-each \(lambda \(ref\) \(cas-pin ref recursi)-.2 E -.15(ve)-.25 G 2.5
(:#).15 G(t\)\))-2.5 E(\(object-references hash\)\)\)\)\))122 96 Q
(\(de\214ne \(cas-unpin hash\))82 120 Q("Remo)87 132 Q .3 -.15(ve p)-.15
H(in, allo).15 E 2.5(wG)-.25 G(C")-2.5 E
(\(delete-\214le \(pin-path hash\)\)\))87 144 Q
(\(de\214ne \(cas-pinned? hash\))82 168 Q("Check if object is pinned")87
180 Q(\(\214le-e)87 192 Q(xists? \(pin-path hash\)\)\))-.15 E
(Pin Manifest)72 216 Q(;; All pins as soup objects)82 240 Q
(\(soup-query type: 'pin\))82 252 Q(;; Pin statistics)82 276 Q 12.5
(\(soup-pin-count\) ;)82 288 R(=> 142 objects pinned)2.5 E 7.5
(\(soup-pinned-size\) ;)82 300 R(=> 23.4MB)2.5 E(Root Pins)72 324 Q
(Certain objects are implicitly pinned:)72 348 Q
(\(de\214ne implicit-roots)82 372 Q 25('\("HEAD" ;)87 384 R
(Current commit)2.5 E 7.5("refs/tags/*" ;)92 396 R(All tags)2.5 E 12.5
("bootstrap" ;)92 408 R(System bootstrap)2.5 E 10("schema/*"\)\) ;)92
420 R(All schemas)2.5 E(-----------------------------------------------\
-------------------------------)72 444 Q(Bloom Filters)72 468 Q
(Compact probabilistic set membership for ef)72 492 Q
(\214cient replication.)-.25 E(Structure)72 516 Q(\(de\214ne \(mak)82
540 Q(e-bloom-\214lter capacity error)-.1 E(-rate\))-.2 E
("Create bloom \214lter for approximate membership")87 552 Q
(\(let* \(\(bits \(bloom-optimal-bits capacity error)87 564 Q(-rate\)\))
-.2 E(\(hashes \(bloom-optimal-hashes capacity bits\)\)\))104.5 576 Q
(\(bloom-\214lter)92 588 Q(\(bit-v)97 600 Q(ector \(mak)-.15 E(e-v)-.1 E
(ector bits 0\)\))-.15 E(\(hash-count hashes\))97 612 Q
(\(capacity capacity\))97 624 Q(\(error)97 636 Q(-rate error)-.2 E
(-rate\)\)\)\))-.2 E(Operations)72 660 Q
(\(de\214ne \(bloom-add! \214lter hash\))82 684 Q
("Add hash to bloom \214lter")87 696 Q(\(for)87 708 Q(-each)-.2 E
(\(lambda \(i\))92 720 Q(\(bit-v)97 732 Q(ector)-.15 E
(-set! \(bloom-bits \214lter\) \(bloom-inde)-.2 E 2.5<788c>-.15 G
(lter hash i\) 1\)\))-2.5 E(\(iota \(bloom-hash-count \214lter\)\)\)\))
92 744 Q(\(de\214ne \(bloom-contains? \214lter hash\))82 768 Q
("Check if hash MIGHT be in \214lter \(f)87 780 Q(alse positi)-.1 E -.15
(ve)-.25 G 2.5(sp).15 G(ossible\)")-2.5 E(\(e)87 792 Q -.15(ve)-.25 G
(ry).15 E 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(lambda \(i\))92 12 Q(\(= 1 \(bit-v)97 24 Q
(ector)-.15 E(-ref \(bloom-bits \214lter\) \(bloom-inde)-.2 E 2.5<788c>
-.15 G(lter hash i\)\)\)\))-2.5 E
(\(iota \(bloom-hash-count \214lter\)\)\)\))92 36 Q
(Replication Protocol)72 60 Q(;; Sender: "Here')82 84 Q 2.5(sw)-.55 G
(hat I ha)-2.5 E -.15(ve)-.2 G(").15 E(\(de\214ne \(bloom-in)82 96 Q
-.15(ve)-.4 G(ntory\)).15 E(\(let \(\(\214lter \(mak)87 108 Q
(e-bloom-\214lter 10000 0.01\)\)\))-.1 E(\(for)92 120 Q
(-each \(lambda \(hash\) \(bloom-add! \214lter hash\)\))-.2 E
(\(all-object-hashes\)\))117 132 Q(\214lter\)\))92 144 Q(;; Recei)82 168
Q -.15(ve)-.25 G(r: "Send me what I'm missing").15 E
(\(de\214ne \(bloom-dif)82 180 Q 2.5(fl)-.25 G
(ocal-\214lter remote-\214lter\))-2.5 E(\(\214lter \(lambda \(hash\))87
192 Q(\(and \(bloom-contains? remote-\214lter hash\))112 204 Q
(\(not \(cas-e)124.5 216 Q(xists? hash\)\)\)\))-.15 E
(\(all-object-hashes\)\)\))107 228 Q
(;; Exchange is O\(bloom-size\) not O\(object-count\))82 252 Q
(Soup Inte)72 276 Q(gration)-.15 E
(;; Bloom \214lter itself is a soup object)82 300 Q(\(soup-object)82 312
Q(\(name "bloom/2026-01-07"\))87 324 Q(\(type bloom-\214lter\))87 336 Q
(\(size "12KB"\))87 348 Q(\(crypto \(sha256 "bloom-hash..."\)\))87 360 Q
(\(capacity 10000\))87 372 Q(\(error)87 384 Q(-rate 0.01\))-.2 E
(\(population 4723\)\))87 396 Q(---------------------------------------\
---------------------------------------)72 420 Q(Content T)72 444 Q
(ypes)-.8 E -.8(Ty)72 468 S(ped objects with schema v).8 E(alidation.)
-.25 E -.8(Ty)72 492 S(pe Re).8 E(gistry)-.15 E
(\(de\214ne content-types)82 516 Q 17.5('\(\(blob .)87 528 R
("application/octet-stream"\))2.5 E(\(te)92 540 Q 17.5(xt .)-.15 F("te)
2.5 E(xt/plain"\))-.15 E(\(markdo)92 552 Q 7.5(wn .)-.25 F("te)2.5 E
(xt/markdo)-.15 E(wn"\))-.25 E 12.5(\(scheme .)92 564 R("te)2.5 E
(xt/x-scheme"\))-.15 E(\(se)92 576 Q 17.5(xp .)-.15 F("application/x-se)
2.5 E(xp"\))-.15 E 17.5(\(json .)92 588 R("application/json"\))2.5 E 20
(\(pdf .)92 600 R("application/pdf"\))2.5 E(\(archi)92 612 Q 10.3 -.15
(ve .)-.25 H("application/x-sealed-archi)2.65 E -.15(ve)-.25 G("\)).15 E
(\(k)92 624 Q 20.3 -.15(ey .)-.1 H("application/x-spki-k)2.65 E -.15(ey)
-.1 G("\)).15 E(\(certi\214cate . "application/x-spki-cert"\)\)\))92 636
Q -.8(Ty)72 660 S(ped Storage).8 E
(\(de\214ne \(cas-put/typed content type #!k)82 684 Q .3 -.15(ey s)-.1 H
(chema\)).15 E("Store with type metadata")87 696 Q
(\(let* \(\(hash \(sha256 content\)\))87 708 Q(\(meta `\(typed-object)
104.5 720 Q(\(hash ,hash\))124.5 732 Q(\(type ,type\))124.5 744 Q
(\(size ,\(blob-length content\)\))124.5 756 Q(\(schema ,schema\)\)\)\))
124.5 768 Q(\(cas-put content\))92 780 Q(\(cas-put \(serialize meta\)\))
92 792 Q 0 Cg EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(hash\)\))92 12 Q(Schema V)72 36 Q(alidation)
-1.11 E(\(de\214ne \(cas-v)82 60 Q(alidate hash\))-.25 E("V)87 72 Q
(alidate object ag)-1.11 E(ainst its schema")-.05 E
(\(let* \(\(meta \(cas-get-meta hash\)\))87 84 Q
(\(schema-hash \(typed-object-schema meta\)\))104.5 96 Q
(\(schema \(cas-get schema-hash\)\))104.5 108 Q
(\(content \(cas-get hash\)\)\))104.5 120 Q(\(schema-v)92 132 Q
(alidate schema content\)\)\))-.25 E
(;; Schema is itself content-addressed)82 156 Q(\(soup-object)82 168 Q
(\(name "schema/soup-object"\))87 180 Q(\(type schema\))87 192 Q(\(v)87
204 Q(alidates soup-object\))-.25 E
(\(crypto \(sha256 "schema-hash..."\)\)\))87 216 Q(MIME Detection)72 240
Q(\(de\214ne \(cas-detect-type content\))82 264 Q
("Detect content type from magic bytes")87 276 Q(\(cond)87 288 Q
(\(\(pdf-magic? content\) 'pdf\))92 300 Q
(\(\(gzip-magic? content\) 'archi)92 312 Q -.15(ve)-.25 G(\)).15 E
(\(\(utf8-te)92 324 Q(xt? content\))-.15 E(\(cond)94.5 336 Q(\(\(se)99.5
348 Q(xp-syntax? content\) ')-.15 E(se)-.55 E(xp\))-.15 E(\(\(markdo)
99.5 360 Q(wn-syntax? content\) 'markdo)-.25 E(wn\))-.25 E(\(else ')99.5
372 Q(te)-.18 E(xt\)\)\))-.15 E(\(else 'blob\)\)\))92 384 Q(-----------\
-------------------------------------------------------------------)72
408 Q(Object Capabilities)72 432 Q
(Content addresses as capabilities: if you kno)72 456 Q 2.5(wt)-.25 G
(he hash, you can retrie)-2.5 E .3 -.15(ve i)-.25 H(t.).15 E
(Hash as Capability)72 480 Q(;; Kno)82 504 Q
(wledge of hash grants read access)-.25 E(\(de\214ne \(cas-get-if-kno)82
516 Q(wn hash\))-.25 E("Capability-based retrie)87 528 Q -.25(va)-.25 G
(l").25 E(\(if \(v)87 540 Q(alid-hash? hash\))-.25 E(\(cas-get hash\))97
552 Q(\(error "In)97 564 Q -.25(va)-.4 G(lid capability"\)\)\)).25 E
(;; Hashes are unguessable \(256-bit entrop)82 588 Q(y\))-.1 E
(;; Sharing a hash = sharing read access)82 600 Q
(Capability Attenuation)72 624 Q
(;; SPKI certi\214cate granting access to speci\214c content)82 648 Q
(\(spki-cert)82 660 Q(\(issuer v)87 672 Q(ault-k)-.25 E -.15(ey)-.1 G
(\)).15 E(\(subject reader)87 684 Q(-k)-.2 E -.15(ey)-.1 G(\)).15 E
(\(permission \(read \(hash sha256 "speci\214c-content..."\)\)\))87 696
Q(\(v)87 708 Q(alidity \(not-after "2027-01-01"\)\)\))-.25 E
(;; Grant access to a subtree)82 732 Q(\(spki-cert)82 744 Q(\(issuer v)
87 756 Q(ault-k)-.25 E -.15(ey)-.1 G(\)).15 E(\(subject reader)87 768 Q
(-k)-.2 E -.15(ey)-.1 G(\)).15 E
(\(permission \(read \(tree sha256 "subtree-root..."\)\)\))87 780 Q
(\(propag)87 792 Q(ate #t\)\))-.05 E 2.5(;A)5 G
(ccess to all referenced objects)-2.5 E 0 Cg EP
%%Page: 13 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Sealed Capabilities)72 24 Q
(;; Encrypted capability - only holder of k)82 48 Q .3 -.15(ey c)-.1 H
(an use).15 E(\(de\214ne \(seal-capability hash recipient-k)82 60 Q -.15
(ey)-.1 G(\)).15 E(\(let \(\(cap `\(capability)87 72 Q(\(object ,hash\))
119.5 84 Q(\(granted-at ,\(current-seconds\)\)\)\)\))119.5 96 Q
(\(age-encrypt \(serialize cap\) recipient-k)92 108 Q -.15(ey)-.1 G
(\)\)\)).15 E(;; Recipient decrypts to obtain hash)82 132 Q
(\(de\214ne \(unseal-capability sealed-cap identity\))82 144 Q
(\(let \(\(cap \(deserialize \(age-decrypt sealed-cap identity\)\)\)\))
87 156 Q(\(capability-object cap\)\)\))92 168 Q(Capability Re)72 192 Q
-.2(vo)-.25 G(cation).2 E(;; Re)82 216 Q -.2(vo)-.25 G
(cation via tombstone).2 E(\(de\214ne \(re)82 228 Q -.2(vo)-.25 G -.1
(ke).2 G(-capability hash\)).1 E
(\(cas-tombstone hash reason: "Capability re)87 240 Q -.2(vo)-.25 G -.1
(ke).2 G(d"\)\)).1 E(;; Or via SPKI CRL)82 264 Q(\(spki-crl)82 276 Q
(\(issuer v)87 288 Q(ault-k)-.25 E -.15(ey)-.1 G(\)).15 E(\(re)87 300 Q
-.2(vo)-.25 G -.1(ke).2 G(d).1 E(\(\(hash sha256 "re)92 312 Q -.2(vo)
-.25 G -.1(ke).2 G(d-content..."\)).1 E(\(reason "Superseded"\))94.5 324
Q(\(re)94.5 336 Q -.2(vo)-.25 G -.1(ke).2 G(d-at 1767700000\)\)\)\)).1 E
(----------------------------------------------------------------------\
--------)72 360 Q(Hash Migration)72 384 Q
(When cryptographic algorithms weak)72 408 Q
(en, the system must migrate.)-.1 E(Multihash)72 432 Q
(;; Self-describing hash format)82 456 Q
(\(de\214ne \(multihash algo data\))82 468 Q(\(let \(\(hash \(case algo)
87 480 Q(\(\(sha256\) \(sha256 data\)\))122 492 Q
(\(\(sha384\) \(sha384 data\)\))122 504 Q
(\(\(sha512\) \(sha512 data\)\))122 516 Q(\(\(blak)122 528 Q
(e3\) \(blak)-.1 E(e3 data\)\)\)\)\))-.1 E
(\(list algo \(blob-length hash\) hash\)\)\))92 540 Q(;; P)82 564 Q
(arse multihash)-.15 E
(\(de\214ne \(multihash-algorithm mh\) \(car mh\)\))82 576 Q
(\(de\214ne \(multihash-digest mh\) \(caddr mh\)\))82 588 Q
(Dual-Hash Period)72 612 Q(;; During migration, store under both hashes)
82 636 Q(\(de\214ne \(cas-put/migrate content old-algo ne)82 648 Q
(w-algo\))-.25 E(\(let \(\(old-hash \(hash-with old-algo content\)\))87
660 Q(\(ne)102 672 Q(w-hash \(hash-with ne)-.25 E(w-algo content\)\)\))
-.25 E(\(cas-put-ra)92 684 Q 2.5(wo)-.15 G(ld-hash content\))-2.5 E
(\(cas-put-ra)92 696 Q 2.5(wn)-.15 G -.25(ew)-2.5 G(-hash content\)).25
E(;; Link old to ne)92 708 Q(w)-.25 E
(\(ref-set \(string-append "migrate/" old-hash\) ne)92 720 Q(w-hash\))
-.25 E(ne)92 732 Q(w-hash\)\))-.25 E(;; Lookup follo)82 756 Q
(ws migration links)-.25 E(\(de\214ne \(cas-get/migrate hash\))82 768 Q
(\(let \(\(migrated \(ref-get \(string-append "migrate/" hash\)\)\)\))87
780 Q(\(cas-get \(or migrated hash\)\)\)\))92 792 Q 0 Cg EP
%%Page: 14 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Migration Manifest)72 24 Q(\(migration-manifest)
82 48 Q(\(from-algorithm sha256\))87 60 Q(\(to-algorithm sha384\))87 72
Q(\(started-at 1767700000\))87 84 Q(\(status in-progress\))87 96 Q
(\(migrated 4723\))87 108 Q(\(remaining 1892\))87 120 Q(\(mappings)87
132 Q(\(\("sha256:abc..." . "sha384:def..."\))92 144 Q
(\("sha256:123..." . "sha384:456..."\))94.5 156 Q(...\)\)\))94.5 168 Q
-1.11(Ve)72 192 S(ri\214cation During Migration)1.11 E(\(de\214ne \(v)82
216 Q(erify-migration hash\))-.15 E("V)87 228 Q
(erify object under both old and ne)-1.11 E 2.5(wh)-.25 G(ash")-2.5 E
(\(let* \(\(content \(cas-get hash\)\))87 240 Q
(\(old-hash \(sha256 content\)\))104.5 252 Q(\(ne)104.5 264 Q
(w-hash \(sha384 content\)\)\))-.25 E
(\(and \(or \(equal? hash old-hash\))92 276 Q(\(equal? hash ne)114.5 288
Q(w-hash\)\))-.25 E
(\(equal? \(ref-get \(string-append "migrate/" old-hash\)\))104.5 300 Q
(ne)124.5 312 Q(w-hash\)\)\)\))-.25 E(---------------------------------\
---------------------------------------------)72 336 Q
(Comparison with Related Systems)72 360 Q 17.5(System Hash)77 384 R 15
(Chunking Naming)40 F
(------------- ------------------- -------------- ---------------)77 396
Q 25(Git SHA-1)77 408 R -.15(Pa)37.5 G(ck \214les).15 E(refs/branches)
12.5 E 22.5(IPFS SHA-256/multihash)77 420 R 22.5(Rabin IPNS,)7.5 F
(DNSLink)2.5 E(Perk)77 432 Q 15(eep SHA-224)-.1 F(Rolling hash)32.5 E
(Permanodes)7.5 E(Library CAS)77 444 Q 30(SHA-256 Con\214gurable)7.5 F
-1.11(Va)7.5 G(ult refs)1.11 E(----------------------------------------\
--------------------------------------)72 468 Q(Security Considerations)
72 492 Q(Hash Collision Attacks)72 516 Q(SHA-256 pro)72 540 Q
(vides 128-bit collision resistance. No practical attacks kno)-.15 E
(wn.)-.25 E(If SHA-256 is e)72 564 Q -.15(ve)-.25 G 2.5(rb).15 G(rok)
-2.5 E(en:)-.1 E(;; Multihash for algorithm agility)82 588 Q
(\(de\214ne \(multihash algo data\))82 600 Q(\(case algo)87 612 Q
(\(\(sha256\) \(cons ')92 624 Q(sha256 \(sha256 data\)\)\))-.55 E
(\(\(sha384\) \(cons ')92 636 Q(sha384 \(sha384 data\)\)\))-.55 E
(\(\(blak)92 648 Q(e3\) \(cons 'blak)-.1 E(e3 \(blak)-.1 E
(e3 data\)\)\)\)\))-.1 E(Length Extension Attacks)72 672 Q
(SHA-256 is vulnerable to length e)72 696 Q(xtension. F)-.15 E
(or authentication, use HMA)-.15 E(C:)-.4 E(\(de\214ne \(cas-mac k)82
720 Q .3 -.15(ey h)-.1 H(ash\)).15 E(\(hmac-sha256 k)87 732 Q .3 -.15
(ey h)-.1 H(ash\)\)).15 E -.35(Ti)72 756 S(ming Attacks).35 E
(Hash comparison MUST be constant-time:)72 780 Q 0 Cg EP
%%Page: 15 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne \(hash-equal? a b\))82 12 Q
(\(let \(\(result 0\)\))87 24 Q(\(do \(\(i 0 \(+ i 1\)\)\))92 36 Q
(\(\(= i 32\) \(zero? result\)\))102 48 Q
(\(set! result \(bitwise-ior result)97 60 Q
(\(bitwise-xor \(blob-ref a i\) \(blob-ref b i\)\)\)\)\)\)\))132 72 Q(-\
-----------------------------------------------------------------------\
------)72 96 Q(Performance Considerations)72 120 Q(Caching)72 144 Q
(;; LR)82 168 Q 2.5(Uc)-.4 G(ache for hot objects)-2.5 E
(\(de\214ne cas-cache \(mak)82 180 Q(e-lru-cache 1000\)\))-.1 E
(\(de\214ne \(cas-get/cached hash\))82 204 Q
(\(or \(lru-get cas-cache hash\))87 216 Q
(\(let \(\(content \(cas-get hash\)\)\))97 228 Q
(\(lru-put! cas-cache hash content\))102 240 Q(content\)\)\))102 252 Q
-.15(Pa)72 276 S(rallel Hashing).15 E(Lar)72 300 Q
(ge \214les bene\214t from parallel hashing of chunks.)-.18 E
(SSD Optimization)72 324 Q
(Random access pattern. Use write-ahead log for durability:)72 348 Q
(\(de\214ne \(cas-put/durable content\))82 372 Q
(\(let \(\(hash \(sha256 content\)\)\))87 384 Q(\(w)92 396 Q
(al-append hash content\))-.1 E
(\(write-blob \(hash->path hash\) content\))92 408 Q(\(w)92 420 Q
(al-commit hash\))-.1 E(hash\)\))92 432 Q(-----------------------------\
-------------------------------------------------)72 456 Q
(Implementation Notes)72 480 Q(Dependencies)72 504 Q 5
(Component Library)77 528 R(----------- ----------------------)77 540 Q
10(SHA-256 message-digest,)77 552 R(sha2)2.5 E(Blob I/O)77 564 Q
(CHICKEN I/O)10 E 7.5(Chunking Custom)77 576 R(Error Handling)72 600 Q
(\(de\214ne-condition-type &cas-error &error)82 624 Q(cas-error?)87 636
Q(\(hash cas-error)87 648 Q(-hash\)\))-.2 E
(\(de\214ne-condition-type &cas-not-found &cas-error)82 672 Q
(cas-not-found?\))87 684 Q
(\(de\214ne-condition-type &cas-corrupt &cas-error)82 708 Q
(cas-corrupt?\))87 720 Q(----------------------------------------------\
--------------------------------)72 744 Q(References)72 768 Q 2.5
(1. Merkle,)72 792 R(R. \(1987\). A Digital Signature Based on a Con)2.5
E -.15(ve)-.4 G(ntional Encryption).15 E 0 Cg EP
%%Page: 16 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF .795(Function 2.)82 12 R .795
(Git Internals - Git Objects 3.)5.795 F .796(IPFS Content Addressing 4.)
5.796 F .796(RFC-006: V)5.796 F .796(ault System Architecture 5.)-1.11 F
(RFC-018: Sealed Archi)72 24 Q .3 -.15(ve Fo)-.25 H(rmat).15 E(--------\
----------------------------------------------------------------------)
72 48 Q(Changelog)72 72 Q 2.5(-2)72 96 S(026-01-07 - Initial draft)-2.5
E(---------------------------------------------------------------------\
---------)72 120 Q
(Implementation Status: Draft Dependencies: sha2, message-digest Inte)72
144 Q(gration: V)-.15 E(ault, Replication, SPKI)-1.11 E 0 Cg EP
%%Trailer
end
%%EOF
