%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 7
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-031: Monitoring and Observ)72 12 Q(ability)
-.25 E 1.95(**Status:** Draft **Date:** January 2026 **Author:** Derrel\
l Piper <ddp@eludom.net> **Implementation:**)72 36 R(Proposed)72 48 Q
(---)72 72 Q(Abstract)72 96 Q .726
(This RFC speci\214es monitoring and observ)72 120 R .727
(ability for the Library of Cyberspace: ho)-.25 F 3.227(wv)-.25 G .727
(aults e)-3.477 F .727(xpose metrics, traces,)-.15 F 1.38
(and logs for operational visibility while maintaining pri)72 132 R -.25
(va)-.25 G 1.68 -.15(cy a).25 H 1.38(nd security).15 F 3.88(.O)-.65 G
(bserv)-3.88 E 1.38(ability data is itself content-ad-)-.25 F
(dressed and auditable.)72 144 Q(---)72 168 Q(Moti)72 192 Q -.25(va)-.25
G(tion).25 E(Operating distrib)72 216 Q
(uted systems requires visibility:)-.2 E 3.094(-*)72 240 S .594
(*Health** - Is the v)-3.094 F .594(ault functioning correctly?)-.25 F
3.094(-*)5.594 G .594(*Performance** - Ho)-3.094 F 3.094(wf)-.25 G .594
(ast are operations?)-3.194 F 3.095(-*)5.594 G .595(*Capacity** -)-3.095
F(Ho)72 252 Q 2.5(wm)-.25 G(uch storage remains?)-2.5 E 2.5(-*)5 G
(*Errors** - What')-2.5 E 2.5(sf)-.55 G(ailing and wh)-2.6 E 2.5(y? -)
-.05 F(**Security** - Who')2.5 E 2.5(sa)-.55 G(ccessing what?)-2.5 E
(But observ)72 276 Q(ability must not compromise:)-.25 E 3.489(-*)72 300
S(*Pri)-3.489 E -.25(va)-.25 G -.15(cy).25 G .989(** - No sensiti).15 F
1.289 -.15(ve d)-.25 H .989
(ata in metrics - **Security** - Metrics don').15 F 3.489(tl)-.18 G .988
(eak capabilities - **Performance** -)-3.489 F(Minimal o)72 312 Q -.15
(ve)-.15 G(rhead - **Storage** - Observ).15 E(ability data is bounded)
-.25 E(---)72 336 Q(Metrics)72 360 Q(Core Metrics)72 384 Q -.74(```)72
408 S(scheme \(de\214ne v).74 E(ault-metrics)-.25 E('\(;; Storage)77 420
Q(\(storage.used.bytes g)82 432 Q(auge "T)-.05 E(otal bytes used"\))-.8
E(\(storage.a)82 444 Q -.25(va)-.2 G(ilable.bytes g).25 E(auge "Bytes a)
-.05 E -.25(va)-.2 G(ilable"\)).25 E(\(storage.objects.count g)82 456 Q
(auge "Number of objects"\))-.05 E(;; Operations)82 480 Q
(\(cas.put.count counter "CAS put operations"\))82 492 Q
(\(cas.put.bytes counter "Bytes written"\))82 504 Q
(\(cas.put.duration histogram "Put latenc)82 516 Q(y"\))-.15 E
(\(cas.get.count counter "CAS get operations"\))82 528 Q
(\(cas.get.bytes counter "Bytes read"\))82 540 Q
(\(cas.get.duration histogram "Get latenc)82 552 Q(y"\))-.15 E(;; Soup)
82 576 Q(\(soup.queries.count counter "Soup queries"\))82 588 Q
(\(soup.queries.duration histogram "Query latenc)82 600 Q(y"\))-.15 E
(\(soup.inde)82 612 Q(x.size.bytes g)-.15 E(auge "Inde)-.05 E 2.5(xs)
-.15 G(ize"\))-2.5 E(;; Netw)82 636 Q(ork)-.1 E(\(netw)82 648 Q
(ork.connections.acti)-.1 E .3 -.15(ve g)-.25 H(auge "Acti).1 E .3 -.15
(ve c)-.25 H(onnections"\)).15 E(\(netw)82 660 Q
(ork.bytes.sent counter "Bytes sent"\))-.1 E(\(netw)82 672 Q
(ork.bytes.recei)-.1 E -.15(ve)-.25 G 2.5(dc).15 G(ounter "Bytes recei)
-2.5 E -.15(ve)-.25 G(d"\)).15 E(;; Replication)82 696 Q
(\(replication.lag.seconds g)82 708 Q(auge "Replication lag"\))-.05 E
(\(replication.objects.pending g)82 720 Q(auge "Objects pending sync"\))
-.05 E(;; Errors)82 744 Q(\(errors.total counter "T)82 756 Q
(otal errors" labels: \(type\)\))-.8 E(\(errors.rate g)82 768 Q
(auge "Error rate per second"\)\)\) `)-.05 E -.74(``)-.74 G
(Metric Collection)72 792 Q 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.74(```)72 24 S(scheme \(de\214ne metrics-re)
.74 E(gistry \(mak)-.15 E(e-hash-table\)\))-.1 E(\(de\214ne \(re)72 48 Q
(gister)-.15 E(-metric name type help #!k)-.2 E .3 -.15(ey l)-.1 H
(abels\)).15 E(\(hash-table-set! metrics-re)77 60 Q(gistry name)-.15 E
(`\(\(type . ,type\))82 72 Q(\(help . ,help\))87 84 Q
(\(labels . ,labels\))87 96 Q(\(v)87 108 Q(alue . ,\(case type)-.25 E
(\(\(counter\) 0\))117 120 Q(\(\(g)117 132 Q(auge\) 0\))-.05 E
(\(\(histogram\) \(mak)117 144 Q(e-histogram-b)-.1 E(uck)-.2 E
(ets\)\)\)\)\)\)\))-.1 E(\(de\214ne \(metric-inc! name #!k)72 168 Q .3
-.15(ey \()-.1 H(delta 1\) labels\)).15 E
(\(let \(\(metric \(hash-table-ref metrics-re)77 180 Q
(gistry name\)\)\))-.15 E(\(case \(assoc-ref metric ')82 192 Q(type\))
-.18 E(\(\(counter g)87 204 Q(auge\))-.05 E(\(set! \(assoc-ref metric ')
89.5 216 Q -.25(va)-.5 G(lue\)).25 E(\(+ \(assoc-ref metric ')104.5 228
Q -.25(va)-.5 G(lue\) delta\)\)\)\)\)\)).25 E
(\(de\214ne \(metric-set! name v)72 252 Q(alue #!k)-.25 E .3 -.15(ey l)
-.1 H(abels\)).15 E(\(let \(\(metric \(hash-table-ref metrics-re)77 264
Q(gistry name\)\)\))-.15 E(\(set! \(assoc-ref metric ')82 276 Q -.25(va)
-.5 G(lue\) v).25 E(alue\)\)\))-.25 E(\(de\214ne \(metric-observ)72 300
Q(e! name v)-.15 E(alue #!k)-.25 E .3 -.15(ey l)-.1 H(abels\)).15 E
(\(let \(\(metric \(hash-table-ref metrics-re)77 312 Q
(gistry name\)\)\))-.15 E(\(histogram-observ)82 324 Q
(e! \(assoc-ref metric ')-.15 E -.25(va)-.5 G(lue\) v).25 E
(alue\)\)\) `)-.25 E -.74(``)-.74 G(Histogram Buck)72 348 Q(ets)-.1 E
-.74(```)72 372 S(scheme \(de\214ne \(mak).74 E(e-histogram-b)-.1 E(uck)
-.2 E(ets\))-.1 E("Def)77 384 Q(ault latenc)-.1 E 2.5(yb)-.15 G(uck)-2.7
E(ets in milliseconds")-.1 E(\(let \(\(b)77 396 Q(uck)-.2 E
(ets '\(1 5 10 25 50 100 250 500 1000 2500 5000 10000\)\)\))-.1 E
(\(map \(lambda \(b\) \(cons b 0\)\) b)82 408 Q(uck)-.2 E(ets\)\)\))-.1
E(\(de\214ne \(histogram-observ)72 432 Q(e! histogram v)-.15 E(alue\))
-.25 E(\(for)77 444 Q(-each \(lambda \(b)-.2 E(uck)-.2 E(et\))-.1 E
(\(when \(<= v)107 456 Q(alue \(car b)-.25 E(uck)-.2 E(et\)\))-.1 E
(\(set-cdr! b)112 468 Q(uck)-.2 E(et \(+ \(cdr b)-.1 E(uck)-.2 E
(et\) 1\)\)\)\))-.1 E(histogram\)\) `)102 480 Q -.74(``)-.74 G(---)72
504 Q -.35(Tr)72 528 S(acing).35 E -.35(Tr)72 552 S(ace Structure).35 E
-.74(```)72 576 S(scheme \(de\214ne \(mak).74 E(e-trace operation\))-.1
E(`\(trace)77 588 Q(\(trace-id ,\(generate-trace-id\)\))82 600 Q
(\(span-id ,\(generate-span-id\)\))82 612 Q(\(parent-span-id #f\))82 624
Q(\(operation ,operation\))82 636 Q(\(start-time ,\(current-time-ns\)\))
82 648 Q(\(end-time #f\))82 660 Q(\(status pending\))82 672 Q(\(attrib)
82 684 Q(utes \(\)\))-.2 E(\(e)82 696 Q -.15(ve)-.25 G(nts \(\)\)\)\))
.15 E(\(de\214ne \(trace-start! trace\))72 720 Q
(\(set! \(assoc-ref trace ')77 732 Q(start-time\) \(current-time-ns\)\))
-.55 E(trace\))77 744 Q(\(de\214ne \(trace-end! trace status\))72 768 Q
(\(set! \(assoc-ref trace 'end-time\) \(current-time-ns\)\))77 780 Q
(\(set! \(assoc-ref trace ')77 792 Q(status\) status\))-.55 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(record-trace! trace\)\) `)77 12 Q -.74(``)-.74
G(Span Conte)72 36 Q(xt)-.15 E -.74(```)72 60 S
(scheme \(de\214ne current-trace \(mak).74 E
(e-parameter #f\)\) \(de\214ne current-span \(mak)-.1 E
(e-parameter #f\)\))-.1 E(\(de\214ne \(with-span operation proc\))72 84
Q("Ex)77 96 Q(ecute proc within a traced span")-.15 E
(\(let* \(\(parent \(current-span\)\))77 108 Q(\(span \(mak)94.5 120 Q
(e-span operation \(and parent \(span-id parent\)\)\)\)\))-.1 E
(\(parameterize \(\(current-span span\)\))82 132 Q(\(span-start! span\))
87 144 Q(\(guard \(e)87 156 Q(x)-.15 E(\(else)107 168 Q
(\(span-error! span e)109.5 180 Q(x\))-.15 E(\(span-end! span 'error\))
109.5 192 Q(\(raise e)109.5 204 Q(x\)\)\))-.15 E
(\(let \(\(result \(proc\)\)\))92 216 Q(\(span-end! span 'ok\))97 228 Q
(result\)\)\)\)\))97 240 Q
(;; Example usage \(de\214ne \(traced-cas-get hash\))72 264 Q
(\(with-span "cas.get")77 276 Q(\(lambda \(\))82 288 Q
(\(span-set-attrib)87 300 Q(ute! "hash" hash\))-.2 E
(\(cas-get hash\)\)\)\) `)87 312 Q -.74(``)-.74 G(Distrib)72 336 Q
(uted T)-.2 E(racing)-.35 E -.74(```)72 360 S(scheme ;; Propag).74 E
(ate trace conte)-.05 E(xt across v)-.15 E
(ault boundaries \(de\214ne \(inject-trace-conte)-.25 E(xt headers\))
-.15 E("Inject trace conte)77 372 Q(xt into outgoing request")-.15 E
(\(let \(\(span \(current-span\)\)\))77 384 Q(\(when span)82 396 Q
(\(hash-table-set! headers "X-T)87 408 Q
(race-Id" \(span-trace-id span\)\))-.35 E
(\(hash-table-set! headers "X-Span-Id" \(span-id span\)\)\)\)\))87 420 Q
(\(de\214ne \(e)72 444 Q(xtract-trace-conte)-.15 E(xt headers\))-.15 E
("Extract trace conte)77 456 Q(xt from incoming request")-.15 E
(\(let \(\(trace-id \(hash-table-ref headers "X-T)77 468 Q
(race-Id" #f\)\))-.35 E
(\(parent-span-id \(hash-table-ref headers "X-Span-Id" #f\)\)\))92 480 Q
(\(when trace-id)82 492 Q(\(current-trace trace-id\))87 504 Q(\(mak)87
516 Q(e-span-with-parent parent-span-id\)\)\)\) `)-.1 E -.74(``)-.74 G
(---)72 540 Q(Logging)72 564 Q(Structured Logging)72 588 Q -.74(```)72
612 S(scheme \(de\214ne \(log le).74 E -.15(ve)-.25 G 2.5(lm).15 G
(essage #!rest attrib)-2.5 E(utes\))-.2 E("Emit structured log entry")77
624 Q(\(let \(\(entry `\(\(timestamp . ,\(current-time-iso8601\)\))77
636 Q(\(le)114.5 648 Q -.15(ve)-.25 G 2.5(l.,).15 G(le)-2.5 E -.15(ve)
-.25 G(l\)).15 E(\(message . ,message\))114.5 660 Q(\(v)114.5 672 Q
(ault . ,\(v)-.25 E(ault-id\)\))-.25 E(\(trace-id . ,\(and \(current-sp\
an\) \(span-trace-id \(current-span\)\)\)\))114.5 684 Q
(,@\(plist->alist attrib)114.5 696 Q(utes\)\)\)\))-.2 E
(\(emit-log entry\)\)\))82 708 Q 1.117(\(de\214ne \(log-deb)72 732 R
1.117(ug message . attrs\) \(apply log ')-.2 F(deb)-.5 E 1.118(ug messa\
ge attrs\)\) \(de\214ne \(log-info message . attrs\) \(apply log)-.2 F
.278('info message attrs\)\) \(de\214ne \(log-w)72 744 R .278
(arn message . attrs\) \(apply log 'w)-.1 F .277
(arn message attrs\)\) \(de\214ne \(log-error message .)-.1 F
(attrs\) \(apply log 'error message attrs\)\))72 756 Q
(;; Example \(log-info "Object stored")72 780 Q('hash hash)97 792 Q 0 Cg
EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.55('s)97 12 S(ize \(byte).55 E -.15(ve)-.25 G
(ctor).15 E(-length data\))-.2 E -.5('d)97 24 S(uration-ms elapsed\) `)
.5 E -.74(``)-.74 G(Log Le)72 48 Q -.15(ve)-.25 G(ls).15 E -.74(```)72
72 S(scheme \(de\214ne log-le).74 E -.15(ve)-.25 G
(ls '\(\(trace . 0\) \(deb).15 E(ug . 1\) \(info . 2\))-.2 E(\(w)124.5
84 Q(arn . 3\) \(error . 4\) \(f)-.1 E(atal . 5\)\)\))-.1 E
(\(de\214ne current-log-le)72 108 Q -.15(ve)-.25 G 2.5(l\().15 G(mak)
-2.5 E(e-parameter 'info\)\))-.1 E(\(de\214ne \(log-enabled? le)72 132 Q
-.15(ve)-.25 G(l\)).15 E(\(>= \(assoc-ref log-le)77 144 Q -.15(ve)-.25 G
(ls le).15 E -.15(ve)-.25 G(l\)).15 E(\(assoc-ref log-le)87 156 Q -.15
(ve)-.25 G(ls \(current-log-le).15 E -.15(ve)-.25 G(l\)\)\)\) `).15 E
-.74(``)-.74 G(Log Sinks)72 180 Q -.74(```)72 204 S
(scheme ;; Multiple output destinations \(de\214ne log-sinks '\(\)\)).74
E(\(de\214ne \(add-log-sink! sink\))72 228 Q
(\(set! log-sinks \(cons sink log-sinks\)\)\))77 240 Q
(\(de\214ne \(emit-log entry\))72 264 Q
(\(when \(log-enabled? \(assoc-ref entry ')77 276 Q(le)-.1 E -.15(ve)
-.25 G(l\)\)).15 E(\(for)82 288 Q(-each \(lambda \(sink\))-.2 E
(\(sink-write sink entry\)\))112 300 Q(log-sinks\)\)\))107 312 Q
(;; Sink implementations \(de\214ne \(mak)72 336 Q(e-\214le-sink path\))
-.1 E(\(lambda \(entry\))77 348 Q(\(with-output-to-\214le path)82 360 Q
(\(lambda \(\) \(write-json entry\) \(ne)87 372 Q(wline\)\))-.25 E
('append\)\)\))87 384 Q(\(de\214ne \(mak)72 408 Q(e-soup-sink\))-.1 E
(\(lambda \(entry\))77 420 Q(\(soup-put entry type: ')82 432 Q
(log-entry\)\)\) `)-.1 E -.74(``)-.74 G(---)72 456 Q(Health Checks)72
480 Q(Health Endpoints)72 504 Q -.74(```)72 528 S
(scheme \(de\214ne \(health-check\)).74 E("Comprehensi)77 540 Q .3 -.15
(ve h)-.25 H(ealth check").15 E(`\(\(status . ,\(if \(all-health)77 552
Q(y?\) 'health)-.05 E 2.5(y')-.05 G(unhealth)-2.5 E(y\)\))-.05 E
(\(checks . \(\(storage . ,\(check-storage\)\))82 564 Q(\(netw)109.5 576
Q(ork . ,\(check-netw)-.1 E(ork\)\))-.1 E
(\(replication . ,\(check-replication\)\))109.5 588 Q(\(k)109.5 600 Q
-.15(ey)-.1 G 2.5(s.,).15 G(\(check-k)-2.5 E -.15(ey)-.1 G
(s\)\)\)\)\)\)).15 E(\(de\214ne \(check-storage\))72 624 Q
(`\(\(status . ,\(if \(storage-accessible?\) 'health)77 636 Q 2.5(y')
-.05 G(unhealth)-2.5 E(y\)\))-.05 E(\(used . ,\(storage-used\)\))82 648
Q(\(a)82 660 Q -.25(va)-.2 G(ilable . ,\(storage-a).25 E -.25(va)-.2 G
(ilable\)\)).25 E(\(percent . ,\(storage-percent-used\)\)\)\))82 672 Q
(\(de\214ne \(check-netw)72 696 Q(ork\))-.1 E
(`\(\(status . ,\(if \(netw)77 708 Q(ork-health)-.1 E(y?\) 'health)-.05
E 2.5(y')-.05 G(unhealth)-2.5 E(y\)\))-.05 E
(\(peers . ,\(connected-peer)82 720 Q(-count\)\))-.2 E(\(latenc)82 732 Q
(y-ms . ,\(a)-.15 E -.15(ve)-.2 G(rage-peer).15 E(-latenc)-.2 E
(y\)\)\)\))-.15 E(\(de\214ne \(check-replication\))72 756 Q
(`\(\(status . ,\(if \(replication-health)77 768 Q(y?\) 'health)-.05 E
2.5(y')-.05 G(unhealth)-2.5 E(y\)\))-.05 E
(\(lag-seconds . ,\(replication-lag\)\))82 780 Q
(\(pending . ,\(pending-replication-count\)\)\)\) `)82 792 Q -.74(``)
-.74 G 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Readiness vs Li)72 24 Q -.15(ve)-.25 G(ness).15
E -.74(```)72 48 S(scheme ;; Li).74 E -.15(ve)-.25 G
(ness: is the process running?).15 E(\(de\214ne \(li)5 E -.15(ve)-.25 G
(ness-check\)).15 E('\(\(status . ali)77 60 Q -.15(ve)-.25 G(\)\)\)).15
E(;; Readiness: can we serv)72 84 Q 2.5(er)-.15 G 2.5
(equests? \(de\214ne)-2.5 F(\(readiness-check\))2.5 E
(\(if \(and \(storage-accessible?\))77 96 Q(\(k)99.5 108 Q -.15(ey)-.1 G
(s-a).15 E -.25(va)-.2 G(ilable?\)).25 E(\(not \(v)99.5 120 Q
(ault-readonly?\)\)\))-.25 E('\(\(status . ready\)\))87 132 Q
('\(\(status . not-ready\)\)\)\) `)87 144 Q -.74(``)-.74 G(---)72 168 Q
(Alerting)72 192 Q(Alert Rules)72 216 Q -.74(```)72 240 S
(scheme \(de\214ne alert-rules).74 E(`\(\(storage-critical)77 252 Q
(\(condition \(> \(metric-v)84.5 264 Q(alue ')-.25 E
(storage.percent.used\) 95\)\))-.55 E(\(se)84.5 276 Q -.15(ve)-.25 G
(rity critical\)).15 E(\(message "Storage critically lo)84.5 288 Q
(w"\)\))-.25 E(\(storage-w)82 312 Q(arning)-.1 E
(\(condition \(> \(metric-v)84.5 324 Q(alue ')-.25 E
(storage.percent.used\) 80\)\))-.55 E(\(se)84.5 336 Q -.15(ve)-.25 G
(rity w).15 E(arning\))-.1 E(\(message "Storage running lo)84.5 348 Q
(w"\)\))-.25 E(\(error)82 372 Q(-rate-high)-.2 E
(\(condition \(> \(metric-v)84.5 384 Q(alue 'errors.rate\) 10\)\))-.25 E
(\(se)84.5 396 Q -.15(ve)-.25 G(rity w).15 E(arning\))-.1 E
(\(message "High error rate detected"\)\))84.5 408 Q(\(replication-lag)
82 432 Q(\(condition \(> \(metric-v)84.5 444 Q(alue ')-.25 E
(replication.lag.seconds\) 300\)\))-.5 E(\(se)84.5 456 Q -.15(ve)-.25 G
(rity w).15 E(arning\))-.1 E(\(message "Replication lag e)84.5 468 Q
(xceeds 5 minutes"\)\))-.15 E(\(peer)82 492 Q(-disconnected)-.2 E
(\(condition \(< \(metric-v)84.5 504 Q(alue 'netw)-.25 E
(ork.peers.connected\) 1\)\))-.1 E(\(se)84.5 516 Q -.15(ve)-.25 G
(rity critical\)).15 E(\(message "No peers connected"\)\)\)\) `)84.5 528
Q -.74(``)-.74 G(Alert Ev)72 552 Q(aluation)-.25 E -.74(```)72 576 S
(scheme \(de\214ne \(e).74 E -.25(va)-.25 G(luate-alerts\)).25 E
("Check all alert conditions")77 588 Q(\(\214lter)77 600 Q(-map)-.2 E
(\(lambda \(rule\))82 612 Q(\(when \(e)87 624 Q -.25(va)-.25 G
(l-condition \(assoc-ref rule 'condition\)\)).25 E
(\(\214re-alert rule\)\)\))92 636 Q(alert-rules\)\))82 648 Q
(\(de\214ne \(\214re-alert rule\))72 672 Q
(\(let \(\(alert `\(\(name . ,\(car rule\)\))77 684 Q(\(se)114.5 696 Q
-.15(ve)-.25 G(rity . ,\(assoc-ref \(cdr rule\) ').15 E(se)-.55 E -.15
(ve)-.25 G(rity\)\)).15 E
(\(message . ,\(assoc-ref \(cdr rule\) 'message\)\))114.5 708 Q
(\(timestamp . ,\(current-time\)\)\)\)\))114.5 720 Q
(\(audit-append action: 'alert-\214red alert: alert\))82 732 Q
(\(notify-alert alert\))82 744 Q(alert\)\) `)82 756 Q -.74(``)-.74 G
(---)72 780 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Dashboards)72 12 Q(Metric Export)72 36 Q -.74
(```)72 60 S(scheme ;; Prometheus format \(de\214ne \(e).74 E
(xport-prometheus\))-.15 E(\(with-output-to-string)77 72 Q
(\(lambda \(\))82 84 Q(\(for)87 96 Q(-each)-.2 E(\(lambda \(metric\))92
108 Q(\(let \(\(name \(car metric\)\))97 120 Q
(\(data \(cdr metric\)\)\))112 132 Q
(\(format #t "# HELP ~a ~a~%" name \(assoc-ref data 'help\)\))102 144 Q
(\(format #t "# TYPE ~a ~a~%" name \(assoc-ref data ')102 156 Q
(type\)\))-.18 E(\(format #t "~a ~a~%" name \(assoc-ref data ')102 168 Q
-.25(va)-.5 G(lue\)\)\)\)).25 E(\(hash-table->alist metrics-re)92 180 Q
(gistry\)\)\)\)\) `)-.15 E -.74(``)-.74 G(Status P)72 204 Q(age)-.15 E
-.74(```)72 228 S(scheme \(de\214ne \(status-page\)).74 E
("Generate human-readable status")77 240 Q(`\(v)77 252 Q(ault-status)
-.25 E(\(health . ,\(health-check\)\))82 264 Q(\(uptime . ,\(v)82 276 Q
(ault-uptime\)\))-.25 E(\(v)82 288 Q(ersion . ,\(v)-.15 E(ault-v)-.25 E
(ersion\)\))-.15 E(\(metrics . \(\(storage . ,\(storage-metrics\)\))82
300 Q(\(operations . ,\(operation-metrics\)\))112 312 Q(\(netw)112 324 Q
(ork . ,\(netw)-.1 E(ork-metrics\)\)\)\))-.1 E
(\(recent-errors . ,\(recent-errors 10\)\)\)\) `)82 336 Q -.74(``)-.74 G
(---)72 360 Q(Pri)72 384 Q -.25(va)-.25 G -.15(cy).25 G
(Metric Sanitization)72 408 Q -.74(```)72 432 S(scheme ;; Ne).74 E -.15
(ve)-.25 G 2.5(re).15 G(xpose sensiti)-2.65 E .3 -.15(ve d)-.25 H
(ata in metrics \(de\214ne \(sanitize-metric-labels labels\)).15 E
(\(map \(lambda \(label\))77 444 Q(\(case \(car label\))94.5 456 Q
(\(\(hash\) \(cons 'hash "[RED)99.5 468 Q -.4(AC)-.4 G(TED]"\)\)).4 E
(\(\(principal\) \(cons 'principal \(hash-principal \(cdr label\)\)\)\))
99.5 480 Q(\(else label\)\)\))99.5 492 Q(labels\)\))89.5 504 Q
(\(de\214ne \(safe-metric name v)72 528 Q(alue #!k)-.25 E .3 -.15(ey l)
-.1 H(abels\)).15 E(\(metric-set! name v)77 540 Q
(alue labels: \(sanitize-metric-labels labels\)\)\) `)-.25 E -.74(``)
-.74 G(Aggre)72 564 Q -.05(ga)-.15 G(te Metrics Only).05 E -.74(```)72
588 S(scheme ;; Expose only aggre).74 E -.05(ga)-.15 G(tes, not indi).05
E(vidual operations \(de\214ne \(operation-metrics\))-.25 E
(`\(\(total-operations . ,\(metric-v)77 600 Q
(alue 'cas.operations.total\)\))-.25 E(\(operations-per)82 612 Q
(-second . ,\(metric-v)-.2 E(alue 'cas.operations.rate\)\))-.25 E(\(a)82
624 Q -.15(ve)-.2 G(rage-latenc).15 E(y-ms . ,\(metric-v)-.15 E
(alue 'cas.latenc)-.25 E -.65(y.)-.15 G -2.25 -.2(av e).65 H(rage\)\)).2
E(\(p99-latenc)82 636 Q(y-ms . ,\(metric-v)-.15 E(alue 'cas.latenc)-.25
E -.65(y.)-.15 G(p99\)\)\)\) `).65 E -.74(``)-.74 G(---)72 660 Q
(Storage)72 684 Q(Metric Retention)72 708 Q -.74(```)72 732 S(scheme ;;\
 Metrics stored in soup with TTL \(de\214ne *metric-retention* \(* 30 2\
4 3600\)\)).74 E 2.5(;3)5 G 2.5(0d)-2.5 G(ays)-2.5 E
(\(de\214ne \(store-metric-snapshot\))72 756 Q
("Periodic metric snapshot")77 768 Q
(\(let \(\(snapshot `\(\(timestamp . ,\(current-time\)\))77 780 Q
(\(metrics . ,\(e)122 792 Q(xport-all-metrics\)\)\)\)\))-.15 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(soup-put snapshot)82 12 Q
(type: 'metric-snapshot)87 24 Q(ttl: *metric-retention*\)\)\))87 36 Q
(\(de\214ne \(gc-old-metrics\))72 60 Q("Remo)77 72 Q .3 -.15(ve ex)-.15
H(pired metric snapshots").15 E(\(let \(\(e)77 84 Q
(xpired \(soup-query type: 'metric-snapshot)-.15 E
(timestamp: \(< \(- \(current-time\) *metric-retention*\)\)\)\)\))144.5
96 Q(\(for)82 108 Q(-each soup-delete! e)-.2 E(xpired\)\)\) `)-.15 E
-.74(``)-.74 G -.35(Tr)72 132 S(ace Sampling).35 E -.74(```)72 156 S(sc\
heme ;; Sample traces to control storage \(de\214ne *trace-sample-rate*\
 0.1\)).74 E 2.5(;1)5 G(0%)-2.5 E(\(de\214ne \(should-sample-trace?\))72
180 Q(\(< \(random 1.0\) *trace-sample-rate*\)\))77 192 Q
(\(de\214ne \(record-trace! trace\))72 216 Q
(\(when \(or \(trace-has-error? trace\))77 228 Q
(\(should-sample-trace?\)\))102 240 Q(\(soup-put trace type: ')82 252 Q
(trace\)\)\) `)-.18 E -.74(``)-.74 G(---)72 276 Q(References)72 300 Q
1.47(1. [OpenT)72 324 R(elemetry]\(https://opentelemetry)-.7 E 1.47
(.io/\) - Observ)-.65 F 1.47(ability frame)-.25 F -.1(wo)-.25 G 1.47
(rk 2. [Prometheus]\(https://prometheus.io/\) -).1 F 2.978
(Monitoring system 3. [RFC-003: Cryptographic Audit T)72 336 R 2.978
(rail]\(rfc-003-audit-trail.md\) 4. [RFC-028: Error Han-)-.35 F
(dling]\(rfc-028-error)72 348 Q(-handling.md\))-.2 E(---)72 372 Q
(Changelog)72 396 Q 2.5(-*)72 420 S(*2026-01-07** - Initial draft)-2.5 E
(---)72 444 Q
(**Implementation Status:** Draft **Dependencies:** soup, audit **Inte)
72 468 Q(gration:** Operations, alerting, dashboards)-.15 E 0 Cg EP
%%Trailer
end
%%EOF
