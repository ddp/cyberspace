%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Mon Jan 12 10:28:49 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 10
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-031: Monitoring and Obser)202.284 123 Q -.12
(va)-.12 G(bility).12 E/F1 10/Times-Italic@0 SF(Libr)260.85 159 Q
(ary of Cyber)-.15 E(space)-.1 E/F2 10/Times-Roman@0 SF(2026)296 177 Q
F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3 10/Times-Bold@0 SF 2.5(1. Abstract)
72 261 R F2 .727(This RFC speci\214es monitoring and observ)72 276.6 R
.727(ability for the Library of Cyberspace: ho)-.25 F 3.226(wv)-.25 G
.726(aults e)-3.476 F .726(xpose metrics, traces,)-.15 F 1.333
(and logs for operational visibility while maintaining pri)72 288.6 R
-.25(va)-.25 G 1.634 -.15(cy a).25 H 1.334(nd security. Observ).15 F
1.334(ability data is itself content-ad-)-.25 F(dressed and auditable.)
72 300.6 Q F3 2.5(2. Moti)72 324.6 R -.1(va)-.1 G(tion).1 E F2
(Operating distrib)72 340.2 Q(uted systems requires visibility:)-.2 E
6.5<8348>72 355.8 S(ealth)-6.5 E 6.5<8349>72 371.4 S 2.5(st)-6.5 G(he v)
-2.5 E(ault functioning correctly?)-.25 E 6.5<8350>72 387 S(erformance)
-6.5 E 6.5<8348>72 402.6 S .5 -.25(ow f)-6.5 H(ast are operations?).15 E
6.5<8343>72 418.2 S(apacity)-6.5 E 6.5<8348>72 433.8 S .5 -.25(ow m)-6.5
H(uch storage remains?).25 E 6.5<8345>72 449.4 S(rrors)-6.5 E 6.5<8357>
72 465 S(hat')-6.5 E 2.5(sf)-.55 G(ailing and wh)-2.6 E(y?)-.05 E 6.5
<8353>72 480.6 S(ecurity)-6.5 E 6.5<8357>72 496.2 S(ho')-6.5 E 2.5(sa)
-.55 G(ccessing what?)-2.5 E(But observ)72 515.4 Q
(ability must not compromise:)-.25 E 6.5<8350>72 531 S(ri)-6.5 E -.25
(va)-.25 G -.15(cy).25 G 6.5<834e>72 546.6 S 2.5(os)-6.5 G(ensiti)-2.5 E
.3 -.15(ve d)-.25 H(ata in metrics).15 E 6.5<8353>72 562.2 S(ecurity)
-6.5 E 6.5<834d>72 577.8 S(etrics don')-6.5 E 2.5(tl)-.18 G
(eak capabilities)-2.5 E 6.5<8350>72 593.4 S(erformance)-6.5 E 6.5<834d>
72 609 S(inimal o)-6.5 E -.15(ve)-.15 G(rhead).15 E 6.5<8353>72 624.6 S
(torage)-6.5 E 6.5<834f>72 640.2 S(bserv)-6.5 E(ability data is bounded)
-.25 E F3 2.5(3. Metrics)72 667.8 R 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. Cor)72 84 R 2.5(eM)-.18 G(etrics)-2.5 E/F2 8/Courier@0 SF
(\(define vault-metrics)108 102 Q('\(;; Storage)117.6 114 Q
(\(storage.used.bytes gauge "Total bytes used"\))127.2 126 Q
(\(storage.available.bytes gauge "Bytes available"\))127.2 138 Q
(\(storage.objects.count gauge "Number of objects"\))127.2 150 Q
(;; Operations)127.2 174 Q
(\(cas.put.count counter "CAS put operations"\))127.2 186 Q
(\(cas.put.bytes counter "Bytes written"\))127.2 198 Q
(\(cas.put.duration histogram "Put latency"\))127.2 210 Q
(\(cas.get.count counter "CAS get operations"\))127.2 222 Q
(\(cas.get.bytes counter "Bytes read"\))127.2 234 Q
(\(cas.get.duration histogram "Get latency"\))127.2 246 Q(;; Soup)127.2
270 Q(\(soup.queries.count counter "Soup queries"\))127.2 282 Q
(\(soup.queries.duration histogram "Query latency"\))127.2 294 Q
(\(soup.index.size.bytes gauge "Index size"\))127.2 306 Q(;; Network)
127.2 330 Q(\(network.connections.active gauge "Active connections"\))
127.2 342 Q(\(network.bytes.sent counter "Bytes sent"\))127.2 354 Q
(\(network.bytes.received counter "Bytes received"\))127.2 366 Q
(;; Replication)127.2 390 Q
(\(replication.lag.seconds gauge "Replication lag"\))127.2 402 Q
(\(replication.objects.pending gauge "Objects pending sync"\))127.2 414
Q(;; Errors)127.2 438 Q
(\(errors.total counter "Total errors" labels: \(type\)\))127.2 450 Q
(\(errors.rate gauge "Error rate per second"\)\)\))127.2 462 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.2. Metric)72 84 R(Collection)2.5 E/F2 8/Courier@0 SF
(\(define metrics-registry \(make-hash-table\)\))108 102 Q
(\(define \(register-metric name type help #!key labels\))108 126 Q
(\(hash-table-set! metrics-registry name)117.6 138 Q
(`\(\(type . ,type\))127.2 150 Q(\(help . ,help\))136.8 162 Q
(\(labels . ,labels\))136.8 174 Q(\(value . ,\(case type)136.8 186 Q
(\(\(counter\) 0\))194.4 198 Q(\(\(gauge\) 0\))194.4 210 Q
(\(\(histogram\) \(make-histogram-buckets\)\)\)\)\)\)\))194.4 222 Q
(\(define \(metric-inc! name #!key \(delta 1\) labels\))108 246 Q
(\(let \(\(metric \(hash-table-ref metrics-registry name\)\)\))117.6 258
Q(\(case \(assoc-ref metric 'type\))127.2 270 Q(\(\(counter gauge\))
136.8 282 Q(\(set! \(assoc-ref metric 'value\))141.6 294 Q
(\(+ \(assoc-ref metric 'value\) delta\)\)\)\)\)\))170.4 306 Q
(\(define \(metric-set! name value #!key labels\))108 330 Q
(\(let \(\(metric \(hash-table-ref metrics-registry name\)\)\))117.6 342
Q(\(set! \(assoc-ref metric 'value\) value\)\)\))127.2 354 Q
(\(define \(metric-observe! name value #!key labels\))108 378 Q
(\(let \(\(metric \(hash-table-ref metrics-registry name\)\)\))117.6 390
Q(\(histogram-observe! \(assoc-ref metric 'value\) value\)\)\))127.2 402
Q F1 2.5(3.3. Histogram)72 420 R(Buck)2.5 E(ets)-.1 E F2
(\(define \(make-histogram-buckets\))108 438 Q
("Default latency buckets in milliseconds")117.6 450 Q(\(let \(\(bucket\
s '\(1 5 10 25 50 100 250 500 1000 2500 5000 10000\)\)\))117.6 462 Q
(\(map \(lambda \(b\) \(cons b 0\)\) buckets\)\)\))127.2 474 Q
(\(define \(histogram-observe! histogram value\))108 498 Q
(\(for-each \(lambda \(bucket\))117.6 510 Q
(\(when \(<= value \(car bucket\)\))175.2 522 Q
(\(set-cdr! bucket \(+ \(cdr bucket\) 1\)\)\)\))184.8 534 Q
(histogram\)\))165.6 546 Q F1 2.5(4. T)72 564 R(racing)-.74 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.1. T)72 84 R(race Structur)-.74 E(e)-.18 E/F2 8/Courier@0 SF
(\(define \(make-trace operation\))108 102 Q(`\(trace)117.6 114 Q
(\(trace-id ,\(generate-trace-id\)\))127.2 126 Q
(\(span-id ,\(generate-span-id\)\))127.2 138 Q(\(parent-span-id #f\))
127.2 150 Q(\(operation ,operation\))127.2 162 Q
(\(start-time ,\(current-time-ns\)\))127.2 174 Q(\(end-time #f\))127.2
186 Q(\(status pending\))127.2 198 Q(\(attributes \(\)\))127.2 210 Q
(\(events \(\)\)\)\))127.2 222 Q(\(define \(trace-start! trace\))108 246
Q(\(set! \(assoc-ref trace 'start-time\) \(current-time-ns\)\))117.6 258
Q(trace\))117.6 270 Q(\(define \(trace-end! trace status\))108 294 Q
(\(set! \(assoc-ref trace 'end-time\) \(current-time-ns\)\))117.6 306 Q
(\(set! \(assoc-ref trace 'status\) status\))117.6 318 Q
(\(record-trace! trace\)\))117.6 330 Q F1 2.5(4.2. Span)72 348 R
(Context)2.5 E F2(\(define current-trace \(make-parameter #f\)\))108 366
Q(\(define current-span \(make-parameter #f\)\))108 378 Q
(\(define \(with-span operation proc\))108 402 Q
("Execute proc within a traced span")117.6 414 Q
(\(let* \(\(parent \(current-span\)\))117.6 426 Q
(\(span \(make-span operation \(and parent \(span-id parent\)\)\)\)\))
151.2 438 Q(\(parameterize \(\(current-span span\)\))127.2 450 Q
(\(span-start! span\))136.8 462 Q(\(guard \(ex)136.8 474 Q(\(else)175.2
486 Q(\(span-error! span ex\))180 498 Q(\(span-end! span 'error\))180
510 Q(\(raise ex\)\)\))180 522 Q(\(let \(\(result \(proc\)\)\))146.4 534
Q(\(span-end! span 'ok\))156 546 Q(result\)\)\)\)\))156 558 Q
(;; Example usage)108 582 Q(\(define \(traced-cas-get hash\))108 594 Q
(\(with-span "cas.get")117.6 606 Q(\(lambda \(\))127.2 618 Q
(\(span-set-attribute! "hash" hash\))136.8 630 Q(\(cas-get hash\)\)\)\))
136.8 642 Q 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.3. Distrib)72 84 R(uted T)-.2 E(racing)-.74 E/F2 8/Courier@0 SF
(;; Propagate trace context across vault boundaries)108 102 Q
(\(define \(inject-trace-context headers\))108 114 Q
("Inject trace context into outgoing request")117.6 126 Q
(\(let \(\(span \(current-span\)\)\))117.6 138 Q(\(when span)127.2 150 Q
(\(hash-table-set! headers "X-Trace-Id" \(span-trace-id span\)\))136.8
162 Q(\(hash-table-set! headers "X-Span-Id" \(span-id span\)\)\)\)\))
136.8 174 Q(\(define \(extract-trace-context headers\))108 198 Q
("Extract trace context from incoming request")117.6 210 Q
(\(let \(\(trace-id \(hash-table-ref headers "X-Trace-Id" #f\)\))117.6
222 Q(\(parent-span-id \(hash-table-ref headers "X-Span-Id" #f\)\)\))
146.4 234 Q(\(when trace-id)127.2 246 Q(\(current-trace trace-id\))136.8
258 Q(\(make-span-with-parent parent-span-id\)\)\)\))136.8 270 Q F1 2.5
(5. Logging)72 288 R 2.5(5.1. Structur)72 312 R(ed Logging)-.18 E F2
(\(define \(log level message #!rest attributes\))108 330 Q
("Emit structured log entry")117.6 342 Q
(\(let \(\(entry `\(\(timestamp . ,\(current-time-iso8601\)\))117.6 354
Q(\(level . ,level\))189.6 366 Q(\(message . ,message\))189.6 378 Q
(\(vault . ,\(vault-id\)\))189.6 390 Q(\(trace-id . ,\(and \(current-sp\
an\) \(span-trace-id \(current-span\)\)\)\))189.6 402 Q
(,@\(plist->alist attributes\)\)\)\))189.6 414 Q(\(emit-log entry\)\)\))
127.2 426 Q(\(define \(log-debug message . attrs\) \(apply log 'debug m\
essage attrs\)\))108 450 Q(\(define \(log-info message . attrs\) \(appl\
y log 'info message attrs\)\))108 462 Q(\(define \(log-warn message . a\
ttrs\) \(apply log 'warn message attrs\)\))108 474 Q(\(define \(log-err\
or message . attrs\) \(apply log 'error message attrs\)\))108 486 Q
(;; Example)108 510 Q(\(log-info "Object stored")108 522 Q('hash hash)
156 534 Q('size \(bytevector-length data\))156 546 Q
('duration-ms elapsed\))156 558 Q F1 2.5(5.2. Log)72 576 R(Le)2.5 E -.1
(ve)-.15 G(ls).1 E F2
(\(define log-levels '\(\(trace . 0\) \(debug . 1\) \(info . 2\))108 594
Q(\(warn . 3\) \(error . 4\) \(fatal . 5\)\)\))208.8 606 Q
(\(define current-log-level \(make-parameter 'info\)\))108 630 Q
(\(define \(log-enabled? level\))108 654 Q
(\(>= \(assoc-ref log-levels level\))117.6 666 Q
(\(assoc-ref log-levels \(current-log-level\)\)\)\))136.8 678 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.3. Log)72 84 R(Sinks)2.5 E/F2 8/Courier@0 SF
(;; Multiple output destinations)108 102 Q(\(define log-sinks '\(\)\))
108 114 Q(\(define \(add-log-sink! sink\))108 138 Q
(\(set! log-sinks \(cons sink log-sinks\)\)\))117.6 150 Q
(\(define \(emit-log entry\))108 174 Q
(\(when \(log-enabled? \(assoc-ref entry 'level\)\))117.6 186 Q
(\(for-each \(lambda \(sink\))127.2 198 Q(\(sink-write sink entry\)\))
184.8 210 Q(log-sinks\)\)\))175.2 222 Q(;; Sink implementations)108 246
Q(\(define \(make-file-sink path\))108 258 Q(\(lambda \(entry\))117.6
270 Q(\(with-output-to-file path)127.2 282 Q
(\(lambda \(\) \(write-json entry\) \(newline\)\))136.8 294 Q
('append\)\)\))136.8 306 Q(\(define \(make-soup-sink\))108 330 Q
(\(lambda \(entry\))117.6 342 Q(\(soup-put entry type: 'log-entry\)\)\))
127.2 354 Q F1 2.5(6. Health)72 372 R(Checks)2.5 E 2.5(6.1. Health)72
396 R(Endpoints)2.5 E F2(\(define \(health-check\))108 414 Q
("Comprehensive health check")117.6 426 Q
(\(\(status . ,\(if \(all-healthy?\) 'healthy 'unhealthy\)\))117.6 438 Q
(\(checks . \(\(storage . ,\(check-storage\)\))127.2 450 Q
(\(network . ,\(check-network\)\))180 462 Q
(\(replication . ,\(check-replication\)\))180 474 Q
(\(keys . ,\(check-keys\)\)\)\)\)\))180 486 Q
(\(define \(check-storage\))108 510 Q
(\(\(status . ,\(if \(storage-accessible?\) 'healthy 'unhealthy\)\))
117.6 522 Q(\(used . ,\(storage-used\)\))127.2 534 Q
(\(available . ,\(storage-available\)\))127.2 546 Q
(\(percent . ,\(storage-percent-used\)\)\)\))127.2 558 Q
(\(define \(check-network\))108 582 Q
(\(\(status . ,\(if \(network-healthy?\) 'healthy 'unhealthy\)\))117.6
594 Q(\(peers . ,\(connected-peer-count\)\))127.2 606 Q
(\(latency-ms . ,\(average-peer-latency\)\)\)\))127.2 618 Q
(\(define \(check-replication\))108 642 Q
(\(\(status . ,\(if \(replication-healthy?\) 'healthy 'unhealthy\)\))
117.6 654 Q(\(lag-seconds . ,\(replication-lag\)\))127.2 666 Q
(\(pending . ,\(pending-replication-count\)\)\)\))127.2 678 Q 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.2. Readiness)72 84 R(vs Li)2.5 E -.1(ve)-.1 G(ness).1 E/F2 8
/Courier@0 SF(;; Liveness: is the process running?)108 102 Q
(\(define \(liveness-check\))108 114 Q('\(\(status . alive\)\)\))117.6
126 Q(;; Readiness: can we serve requests?)108 150 Q
(\(define \(readiness-check\))108 162 Q
(\(if \(and \(storage-accessible?\))117.6 174 Q(\(keys-available?\))
160.8 186 Q(\(not \(vault-readonly?\)\)\))160.8 198 Q
('\(\(status . ready\)\))136.8 210 Q('\(\(status . not-ready\)\)\)\))
136.8 222 Q F1 2.5(7. Alerting)72 240 R 2.5(7.1. Alert)72 264 R(Rules)
2.5 E F2(\(define alert-rules)108 282 Q(`\(\(storage-critical)117.6 294
Q(\(condition \(> \(metric-value 'storage.percent.used\) 95\)\))132 306
Q(\(severity critical\))132 318 Q
(\(message "Storage critically low"\)\))132 330 Q(\(storage-warning)
127.2 354 Q
(\(condition \(> \(metric-value 'storage.percent.used\) 80\)\))132 366 Q
(\(severity warning\))132 378 Q(\(message "Storage running low"\)\))132
390 Q(\(error-rate-high)127.2 414 Q
(\(condition \(> \(metric-value 'errors.rate\) 10\)\))132 426 Q
(\(severity warning\))132 438 Q
(\(message "High error rate detected"\)\))132 450 Q(\(replication-lag)
127.2 474 Q
(\(condition \(> \(metric-value 'replication.lag.seconds\) 300\)\))132
486 Q(\(severity warning\))132 498 Q
(\(message "Replication lag exceeds 5 minutes"\)\))132 510 Q
(\(peer-disconnected)127.2 534 Q
(\(condition \(< \(metric-value 'network.peers.connected\) 1\)\))132 546
Q(\(severity critical\))132 558 Q
(\(message "No peers connected"\)\)\)\))132 570 Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(7.2. Alert)72 84 R(Ev)2.5 E(aluation)-.1 E/F2 8/Courier@0 SF
(\(define \(evaluate-alerts\))108 102 Q("Check all alert conditions")
117.6 114 Q(\(filter-map)117.6 126 Q(\(lambda \(rule\))127.2 138 Q
(\(when \(eval-condition \(assoc-ref rule 'condition\)\))136.8 150 Q
(\(fire-alert rule\)\)\))146.4 162 Q(alert-rules\)\))127.2 174 Q
(\(define \(fire-alert rule\))108 198 Q
(\(let \(\(alert `\(\(name . ,\(car rule\)\))117.6 210 Q
(\(severity . ,\(assoc-ref \(cdr rule\) 'severity\)\))189.6 222 Q
(\(message . ,\(assoc-ref \(cdr rule\) 'message\)\))189.6 234 Q
(\(timestamp . ,\(current-time\)\)\)\)\))189.6 246 Q
(\(audit-append action: 'alert-fired alert: alert\))127.2 258 Q
(\(notify-alert alert\))127.2 270 Q(alert\)\))127.2 282 Q F1 2.5
(8. Dashboards)72 300 R 2.5(8.1. Metric)72 324 R(Export)2.5 E F2
(;; Prometheus format)108 342 Q(\(define \(export-prometheus\))108 354 Q
(\(with-output-to-string)117.6 366 Q(\(lambda \(\))127.2 378 Q
(\(for-each)136.8 390 Q(\(lambda \(metric\))146.4 402 Q
(\(let \(\(name \(car metric\)\))156 414 Q(\(data \(cdr metric\)\)\))
184.8 426 Q
(\(format #t "# HELP ~a ~a~%" name \(assoc-ref data 'help\)\))165.6 438
Q(\(format #t "# TYPE ~a ~a~%" name \(assoc-ref data 'type\)\))165.6 450
Q(\(format #t "~a ~a~%" name \(assoc-ref data 'value\)\)\)\))165.6 462 Q
(\(hash-table->alist metrics-registry\)\)\)\)\))146.4 474 Q F1 2.5
(8.2. Status)72 492 R -.1(Pa)2.5 G(ge).1 E F2(\(define \(status-page\))
108 510 Q("Generate human-readable status")117.6 522 Q(`\(vault-status)
117.6 534 Q(\(health . ,\(health-check\)\))127.2 546 Q
(\(uptime . ,\(vault-uptime\)\))127.2 558 Q
(\(version . ,\(vault-version\)\))127.2 570 Q
(\(metrics . \(\(storage . ,\(storage-metrics\)\))127.2 582 Q
(\(operations . ,\(operation-metrics\)\))184.8 594 Q
(\(network . ,\(network-metrics\)\)\)\))184.8 606 Q
(\(recent-errors . ,\(recent-errors 10\)\)\)\))127.2 618 Q F1 2.5
(9. Pri)72 636 R -.1(va)-.1 G(cy).1 E 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.1. Metric)72 84 R(Sanitization)2.5 E/F2 8/Courier@0 SF
(;; Never expose sensitive data in metrics)108 102 Q
(\(define \(sanitize-metric-labels labels\))108 114 Q
(\(map \(lambda \(label\))117.6 126 Q(\(case \(car label\))151.2 138 Q
(\(\(hash\) \(cons 'hash "[REDACTED]"\)\))160.8 150 Q
(\(\(principal\) \(cons 'principal \(hash-principal \(cdr label\)\)\)\))
160.8 162 Q(\(else label\)\)\))160.8 174 Q(labels\)\))141.6 186 Q
(\(define \(safe-metric name value #!key labels\))108 210 Q
(\(metric-set! name value labels: \(sanitize-metric-labels labels\)\)\))
117.6 222 Q F1 2.5(9.2. Aggr)72 240 R(egate Metrics Only)-.18 E F2
(;; Expose only aggregates, not individual operations)108 258 Q
(\(define \(operation-metrics\))108 270 Q
(`\(\(total-operations . ,\(metric-value 'cas.operations.total\)\))117.6
282 Q
(\(operations-per-second . ,\(metric-value 'cas.operations.rate\)\))
127.2 294 Q
(\(average-latency-ms . ,\(metric-value 'cas.latency.average\)\))127.2
306 Q(\(p99-latency-ms . ,\(metric-value 'cas.latency.p99\)\)\)\))127.2
318 Q F1 2.5(10. Storage)72 336 R 2.5(10.1. Metric)72 360 R(Retention)
2.5 E F2(;; Metrics stored in soup with TTL)108 378 Q
(\(define metric-retention \( 30 24 3600\)\))108 390 Q 4.8(;3)9.6 G 4.8
(0d)-4.8 G(ays)-4.8 E(\(define \(store-metric-snapshot\))108 414 Q
("Periodic metric snapshot")117.6 426 Q
(\(let \(\(snapshot `\(\(timestamp . ,\(current-time\)\))117.6 438 Q
(\(metrics . ,\(export-all-metrics\)\)\)\)\))204 450 Q
(\(soup-put snapshot)127.2 462 Q(type: 'metric-snapshot)136.8 474 Q
(ttl: metric-retention\)\)\))136.8 486 Q(\(define \(gc-old-metrics\))108
510 Q("Remove expired metric snapshots")117.6 522 Q
(\(let \(\(expired \(soup-query type: 'metric-snapshot)117.6 534 Q
(timestamp: \(< \(- \(current-time\) metric-retention*\)\)\)\)\))247.2
546 Q(\(for-each soup-delete! expired\)\)\))127.2 558 Q F1 2.5(10.2. T)
72 576 R(race Sampling)-.74 E F2(;; Sample traces to control storage)108
594 Q(\(define trace-sample-rate 0.1\))108 606 Q 4.8(;1)9.6 G(0%)-4.8 E
(\(define \(should-sample-trace?\))108 630 Q
(\(< \(random 1.0\) trace-sample-rate\)\))117.6 642 Q
(\(define \(record-trace! trace\))108 666 Q
(\(when \(or \(trace-has-error? trace\))117.6 678 Q
(\(should-sample-trace?\)\))165.6 690 Q
(\(soup-put trace type: 'trace\)\)\))127.2 702 Q 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-031 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(11. Refer)72 84 R(ences)-.18 E F0 1.378(1. [OpenT)72 99.6 R 1.377
(elemetry]\(https://opentelemetry.io/\) - Observ)-.7 F 1.377
(ability frame)-.25 F -.1(wo)-.25 G 1.377
(rk 2. [Prometheus]\(https://prometheus.io/\) -).1 F 2.422
(Monitoring system 3. [RFC-003: Cryptographic Audit T)72 111.6 R 2.422
(rail]\(rfc-003-audit-trail.html\) 4. [RFC-028: Error Han-)-.35 F
(dling]\(rfc-028-error)72 123.6 Q(-handling.html\))-.2 E F1 2.5
(12. Changelog)72 147.6 R F0 6.5<8332>72 163.2 S(026-01-07)-6.5 E 6.5
<8349>72 178.8 S(nitial draft)-6.5 E 0 Cg EP
%%Trailer
end
%%EOF
