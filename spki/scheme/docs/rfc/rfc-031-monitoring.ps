%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Thu Jan  8 15:17:54 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 7
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-031: Monitoring and Observ)72 12 Q(ability)
-.25 E(Status: Draft Date: January 2026 Author: Derrell Piper ddp@eludo\
m.net Implementation: Proposed)72 36 Q(--------------------------------\
----------------------------------------------)72 60 Q(Abstract)72 84 Q
.727(This RFC speci\214es monitoring and observ)72 108 R .727
(ability for the Library of Cyberspace: ho)-.25 F 3.226(wv)-.25 G .726
(aults e)-3.476 F .726(xpose metrics, traces,)-.15 F 1.38
(and logs for operational visibility while maintaining pri)72 120 R -.25
(va)-.25 G 1.68 -.15(cy a).25 H 1.38(nd security).15 F 3.88(.O)-.65 G
(bserv)-3.88 E 1.38(ability data is itself content-ad-)-.25 F
(dressed and auditable.)72 132 Q(--------------------------------------\
----------------------------------------)72 156 Q(Moti)72 180 Q -.25(va)
-.25 G(tion).25 E(Operating distrib)72 204 Q
(uted systems requires visibility:)-.2 E 2.653(-H)72 228 S .153
(ealth - Is the v)-2.653 F .153(ault functioning correctly?)-.25 F 2.653
(-P)5.153 G .153(erformance - Ho)-2.653 F 2.653(wf)-.25 G .153
(ast are operations?)-2.753 F 2.653(-C)5.153 G .153(apacity - Ho)-2.653
F 2.653(wm)-.25 G .153(uch stor)-2.653 F(-)-.2 E(age remains?)72 240 Q
2.5(-E)5 G(rrors - What\342s f)-2.5 E(ailing and wh)-.1 E 2.5(y? -)-.05
F(Security - Who\342s accessing what?)2.5 E(But observ)72 264 Q
(ability must not compromise:)-.25 E 3.314(-P)72 288 S(ri)-3.314 E -.25
(va)-.25 G 1.114 -.15(cy - N).25 H 3.314(os).15 G(ensiti)-3.314 E 1.114
-.15(ve d)-.25 H .814(ata in metrics - Security - Metrics don\342t leak\
 capabilities - Performance - Minimal o).15 F -.15(ve)-.15 G -.2(r-).15
G(head - Storage - Observ)72 300 Q(ability data is bounded)-.25 E(-----\
-----------------------------------------------------------------------\
--)72 324 Q(Metrics)72 348 Q(Core Metrics)72 372 Q(\(de\214ne v)82 396 Q
(ault-metrics)-.25 E('\(;; Storage)87 408 Q(\(storage.used.bytes g)92
420 Q(auge "T)-.05 E(otal bytes used"\))-.8 E(\(storage.a)92 432 Q -.25
(va)-.2 G(ilable.bytes g).25 E(auge "Bytes a)-.05 E -.25(va)-.2 G
(ilable"\)).25 E(\(storage.objects.count g)92 444 Q
(auge "Number of objects"\))-.05 E(;; Operations)92 468 Q
(\(cas.put.count counter "CAS put operations"\))92 480 Q
(\(cas.put.bytes counter "Bytes written"\))92 492 Q
(\(cas.put.duration histogram "Put latenc)92 504 Q(y"\))-.15 E
(\(cas.get.count counter "CAS get operations"\))92 516 Q
(\(cas.get.bytes counter "Bytes read"\))92 528 Q
(\(cas.get.duration histogram "Get latenc)92 540 Q(y"\))-.15 E(;; Soup)
92 564 Q(\(soup.queries.count counter "Soup queries"\))92 576 Q
(\(soup.queries.duration histogram "Query latenc)92 588 Q(y"\))-.15 E
(\(soup.inde)92 600 Q(x.size.bytes g)-.15 E(auge "Inde)-.05 E 2.5(xs)
-.15 G(ize"\))-2.5 E(;; Netw)92 624 Q(ork)-.1 E(\(netw)92 636 Q
(ork.connections.acti)-.1 E .3 -.15(ve g)-.25 H(auge "Acti).1 E .3 -.15
(ve c)-.25 H(onnections"\)).15 E(\(netw)92 648 Q
(ork.bytes.sent counter "Bytes sent"\))-.1 E(\(netw)92 660 Q
(ork.bytes.recei)-.1 E -.15(ve)-.25 G 2.5(dc).15 G(ounter "Bytes recei)
-2.5 E -.15(ve)-.25 G(d"\)).15 E(;; Replication)92 684 Q
(\(replication.lag.seconds g)92 696 Q(auge "Replication lag"\))-.05 E
(\(replication.objects.pending g)92 708 Q(auge "Objects pending sync"\))
-.05 E(;; Errors)92 732 Q(\(errors.total counter "T)92 744 Q
(otal errors" labels: \(type\)\))-.8 E(\(errors.rate g)92 756 Q
(auge "Error rate per second"\)\)\))-.05 E(Metric Collection)72 780 Q 0
Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne metrics-re)82 12 Q(gistry \(mak)-.15
E(e-hash-table\)\))-.1 E(\(de\214ne \(re)82 36 Q(gister)-.15 E
(-metric name type help #!k)-.2 E .3 -.15(ey l)-.1 H(abels\)).15 E
(\(hash-table-set! metrics-re)87 48 Q(gistry name)-.15 E
(`\(\(type . ,type\))92 60 Q(\(help . ,help\))97 72 Q
(\(labels . ,labels\))97 84 Q(\(v)97 96 Q(alue . ,\(case type)-.25 E
(\(\(counter\) 0\))127 108 Q(\(\(g)127 120 Q(auge\) 0\))-.05 E
(\(\(histogram\) \(mak)127 132 Q(e-histogram-b)-.1 E(uck)-.2 E
(ets\)\)\)\)\)\)\))-.1 E(\(de\214ne \(metric-inc! name #!k)82 156 Q .3
-.15(ey \()-.1 H(delta 1\) labels\)).15 E
(\(let \(\(metric \(hash-table-ref metrics-re)87 168 Q
(gistry name\)\)\))-.15 E(\(case \(assoc-ref metric ')92 180 Q(type\))
-.18 E(\(\(counter g)97 192 Q(auge\))-.05 E(\(set! \(assoc-ref metric ')
99.5 204 Q -.25(va)-.5 G(lue\)).25 E(\(+ \(assoc-ref metric ')114.5 216
Q -.25(va)-.5 G(lue\) delta\)\)\)\)\)\)).25 E
(\(de\214ne \(metric-set! name v)82 240 Q(alue #!k)-.25 E .3 -.15(ey l)
-.1 H(abels\)).15 E(\(let \(\(metric \(hash-table-ref metrics-re)87 252
Q(gistry name\)\)\))-.15 E(\(set! \(assoc-ref metric ')92 264 Q -.25(va)
-.5 G(lue\) v).25 E(alue\)\)\))-.25 E(\(de\214ne \(metric-observ)82 288
Q(e! name v)-.15 E(alue #!k)-.25 E .3 -.15(ey l)-.1 H(abels\)).15 E
(\(let \(\(metric \(hash-table-ref metrics-re)87 300 Q
(gistry name\)\)\))-.15 E(\(histogram-observ)92 312 Q
(e! \(assoc-ref metric ')-.15 E -.25(va)-.5 G(lue\) v).25 E(alue\)\)\))
-.25 E(Histogram Buck)72 336 Q(ets)-.1 E(\(de\214ne \(mak)82 360 Q
(e-histogram-b)-.1 E(uck)-.2 E(ets\))-.1 E("Def)87 372 Q(ault latenc)-.1
E 2.5(yb)-.15 G(uck)-2.7 E(ets in milliseconds")-.1 E(\(let \(\(b)87 384
Q(uck)-.2 E(ets '\(1 5 10 25 50 100 250 500 1000 2500 5000 10000\)\)\))
-.1 E(\(map \(lambda \(b\) \(cons b 0\)\) b)92 396 Q(uck)-.2 E
(ets\)\)\))-.1 E(\(de\214ne \(histogram-observ)82 420 Q(e! histogram v)
-.15 E(alue\))-.25 E(\(for)87 432 Q(-each \(lambda \(b)-.2 E(uck)-.2 E
(et\))-.1 E(\(when \(<= v)117 444 Q(alue \(car b)-.25 E(uck)-.2 E
(et\)\))-.1 E(\(set-cdr! b)122 456 Q(uck)-.2 E(et \(+ \(cdr b)-.1 E(uck)
-.2 E(et\) 1\)\)\)\))-.1 E(histogram\)\))112 468 Q(--------------------\
----------------------------------------------------------)72 492 Q -.35
(Tr)72 516 S(acing).35 E -.35(Tr)72 540 S(ace Structure).35 E
(\(de\214ne \(mak)82 564 Q(e-trace operation\))-.1 E(`\(trace)87 576 Q
(\(trace-id ,\(generate-trace-id\)\))92 588 Q
(\(span-id ,\(generate-span-id\)\))92 600 Q(\(parent-span-id #f\))92 612
Q(\(operation ,operation\))92 624 Q(\(start-time ,\(current-time-ns\)\))
92 636 Q(\(end-time #f\))92 648 Q(\(status pending\))92 660 Q(\(attrib)
92 672 Q(utes \(\)\))-.2 E(\(e)92 684 Q -.15(ve)-.25 G(nts \(\)\)\)\))
.15 E(\(de\214ne \(trace-start! trace\))82 708 Q
(\(set! \(assoc-ref trace ')87 720 Q(start-time\) \(current-time-ns\)\))
-.55 E(trace\))87 732 Q(\(de\214ne \(trace-end! trace status\))82 756 Q
(\(set! \(assoc-ref trace 'end-time\) \(current-time-ns\)\))87 768 Q
(\(set! \(assoc-ref trace ')87 780 Q(status\) status\))-.55 E
(\(record-trace! trace\)\))87 792 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Span Conte)72 24 Q(xt)-.15 E
(\(de\214ne current-trace \(mak)82 48 Q(e-parameter #f\)\))-.1 E
(\(de\214ne current-span \(mak)82 60 Q(e-parameter #f\)\))-.1 E
(\(de\214ne \(with-span operation proc\))82 84 Q("Ex)87 96 Q
(ecute proc within a traced span")-.15 E
(\(let* \(\(parent \(current-span\)\))87 108 Q(\(span \(mak)104.5 120 Q
(e-span operation \(and parent \(span-id parent\)\)\)\)\))-.1 E
(\(parameterize \(\(current-span span\)\))92 132 Q(\(span-start! span\))
97 144 Q(\(guard \(e)97 156 Q(x)-.15 E(\(else)117 168 Q
(\(span-error! span e)119.5 180 Q(x\))-.15 E(\(span-end! span 'error\))
119.5 192 Q(\(raise e)119.5 204 Q(x\)\)\))-.15 E
(\(let \(\(result \(proc\)\)\))102 216 Q(\(span-end! span 'ok\))107 228
Q(result\)\)\)\)\))107 240 Q(;; Example usage)82 264 Q
(\(de\214ne \(traced-cas-get hash\))82 276 Q(\(with-span "cas.get")87
288 Q(\(lambda \(\))92 300 Q(\(span-set-attrib)97 312 Q
(ute! "hash" hash\))-.2 E(\(cas-get hash\)\)\)\))97 324 Q(Distrib)72 348
Q(uted T)-.2 E(racing)-.35 E(;; Propag)82 372 Q(ate trace conte)-.05 E
(xt across v)-.15 E(ault boundaries)-.25 E
(\(de\214ne \(inject-trace-conte)82 384 Q(xt headers\))-.15 E
("Inject trace conte)87 396 Q(xt into outgoing request")-.15 E
(\(let \(\(span \(current-span\)\)\))87 408 Q(\(when span)92 420 Q
(\(hash-table-set! headers "X-T)97 432 Q
(race-Id" \(span-trace-id span\)\))-.35 E
(\(hash-table-set! headers "X-Span-Id" \(span-id span\)\)\)\)\))97 444 Q
(\(de\214ne \(e)82 468 Q(xtract-trace-conte)-.15 E(xt headers\))-.15 E
("Extract trace conte)87 480 Q(xt from incoming request")-.15 E
(\(let \(\(trace-id \(hash-table-ref headers "X-T)87 492 Q
(race-Id" #f\)\))-.35 E
(\(parent-span-id \(hash-table-ref headers "X-Span-Id" #f\)\)\))102 504
Q(\(when trace-id)92 516 Q(\(current-trace trace-id\))97 528 Q(\(mak)97
540 Q(e-span-with-parent parent-span-id\)\)\)\))-.1 E(-----------------\
-------------------------------------------------------------)72 564 Q
(Logging)72 588 Q(Structured Logging)72 612 Q(\(de\214ne \(log le)82 636
Q -.15(ve)-.25 G 2.5(lm).15 G(essage #!rest attrib)-2.5 E(utes\))-.2 E
("Emit structured log entry")87 648 Q
(\(let \(\(entry `\(\(timestamp . ,\(current-time-iso8601\)\))87 660 Q
(\(le)124.5 672 Q -.15(ve)-.25 G 2.5(l.,).15 G(le)-2.5 E -.15(ve)-.25 G
(l\)).15 E(\(message . ,message\))124.5 684 Q(\(v)124.5 696 Q
(ault . ,\(v)-.25 E(ault-id\)\))-.25 E(\(trace-id . ,\(and \(current-sp\
an\) \(span-trace-id \(current-span\)\)\)\))124.5 708 Q
(,@\(plist->alist attrib)124.5 720 Q(utes\)\)\)\))-.2 E
(\(emit-log entry\)\)\))92 732 Q(\(de\214ne \(log-deb)82 756 Q
(ug message . attrs\) \(apply log ')-.2 E(deb)-.5 E
(ug message attrs\)\))-.2 E(\(de\214ne \(log-info message . attrs\) \(a\
pply log 'info message attrs\)\))82 768 Q(\(de\214ne \(log-w)82 780 Q
(arn message . attrs\) \(apply log 'w)-.1 E(arn message attrs\)\))-.1 E
(\(de\214ne \(log-error message . attrs\) \(apply log 'error message at\
trs\)\))82 792 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; Example)82 24 Q(\(log-info "Object stored")82
36 Q('hash hash)107 48 Q -.55('s)107 60 S(ize \(byte).55 E -.15(ve)-.25
G(ctor).15 E(-length data\))-.2 E -.5('d)107 72 S(uration-ms elapsed\))
.5 E(Log Le)72 96 Q -.15(ve)-.25 G(ls).15 E(\(de\214ne log-le)82 120 Q
-.15(ve)-.25 G(ls '\(\(trace . 0\) \(deb).15 E(ug . 1\) \(info . 2\))-.2
E(\(w)134.5 132 Q(arn . 3\) \(error . 4\) \(f)-.1 E(atal . 5\)\)\))-.1 E
(\(de\214ne current-log-le)82 156 Q -.15(ve)-.25 G 2.5(l\().15 G(mak)
-2.5 E(e-parameter 'info\)\))-.1 E(\(de\214ne \(log-enabled? le)82 180 Q
-.15(ve)-.25 G(l\)).15 E(\(>= \(assoc-ref log-le)87 192 Q -.15(ve)-.25 G
(ls le).15 E -.15(ve)-.25 G(l\)).15 E(\(assoc-ref log-le)97 204 Q -.15
(ve)-.25 G(ls \(current-log-le).15 E -.15(ve)-.25 G(l\)\)\)\)).15 E
(Log Sinks)72 228 Q(;; Multiple output destinations)82 252 Q
(\(de\214ne log-sinks '\(\)\))82 264 Q
(\(de\214ne \(add-log-sink! sink\))82 288 Q
(\(set! log-sinks \(cons sink log-sinks\)\)\))87 300 Q
(\(de\214ne \(emit-log entry\))82 324 Q
(\(when \(log-enabled? \(assoc-ref entry ')87 336 Q(le)-.1 E -.15(ve)
-.25 G(l\)\)).15 E(\(for)92 348 Q(-each \(lambda \(sink\))-.2 E
(\(sink-write sink entry\)\))122 360 Q(log-sinks\)\)\))117 372 Q
(;; Sink implementations)82 396 Q(\(de\214ne \(mak)82 408 Q
(e-\214le-sink path\))-.1 E(\(lambda \(entry\))87 420 Q
(\(with-output-to-\214le path)92 432 Q
(\(lambda \(\) \(write-json entry\) \(ne)97 444 Q(wline\)\))-.25 E
('append\)\)\))97 456 Q(\(de\214ne \(mak)82 480 Q(e-soup-sink\))-.1 E
(\(lambda \(entry\))87 492 Q(\(soup-put entry type: ')92 504 Q
(log-entry\)\)\))-.1 E(------------------------------------------------\
------------------------------)72 528 Q(Health Checks)72 552 Q
(Health Endpoints)72 576 Q(\(de\214ne \(health-check\))82 600 Q
("Comprehensi)87 612 Q .3 -.15(ve h)-.25 H(ealth check").15 E
(`\(\(status . ,\(if \(all-health)87 624 Q(y?\) 'health)-.05 E 2.5(y')
-.05 G(unhealth)-2.5 E(y\)\))-.05 E
(\(checks . \(\(storage . ,\(check-storage\)\))92 636 Q(\(netw)119.5 648
Q(ork . ,\(check-netw)-.1 E(ork\)\))-.1 E
(\(replication . ,\(check-replication\)\))119.5 660 Q(\(k)119.5 672 Q
-.15(ey)-.1 G 2.5(s.,).15 G(\(check-k)-2.5 E -.15(ey)-.1 G
(s\)\)\)\)\)\)).15 E(\(de\214ne \(check-storage\))82 696 Q
(`\(\(status . ,\(if \(storage-accessible?\) 'health)87 708 Q 2.5(y')
-.05 G(unhealth)-2.5 E(y\)\))-.05 E(\(used . ,\(storage-used\)\))92 720
Q(\(a)92 732 Q -.25(va)-.2 G(ilable . ,\(storage-a).25 E -.25(va)-.2 G
(ilable\)\)).25 E(\(percent . ,\(storage-percent-used\)\)\)\))92 744 Q
(\(de\214ne \(check-netw)82 768 Q(ork\))-.1 E
(`\(\(status . ,\(if \(netw)87 780 Q(ork-health)-.1 E(y?\) 'health)-.05
E 2.5(y')-.05 G(unhealth)-2.5 E(y\)\))-.05 E
(\(peers . ,\(connected-peer)92 792 Q(-count\)\))-.2 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(latenc)92 12 Q(y-ms . ,\(a)-.15 E -.15(ve)-.2
G(rage-peer).15 E(-latenc)-.2 E(y\)\)\)\))-.15 E
(\(de\214ne \(check-replication\))82 36 Q
(`\(\(status . ,\(if \(replication-health)87 48 Q(y?\) 'health)-.05 E
2.5(y')-.05 G(unhealth)-2.5 E(y\)\))-.05 E
(\(lag-seconds . ,\(replication-lag\)\))92 60 Q
(\(pending . ,\(pending-replication-count\)\)\)\))92 72 Q
(Readiness vs Li)72 96 Q -.15(ve)-.25 G(ness).15 E(;; Li)82 120 Q -.15
(ve)-.25 G(ness: is the process running?).15 E(\(de\214ne \(li)82 132 Q
-.15(ve)-.25 G(ness-check\)).15 E('\(\(status . ali)87 144 Q -.15(ve)
-.25 G(\)\)\)).15 E(;; Readiness: can we serv)82 168 Q 2.5(er)-.15 G
(equests?)-2.5 E(\(de\214ne \(readiness-check\))82 180 Q
(\(if \(and \(storage-accessible?\))87 192 Q(\(k)109.5 204 Q -.15(ey)-.1
G(s-a).15 E -.25(va)-.2 G(ilable?\)).25 E(\(not \(v)109.5 216 Q
(ault-readonly?\)\)\))-.25 E('\(\(status . ready\)\))97 228 Q
('\(\(status . not-ready\)\)\)\))97 240 Q(-----------------------------\
-------------------------------------------------)72 264 Q(Alerting)72
288 Q(Alert Rules)72 312 Q(\(de\214ne alert-rules)82 336 Q
(`\(\(storage-critical)87 348 Q(\(condition \(> \(metric-v)94.5 360 Q
(alue ')-.25 E(storage.percent.used\) 95\)\))-.55 E(\(se)94.5 372 Q -.15
(ve)-.25 G(rity critical\)).15 E(\(message "Storage critically lo)94.5
384 Q(w"\)\))-.25 E(\(storage-w)92 408 Q(arning)-.1 E
(\(condition \(> \(metric-v)94.5 420 Q(alue ')-.25 E
(storage.percent.used\) 80\)\))-.55 E(\(se)94.5 432 Q -.15(ve)-.25 G
(rity w).15 E(arning\))-.1 E(\(message "Storage running lo)94.5 444 Q
(w"\)\))-.25 E(\(error)92 468 Q(-rate-high)-.2 E
(\(condition \(> \(metric-v)94.5 480 Q(alue 'errors.rate\) 10\)\))-.25 E
(\(se)94.5 492 Q -.15(ve)-.25 G(rity w).15 E(arning\))-.1 E
(\(message "High error rate detected"\)\))94.5 504 Q(\(replication-lag)
92 528 Q(\(condition \(> \(metric-v)94.5 540 Q(alue ')-.25 E
(replication.lag.seconds\) 300\)\))-.5 E(\(se)94.5 552 Q -.15(ve)-.25 G
(rity w).15 E(arning\))-.1 E(\(message "Replication lag e)94.5 564 Q
(xceeds 5 minutes"\)\))-.15 E(\(peer)92 588 Q(-disconnected)-.2 E
(\(condition \(< \(metric-v)94.5 600 Q(alue 'netw)-.25 E
(ork.peers.connected\) 1\)\))-.1 E(\(se)94.5 612 Q -.15(ve)-.25 G
(rity critical\)).15 E(\(message "No peers connected"\)\)\)\))94.5 624 Q
(Alert Ev)72 648 Q(aluation)-.25 E(\(de\214ne \(e)82 672 Q -.25(va)-.25
G(luate-alerts\)).25 E("Check all alert conditions")87 684 Q(\(\214lter)
87 696 Q(-map)-.2 E(\(lambda \(rule\))92 708 Q(\(when \(e)97 720 Q -.25
(va)-.25 G(l-condition \(assoc-ref rule 'condition\)\)).25 E
(\(\214re-alert rule\)\)\))102 732 Q(alert-rules\)\))92 744 Q
(\(de\214ne \(\214re-alert rule\))82 768 Q
(\(let \(\(alert `\(\(name . ,\(car rule\)\))87 780 Q(\(se)124.5 792 Q
-.15(ve)-.25 G(rity . ,\(assoc-ref \(cdr rule\) ').15 E(se)-.55 E -.15
(ve)-.25 G(rity\)\)).15 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF
(\(message . ,\(assoc-ref \(cdr rule\) 'message\)\))124.5 12 Q
(\(timestamp . ,\(current-time\)\)\)\)\))124.5 24 Q
(\(audit-append action: 'alert-\214red alert: alert\))92 36 Q
(\(notify-alert alert\))92 48 Q(alert\)\))92 60 Q(---------------------\
---------------------------------------------------------)72 84 Q
(Dashboards)72 108 Q(Metric Export)72 132 Q(;; Prometheus format)82 156
Q(\(de\214ne \(e)82 168 Q(xport-prometheus\))-.15 E
(\(with-output-to-string)87 180 Q(\(lambda \(\))92 192 Q(\(for)97 204 Q
(-each)-.2 E(\(lambda \(metric\))102 216 Q
(\(let \(\(name \(car metric\)\))107 228 Q(\(data \(cdr metric\)\)\))122
240 Q(\(format #t "# HELP ~a ~a~%" name \(assoc-ref data 'help\)\))112
252 Q(\(format #t "# TYPE ~a ~a~%" name \(assoc-ref data ')112 264 Q
(type\)\))-.18 E(\(format #t "~a ~a~%" name \(assoc-ref data ')112 276 Q
-.25(va)-.5 G(lue\)\)\)\)).25 E(\(hash-table->alist metrics-re)102 288 Q
(gistry\)\)\)\)\))-.15 E(Status P)72 312 Q(age)-.15 E
(\(de\214ne \(status-page\))82 336 Q("Generate human-readable status")87
348 Q(`\(v)87 360 Q(ault-status)-.25 E(\(health . ,\(health-check\)\))92
372 Q(\(uptime . ,\(v)92 384 Q(ault-uptime\)\))-.25 E(\(v)92 396 Q
(ersion . ,\(v)-.15 E(ault-v)-.25 E(ersion\)\))-.15 E
(\(metrics . \(\(storage . ,\(storage-metrics\)\))92 408 Q
(\(operations . ,\(operation-metrics\)\))122 420 Q(\(netw)122 432 Q
(ork . ,\(netw)-.1 E(ork-metrics\)\)\)\))-.1 E
(\(recent-errors . ,\(recent-errors 10\)\)\)\))92 444 Q(---------------\
---------------------------------------------------------------)72 468 Q
(Pri)72 492 Q -.25(va)-.25 G -.15(cy).25 G(Metric Sanitization)72 516 Q
(;; Ne)82 540 Q -.15(ve)-.25 G 2.5(re).15 G(xpose sensiti)-2.65 E .3
-.15(ve d)-.25 H(ata in metrics).15 E
(\(de\214ne \(sanitize-metric-labels labels\))82 552 Q
(\(map \(lambda \(label\))87 564 Q(\(case \(car label\))104.5 576 Q
(\(\(hash\) \(cons 'hash "[RED)109.5 588 Q -.4(AC)-.4 G(TED]"\)\)).4 E
(\(\(principal\) \(cons 'principal \(hash-principal \(cdr label\)\)\)\))
109.5 600 Q(\(else label\)\)\))109.5 612 Q(labels\)\))99.5 624 Q
(\(de\214ne \(safe-metric name v)82 648 Q(alue #!k)-.25 E .3 -.15(ey l)
-.1 H(abels\)).15 E(\(metric-set! name v)87 660 Q
(alue labels: \(sanitize-metric-labels labels\)\)\))-.25 E(Aggre)72 684
Q -.05(ga)-.15 G(te Metrics Only).05 E(;; Expose only aggre)82 708 Q
-.05(ga)-.15 G(tes, not indi).05 E(vidual operations)-.25 E
(\(de\214ne \(operation-metrics\))82 720 Q
(`\(\(total-operations . ,\(metric-v)87 732 Q
(alue 'cas.operations.total\)\))-.25 E(\(operations-per)92 744 Q
(-second . ,\(metric-v)-.2 E(alue 'cas.operations.rate\)\))-.25 E(\(a)92
756 Q -.15(ve)-.2 G(rage-latenc).15 E(y-ms . ,\(metric-v)-.15 E
(alue 'cas.latenc)-.25 E -.65(y.)-.15 G -2.25 -.2(av e).65 H(rage\)\)).2
E(\(p99-latenc)92 768 Q(y-ms . ,\(metric-v)-.15 E(alue 'cas.latenc)-.25
E -.65(y.)-.15 G(p99\)\)\)\)).65 E(------------------------------------\
------------------------------------------)72 792 Q 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Storage)72 24 Q(Metric Retention)72 48 Q
(;; Metrics stored in soup with TTL)82 72 Q
(\(de\214ne *metric-retention* \(* 30 24 3600\)\))82 84 Q 2.5(;3)5 G 2.5
(0d)-2.5 G(ays)-2.5 E(\(de\214ne \(store-metric-snapshot\))82 108 Q
("Periodic metric snapshot")87 120 Q
(\(let \(\(snapshot `\(\(timestamp . ,\(current-time\)\))87 132 Q
(\(metrics . ,\(e)132 144 Q(xport-all-metrics\)\)\)\)\))-.15 E
(\(soup-put snapshot)92 156 Q(type: 'metric-snapshot)97 168 Q
(ttl: *metric-retention*\)\)\))97 180 Q(\(de\214ne \(gc-old-metrics\))82
204 Q("Remo)87 216 Q .3 -.15(ve ex)-.15 H(pired metric snapshots").15 E
(\(let \(\(e)87 228 Q(xpired \(soup-query type: 'metric-snapshot)-.15 E
(timestamp: \(< \(- \(current-time\) *metric-retention*\)\)\)\)\))154.5
240 Q(\(for)92 252 Q(-each soup-delete! e)-.2 E(xpired\)\)\))-.15 E -.35
(Tr)72 276 S(ace Sampling).35 E(;; Sample traces to control storage)82
300 Q(\(de\214ne *trace-sample-rate* 0.1\))82 312 Q 2.5(;1)5 G(0%)-2.5 E
(\(de\214ne \(should-sample-trace?\))82 336 Q
(\(< \(random 1.0\) *trace-sample-rate*\)\))87 348 Q
(\(de\214ne \(record-trace! trace\))82 372 Q
(\(when \(or \(trace-has-error? trace\))87 384 Q
(\(should-sample-trace?\)\))112 396 Q(\(soup-put trace type: ')92 408 Q
(trace\)\)\))-.18 E(---------------------------------------------------\
---------------------------)72 432 Q(References)72 456 Q 2.899(1. OpenT)
72 480 R .399(elemetry - Observ)-.7 F .399(ability frame)-.25 F -.1(wo)
-.25 G .399(rk 2.).1 F .398(Prometheus - Monitoring system 3.)5.399 F
.398(RFC-003: Cryptographic Au-)5.398 F(dit T)72 492 Q(rail 4.)-.35 E
(RFC-028: Error Handling)5 E(------------------------------------------\
------------------------------------)72 516 Q(Changelog)72 540 Q 2.5(-2)
72 564 S(026-01-07 - Initial draft)-2.5 E(-----------------------------\
-------------------------------------------------)72 588 Q
(Implementation Status: Draft Dependencies: soup, audit Inte)72 612 Q
(gration: Operations, alerting, dashboards)-.15 E 0 Cg EP
%%Trailer
end
%%EOF
