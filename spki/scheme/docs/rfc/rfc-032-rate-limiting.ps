%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 7
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-032: Rate Limiting and Quotas)72 12 Q 1.95(\
**Status:** Draft **Date:** January 2026 **Author:** Derrell Piper <ddp\
@eludom.net> **Implementation:**)72 36 R(Proposed)72 48 Q(---)72 72 Q
(Abstract)72 96 Q .05(This RFC speci\214es rate limiting and quotas for\
 the Library of Cyberspace: ho)72 120 R 2.55(wv)-.25 G .05
(aults protect themselv)-2.8 F .05(es from ab)-.15 F(use)-.2 E
(while ensuring f)72 132 Q(air access for le)-.1 E
(gitimate users. Limits are capability-a)-.15 E -.1(wa)-.15 G
(re and auditable.).1 E(---)72 156 Q(Moti)72 180 Q -.25(va)-.25 G(tion)
.25 E(Shared resources require protection:)72 204 Q 2.92(-*)72 228 S .42
(*Denial of Service** - Malicious o)-2.92 F -.15(ve)-.15 G .42
(rload - **Resource e).15 F .42(xhaustion** - Runa)-.15 F -.1(wa)-.15 G
2.92(yp).1 G .42(rocesses - **F)-2.92 F .42(air sharing** -)-.15 F
(Equal access for all users - **Cost control** - Pre)72 240 Q -.15(ve)
-.25 G(nt unbounded consumption).15 E(Limits must be:)72 264 Q 4.636(-*)
72 288 S 2.136(*Con\214gurable** - Dif)-4.636 F 2.136
(ferent limits for dif)-.25 F 2.136
(ferent principals - **Graceful** - De)-.25 F 2.136(grade smoothly)-.15
F 4.636(,d)-.65 G(on')-4.636 E 4.636(tc)-.18 G(lif)-4.636 E 4.636(f-)
-.25 G(**T)72 300 Q(ransparent** - Users kno)-.35 E 2.5(wt)-.25 G
(heir limits - **Auditable** - All limiting decisions logged)-2.5 E(---)
72 324 Q(Rate Limiting)72 348 Q -.8(To)72 372 S -.1(ke).8 G 2.5(nB).1 G
(uck)-2.5 E(et Algorithm)-.1 E -.74(```)72 396 S
(scheme \(de\214ne \(mak).74 E(e-tok)-.1 E(en-b)-.1 E(uck)-.2 E
(et capacity \214ll-rate\))-.1 E("Create tok)77 408 Q(en b)-.1 E(uck)-.2
E(et rate limiter")-.1 E(\(let \(\(tok)77 420 Q(ens capacity\))-.1 E
(\(last-\214ll \(current-time-ms\)\)\))92 432 Q(\(lambda \(cost\))82 456
Q(;; Re\214ll tok)87 468 Q(ens based on elapsed time)-.1 E
(\(let* \(\(no)87 480 Q 2.5(w\()-.25 G(current-time-ms\)\))-2.5 E
(\(elapsed \(- no)104.5 492 Q 2.5(wl)-.25 G(ast-\214ll\)\))-2.5 E(\(ne)
104.5 504 Q(w-tok)-.25 E(ens \(+ tok)-.1 E
(ens \(* \214ll-rate \(/ elapsed 1000\)\)\)\)\))-.1 E(\(set! tok)92 516
Q(ens \(min capacity ne)-.1 E(w-tok)-.25 E(ens\)\))-.1 E
(\(set! last-\214ll no)92 528 Q(w\))-.25 E(;; T)92 552 Q
(ry to consume tok)-.35 E(ens)-.1 E(\(if \(>= tok)92 564 Q(ens cost\))
-.1 E(\(be)102 576 Q(gin)-.15 E(\(set! tok)107 588 Q(ens \(- tok)-.1 E
(ens cost\)\))-.1 E 2.5(#t\) ;)107 600 R(Allo)2.5 E(wed)-.25 E
(#f\)\)\)\)\) ; Denied)102 612 Q(;; Example: 100 requests per second, b)
72 636 Q(urst of 200 \(de\214ne request-limiter \(mak)-.2 E(e-tok)-.1 E
(en-b)-.1 E(uck)-.2 E(et 200 100\)\) `)-.1 E -.74(``)-.74 G(Sliding W)72
660 Q(indo)-.4 E(w)-.25 E -.74(```)72 684 S(scheme \(de\214ne \(mak).74
E(e-sliding-windo)-.1 E 2.5(ws)-.25 G(ize interv)-2.5 E(al\))-.25 E
("Sliding windo)77 696 Q 2.5(wr)-.25 G(ate limiter")-2.5 E(\(let \(\(e)
77 708 Q -.15(ve)-.25 G(nts \(mak).15 E(e-deque\)\)\))-.1 E
(\(lambda \(\))82 732 Q(;; Remo)87 744 Q .3 -.15(ve o)-.15 H(ld e).15 E
-.15(ve)-.25 G(nts).15 E(\(let \(\(cutof)87 756 Q 2.5(f\()-.25 G 2.5
(-\()-2.5 G(current-time-ms\) interv)-2.5 E(al\)\)\))-.25 E
(\(while \(and \(not \(deque-empty? e)92 768 Q -.15(ve)-.25 G(nts\)\))
.15 E(\(< \(deque-front e)122 780 Q -.15(ve)-.25 G(nts\) cutof).15 E
(f\)\))-.25 E(\(deque-pop-front! e)97 792 Q -.15(ve)-.25 G(nts\)\)\)).15
E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; Check if under limit)87 24 Q
(\(if \(< \(deque-length e)87 36 Q -.15(ve)-.25 G(nts\) size\)).15 E
(\(be)97 48 Q(gin)-.15 E(\(deque-push-back! e)102 60 Q -.15(ve)-.25 G
(nts \(current-time-ms\)\)).15 E(#t\))102 72 Q(#f\)\)\)\) `)97 84 Q -.74
(``)-.74 G(Leak)72 108 Q 2.5(yB)-.15 G(uck)-2.5 E(et)-.1 E -.74(```)72
132 S(scheme \(de\214ne \(mak).74 E(e-leak)-.1 E(y-b)-.15 E(uck)-.2 E
(et capacity leak-rate\))-.1 E("Leak)77 144 Q 2.5(yb)-.15 G(uck)-2.7 E
(et for smoothing b)-.1 E(ursts")-.2 E(\(let \(\(le)77 156 Q -.15(ve)
-.25 G 2.5(l0).15 G(\))-2.5 E(\(last-leak \(current-time-ms\)\)\))92 168
Q(\(lambda \(amount\))82 192 Q(;; Leak based on elapsed time)87 204 Q
(\(let* \(\(no)87 216 Q 2.5(w\()-.25 G(current-time-ms\)\))-2.5 E
(\(elapsed \(- no)104.5 228 Q 2.5(wl)-.25 G(ast-leak\)\))-2.5 E(\(leak)
104.5 240 Q(ed \(* leak-rate \(/ elapsed 1000\)\)\)\))-.1 E(\(set! le)92
252 Q -.15(ve)-.25 G 2.5(l\().15 G(max 0 \(- le)-2.5 E -.15(ve)-.25 G
2.5(ll).15 G(eak)-2.5 E(ed\)\)\))-.1 E(\(set! last-leak no)92 264 Q(w\))
-.25 E(;; T)92 288 Q(ry to add to b)-.35 E(uck)-.2 E(et)-.1 E
(\(if \(<= \(+ le)92 300 Q -.15(ve)-.25 G 2.5(la).15 G
(mount\) capacity\))-2.5 E(\(be)102 312 Q(gin)-.15 E(\(set! le)107 324 Q
-.15(ve)-.25 G 2.5(l\().15 G 2.5(+l)-2.5 G -2.15 -.25(ev e)-2.5 H 2.5
(la).25 G(mount\)\))-2.5 E(#t\))107 336 Q(#f\)\)\)\)\) `)102 348 Q -.74
(``)-.74 G(---)72 372 Q(Quota System)72 396 Q(Quota T)72 420 Q(ypes)-.8
E -.74(```)72 444 S(scheme \(de\214ne quota-types).74 E
('\(\(storage . \(\(unit . bytes\))77 456 Q(\(period . #f\))112 468 Q
2.5(;N)25 G 2.5(or)-2.5 G(eset)-2.5 E(\(def)112 480 Q
(ault . 10737418240\)\)\) ; 10GB)-.1 E(\(bandwidth . \(\(unit . bytes\))
82 504 Q(\(period . monthly\))117 516 Q(\(def)117 528 Q
(ault . 107374182400\)\)\) ; 100GB/month)-.1 E
(\(requests . \(\(unit . count\))82 552 Q(\(period . daily\))114.5 564 Q
(\(def)114.5 576 Q(ault . 100000\)\)\))-.1 E 2.5(;1)10 G(00k/day)-2.5 E
(\(objects . \(\(unit . count\))82 600 Q(\(period . #f\))112 612 Q
(\(def)112 624 Q(ault . 1000000\)\)\)\)\))-.1 E 2.5(;1)5 G 2.5(Mo)-2.5 G
(bjects `)-2.5 E -.74(``)-.74 G(Quota T)72 648 Q(racking)-.35 E -.74
(```)72 672 S(scheme \(de\214ne principal-quotas \(mak).74 E
(e-hash-table\)\))-.1 E(\(de\214ne \(get-quota principal quota-type\))72
696 Q("Get principal')77 708 Q 2.5(sq)-.55 G(uota for type")-2.5 E(\(le\
t \(\(quotas \(hash-table-ref principal-quotas principal '\(\)\)\)\))77
720 Q(\(or \(assoc-ref quotas quota-type\))82 732 Q
(\(assoc-ref quota-types quota-type ')92 744 Q(def)-.5 E(ault\)\)\)\))
-.1 E(\(de\214ne \(get-usage principal quota-type\))72 768 Q
("Get principal')77 780 Q 2.5(sc)-.55 G(urrent usage")-2.5 E
(\(let \(\(period \(quota-period quota-type\)\)\))77 792 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(soup-aggre)82 12 Q -.05(ga)-.15 G(te).05 E
(where: \(and \(type: 'usage-record\))87 24 Q(\(principal: principal\))
117 36 Q(\(quota-type: quota-type\))117 48 Q(\(if period)117 60 Q
(\(timestamp: \(> \(period-start period\)\)\))127 72 Q(#t\)\))127 84 Q
(aggre)87 96 Q -.05(ga)-.15 G(te: \(sum 'amount\)\)\)\)).05 E
(\(de\214ne \(check-quota principal quota-type amount\))72 120 Q
("Check if operation w)77 132 Q(ould e)-.1 E(xceed quota")-.15 E
(\(let \(\(quota \(get-quota principal quota-type\)\))77 144 Q
(\(usage \(get-usage principal quota-type\)\)\))92 156 Q
(\(<= \(+ usage amount\) quota\)\)\) `)82 168 Q -.74(``)-.74 G
(Quota Enforcement)72 192 Q -.74(```)72 216 S
(scheme \(de\214ne \(enforce-quota principal quota-type amount\)).74 E
("Enforce quota, raise error if e)77 228 Q(xceeded")-.15 E
(\(unless \(check-quota principal quota-type amount\))77 240 Q
(\(let \(\(quota \(get-quota principal quota-type\)\))82 252 Q
(\(usage \(get-usage principal quota-type\)\)\))97 264 Q
(\(audit-append action: 'quota-e)87 276 Q(xceeded)-.15 E
(principal: principal)122 288 Q(quota-type: quota-type)122 300 Q
(quota: quota)122 312 Q(usage: usage)122 324 Q(requested: amount\))122
336 Q(\(error 'quota-e)87 348 Q(xceeded)-.15 E
(`\(\(type . ,quota-type\))104.5 360 Q(\(quota . ,quota\))109.5 372 Q
(\(usage . ,usage\))109.5 384 Q(\(requested . ,amount\)\)\)\)\)\))109.5
396 Q(\(de\214ne \(record-usage principal quota-type amount\))72 420 Q
("Record quota usage")77 432 Q(\(soup-put)77 444 Q
(`\(\(type . usage-record\))82 456 Q(\(principal . ,principal\))87 468 Q
(\(quota-type . ,quota-type\))87 480 Q(\(amount . ,amount\))87 492 Q
(\(timestamp . ,\(current-time\)\)\)\)\) `)87 504 Q -.74(``)-.74 G(---)
72 528 Q(Principal-Based Limits)72 552 Q(Limit T)72 576 Q(iers)-.35 E
-.74(```)72 600 S(scheme \(de\214ne limit-tiers).74 E('\(\(anon)77 612 Q
(ymous . \(\(requests-per)-.15 E(-second . 10\))-.2 E
(\(storage-bytes . 0\))117 624 Q(\(bandwidth-bytes . 1073741824\)\)\))
117 636 Q(\(authenticated . \(\(requests-per)82 660 Q(-second . 100\))
-.2 E(\(storage-bytes . 10737418240\))127 672 Q
(\(bandwidth-bytes . 107374182400\)\)\))127 684 Q
(\(premium . \(\(requests-per)82 708 Q(-second . 1000\))-.2 E
(\(storage-bytes . 1099511627776\))112 720 Q
(\(bandwidth-bytes . 10995116277760\)\)\))112 732 Q
(\(admin . \(\(requests-per)82 756 Q(-second . #f\))-.2 E 2.5(;U)5 G
(nlimited)-2.5 E(\(storage-bytes . #f\))107 768 Q
(\(bandwidth-bytes . #f\)\)\)\)\))107 780 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne \(principal-tier principal\))72 12 Q
("Determine principal')77 24 Q 2.5(sl)-.55 G(imit tier")-2.5 E(\(cond)77
36 Q(\(\(admin-principal? principal\) 'admin\))82 48 Q
(\(\(premium-principal? principal\) 'premium\))82 60 Q
(\(\(authenticated? principal\) 'authenticated\))82 72 Q(\(else 'anon)82
84 Q(ymous\)\)\) `)-.15 E -.74(``)-.74 G(Per)72 108 Q
(-Principal Limiters)-.2 E -.74(```)72 132 S
(scheme \(de\214ne principal-limiters \(mak).74 E(e-hash-table\)\))-.1 E
(\(de\214ne \(get-limiter principal\))72 156 Q
("Get or create rate limiter for principal")77 168 Q
(\(or \(hash-table-ref principal-limiters principal #f\))77 180 Q
(\(let* \(\(tier \(principal-tier principal\)\))87 192 Q
(\(rps \(assoc-ref \(assoc-ref limit-tiers tier\))104.5 204 Q -.5('r)142
216 S(equests-per).5 E(-second\)\)\))-.2 E(\(if rps)92 228 Q
(\(let \(\(limiter \(mak)102 240 Q(e-tok)-.1 E(en-b)-.1 E(uck)-.2 E
(et \(* rps 2\) rps\)\)\))-.1 E
(\(hash-table-set! principal-limiters principal limiter\))107 252 Q
(limiter\))107 264 Q(\(lambda \(_\) #t\)\)\)\)\))102 276 Q 2.5(;U)5 G
(nlimited)-2.5 E(\(de\214ne \(rate-limit-principal principal\))72 300 Q
("Apply rate limit to principal")77 312 Q
(\(let \(\(limiter \(get-limiter principal\)\)\))77 324 Q
(\(unless \(limiter 1\))82 336 Q(\(audit-append action: ')87 348 Q
(rate-limited principal: principal\))-.5 E(\(error ')87 360 Q
(rate-limited\)\)\)\) `)-.5 E -.74(``)-.74 G(Capability-Based Limits)72
384 Q -.74(```)72 408 S
(scheme ;; Capabilities can include rate limits \(spki-cert).74 E
(\(issuer v)77 420 Q(ault-admin\))-.25 E(\(subject api-client\))77 432 Q
(\(capability)77 444 Q(\(action read\))82 456 Q(\(object v)82 468 Q
(ault-content\))-.25 E(\(rate-limit)82 480 Q(\(requests-per)87 492 Q
(-second 50\))-.2 E(\(b)87 504 Q(urst 100\)\)\))-.2 E(\(v)77 516 Q
(alidity \(not-after "2027-01-01"\)\)\))-.25 E
(\(de\214ne \(capability-rate-limit cap\))72 540 Q
("Extract rate limit from capability")77 552 Q(\(assoc-ref cap ')77 564
Q(rate-limit\)\) `)-.5 E -.74(``)-.74 G(---)72 588 Q
(Resource-Speci\214c Limits)72 612 Q(Storage Limits)72 636 Q -.74(```)72
660 S(scheme \(de\214ne \(enforce-storage-limit principal size\)).74 E
("Enforce storage quota before write")77 672 Q
(\(let* \(\(quota \(get-quota principal ')77 684 Q(storage\)\))-.55 E
(\(used \(principal-storage-used principal\)\)\))94.5 696 Q
(\(when \(and quota \(> \(+ used size\) quota\)\))82 708 Q(\(error ')87
720 Q(storage-quota-e)-.55 E(xceeded)-.15 E(`\(\(quota . ,quota\))104.5
732 Q(\(used . ,used\))109.5 744 Q(\(requested . ,size\)\)\)\)\)\))109.5
756 Q(\(de\214ne \(principal-storage-used principal\))72 780 Q
("Calculate principal')77 792 Q 2.5(ss)-.55 G(torage usage")-2.5 E 0 Cg
EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(soup-aggre)77 12 Q -.05(ga)-.15 G(te).05 E
(where: \(o)82 24 Q(wner: principal\))-.25 E(aggre)82 36 Q -.05(ga)-.15
G(te: \(sum ').05 E(size\)\)\) `)-.55 E -.74(``)-.74 G(Bandwidth Limits)
72 60 Q -.74(```)72 84 S(scheme \(de\214ne \(enforce-bandwidth-limit pr\
incipal bytes direction\)).74 E("Enforce bandwidth quota")77 96 Q
(\(let* \(\(quota \(get-quota principal 'bandwidth\)\))77 108 Q
(\(used \(principal-bandwidth-used principal\)\)\))94.5 120 Q
(\(when \(and quota \(> \(+ used bytes\) quota\)\))82 132 Q
(\(error 'bandwidth-quota-e)87 144 Q(xceeded)-.15 E
(`\(\(quota . ,quota\))104.5 156 Q(\(used . ,used\))109.5 168 Q
(\(requested . ,bytes\))109.5 180 Q
(\(direction . ,direction\)\)\)\)\)\) `)109.5 192 Q -.74(``)-.74 G
(Connection Limits)72 216 Q -.74(```)72 240 S
(scheme \(de\214ne max-connections-per).74 E
(-principal 100\) \(de\214ne principal-connections \(mak)-.2 E
(e-hash-table\)\))-.1 E
(\(de\214ne \(enforce-connection-limit principal\))72 264 Q
("Limit concurrent connections")77 276 Q(\(let \(\(count \(hash-table-r\
ef principal-connections principal 0\)\)\))77 288 Q
(\(when \(>= count max-connections-per)82 300 Q(-principal\))-.2 E
(\(error 'connection-limit-e)87 312 Q(xceeded)-.15 E
(`\(\(limit . ,max-connections-per)104.5 324 Q(-principal\))-.2 E
(\(current . ,count\)\)\)\)\)\))109.5 336 Q
(\(de\214ne \(track-connection principal direction\))72 360 Q(\(let \(\
\(count \(hash-table-ref principal-connections principal 0\)\)\))77 372
Q(\(hash-table-set! principal-connections principal)82 384 Q
(\(case direction)87 396 Q(\(\(open\) \(+ count 1\)\))92 408 Q
(\(\(close\) \(max 0 \(- count 1\)\)\)\)\)\)\) `)92 420 Q -.74(``)-.74 G
(---)72 444 Q(Backpressure)72 468 Q(Request Queuing)72 492 Q -.74(```)72
516 S(scheme \(de\214ne request-queue \(mak).74 E
(e-bounded-queue 1000\)\))-.1 E(\(de\214ne \(queue-request request\))72
540 Q("Queue request with backpressure")77 552 Q
(\(if \(queue-full? request-queue\))77 564 Q(\(be)87 576 Q(gin)-.15 E
(\(audit-append action: ')92 588 Q
(request-rejected reason: 'queue-full\))-.5 E(\(error ')92 600 Q
(service-una)-.55 E -.25(va)-.2 G(ilable\)\)).25 E
(\(queue-push! request-queue request\)\)\) `)87 612 Q -.74(``)-.74 G
(Load Shedding)72 636 Q -.74(```)72 660 S
(scheme \(de\214ne \(should-shed-load?\)).74 E
("Determine if load shedding needed")77 672 Q
(\(or \(> \(cpu-usage\) 0.9\))77 684 Q(\(> \(memory-usage\) 0.9\))87 696
Q(\(> \(queue-length request-queue\) 800\)\)\))87 708 Q
(\(de\214ne \(shed-load request\))72 732 Q("Selecti)77 744 Q -.15(ve)
-.25 G(ly reject requests under load").15 E(\(cond)77 756 Q(;; Al)82 768
Q -.1(wa)-.1 G(ys allo).1 E 2.5(wa)-.25 G(dmin requests)-2.5 E
(\(\(admin-principal? \(request-principal request\)\))82 780 Q
(\(process-request request\)\))84.5 792 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; Shed lo)82 12 Q(w-priority requests)-.25 E
(\(\(and \(should-shed-load?\))82 24 Q(\(lo)97 36 Q
(w-priority-request? request\)\))-.25 E(\(audit-append action: ')84.5 48
Q(load-shed request: \(request-id request\)\))-.1 E(\(error ')84.5 60 Q
(service-una)-.55 E -.25(va)-.2 G(ilable\)\)).25 E(\(else)82 72 Q
(\(process-request request\)\)\)\) `)84.5 84 Q -.74(``)-.74 G
(Retry-After)72 108 Q -.74(```)72 132 S
(scheme \(de\214ne \(rate-limit-response retry-after\)).74 E
("Generate rate limit response")77 144 Q(`\(\(status . 429\))77 156 Q
(\(headers . \(\(Retry-After . ,retry-after\))82 168 Q
(\(X-RateLimit-Limit . ,\(current-limit\)\))112 180 Q
(\(X-RateLimit-Remaining . ,\(remaining-tok)112 192 Q(ens\)\))-.1 E
(\(X-RateLimit-Reset . ,\(reset-time\)\)\)\)\)\) `)112 204 Q -.74(``)
-.74 G(---)72 228 Q(Monitoring)72 252 Q(Limit Metrics)72 276 Q -.74(```)
72 300 S(scheme \(de\214ne \(record-limit-metrics\)).74 E
("Record rate limiting metrics")77 312 Q(\(metric-set! ')77 324 Q
(ratelimit.requests.allo)-.5 E(wed allo)-.25 E(wed-count\))-.25 E
(\(metric-set! ')77 336 Q(ratelimit.requests.denied denied-count\))-.5 E
(\(metric-set! ')77 348 Q
(ratelimit.requests.queued \(queue-length request-queue\)\))-.5 E
(\(metric-set! 'quota.storage.used total-storage-used\))77 360 Q
(\(metric-set! 'quota.storage.a)77 372 Q -.25(va)-.2 G
(ilable total-storage-a).25 E -.25(va)-.2 G(ilable\)\) `).25 E -.74(``)
-.74 G(Limit Alerts)72 396 Q -.74(```)72 420 S
(scheme \(de\214ne limit-alerts).74 E('\(\(high-rejection-rate)77 432 Q
(\(condition \(> \(/ denied-count \(+ allo)84.5 444 Q
(wed-count denied-count\)\) 0.1\)\))-.25 E(\(se)84.5 456 Q -.15(ve)-.25
G(rity w).15 E(arning\))-.1 E
(\(message "High rate limit rejection rate"\)\))84.5 468 Q(\(quota-near)
82 492 Q(-limit)-.2 E(\(condition \(> \(/ used quota\) 0.9\)\))84.5 504
Q(\(se)84.5 516 Q -.15(ve)-.25 G(rity w).15 E(arning\))-.1 E
(\(message "Principal approaching quota limit"\)\)\)\) `)84.5 528 Q -.74
(``)-.74 G(---)72 552 Q(Con\214guration)72 576 Q(Dynamic Limits)72 600 Q
-.74(```)72 624 S(scheme ;; Limits can be adjusted at runtime \(de\214n\
e \(set-limit principal limit-type v).74 E(alue\))-.25 E
("Set custom limit for principal")77 636 Q(\(soup-put)77 648 Q
(`\(\(type . principal-limit\))82 660 Q(\(principal . ,principal\))87
672 Q(\(limit-type . ,limit-type\))87 684 Q(\(v)87 696 Q(alue . ,v)-.25
E(alue\))-.25 E(\(set-by . ,\(current-principal\)\))87 708 Q
(\(set-at . ,\(current-time\)\)\))87 720 Q(type: 'con\214guration\)\))82
732 Q(\(de\214ne \(get-ef)72 756 Q(fecti)-.25 E -.15(ve)-.25 G
(-limit principal limit-type\)).15 E("Get principal')77 768 Q 2.5(se)
-.55 G -.25(ff)-2.5 G(ecti).25 E .3 -.15(ve l)-.25 H(imit").15 E
(\(or \(soup-query-one type: 'principal-limit)77 780 Q
(principal: principal)127 792 Q 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(limit-type: limit-type\))127 12 Q(\(tier)87 24 Q
(-limit \(principal-tier principal\) limit-type\)\)\) `)-.2 E -.74(``)
-.74 G(Limit Inheritance)72 48 Q -.74(```)72 72 S
(scheme ;; Groups can ha).74 E .3 -.15(ve l)-.2 H
(imits that members inherit \(de\214ne \(group-limit group limit-type\))
.15 E(\(soup-query-one type: 'group-limit)77 84 Q(group: group)117 96 Q
(limit-type: limit-type\)\))117 108 Q(\(de\214ne \(ef)72 132 Q(fecti)
-.25 E -.15(ve)-.25 G(-limit principal limit-type\)).15 E("Resolv)77 144
Q 2.5(el)-.15 G(imit with inheritance")-2.5 E(\(or \(get-ef)77 156 Q
(fecti)-.25 E -.15(ve)-.25 G(-limit principal limit-type\)).15 E
(\(let \(\(groups \(principal-groups principal\)\)\))87 168 Q
(\(\214nd \(lambda \(g\) \(group-limit g limit-type\)\) groups\)\))92
180 Q(\(def)87 192 Q(ault-limit limit-type\)\)\) `)-.1 E -.74(``)-.74 G
(---)72 216 Q(Security)72 240 Q(Limit Bypass Pre)72 264 Q -.15(ve)-.25 G
(ntion).15 E -.74(```)72 288 S(scheme ;; Pre).74 E -.15(ve)-.25 G(nt li\
mit bypass via identity rotation \(de\214ne \(track-ip-limits ip\)).15 E
("T)77 300 Q(rack limits by IP in addition to principal")-.35 E
(\(let \(\(limiter \(get-ip-limiter ip\)\)\))77 312 Q
(\(unless \(limiter 1\))82 324 Q(\(error 'ip-rate-limited\)\)\)\))87 336
Q(;; Combine principal and IP limits \(de\214ne \(combined-rate-limit p\
rincipal ip\))72 360 Q(\(and \(rate-limit-principal principal\))77 372 Q
(\(track-ip-limits ip\)\)\) `)89.5 384 Q -.74(``)-.74 G(Audit T)72 408 Q
(rail)-.35 E -.74(```)72 432 S(scheme \(de\214ne \(audit-limit-e).74 E
-.15(ve)-.25 G(nt e).15 E -.15(ve)-.25 G(nt-type principal details\)).15
E(\(audit-append)77 444 Q(action: e)82 456 Q -.15(ve)-.25 G(nt-type).15
E(principal: principal)82 468 Q(details: details)82 480 Q
(timestamp: \(current-time\)\)\) `)82 492 Q -.74(``)-.74 G(---)72 516 Q
(References)72 540 Q 10.533(1. [T)72 564 R(ok)-.8 E 10.533(en Buck)-.1 F
10.533(et Algorithm]\(https://en.wikipedia.or)-.1 F(g/wiki/T)-.18 E(ok)
-.8 E(en_b)-.1 E(uck)-.2 E 10.533(et\) 2. [Leak)-.1 F 13.033(yB)-.15 G
(uck)-13.033 E 10.532(et Algo-)-.1 F(rithm]\(https://en.wikipedia.or)72
576 Q(g/wiki/Leak)-.18 E(y_b)-.15 E(uck)-.2 E 1.092
(et\) 3. [RFC-021: Capability Dele)-.1 F -.05(ga)-.15 G
(tion]\(rfc-021-capability-dele).05 E -.05(ga)-.15 G(-).05 E
(tion.md\) 4. [RFC-031: Monitoring]\(rfc-031-monitoring.md\))72 588 Q
(---)72 612 Q(Changelog)72 636 Q 2.5(-*)72 660 S
(*2026-01-07** - Initial draft)-2.5 E(---)72 684 Q 1.008(**Implementati\
on Status:** Draft **Dependencies:** soup, spki, monitoring **Inte)72
708 R 1.008(gration:** API layer)-.15 F 3.508(,n)-.4 G(etw)-3.508 E(ork)
-.1 E(protocol, resource management)72 720 Q 0 Cg EP
%%Trailer
end
%%EOF
