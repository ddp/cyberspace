%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 7
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-025: Soup Query Language)72 12 Q 1.95(**Sta\
tus:** Draft **Date:** January 2026 **Author:** Derrell Piper <ddp@elud\
om.net> **Implementation:**)72 36 R(Proposed)72 48 Q(---)72 72 Q
(Abstract)72 96 Q .162(This RFC speci\214es the query language for the \
Library of Cyberspace soup: ho)72 120 R 2.662(wp)-.25 G .162
(rincipals search, \214lter)-2.662 F 2.662(,a)-.4 G .162(nd retrie)
-2.662 F -.15(ve)-.25 G 1.276
(objects from the content-addressed store using the rich metadata layer)
72 132 R 3.776(.Q)-.55 G 1.276(ueries are themselv)-3.776 F 1.276
(es content-addressed)-.15 F(and auditable.)72 144 Q(---)72 168 Q(Moti)
72 192 Q -.25(va)-.25 G(tion).25 E(The soup contains in\214nite metadat\
a. Finding needles requires a query language that is:)72 216 Q 2.851(-*)
72 240 S(*Expressi)-2.851 E -.15(ve)-.25 G .351(** - Comple).15 F 2.851
(xp)-.15 G .351(redicates, joins across objects - **Ef)-2.851 F .351
(\214cient** - Inde)-.25 F -.15(xe)-.15 G .352
(s, bloom \214lters, query planning).15 F 2.5(-*)72 252 S(*Secure** - Q\
ueries respect capability boundaries - **Auditable** - Query patterns r\
e)-2.5 E -.15(ve)-.25 G(al access patterns).15 E(Ne)72 276 Q(wton')-.25
E 2.5(ss)-.55 G(oup had cursor)-2.5 E(-based queries. W)-.2 E 2.5(ee)-.8
G(xtend this with content-addressed semantics.)-2.65 E(---)72 300 Q
(Query Model)72 324 Q(Basic Queries)72 348 Q -.74(```)72 372 S
(scheme ;; Find by type \(soup-query type: ').74 E(document\))-.5 E
(;; Find by attrib)72 396 Q(ute \(soup-query author: "alice@e)-.2 E
(xample.com"\))-.15 E(;; Find by multiple attrib)72 420 Q
(utes \(AND\) \(soup-query type: ')-.2 E(document)-.5 E
(author: "alice@e)102 432 Q(xample.com")-.15 E
(created-after: "2026-01-01"\))102 444 Q
(;; Find by content hash \(soup-query hash: "sha256:7f83b1657f)72 468 Q
2.5(f1fc..."\) `)-.25 F -.74(``)-.74 G(Query Results)72 492 Q -.74(```)
72 516 S(scheme ;; Results are lazy cursors \(de\214ne results \(soup-q\
uery type: ').74 E(document\)\))-.5 E .154(;; Iterate \(soup-cursor)72
540 R(-ne)-.2 E .154(xt results\))-.15 F 2.654(;=)10.154 G 2.654(>s)
-2.654 G .154(oup-object or #f \(soup-cursor)-2.654 F .154
(-peek results\))-.2 F 2.654(;=)10.154 G 2.654(>n)-2.654 G -.15(ex)
-2.654 G 2.654(tw).15 G .154(ithout adv)-2.654 F(ancing)-.25 E
(\(soup-cursor)72 552 Q(-reset results\))-.2 E 2.5(;=)7.5 G 2.5(>b)-2.5
G(ack to be)-2.5 E(ginning)-.15 E .578(;; Collect \(careful with lar)72
576 R .579(ge result sets\) \(soup-cursor)-.18 F .579(->list results\))
-.2 F 3.079(;=)8.079 G 3.079(>l)-3.079 G .579
(ist of soup-objects \(soup-cursor)-3.079 F .579(-count re-)-.2 F 5
(sults\) ;)72 588 R(=> total count `)2.5 E -.74(``)-.74 G(Predicates)72
612 Q -.74(```)72 636 S .566
(scheme ;; Comparison operators \(soup-query size: \(> 1000000\)\)).74 F
3.066(;l)28.066 G(ar)-3.066 E .565
(ger than 1MB \(soup-query created: \(<)-.18 F 5.551("2025-01-01"\)\) ;)
72 648 R .551(before 2025 \(soup-query name: \(lik)3.051 F 3.051(e")-.1
G 18.051(rfc-*"\)\) ;)-3.051 F .552
(glob pattern \(soup-query tags: \(contains "ur)3.052 F(-)-.2 E 5
(gent"\)\) ;)72 660 R(list membership)2.5 E
(;; Logical operators \(soup-query \(and \(type: ')72 684 Q(document\))
-.5 E(\(or \(author: "alice"\))114.5 696 Q(\(author: "bob"\)\)\)\))124.5
708 Q(;; Ne)72 732 Q -.05(ga)-.15 G(tion \(soup-query \(not \(type: ')
.05 E(tombstone\)\)\))-.18 E .915(;; Existence \(soup-query \(e)72 756 R
.915(xists 'encryption-k)-.15 F -.15(ey)-.1 G 8.415(\)\) ;).15 F .915
(has attrib)3.415 F .914(ute \(soup-query \(missing 'e)-.2 F 23.414
(xpires\)\) ;)-.15 F .914(lacks at-)3.414 F(trib)72 768 Q(ute `)-.2 E
-.74(``)-.74 G(---)72 792 Q 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Adv)72 24 Q(anced Queries)-.25 E(Range Queries)
72 48 Q -.74(```)72 72 S
(scheme ;; Numeric ranges \(soup-query size: \(between 1000 10000\)\))
.74 E(;; Date ranges \(soup-query created: \(between "2026-01-01" "2026\
-12-31"\)\))72 96 Q(;; Le)72 120 Q(xicographic ranges \(soup-query name\
: \(between "rfc-010" "rfc-020"\)\) `)-.15 E -.74(``)-.74 G(Full-T)72
144 Q -.15(ex)-.7 G 2.5(tS).15 G(earch)-2.5 E -.74(```)72 168 S
(scheme ;; Search inde).74 E -.15(xe)-.15 G 2.5(dc).15 G
(ontent \(soup-query \(te)-2.5 E(xt-search "capability dele)-.15 E -.05
(ga)-.15 G(tion"\)\)).05 E(;; W)72 192 Q
(ith highlighting \(soup-query \(te)-.4 E
(xt-search "SPKI certi\214cate"\))-.15 E(highlight: #t\))102 204 Q
(;; Phrase search \(soup-query \(te)72 228 Q(xt-search ")-.15 E
(;; Fuzzy search \(soup-query \(te)72 252 Q(xt-search "delg)-.15 E 2.5
(ation~"\)\) ;)-.05 F(typo-tolerant `)2.5 E -.74(``)-.74 G(Reference T)
72 276 Q(ra)-.35 E -.15(ve)-.2 G(rsal).15 E -.74(```)72 300 S(scheme ;;\
 Objects referencing this hash \(soup-query references: "sha256:tar).74
E(get..."\))-.18 E(;; Objects referenced by this hash \(soup-query refe\
renced-by: "sha256:source..."\))72 324 Q(;; T)72 348 Q(ransiti)-.35 E .3
-.15(ve c)-.25 H
(losure \(careful - can be huge\) \(soup-query \(transiti).15 E -.15(ve)
-.25 G(-references "sha256:root..."\)).15 E(max-depth: 3\) `)102 360 Q
-.74(``)-.74 G -.7(Te)72 384 S(mporal Queries).7 E -.74(```)72 408 S
(scheme ;; Objects as the).74 E 2.5(ye)-.15 G
(xisted at a point in time \(soup-query type: ')-2.65 E(document)-.5 E
(as-of: "2026-01-01T00:00:00Z"\))102 420 Q
(;; Objects modi\214ed in time windo)72 444 Q 2.5(w\()-.25 G
(soup-query modi\214ed: \(between "2026-01-01" "2026-01-07"\)\))-2.5 E
(;; V)72 468 Q(ersion history \(soup-query \(v)-1.11 E
(ersions-of "sha256:current..."\)\))-.15 E -.74(```)5 G(---)72 492 Q
(Query Composition)72 516 Q(Subqueries)72 540 Q -.74(```)72 564 S(schem\
e ;; Objects authored by members of a group \(soup-query author: \(soup\
-query type: 'principal).74 E(member)152 576 Q(-of: "engineering"\)\))
-.2 E(;; Documents referencing an)72 600 Q 2.5(yR)-.15 G
(FC \(soup-query type: ')-2.5 E(document)-.5 E
(references: \(soup-query name: \(lik)102 612 Q 2.5(e")-.1 G
(rfc-*"\)\)\) `)-2.5 E -.74(``)-.74 G(Aggre)72 636 Q -.05(ga)-.15 G
(tion).05 E -.74(```)72 660 S(scheme ;; Count by type \(soup-aggre).74 E
-.05(ga)-.15 G(te).05 E(group-by: ')77 672 Q(type)-.18 E(aggre)77 684 Q
-.05(ga)-.15 G(te: \(count\)\)).05 E(;; T)72 708 Q
(otal size by author \(soup-aggre)-.8 E -.05(ga)-.15 G(te).05 E
(group-by: 'author)77 720 Q(aggre)77 732 Q -.05(ga)-.15 G(te: \(sum ')
.05 E(size\)\))-.55 E(;; A)72 756 Q -.15(ve)-.74 G
(rage document size \(soup-aggre).15 E -.05(ga)-.15 G(te).05 E
(where: \(type: ')77 768 Q(document\))-.5 E(aggre)77 780 Q -.05(ga)-.15
G(te: \(a).05 E(vg ')-.2 E(size\)\))-.55 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; Distinct v)72 12 Q(alues \(soup-aggre)-.25 E
-.05(ga)-.15 G(te).05 E(aggre)77 24 Q -.05(ga)-.15 G
(te: \(distinct 'content-type\)\) `).05 E -.74(``)-.74 G(Ordering and P)
72 48 Q(agination)-.15 E -.74(```)72 72 S
(scheme ;; Sort by creation date, ne).74 E
(west \214rst \(soup-query type: ')-.25 E(document)-.5 E(order)102 84 Q
(-by: '\(\(created desc\)\)\))-.2 E
(;; Multi-column sort \(soup-query type: ')72 108 Q(document)-.5 E
(order)102 120 Q(-by: '\(\(author asc\) \(created desc\)\)\))-.2 E(;; P)
72 144 Q(agination \(soup-query type: ')-.15 E(document)-.5 E(order)102
156 Q(-by: '\(\(created desc\)\))-.2 E(limit: 20)102 168 Q(of)102 180 Q
(fset: 40\))-.25 E(;; Cursor)72 204 Q(-based pagination \(more ef)-.2 E
(\214cient\) \(soup-query type: ')-.25 E(document)-.5 E(order)102 216 Q
(-by: '\(\(created desc\)\))-.2 E(after: "sha256:last-seen..."\))102 228
Q -.74(```)5 G(---)72 252 Q(Capability-A)72 276 Q -.1(wa)-.92 G
(re Queries).1 E(Query Filtering)72 300 Q(Queries automatically \214lte\
r results based on the querying principal')72 324 Q 2.5(sc)-.55 G
(apabilities:)-2.5 E -.74(```)72 348 S
(scheme \(de\214ne \(soup-query-with-caps query principal\)).74 E("Ex)77
360 Q(ecute query \214ltered by principal')-.15 E 2.5(sc)-.55 G
(apabilities")-2.5 E(\(let* \(\(ra)77 372 Q(w-results \(e)-.15 E -.15
(xe)-.15 G(cute-query query\)\)).15 E
(\(caps \(principal-capabilities principal\)\)\))94.5 384 Q
(\(\214lter \(lambda \(obj\))82 396 Q
(\(can-read? principal obj caps\)\))107 408 Q(ra)102 420 Q
(w-results\)\)\) `)-.15 E -.74(``)-.74 G(Capability Queries)72 444 Q
-.74(```)72 468 S(scheme ;; What can I access?).74 E
(\(soup-query \(accessible-by \(current-principal\)\)\))5 E
(;; Who can access this?)72 492 Q(\(soup-query type: 'certi\214cate)5 E
(grants-access-to: "sha256:tar)102 504 Q(get..."\))-.18 E
(;; Find my capabilities \(soup-query type: 'certi\214cate)72 528 Q
(subject: \(current-principal\)\) `)102 540 Q -.74(``)-.74 G
(Query Authorization)72 564 Q -.74(```)72 588 S
(scheme ;; Some queries require e).74 E
(xplicit capability \(soup-query type: 'audit-log\))-.15 E 2.5(;r)5 G
(equires audit-read capability)-2.5 E
(;; Query capability certi\214cate \(spki-cert)72 612 Q(\(issuer v)77
624 Q(ault-admin\))-.25 E(\(subject auditor)77 636 Q(-k)-.2 E -.15(ey)
-.1 G(\)).15 E(\(capability)77 648 Q(\(action query\))82 660 Q
(\(object \(type 'audit-log\)\)\))82 672 Q(\(v)77 684 Q
(alidity \(not-after "2027-01-01"\)\)\) `)-.25 E -.74(``)-.74 G(---)72
708 Q(Inde)72 732 Q -.15(xe)-.15 G(s).15 E(Inde)72 756 Q 2.5(xT)-.15 G
(ypes)-3.3 E -.74(```)72 780 S(scheme ;; B-tree inde).74 E 2.5(x\()-.15
G(ordered, range queries\) \(de\214ne-inde)-2.5 E 2.5(x')-.15 G
(created-idx)-2.5 E(type: 'btree)77 792 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(on: 'created\))77 12 Q(;; Hash inde)72 36 Q 2.5
(x\()-.15 G(equality only)-2.5 E 2.5(,f)-.65 G(aster\) \(de\214ne-inde)
-2.6 E 2.5(x')-.15 G(hash-idx)-2.5 E(type: 'hash)77 48 Q
(on: 'content-hash\))77 60 Q(;; Full-te)72 84 Q(xt inde)-.15 E 2.5(x\()
-.15 G(search\) \(de\214ne-inde)-2.5 E 2.5(x')-.15 G(content-idx)-2.5 E
(type: 'fullte)77 96 Q(xt)-.15 E(on: 'content)77 108 Q
(language: 'english\))77 120 Q(;; Composite inde)72 144 Q 2.5(x\()-.15 G
(de\214ne-inde)-2.5 E 2.5(x')-.15 G(author)-2.5 E(-date-idx)-.2 E
(type: 'btree)77 156 Q(on: '\(author created\)\))77 168 Q
(;; Bloom \214lter inde)72 192 Q 2.5(x\()-.15 G
(membership testing\) \(de\214ne-inde)-2.5 E 2.5(x')-.15 G(tags-bloom)
-2.68 E(type: 'bloom)77 204 Q(on: ')77 216 Q(tags)-.18 E -.1(fa)77 228 S
(lse-positi).1 E -.15(ve)-.25 G(-rate: 0.01\) `).15 E -.74(``)-.74 G
(Inde)72 252 Q 2.5(xS)-.15 G(election)-2.5 E -.74(```)72 276 S
(scheme \(de\214ne \(plan-query query inde).74 E -.15(xe)-.15 G(s\)).15
E("Select best inde)77 288 Q 2.5(xf)-.15 G(or query")-2.5 E
(\(let \(\(predicates \(query-predicates query\)\)\))77 300 Q
(\(\214nd \(lambda \(idx\))82 312 Q(\(inde)102 324 Q(x-co)-.15 E -.15
(ve)-.15 G(rs? idx predicates\)\)).15 E(\(sort inde)97 336 Q -.15(xe)
-.15 G 2.5(si).15 G(nde)-2.5 E(x-selecti)-.15 E(vity>\)\)\)\) `)-.25 E
-.74(``)-.74 G(Inde)72 360 Q 2.5(xM)-.15 G(aintenance)-2.5 E -.74(```)72
384 S(scheme ;; Inde).74 E -.15(xe)-.15 G 2.5(sa).15 G
(re updated on soup-put \(de\214ne \(soup-put-inde)-2.5 E -.15(xe)-.15 G
2.5(do).15 G(bj\))-2.5 E(\(let \(\(hash \(soup-put obj\)\)\))77 396 Q
(\(for)82 408 Q(-each \(lambda \(idx\))-.2 E(\(inde)112 420 Q
(x-insert! idx obj hash\)\))-.15 E(\(applicable-inde)107 432 Q -.15(xe)
-.15 G 2.5(so).15 G(bj\)\))-2.5 E(hash\)\))82 444 Q(;; Periodic inde)72
468 Q 2.5(xo)-.15 G(ptimization \(de\214ne \(optimize-inde)-2.5 E -.15
(xe)-.15 G(s\)).15 E(\(for)77 480 Q(-each inde)-.2 E
(x-compact! \(all-inde)-.15 E -.15(xe)-.15 G(s\)\)\) `).15 E -.74(``)
-.74 G(---)72 504 Q(Query Ex)72 528 Q(ecution)-.15 E(Query Planning)72
552 Q -.74(```)72 576 S(scheme \(de\214ne \(e).74 E -.15(xe)-.15 G
(cute-query query\)).15 E("Plan and e)77 588 Q -.15(xe)-.15 G
(cute query").15 E(\(let* \(\(plan \(plan-query query\)\))77 600 Q
(\(cost \(estimate-cost plan\)\)\))94.5 612 Q
(\(when \(> cost *query-cost-limit*\))82 624 Q(\(error "Query too e)87
636 Q(xpensi)-.15 E -.15(ve)-.25 G 2.5("c).15 G(ost\)\))-2.5 E(\(e)82
648 Q -.15(xe)-.15 G(cute-plan plan\)\)\)).15 E
(\(de\214ne \(plan-query query\))72 672 Q("Generate query e)77 684 Q
-.15(xe)-.15 G(cution plan").15 E(`\(query-plan)77 696 Q
(\(predicates ,\(query-predicates query\)\))82 708 Q(\(inde)82 720 Q 2.5
(x,)-.15 G(\(select-inde)-2.5 E 2.5(xq)-.15 G(uery\)\))-2.5 E
(\(\214lter ,\(remaining-predicates query\)\))82 732 Q
(\(order ,\(query-order query\)\))82 744 Q
(\(limit ,\(query-limit query\)\)\)\) `)82 756 Q -.74(``)-.74 G(Ex)72
780 Q(ecution Strate)-.15 E(gies)-.15 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.74(```)72 12 S(scheme ;; Inde).74 E 2.5(xs)
-.15 G(can \(de\214ne \(inde)-2.5 E(x-scan inde)-.15 E 2.5(xp)-.15 G
(redicate\))-2.5 E(\(inde)77 24 Q(x-range-query inde)-.15 E(x)-.15 E
(\(predicate-lo)124.5 36 Q(wer)-.25 E(-bound predicate\))-.2 E
(\(predicate-upper)124.5 48 Q(-bound predicate\)\)\))-.2 E
(;; Full scan \(last resort\) \(de\214ne \(full-scan predicate\))72 72 Q
(\(\214lter predicate \(all-soup-objects\)\)\))77 84 Q(;; Inde)72 108 Q
2.5(xi)-.15 G(ntersection \(de\214ne \(inde)-2.5 E
(x-intersect idx1 idx2 pred1 pred2\))-.15 E(\(set-intersection)77 120 Q
(\(inde)82 132 Q(x-scan idx1 pred1\))-.15 E(\(inde)82 144 Q
(x-scan idx2 pred2\)\)\) `)-.15 E -.74(``)-.74 G(Query Caching)72 168 Q
-.74(```)72 192 S
(scheme ;; Query results can be cached \(de\214ne query-cache \(mak).74
E(e-lru-cache 1000\)\))-.1 E(\(de\214ne \(cached-query query\))72 216 Q
(\(let \(\(k)77 228 Q .3 -.15(ey \()-.1 H(query->hash query\)\)\)).15 E
(\(or \(lru-get query-cache k)82 240 Q -.15(ey)-.1 G(\)).15 E
(\(let \(\(result \(e)92 252 Q -.15(xe)-.15 G(cute-query query\)\)\)).15
E(\(lru-put! query-cache k)97 264 Q .3 -.15(ey r)-.1 H(esult\)).15 E
(result\)\)\)\))97 276 Q(;; Cache in)72 300 Q -.25(va)-.4 G
(lidation on soup changes \(de\214ne \(in).25 E -.25(va)-.4 G
(lidate-query-cache obj\)).25 E(\(let \(\(af)77 312 Q
(fected \(queries-af)-.25 E(fected-by obj\)\)\))-.25 E(\(for)82 324 Q
(-each \(lambda \(q\))-.2 E(\(lru-remo)112 336 Q -.15(ve)-.15 G 2.5(!q)
.15 G(uery-cache \(query->hash q\)\)\))-2.5 E(af)107 348 Q
(fected\)\)\) `)-.25 E -.74(``)-.74 G(---)72 372 Q(Distrib)72 396 Q
(uted Queries)-.2 E(Federated Query)72 420 Q -.74(```)72 444 S
(scheme ;; Query across multiple v).74 E(aults \(soup-query type: ')-.25
E(document)-.5 E(federation: '\(v)102 456 Q(ault-a v)-.25 E(ault-b v)
-.25 E(ault-c\)\))-.25 E
(;; Query with locality preference \(soup-query type: ')72 480 Q
(document)-.5 E(prefer)102 492 Q(-local: #t\) `)-.2 E -.74(``)-.74 G
(Query Routing)72 516 Q -.74(```)72 540 S
(scheme \(de\214ne \(route-query query v).74 E(aults\))-.25 E
("Route query to appropriate v)77 552 Q(aults")-.25 E
(\(let \(\(partitions \(query-partitions query\)\)\))77 564 Q
(\(map \(lambda \(v)82 576 Q(ault\))-.25 E(\(list v)99.5 588 Q
(ault \(subquery-for)-.25 E(-v)-.2 E(ault query v)-.25 E(ault\)\)\))-.25
E(\(\214lter \(lambda \(v\))94.5 600 Q(\(v)119.5 612 Q
(ault-has-partition? v partitions\)\))-.25 E -.25(va)114.5 624 S
(ults\)\)\)\) `).25 E -.74(``)-.74 G(Result Mer)72 648 Q(ging)-.18 E
-.74(```)72 672 S(scheme \(de\214ne \(mer).74 E
(ge-results results order\))-.18 E("Mer)77 684 Q
(ge sorted results from multiple v)-.18 E(aults")-.25 E
(\(let \(\(streams \(map result->stream results\)\)\))77 696 Q(\(mer)82
708 Q(ge-sorted-streams streams \(order)-.18 E
(->comparator order\)\)\)\) `)-.2 E -.74(``)-.74 G(---)72 732 Q
(Query Audit)72 756 Q(Audit T)72 780 Q(rail)-.35 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.74(```)72 12 S(scheme ;; All queries are logg\
ed \(de\214ne \(audited-query query principal\)).74 E
(\(let \(\(start \(current-time\)\))77 24 Q
(\(result \(soup-query-with-caps query principal\)\)\))92 36 Q
(\(audit-append)82 48 Q(action: 'query)87 60 Q(principal: principal)87
72 Q(query: \(query->se)87 84 Q(xp query\))-.15 E
(result-count: \(soup-cursor)87 96 Q(-count result\))-.2 E
(duration: \(- \(current-time\) start\)\))87 108 Q(result\)\) `)82 120 Q
-.74(``)-.74 G(Query Analysis)72 144 Q -.74(```)72 168 S
(scheme ;; Analyze query patterns \(soup-query type: 'audit-entry).74 E
(action: 'query)102 180 Q(principal: "alice"\))102 192 Q(;; Find e)72
216 Q(xpensi)-.15 E .3 -.15(ve q)-.25 H
(ueries \(soup-query type: 'audit-entry).15 E(action: 'query)102 228 Q
(duration: \(> 1000\)\))102 240 Q 2.5(;>1s)5 G(econd)-2.5 E
(;; Access pattern analysis \(soup-aggre)72 264 Q -.05(ga)-.15 G(te).05
E(where: \(and \(type: 'audit-entry\) \(action: 'query\)\))77 276 Q
(group-by: 'principal)77 288 Q(aggre)77 300 Q -.05(ga)-.15 G
(te: \(count\)\) `).05 E -.74(``)-.74 G(---)72 324 Q
(Query Language Grammar)72 348 Q 2.561 -.74(``` q)72 372 T 16.081
(uery ::=).74 F 1.081(\(soup-query clause*\) clause)3.581 F 1.082
(::= attrib)16.081 F 1.082
(ute-clause | predicate-clause | option-clause attrib)-.2 F 6.082
(ute ::=)-.2 F(symbol ':' v)72 384 Q(alue predicate)-.25 E
(::= '\(' op v)7.5 E(alue* '\)' op)-.25 E
(::= '>' | '<' | '>=' | '<=' | '=' | '!=')25 E 2.5(|')107 396 S(lik)-2.6
E(e' | 'between' | 'contains')-.1 E 2.5(|')107 408 S
(and' | 'or' | 'not')-2.5 E 2.5(|')107 420 S -.15(ex)-2.5 G
(ists' | 'missing').15 E 2.5(|')107 432 S(te)-2.68 E(xt-search' | ')-.15
E(references' | ')-.5 E(referenced-by' option)-.5 E(::= 'order)15 E
(-by' | ')-.2 E(limit' | 'of)-.1 E(fset' | 'after')-.25 E 2.5(|')107 444
S -1.95(as-of ')-2.5 F 2.5(|')2.5 G(highlight' | 'federation' v)-2.5 E
15(alue ::=)-.25 F(string | number | boolean | hash | query `)2.5 E -.74
(``)-.74 G(---)72 468 Q(Security Considerations)72 492 Q
(Query Injection)72 516 Q -.74(```)72 540 S(scheme ;; Ne).74 E -.15(ve)
-.25 G 2.5(ri).15 G(nterpolate user input into queries ;; B)-2.5 E
(AD: \(soup-query name: \(string-append "rfc-" user)-.35 E(-input\)\))
-.2 E(;; GOOD: \(soup-query name: \(lik)72 564 Q 2.5(e\()-.1 G
(sanitize-pattern user)-2.5 E(-input\)\)\))-.2 E
(\(de\214ne \(sanitize-pattern s\))72 588 Q(\(string-map \(lambda \(c\))
77 600 Q(\(if \(member c '\(##)112 612 Q(#\\)50 E(c\)\))122 624 Q
(s\)\) `)107 636 Q -.74(``)-.74 G(Query Cost Limits)72 660 Q -.74(```)72
684 S .704(scheme ;; Pre).74 F -.15(ve)-.25 G .703
(nt denial of service via e).15 F(xpensi)-.15 E 1.003 -.15(ve q)-.25 H
.703
(ueries \(de\214ne *query-cost-limit* 10000\) \(de\214ne *query-time-)
.15 F(out* 30\))72 696 Q 2.5(;s)5 G(econds)-2.5 E
(\(de\214ne \(safe-query query\))72 720 Q
(\(with-timeout *query-timeout*)77 732 Q
(\(let \(\(cost \(estimate-cost query\)\)\))82 744 Q
(\(when \(> cost *query-cost-limit*\))87 756 Q(\(error "Query e)92 768 Q
(xceeds cost limit"\)\))-.15 E(\(e)87 780 Q -.15(xe)-.15 G
(cute-query query\)\)\)\) `).15 E -.74(``)-.74 G 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Information Leakage)72 12 Q -.74(```)72 36 S
(scheme ;; Query e).74 E(xistence can leak information ;; Ev)-.15 E
(en "not found" re)-.15 E -.15(ve)-.25 G(als something).15 E
(;; Use constant-time responses for sensiti)72 60 Q .3 -.15(ve q)-.25 H
(ueries \(de\214ne \(pri).15 E -.25(va)-.25 G(te-query query\)).25 E
(\(let \(\(result \(soup-query query\)\)\))77 72 Q
(\(if \(authorized? \(current-principal\) result\))82 84 Q(result)92 96
Q(\(constant-time-not-found\)\)\)\) `)92 108 Q -.74(``)-.74 G(---)72 132
Q(Implementation Notes)72 156 Q(Performance)72 180 Q 2.697(-I)72 204 S
(nde)-2.697 E 2.697(xs)-.15 G .197(election is critical for lar)-2.697 F
.197(ge soups - Bloom \214lters for f)-.18 F .197(ast ne)-.1 F -.05(ga)
-.15 G(ti).05 E .497 -.15(ve l)-.25 H .197
(ookups - Query result streaming to a).15 F -.2(vo)-.2 G(id).2 E
(memory e)72 216 Q(xhaustion - Connection pooling for federated queries)
-.15 E(Compatibility)72 240 Q 3.276(-Q)72 264 S .776
(uery language inspired by Ne)-3.276 F(wton')-.25 E 3.276(ss)-.55 G .776
(oup cursors - SQL-lik)-3.276 F 3.276(es)-.1 G .776
(emantics where applicable - S-e)-3.276 F .776(xpression syntax)-.15 F
(for Scheme inte)72 276 Q(gration)-.15 E(---)72 300 Q(References)72 324
Q .275(1. [Ne)72 348 R .275(wton Programmer')-.25 F 2.775(sG)-.55 G
(uide]\(https://www)-2.775 E(.ne)-.65 E(wtonresearch.or)-.25 E .275
(g/\) - Soup and cursor APIs 2. [SQLite Query Plan-)-.18 F
(ner]\(https://sqlite.or)72 360 Q(g/queryplanner)-.18 E 8.581
(.html\) - Query optimization 3. [RFC-020: Content-Addressed Stor)-.55 F
(-)-.2 E(age]\(rfc-020-content-addressed-storage.md\) 4. [RFC-021: Capa\
bility Dele)72 372 Q -.05(ga)-.15 G(tion]\(rfc-021-capability-dele).05 E
-.05(ga)-.15 G(tion.md\)).05 E(---)72 396 Q(Changelog)72 420 Q 2.5(-*)72
444 S(*2026-01-07** - Initial draft)-2.5 E(---)72 468 Q .166(**Implemen\
tation Status:** Draft **Dependencies:** soup, cas, spki **Inte)72 492 R
.167(gration:** V)-.15 F .167(ault queries, federation, au-)-1.11 F
(dit trail)72 504 Q 0 Cg EP
%%Trailer
end
%%EOF
