%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Thu Jan  8 15:17:54 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 8
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-034: Audit Log Protection)72 12 Q(Status: D\
raft Date: January 2026 Author: Derrell Piper ddp@eludom.net Implementa\
tion: Proposed)72 36 Q(------------------------------------------------\
------------------------------)72 60 Q(Abstract)72 84 Q 1.308(This RFC \
speci\214es protection mechanisms for the Library of Cyberspace audit l\
og: ho)72 108 R 3.808(wt)-.25 G 1.308(he system pre)-3.808 F -.15(ve)
-.25 G 1.308(nts re-).15 F .215(source e)72 120 R .216
(xhaustion, log \215ooding, and denial of service attacks ag)-.15 F .216
(ainst the audit trail while maintaining its inte)-.05 F .216(grity as)
-.15 F(the authoritati)72 132 Q .3 -.15(ve r)-.25 H(ecord of all v).15 E
(ault operations.)-.25 E(----------------------------------------------\
--------------------------------)72 156 Q(Moti)72 180 Q -.25(va)-.25 G
(tion).25 E(The audit log is sacred:)72 204 Q 3.203(-E)72 228 S .703
(vidence - Le)-3.203 F -.05(ga)-.15 G 3.203(la).05 G .703
(nd forensic record - Accountability - Who did what when - Reco)-3.203 F
-.15(ve)-.15 G .702(ry - Reconstruct state after).15 F -.1(fa)72 240 S
(ilure - T).1 E(rust - F)-.35 E(oundation of the security model)-.15 E
(But the audit log is also a tar)72 264 Q(get:)-.18 E 2.695(-F)72 288 S
.195(looding - Generate noise to hide malicious acti)-2.695 F .195
(vity - Exhaustion - Fill storage to halt operations - Ev)-.25 F .195
(asion - Ov)-.25 F(er)-.15 E(-)-.2 E(whelm to pre)72 300 Q -.15(ve)-.25
G(nt logging of real attacks - Ampli\214cation - Small action triggers \
lar).15 E(ge log entries)-.18 E
(The audit log must protect itself while ne)72 324 Q -.15(ve)-.25 G 2.5
(rf).15 G(ailing to record.)-2.6 E(------------------------------------\
------------------------------------------)72 348 Q(Threat Model)72 372
Q(Attack V)72 396 Q(ectors)-1.11 E(\(de\214ne audit-threats)82 420 Q
('\(\(\215ooding)87 432 Q(\(description "Generate massi)94.5 444 Q .3
-.15(ve l)-.25 H(og v).15 E(olume"\))-.2 E(\(goal "Hide malicious acti)
94.5 456 Q(vity in noise"\))-.25 E(\(method "Rapid le)94.5 468 Q
(gitimate-looking operations"\)\))-.15 E(\(e)92 492 Q(xhaustion)-.15 E
(\(description "Fill audit storage"\))94.5 504 Q(\(goal "Halt v)94.5 516
Q(ault operations"\))-.25 E(\(method "Sustained high-v)94.5 528 Q
(olume logging"\)\))-.2 E(\(ampli\214cation)92 552 Q
(\(description "Small input, lar)94.5 564 Q(ge log output"\))-.18 E
(\(goal "Asymmetric resource consumption"\))94.5 576 Q
(\(method "Operations that log disproportionately"\)\))94.5 588 Q
(\(corruption)92 612 Q(\(description "T)94.5 624 Q
(amper with log entries"\))-.8 E(\(goal "Alter historical record"\))94.5
636 Q(\(method "Exploit write access to log storage"\)\))94.5 648 Q
(\(truncation)92 672 Q(\(description "F)94.5 684 Q
(orce log rotation/deletion"\))-.15 E(\(goal "Remo)94.5 696 Q .3 -.15
(ve e)-.15 H(vidence"\))-.1 E
(\(method "Fill logs to trigger cleanup"\)\)\)\))94.5 708 Q(Attack)72
732 Q(er Capabilities)-.1 E(;; Assume attack)82 756 Q(er can:)-.1 E
(;; - Authenticate as a v)82 768 Q(alid principal)-.25 E
(;; - Perform man)82 780 Q 2.5(yl)-.15 G -.15(eg)-2.5 G
(itimate operations).15 E(;; - Control timing of operations)82 792 Q 0
Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; - Observ)82 12 Q 2.5(es)-.15 G(ystem beha)
-2.5 E(vior)-.2 E(;; Assume attack)82 36 Q(er cannot:)-.1 E
(;; - Directly write to audit storage)82 48 Q(;; - F)82 60 Q(or)-.15 E
(ge signatures on log entries)-.18 E(;; - Break cryptographic primiti)82
72 Q -.15(ve)-.25 G(s).15 E(-------------------------------------------\
-----------------------------------)72 96 Q(Rate Limiting)72 120 Q(Per)
72 144 Q(-Principal Audit Limits)-.2 E(\(de\214ne audit-rate-limits)82
168 Q(`\(\(entries-per)87 180 Q(-second . 100\))-.2 E(\(bytes-per)92 192
Q(-second . 102400\))-.2 E 2.5(;1)15 G(00KB/s)-2.5 E(\(entries-per)92
204 Q(-minute . 1000\))-.2 E(\(bytes-per)92 216 Q
(-minute . 10485760\)\)\))-.2 E 2.5(;1)5 G(0MB/min)-2.5 E
(\(de\214ne principal-audit-b)82 240 Q(uck)-.2 E(ets \(mak)-.1 E
(e-hash-table\)\))-.1 E(\(de\214ne \(get-audit-b)82 264 Q(uck)-.2 E
(et principal\))-.1 E(\(or \(hash-table-ref principal-audit-b)87 276 Q
(uck)-.2 E(ets principal #f\))-.1 E(\(let \(\(b)97 288 Q(uck)-.2 E
(et \(mak)-.1 E(e-tok)-.1 E(en-b)-.1 E(uck)-.2 E(et)-.1 E
(\(assoc-ref audit-rate-limits 'entries-per)134.5 300 Q(-second\))-.2 E
(\(assoc-ref audit-rate-limits 'entries-per)134.5 312 Q(-second\)\)\)\))
-.2 E(\(hash-table-set! principal-audit-b)102 324 Q(uck)-.2 E
(ets principal b)-.1 E(uck)-.2 E(et\))-.1 E -.2(bu)102 336 S(ck).2 E
(et\)\)\))-.1 E(\(de\214ne \(audit-rate-check principal entry-size\))82
360 Q("Check if principal can generate audit entry")87 372 Q
(\(let \(\(b)87 384 Q(uck)-.2 E(et \(get-audit-b)-.1 E(uck)-.2 E
(et principal\)\)\))-.1 E(\(b)92 396 Q(uck)-.2 E(et 1\)\)\))-.1 E 2.5
(;C)5 G(onsume one tok)-2.5 E(en)-.1 E(Audit Entry Costing)72 420 Q
(;; Dif)82 444 Q(ferent operations ha)-.25 E .3 -.15(ve d)-.2 H(if).15 E
(ferent audit costs)-.25 E(\(de\214ne audit-costs)82 456 Q
(`\(\(read . 1\))87 468 Q(\(write . 2\))92 480 Q(\(delete . 5\))92 492 Q
(\(query . 1\))92 504 Q(\(admin . 10\))92 516 Q(\(k)92 528 Q -.15(ey)-.1
G(-operation . 50\)).15 E(\(emer)92 540 Q(genc)-.18 E 2.5(y.0)-.15 G 2.5
(\)\)\) ;)-2.5 F(Al)2.5 E -.1(wa)-.1 G(ys allo).1 E(wed)-.25 E
(\(de\214ne \(audit-cost action\))82 564 Q
(\(or \(assoc-ref audit-costs action\) 1\)\))87 576 Q
(\(de\214ne \(consume-audit-b)82 600 Q(udget principal action\))-.2 E
("Deduct from principal')87 612 Q 2.5(sa)-.55 G(udit b)-2.5 E(udget")-.2
E(\(let \(\(cost \(audit-cost action\)\))87 624 Q(\(b)102 636 Q(uck)-.2
E(et \(get-audit-b)-.1 E(uck)-.2 E(et principal\)\)\))-.1 E(\(if \(b)92
648 Q(uck)-.2 E(et cost\))-.1 E(#t)102 660 Q(\(be)102 672 Q(gin)-.15 E
(;; Log the rate limit e)107 684 Q -.15(ve)-.25 G(nt \(al).15 E -.1(wa)
-.1 G(ys succeeds\)).1 E(\(audit-append-pri)107 696 Q(vile)-.25 E(ged)
-.15 E(action: 'audit-rate-limited)112 708 Q(principal: principal)112
720 Q(attempted-action: action\))112 732 Q(#f\)\)\)\))107 744 Q
(Burst Handling)72 768 Q(;; Allo)82 792 Q 2.5(ws)-.25 G(hort b)-2.5 E
(ursts b)-.2 E(ut limit sustained rate)-.2 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne \(mak)82 12 Q(e-audit-limiter\))-.1 E
(\(let \(\(short-term \(mak)87 24 Q(e-tok)-.1 E(en-b)-.1 E(uck)-.2 E
(et 200 100\)\))-.1 E 2.5(;1)7.5 G(00/s, b)-2.5 E(urst 200)-.2 E
(\(long-term \(mak)102 36 Q(e-sliding-windo)-.1 E 2.5(w1)-.25 G
(0000 60\)\)\) ; 10k/min)-2.5 E(\(lambda \(cost\))92 48 Q
(\(and \(short-term cost\))97 60 Q(\(long-term\)\)\)\)\))109.5 72 Q(---\
-----------------------------------------------------------------------\
----)72 96 Q(Storage Protection)72 120 Q(Reserv)72 144 Q(ed Audit Space)
-.15 E(;; Al)82 168 Q -.1(wa)-.1 G(ys reserv).1 E 2.5(es)-.15 G
(pace for audit)-2.5 E(\(de\214ne *audit-reserv)82 180 Q
(ed-space* \(* 1024 1024 1024\)\))-.15 E 2.5(;1)5 G(GB minimum)-2.5 E
(\(de\214ne \(audit-storage-a)82 204 Q -.25(va)-.2 G(ilable\)).25 E
(\(let \(\(total \(storage-a)87 216 Q -.25(va)-.2 G(ilable\)\)).25 E
(\(audit-used \(audit-storage-used\)\)\))102 228 Q
(\(max 0 \(- total *audit-reserv)92 240 Q(ed-space*\)\)\)\))-.15 E
(\(de\214ne \(check-audit-storage entry-size\))82 264 Q
("Ensure space for audit entry")87 276 Q(\(let \(\(a)87 288 Q -.25(va)
-.2 G(ilable \(audit-storage-a).25 E -.25(va)-.2 G(ilable\)\)\)).25 E
(\(when \(< a)92 300 Q -.25(va)-.2 G(ilable entry-size\)).25 E(;; Emer)
97 312 Q(genc)-.18 E(y: halt non-audit operations)-.15 E(\(enter)97 324
Q(-audit-protection-mode\))-.2 E(;; But al)97 336 Q -.1(wa)-.1 G(ys log)
.1 E(#t\)\)\))97 348 Q(Audit Protection Mode)72 372 Q
(\(de\214ne audit-protection-mode? \(mak)82 396 Q(e-parameter #f\)\))-.1
E(\(de\214ne \(enter)82 420 Q(-audit-protection-mode\))-.2 E("Emer)87
432 Q(genc)-.18 E 2.5(ym)-.15 G(ode: only allo)-2.5 E 2.5(wa)-.25 G
(udit writes")-2.5 E(\(audit-protection-mode? #t\))87 444 Q
(\(audit-append-pri)87 456 Q(vile)-.25 E(ged)-.15 E
(action: 'audit-protection-enabled)92 468 Q(reason: ')92 480 Q
(storage-e)-.55 E(xhaustion\))-.15 E
(;; Reject all non-essential operations)87 492 Q(\(set-v)87 504 Q
(ault-mode! 'audit-only\)\))-.25 E(\(de\214ne \(e)82 528 Q
(xit-audit-protection-mode\))-.15 E("Resume normal operations")87 540 Q
(\(when \(> \(audit-storage-a)87 552 Q -.25(va)-.2 G
(ilable\) \(* 2 *audit-reserv).25 E(ed-space*\)\))-.15 E
(\(audit-protection-mode? #f\))92 564 Q(\(set-v)92 576 Q
(ault-mode! 'normal\))-.25 E(\(audit-append-pri)92 588 Q(vile)-.25 E
(ged)-.15 E(action: 'audit-protection-disabled\)\)\))97 600 Q -.35(Ti)72
624 S(ered Storage).35 E(;; Audit log tiers)82 648 Q
(\(de\214ne audit-tiers)82 660 Q('\(\(hot . \(\(retention . 86400\))87
672 Q 2.5(;1d)15 G(ay)-2.5 E(\(storage . ssd\))112 684 Q
(\(compression . none\)\)\))112 696 Q(\(w)92 708 Q
(arm . \(\(retention . 604800\))-.1 E 2.5(;7d)10 G(ays)-2.5 E
(\(storage . hdd\))114.5 720 Q(\(compression . zstd-f)114.5 732 Q
(ast\)\)\))-.1 E(\(cold . \(\(retention . 31536000\))92 744 Q 2.5(;1y)5
G(ear)-2.5 E(\(storage . archi)114.5 756 Q -.15(ve)-.25 G(\)).15 E
(\(compression . zstd-max\)\)\))114.5 768 Q
(\(glacier . \(\(retention . #f\))92 780 Q 2.5(;F)12.5 G(ore)-2.65 E
-.15(ve)-.25 G(r).15 E(\(storage . of)122 792 Q(fsite\))-.25 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(compression . zstd-max\)\)\)\)\))122 12 Q
(\(de\214ne \(tier)82 36 Q(-audit-entry entry age\))-.2 E("Mo)87 48 Q .3
-.15(ve e)-.15 H(ntry to appropriate storage tier").15 E
(\(let \(\(tier \(\214nd \(lambda \(t\))87 60 Q
(\(or \(not \(assoc-ref \(cdr t\) ')137 72 Q(retention\)\))-.5 E
(\(< age \(assoc-ref \(cdr t\) ')147 84 Q(retention\)\)\)\))-.5 E
(audit-tiers\)\)\))132 96 Q(\(migrate-to-tier entry \(car tier\)\)\)\))
92 108 Q(--------------------------------------------------------------\
----------------)72 132 Q(Entry Size Limits)72 156 Q(Maximum Entry Size)
72 180 Q(\(de\214ne *max-audit-entry-size* 65536\))82 204 Q 2.5(;6)5 G
(4KB)-2.5 E(\(de\214ne \(v)82 228 Q(alidate-audit-entry entry\))-.25 E
("V)87 240 Q(alidate entry before logging")-1.11 E
(\(let \(\(size \(serialized-size entry\)\)\))87 252 Q
(\(when \(> size *max-audit-entry-size*\))92 264 Q
(\(error 'audit-entry-too-lar)97 276 Q(ge)-.18 E(`\(\(size . ,size\))
114.5 288 Q(\(limit . ,*max-audit-entry-size*\)\)\)\)\)\))119.5 300 Q
(Entry T)72 324 Q(runcation)-.35 E
(\(de\214ne \(truncate-audit-entry entry max-size\))82 348 Q("T)87 360 Q
(runcate o)-.35 E -.15(ve)-.15 G
(rsized entry while preserving critical \214elds").15 E
(\(let \(\(critical '\(action principal timestamp hash signature\)\)\))
87 372 Q(\(let loop \(\(entry entry\))92 384 Q
(\(\214elds \(entry-\214elds entry\)\)\))119.5 396 Q
(\(if \(<= \(serialized-size entry\) max-size\))97 408 Q(entry)107 420 Q
(\(let \(\(remo)107 432 Q -.25(va)-.15 G(ble \(\214nd \(lambda \(f\)).25
E(\(not \(member f critical\)\)\))169.5 444 Q(\214elds\)\)\))164.5 456 Q
(\(if remo)112 468 Q -.25(va)-.15 G(ble).25 E(\(loop \(assoc-remo)122
480 Q .3 -.15(ve e)-.15 H(ntry remo).15 E -.25(va)-.15 G(ble\)).25 E
(\(delete remo)137 492 Q -.25(va)-.15 G(ble \214elds\)\)).25 E(;; Can')
122 504 Q 2.5(tt)-.18 G(runcate further)-2.5 E 2.5(,l)-.4 G(og w)-2.5 E
(arning)-.1 E(\(be)122 516 Q(gin)-.15 E(\(audit-append-pri)127 528 Q
(vile)-.25 E(ged)-.15 E(action: 'audit-entry-truncation-f)132 540 Q
(ailed)-.1 E(original-size: \(serialized-size entry\)\))132 552 Q
(entry\)\)\)\)\)\)\))127 564 Q -.15(Pa)72 588 S(yload Summarization).15
E(\(de\214ne \(summarize-lar)82 612 Q(ge-payload payload\))-.18 E
("Summarize lar)87 624 Q(ge payloads for audit")-.18 E(\(if \(> \(byte)
87 636 Q -.15(ve)-.25 G(ctor).15 E(-length payload\) 1024\))-.2 E
(`\(\(type . summarized\))97 648 Q(\(original-size . ,\(byte)102 660 Q
-.15(ve)-.25 G(ctor).15 E(-length payload\)\))-.2 E
(\(hash . ,\(content-hash payload\)\))102 672 Q(\(pre)102 684 Q(vie)-.25
E 2.5(w.,)-.25 G(\(subbyte)-2.5 E -.15(ve)-.25 G
(ctor payload 0 256\)\)\)).15 E(payload\)\))97 696 Q(------------------\
------------------------------------------------------------)72 720 Q
(Aggre)72 744 Q -.05(ga)-.15 G(tion).05 E(Ev)72 768 Q(ent Aggre)-.15 E
-.05(ga)-.15 G(tion).05 E(;; Aggre)82 792 Q -.05(ga)-.15 G(te similar e)
.05 E -.15(ve)-.25 G(nts to reduce v).15 E(olume)-.2 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne aggre)82 12 Q -.05(ga)-.15 G
(tion-windo).05 E 2.5(w6)-.25 G 2.5(0\) ;)-2.5 F(seconds)2.5 E
(\(de\214ne pending-aggre)82 24 Q -.05(ga)-.15 G(tions \(mak).05 E
(e-hash-table\)\))-.1 E(\(de\214ne \(aggre)82 48 Q -.05(ga)-.15 G
(te-audit-e).05 E -.15(ve)-.25 G(nt action principal details\)).15 E
("Aggre)87 60 Q -.05(ga)-.15 G(te similar e).05 E -.15(ve)-.25 G
(nts within windo).15 E(w")-.25 E(\(let* \(\(k)87 72 Q .3 -.15(ey \()-.1
H(list action principal\)\)).15 E(\(e)104.5 84 Q
(xisting \(hash-table-ref pending-aggre)-.15 E -.05(ga)-.15 G(tions k)
.05 E .3 -.15(ey #)-.1 H(f\)\)\)).15 E(\(if e)92 96 Q(xisting)-.15 E
(;; Add to e)102 108 Q(xisting aggre)-.15 E -.05(ga)-.15 G(tion).05 E
(\(be)102 120 Q(gin)-.15 E(\(set-cdr! \(assoc 'count e)107 132 Q
(xisting\))-.15 E(\(+ 1 \(assoc-ref e)132 144 Q(xisting 'count\)\)\))
-.15 E(\(set-cdr! \(assoc ')107 156 Q(last-seen e)-.1 E(xisting\))-.15 E
(\(current-time\)\)\))132 168 Q(;; Start ne)102 180 Q 2.5(wa)-.25 G
(ggre)-2.5 E -.05(ga)-.15 G(tion).05 E(\(hash-table-set! pending-aggre)
102 192 Q -.05(ga)-.15 G(tions k).05 E -.15(ey)-.1 G
(`\(\(action . ,action\))107 204 Q(\(principal . ,principal\))112 216 Q
(\(count . 1\))112 228 Q(\(\214rst-seen . ,\(current-time\)\))112 240 Q
(\(last-seen . ,\(current-time\)\))112 252 Q
(\(sample . ,details\)\)\)\)\)\))112 264 Q(\(de\214ne \(\215ush-aggre)82
288 Q -.05(ga)-.15 G(tions\)).05 E("Flush aggre)87 300 Q -.05(ga)-.15 G
(ted e).05 E -.15(ve)-.25 G(nts to audit log").15 E(\(hash-table-w)87
312 Q(alk pending-aggre)-.1 E -.05(ga)-.15 G(tions).05 E(\(lambda \(k)92
324 Q .3 -.15(ey a)-.1 H(gg\)).15 E
(\(when \(> \(- \(current-time\) \(assoc-ref agg '\214rst-seen\)\))97
336 Q(aggre)119.5 348 Q -.05(ga)-.15 G(tion-windo).05 E(w\))-.25 E
(\(audit-append-direct)102 360 Q(action: 'aggre)107 372 Q -.05(ga)-.15 G
(ted-e).05 E -.15(ve)-.25 G(nts).15 E
(original-action: \(assoc-ref agg 'action\))107 384 Q
(principal: \(assoc-ref agg 'principal\))107 396 Q
(count: \(assoc-ref agg 'count\))107 408 Q(windo)107 420 Q
(w-start: \(assoc-ref agg '\214rst-seen\))-.25 E(windo)107 432 Q
(w-end: \(assoc-ref agg ')-.25 E(last-seen\))-.1 E
(sample: \(assoc-ref agg ')107 444 Q(sample\)\))-.55 E
(\(hash-table-delete! pending-aggre)102 456 Q -.05(ga)-.15 G(tions k).05
E -.15(ey)-.1 G(\)\)\)\)\)).15 E(Sampling)72 480 Q(;; Sample high-v)82
504 Q(olume e)-.2 E -.15(ve)-.25 G(nts).15 E
(\(de\214ne \(should-sample? action principal\))82 516 Q
(\(let \(\(rate \(current-rate action principal\)\)\))87 528 Q(\(cond)92
540 Q(\(\(< rate 10\) #t\))97 552 Q 2.5(;A)35 G -.1(lwa)-2.5 G
(ys log lo).1 E(w-rate)-.25 E
(\(\(< rate 100\) \(< \(random 1.0\) 0.5\)\))97 564 Q 2.5(;5)5 G
(0% sample)-2.5 E
(\(\(< rate 1000\) \(< \(random 1.0\) 0.1\)\) ; 10% sample)97 576 Q
(\(else \(< \(random 1.0\) 0.01\)\)\)\)\))97 588 Q 2.5(;1)15 G 2.5(%s)
-2.5 G(ample)-2.5 E
(\(de\214ne \(audit-with-sampling action principal details\))82 612 Q
("Log with sampling for high-v)87 624 Q(olume e)-.2 E -.15(ve)-.25 G
(nts").15 E(\(if \(should-sample? action principal\))87 636 Q
(\(audit-append action: action)97 648 Q(principal: principal)132 660 Q
(details: details)132 672 Q(sampled: #t\))132 684 Q
(;; Still count for rate tracking)97 696 Q
(\(increment-audit-counter action principal\)\)\))97 708 Q(------------\
------------------------------------------------------------------)72
732 Q(Anomaly Detection)72 756 Q(Baseline Establishment)72 780 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF
(\(de\214ne \(establish-audit-baseline principal duration\))82 12 Q
("Establish normal audit patterns for principal")87 24 Q(\(let \(\(e)87
36 Q -.15(ve)-.25 G(nts \(soup-query type: 'audit-entry).15 E
(principal: principal)152 48 Q
(timestamp: \(> \(- \(current-time\) duration\)\)\)\)\))152 60 Q(`\(\(e)
92 72 Q -.15(ve)-.25 G(nts-per).15 E(-hour . ,\(/ \(length e)-.2 E -.15
(ve)-.25 G(nts\) \(/ duration 3600\)\)\)).15 E
(\(common-actions . ,\(top-n \(map audit-action e)97 84 Q -.15(ve)-.25 G
(nts\) 10\)\)).15 E(\(typical-hours . ,\(typical-acti)97 96 Q -.15(ve)
-.25 G(-hours e).15 E -.15(ve)-.25 G(nts\)\)).15 E
(\(established-at . ,\(current-time\)\)\)\)\))97 108 Q
(Anomaly Detection)72 132 Q
(\(de\214ne \(detect-audit-anomaly principal current-rate baseline\))82
156 Q("Detect anomalous audit patterns")87 168 Q(\(let \(\(e)87 180 Q
(xpected \(assoc-ref baseline 'e)-.15 E -.15(ve)-.25 G(nts-per).15 E
(-hour\)\))-.2 E(\(threshold 3.0\)\))102 192 Q 2.5(;3)5 G 2.5(xn)-2.5 G
(ormal is anomalous)-2.5 E(\(when \(> current-rate \(* threshold e)92
204 Q(xpected\)\))-.15 E(\(audit-append-pri)97 216 Q(vile)-.25 E(ged)
-.15 E(action: 'audit-anomaly-detected)102 228 Q(principal: principal)
102 240 Q(current-rate: current-rate)102 252 Q -.15(ex)102 264 S
(pected-rate: e).15 E(xpected)-.15 E(se)102 276 Q -.15(ve)-.25 G
(rity: \(if \(> current-rate \(* 10 e).15 E(xpected\)\))-.15 E
('critical)137 288 Q('w)137 300 Q(arning\)\))-.1 E
(;; Potentially throttle)97 312 Q(\(when \(> current-rate \(* 10 e)97
324 Q(xpected\)\))-.15 E(\(throttle-principal principal\)\)\)\)\))102
336 Q(Flood Detection)72 360 Q(\(de\214ne \(detect-audit-\215ood\))82
384 Q("Detect system-wide audit \215ooding")87 396 Q
(\(let \(\(current-rate \(global-audit-rate\)\))87 408 Q
(\(threshold \(* 10 \(baseline-global-rate\)\)\)\))102 420 Q
(\(when \(> current-rate threshold\))92 432 Q(;; Identify top contrib)97
444 Q(utors)-.2 E
(\(let \(\(top-principals \(top-audit-principals 10\)\)\))97 456 Q
(\(audit-append-pri)102 468 Q(vile)-.25 E(ged)-.15 E
(action: 'audit-\215ood-detected)107 480 Q(global-rate: current-rate)107
492 Q(threshold: threshold)107 504 Q(top-principals: top-principals\))
107 516 Q(;; Throttle top contrib)102 528 Q(utors)-.2 E(\(for)102 540 Q
(-each throttle-principal)-.2 E(\(map car top-principals\)\)\)\)\)\))127
552 Q(-----------------------------------------------------------------\
-------------)72 576 Q(Pri)72 600 Q(vile)-.25 E(ged Logging)-.15 E
(System Ev)72 624 Q(ents)-.15 E(;; Some e)82 648 Q -.15(ve)-.25 G
(nts bypass rate limits).15 E(\(de\214ne pri)82 660 Q(vile)-.25 E
(ged-actions)-.15 E('\(audit-rate-limited)87 672 Q
(audit-protection-enabled)92 684 Q(audit-protection-disabled)92 696 Q
(audit-anomaly-detected)92 708 Q(audit-\215ood-detected)92 720 Q -.1(ke)
92 732 S(y-ceremon)-.05 E(y)-.15 E(emer)92 744 Q(genc)-.18 E(y-re)-.15 E
-.2(vo)-.25 G -.1(ke).2 G(security-alert\)\))92 756 Q
(\(de\214ne \(audit-append-pri)82 780 Q(vile)-.25 E(ged . ar)-.15 E
(gs\))-.18 E("Log pri)87 792 Q(vile)-.25 E(ged e)-.15 E -.15(ve)-.25 G
(nt \(bypasses rate limits\)").15 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(let \(\(entry \(apply mak)87 12 Q
(e-audit-entry ar)-.1 E(gs\)\)\))-.18 E(;; Al)92 24 Q -.1(wa)-.1 G
(ys log, ne).1 E -.15(ve)-.25 G 2.5(rr).15 G(ate limit)-2.5 E
(\(audit-write-direct entry\))92 36 Q(;; Alert on pri)92 48 Q(vile)-.25
E(ged e)-.15 E -.15(ve)-.25 G(nts).15 E
(\(when \(member \(assoc-ref entry 'action\) '\(security-alert emer)92
60 Q(genc)-.18 E(y-re)-.15 E -.2(vo)-.25 G -.1(ke).2 G(\)\)).1 E
(\(send-security-alert entry\)\)\)\))97 72 Q(Guaranteed Deli)72 96 Q
-.15(ve)-.25 G(ry).15 E(\(de\214ne \(audit-write-guaranteed entry\))82
120 Q("Write audit entry with guaranteed deli)87 132 Q -.15(ve)-.25 G
(ry").15 E(;; Write to multiple locations)87 144 Q
(\(let \(\(locations \(list \(primary-audit-log\))87 156 Q
(\(secondary-audit-log\))144.5 168 Q(\(remote-audit-log\)\)\)\))144.5
180 Q(\(let \(\(successes \(\214lter \(lambda \(loc\))92 192 Q
(\(guard \(e)159.5 204 Q 2.5(x\()-.15 G(else #f\)\))-2.5 E
(\(audit-write loc entry\))164.5 216 Q(#t\)\))164.5 228 Q
(locations\)\)\))154.5 240 Q(\(when \(< \(length successes\) 2\))97 252
Q(;; F)102 264 Q(ailed to write to enough locations)-.15 E(\(emer)102
276 Q(genc)-.18 E(y-audit-alert entry successes\)\)\)\)\))-.15 E(------\
-----------------------------------------------------------------------\
-)72 300 Q(Inte)72 324 Q(grity Protection)-.15 E
(Append-Only Enforcement)72 348 Q(;; Audit log is strictly append-only)
82 372 Q(\(de\214ne \(audit-write entry\))82 384 Q
("Append entry to audit log")87 396 Q
(\(let \(\(log \(current-audit-log\)\)\))87 408 Q(;; V)92 420 Q
(erify we')-1.11 E(re at the end)-.5 E(\(unless \(at-log-end? log\))92
432 Q(\(error 'audit-log-not-at-end\)\))97 444 Q
(;; Append with sequence number)92 456 Q(\(let \(\(seq \(ne)92 468 Q
(xt-sequence-number log\)\)\))-.15 E
(\(write-entry log \(cons `\(sequence . ,seq\) entry\)\))97 480 Q
(;; Sign the entry)97 492 Q(\(sign-entry log entry\)\)\)\))97 504 Q
(Chain Inte)72 528 Q(grity)-.15 E(;; Each entry references pre)82 552 Q
(vious \(blockchain-style\))-.25 E(\(de\214ne \(chain-entry entry pre)82
564 Q(vious-hash\))-.25 E(`\(\(pre)87 576 Q(vious-hash . ,pre)-.25 E
(vious-hash\))-.25 E(\(sequence . ,\(+ 1 \(pre)92 588 Q
(vious-sequence\)\)\))-.25 E(\(timestamp . ,\(current-time\)\))92 600 Q
(,@entry)92 612 Q(\(hash . ,\(compute-entry-hash entry pre)92 624 Q
(vious-hash\)\)\)\))-.25 E(\(de\214ne \(v)82 648 Q
(erify-audit-chain log\))-.15 E("V)87 660 Q(erify audit log chain inte)
-1.11 E(grity")-.15 E(\(let loop \(\(entries \(audit-entries log\)\))87
672 Q(\(e)114.5 684 Q(xpected-pre)-.15 E 2.5(v#)-.25 G(f\)\))-2.5 E
(\(if \(null? entries\))92 696 Q(#t)102 708 Q
(\(let \(\(entry \(car entries\)\)\))102 720 Q(\(and \(or \(not e)107
732 Q(xpected-pre)-.15 E(v\))-.25 E(\(equal? \(assoc-ref entry 'pre)
129.5 744 Q(vious-hash\) e)-.25 E(xpected-pre)-.15 E(v\)\))-.25 E
(\(loop \(cdr entries\))119.5 756 Q
(\(assoc-ref entry 'hash\)\)\)\)\)\)\))134.5 768 Q(--------------------\
----------------------------------------------------------)72 792 Q 0 Cg
EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Reco)72 24 Q -.15(ve)-.15 G(ry).15 E
(Log Reconstruction)72 48 Q
(\(de\214ne \(reconstruct-audit-log backups\))82 72 Q
("Reconstruct audit log from multiple backups")87 84 Q
(\(let \(\(entries \(mer)87 96 Q(ge-backup-entries backups\)\)\))-.18 E
(;; Deduplicate by sequence number)92 108 Q
(\(let \(\(deduped \(deduplicate-by-sequence entries\)\)\))92 120 Q
(;; V)97 132 Q(erify chain)-1.11 E(\(unless \(v)97 144 Q
(erify-audit-chain deduped\))-.15 E(\(error 'audit-chain-brok)102 156 Q
(en\)\))-.1 E(deduped\)\)\))97 168 Q(Gap Detection)72 192 Q
(\(de\214ne \(detect-audit-g)82 216 Q(aps log\))-.05 E("Find g)87 228 Q
(aps in audit sequence")-.05 E
(\(let loop \(\(entries \(audit-entries log\)\))87 240 Q(\(e)114.5 252 Q
(xpected-seq 1\))-.15 E(\(g)114.5 264 Q(aps '\(\)\)\))-.05 E
(\(if \(null? entries\))92 276 Q -.05(ga)102 288 S(ps).05 E
(\(let \(\(seq \(assoc-ref \(car entries\) ')102 300 Q(sequence\)\)\))
-.55 E(\(if \(= seq e)107 312 Q(xpected-seq\))-.15 E
(\(loop \(cdr entries\) \(+ seq 1\) g)117 324 Q(aps\))-.05 E
(\(loop \(cdr entries\) \(+ seq 1\))117 336 Q(\(cons \(list e)132 348 Q
(xpected-seq \(- seq 1\)\) g)-.15 E(aps\)\)\)\)\)\)\))-.05 E(----------\
--------------------------------------------------------------------)72
372 Q(References)72 396 Q 4.169(1. NIST)72 420 R 1.669
(SP 800-92: Guide to Computer Security Log Management 2.)4.169 F 1.668
(RFC-003: Cryptographic Audit T)6.668 F 1.668(rail 3.)-.35 F
(RFC-032: Rate Limiting and Quotas 4.)72 432 Q
(RFC-028: Error Handling and Reco)5 E -.15(ve)-.15 G(ry).15 E(---------\
---------------------------------------------------------------------)72
456 Q(Changelog)72 480 Q 2.5(-2)72 504 S(026-01-07 - Initial draft)-2.5
E(---------------------------------------------------------------------\
---------)72 528 Q 1.525(Implementation Status: Draft Dependencies: aud\
it, storage, monitoring Inte)72 552 R 1.526(gration: All v)-.15 F 1.526
(ault operations, security)-.25 F(monitoring, forensics)72 564 Q 0 Cg EP
%%Trailer
end
%%EOF
