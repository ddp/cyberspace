%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 8
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-034: Audit Log Protection)72 12 Q 1.95(**St\
atus:** Draft **Date:** January 2026 **Author:** Derrell Piper <ddp@elu\
dom.net> **Implementation:**)72 36 R(Proposed)72 48 Q(---)72 72 Q
(Abstract)72 96 Q 1.308(This RFC speci\214es protection mechanisms for \
the Library of Cyberspace audit log: ho)72 120 R 3.808(wt)-.25 G 1.308
(he system pre)-3.808 F -.15(ve)-.25 G 1.309(nts re-).15 F .216
(source e)72 132 R .216
(xhaustion, log \215ooding, and denial of service attacks ag)-.15 F .216
(ainst the audit trail while maintaining its inte)-.05 F .215(grity as)
-.15 F(the authoritati)72 144 Q .3 -.15(ve r)-.25 H(ecord of all v).15 E
(ault operations.)-.25 E(---)72 168 Q(Moti)72 192 Q -.25(va)-.25 G(tion)
.25 E(The audit log is sacred:)72 216 Q 3.317(-*)72 240 S .817
(*Evidence** - Le)-3.317 F -.05(ga)-.15 G 3.317(la).05 G .817
(nd forensic record - **Accountability** - Who did what when - **Reco)
-3.317 F -.15(ve)-.15 G .817(ry** - Recon-).15 F(struct state after f)72
252 Q(ailure - **T)-.1 E(rust** - F)-.35 E
(oundation of the security model)-.15 E(But the audit log is also a tar)
72 276 Q(get:)-.18 E 4.246(-*)72 300 S 1.746
(*Flooding** - Generate noise to hide malicious acti)-4.246 F 1.745
(vity - **Exhaustion** - Fill storage to halt operations -)-.25 F(**Ev)
72 312 Q .842(asion** - Ov)-.25 F .842(erwhelm to pre)-.15 F -.15(ve)
-.25 G .843(nt logging of real attacks - **Ampli\214cation** - Small ac\
tion triggers lar).15 F .843(ge log)-.18 F(entries)72 324 Q
(The audit log must protect itself while ne)72 348 Q -.15(ve)-.25 G 2.5
(rf).15 G(ailing to record.)-2.6 E(---)72 372 Q(Threat Model)72 396 Q
(Attack V)72 420 Q(ectors)-1.11 E -.74(```)72 444 S
(scheme \(de\214ne audit-threats).74 E('\(\(\215ooding)77 456 Q
(\(description "Generate massi)84.5 468 Q .3 -.15(ve l)-.25 H(og v).15 E
(olume"\))-.2 E(\(goal "Hide malicious acti)84.5 480 Q(vity in noise"\))
-.25 E(\(method "Rapid le)84.5 492 Q(gitimate-looking operations"\)\))
-.15 E(\(e)82 516 Q(xhaustion)-.15 E
(\(description "Fill audit storage"\))84.5 528 Q(\(goal "Halt v)84.5 540
Q(ault operations"\))-.25 E(\(method "Sustained high-v)84.5 552 Q
(olume logging"\)\))-.2 E(\(ampli\214cation)82 576 Q
(\(description "Small input, lar)84.5 588 Q(ge log output"\))-.18 E
(\(goal "Asymmetric resource consumption"\))84.5 600 Q
(\(method "Operations that log disproportionately"\)\))84.5 612 Q
(\(corruption)82 636 Q(\(description "T)84.5 648 Q
(amper with log entries"\))-.8 E(\(goal "Alter historical record"\))84.5
660 Q(\(method "Exploit write access to log storage"\)\))84.5 672 Q
(\(truncation)82 696 Q(\(description "F)84.5 708 Q
(orce log rotation/deletion"\))-.15 E(\(goal "Remo)84.5 720 Q .3 -.15
(ve e)-.15 H(vidence"\))-.1 E
(\(method "Fill logs to trigger cleanup"\)\)\)\) `)84.5 732 Q -.74(``)
-.74 G(Attack)72 756 Q(er Capabilities)-.1 E -.74(```)72 780 S .728
(scheme ;; Assume attack).74 F .728(er can: ;; - Authenticate as a v)-.1
F .727(alid principal ;; - Perform man)-.25 F 3.227(yl)-.15 G -.15(eg)
-3.227 G .727(itimate operations ;; -).15 F
(Control timing of operations ;; - Observ)72 792 Q 2.5(es)-.15 G
(ystem beha)-2.5 E(vior)-.2 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF .682(;; Assume attack)72 24 R .682
(er cannot: ;; - Directly write to audit storage ;; - F)-.1 F(or)-.15 E
.683(ge signatures on log entries ;; - Break crypto-)-.18 F
(graphic primiti)72 36 Q -.15(ve)-.25 G 2.5(s`).15 G -.74(``)-3.24 G
(---)72 60 Q(Rate Limiting)72 84 Q(Per)72 108 Q(-Principal Audit Limits)
-.2 E -.74(```)72 132 S(scheme \(de\214ne audit-rate-limits).74 E
(`\(\(entries-per)77 144 Q(-second . 100\))-.2 E(\(bytes-per)82 156 Q
(-second . 102400\))-.2 E 2.5(;1)15 G(00KB/s)-2.5 E(\(entries-per)82 168
Q(-minute . 1000\))-.2 E(\(bytes-per)82 180 Q(-minute . 10485760\)\)\))
-.2 E 2.5(;1)5 G(0MB/min)-2.5 E(\(de\214ne principal-audit-b)72 204 Q
(uck)-.2 E(ets \(mak)-.1 E(e-hash-table\)\))-.1 E
(\(de\214ne \(get-audit-b)72 228 Q(uck)-.2 E(et principal\))-.1 E
(\(or \(hash-table-ref principal-audit-b)77 240 Q(uck)-.2 E
(ets principal #f\))-.1 E(\(let \(\(b)87 252 Q(uck)-.2 E(et \(mak)-.1 E
(e-tok)-.1 E(en-b)-.1 E(uck)-.2 E(et)-.1 E
(\(assoc-ref audit-rate-limits 'entries-per)124.5 264 Q(-second\))-.2 E
(\(assoc-ref audit-rate-limits 'entries-per)124.5 276 Q(-second\)\)\)\))
-.2 E(\(hash-table-set! principal-audit-b)92 288 Q(uck)-.2 E
(ets principal b)-.1 E(uck)-.2 E(et\))-.1 E -.2(bu)92 300 S(ck).2 E
(et\)\)\))-.1 E(\(de\214ne \(audit-rate-check principal entry-size\))72
324 Q("Check if principal can generate audit entry")77 336 Q
(\(let \(\(b)77 348 Q(uck)-.2 E(et \(get-audit-b)-.1 E(uck)-.2 E
(et principal\)\)\))-.1 E(\(b)82 360 Q(uck)-.2 E(et 1\)\)\))-.1 E 2.5
(;C)5 G(onsume one tok)-2.5 E(en `)-.1 E -.74(``)-.74 G
(Audit Entry Costing)72 384 Q -.74(```)72 408 S(scheme ;; Dif).74 E
(ferent operations ha)-.25 E .3 -.15(ve d)-.2 H(if).15 E
(ferent audit costs \(de\214ne audit-costs)-.25 E(`\(\(read . 1\))77 420
Q(\(write . 2\))82 432 Q(\(delete . 5\))82 444 Q(\(query . 1\))82 456 Q
(\(admin . 10\))82 468 Q(\(k)82 480 Q -.15(ey)-.1 G(-operation . 50\))
.15 E(\(emer)82 492 Q(genc)-.18 E 2.5(y.0)-.15 G 2.5(\)\)\) ;)-2.5 F(Al)
2.5 E -.1(wa)-.1 G(ys allo).1 E(wed)-.25 E
(\(de\214ne \(audit-cost action\))72 516 Q
(\(or \(assoc-ref audit-costs action\) 1\)\))77 528 Q
(\(de\214ne \(consume-audit-b)72 552 Q(udget principal action\))-.2 E
("Deduct from principal')77 564 Q 2.5(sa)-.55 G(udit b)-2.5 E(udget")-.2
E(\(let \(\(cost \(audit-cost action\)\))77 576 Q(\(b)92 588 Q(uck)-.2 E
(et \(get-audit-b)-.1 E(uck)-.2 E(et principal\)\)\))-.1 E(\(if \(b)82
600 Q(uck)-.2 E(et cost\))-.1 E(#t)92 612 Q(\(be)92 624 Q(gin)-.15 E
(;; Log the rate limit e)97 636 Q -.15(ve)-.25 G(nt \(al).15 E -.1(wa)
-.1 G(ys succeeds\)).1 E(\(audit-append-pri)97 648 Q(vile)-.25 E(ged)
-.15 E(action: 'audit-rate-limited)102 660 Q(principal: principal)102
672 Q(attempted-action: action\))102 684 Q(#f\)\)\)\) `)97 696 Q -.74
(``)-.74 G(Burst Handling)72 720 Q -.74(```)72 744 S(scheme ;; Allo).74
E 2.5(ws)-.25 G(hort b)-2.5 E(ursts b)-.2 E
(ut limit sustained rate \(de\214ne \(mak)-.2 E(e-audit-limiter\))-.1 E
(\(let \(\(short-term \(mak)77 756 Q(e-tok)-.1 E(en-b)-.1 E(uck)-.2 E
(et 200 100\)\))-.1 E 2.5(;1)7.5 G(00/s, b)-2.5 E(urst 200)-.2 E
(\(long-term \(mak)92 768 Q(e-sliding-windo)-.1 E 2.5(w1)-.25 G
(0000 60\)\)\) ; 10k/min)-2.5 E(\(lambda \(cost\))82 780 Q
(\(and \(short-term cost\))87 792 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(long-term\)\)\)\)\) `)99.5 12 Q -.74(``)-.74 G
(---)72 36 Q(Storage Protection)72 60 Q(Reserv)72 84 Q(ed Audit Space)
-.15 E -.74(```)72 108 S(scheme ;; Al).74 E -.1(wa)-.1 G(ys reserv).1 E
2.5(es)-.15 G(pace for audit \(de\214ne *audit-reserv)-2.5 E
(ed-space* \(* 1024 1024 1024\)\))-.15 E 2.5(;1)5 G(GB minimum)-2.5 E
(\(de\214ne \(audit-storage-a)72 132 Q -.25(va)-.2 G(ilable\)).25 E
(\(let \(\(total \(storage-a)77 144 Q -.25(va)-.2 G(ilable\)\)).25 E
(\(audit-used \(audit-storage-used\)\)\))92 156 Q
(\(max 0 \(- total *audit-reserv)82 168 Q(ed-space*\)\)\)\))-.15 E
(\(de\214ne \(check-audit-storage entry-size\))72 192 Q
("Ensure space for audit entry")77 204 Q(\(let \(\(a)77 216 Q -.25(va)
-.2 G(ilable \(audit-storage-a).25 E -.25(va)-.2 G(ilable\)\)\)).25 E
(\(when \(< a)82 228 Q -.25(va)-.2 G(ilable entry-size\)).25 E(;; Emer)
87 240 Q(genc)-.18 E(y: halt non-audit operations)-.15 E(\(enter)87 252
Q(-audit-protection-mode\))-.2 E(;; But al)87 264 Q -.1(wa)-.1 G(ys log)
.1 E(#t\)\)\) `)87 276 Q -.74(``)-.74 G(Audit Protection Mode)72 300 Q
-.74(```)72 324 S(scheme \(de\214ne audit-protection-mode? \(mak).74 E
(e-parameter #f\)\))-.1 E(\(de\214ne \(enter)72 348 Q
(-audit-protection-mode\))-.2 E("Emer)77 360 Q(genc)-.18 E 2.5(ym)-.15 G
(ode: only allo)-2.5 E 2.5(wa)-.25 G(udit writes")-2.5 E
(\(audit-protection-mode? #t\))77 372 Q(\(audit-append-pri)77 384 Q
(vile)-.25 E(ged)-.15 E(action: 'audit-protection-enabled)82 396 Q
(reason: ')82 408 Q(storage-e)-.55 E(xhaustion\))-.15 E
(;; Reject all non-essential operations)77 420 Q(\(set-v)77 432 Q
(ault-mode! 'audit-only\)\))-.25 E(\(de\214ne \(e)72 456 Q
(xit-audit-protection-mode\))-.15 E("Resume normal operations")77 468 Q
(\(when \(> \(audit-storage-a)77 480 Q -.25(va)-.2 G
(ilable\) \(* 2 *audit-reserv).25 E(ed-space*\)\))-.15 E
(\(audit-protection-mode? #f\))82 492 Q(\(set-v)82 504 Q
(ault-mode! 'normal\))-.25 E(\(audit-append-pri)82 516 Q(vile)-.25 E
(ged)-.15 E(action: 'audit-protection-disabled\)\)\) `)87 528 Q -.74(``)
-.74 G -.35(Ti)72 552 S(ered Storage).35 E -.74(```)72 576 S
(scheme ;; Audit log tiers \(de\214ne audit-tiers).74 E
('\(\(hot . \(\(retention . 86400\))77 588 Q 2.5(;1d)15 G(ay)-2.5 E
(\(storage . ssd\))102 600 Q(\(compression . none\)\)\))102 612 Q(\(w)82
624 Q(arm . \(\(retention . 604800\))-.1 E 2.5(;7d)10 G(ays)-2.5 E
(\(storage . hdd\))104.5 636 Q(\(compression . zstd-f)104.5 648 Q
(ast\)\)\))-.1 E(\(cold . \(\(retention . 31536000\))82 660 Q 2.5(;1y)5
G(ear)-2.5 E(\(storage . archi)104.5 672 Q -.15(ve)-.25 G(\)).15 E
(\(compression . zstd-max\)\)\))104.5 684 Q
(\(glacier . \(\(retention . #f\))82 696 Q 2.5(;F)12.5 G(ore)-2.65 E
-.15(ve)-.25 G(r).15 E(\(storage . of)112 708 Q(fsite\))-.25 E
(\(compression . zstd-max\)\)\)\)\))112 720 Q(\(de\214ne \(tier)72 744 Q
(-audit-entry entry age\))-.2 E("Mo)77 756 Q .3 -.15(ve e)-.15 H
(ntry to appropriate storage tier").15 E
(\(let \(\(tier \(\214nd \(lambda \(t\))77 768 Q
(\(or \(not \(assoc-ref \(cdr t\) ')127 780 Q(retention\)\))-.5 E
(\(< age \(assoc-ref \(cdr t\) ')137 792 Q(retention\)\)\)\))-.5 E 0 Cg
EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(audit-tiers\)\)\))122 12 Q
(\(migrate-to-tier entry \(car tier\)\)\)\) `)82 24 Q -.74(``)-.74 G
(---)72 48 Q(Entry Size Limits)72 72 Q(Maximum Entry Size)72 96 Q -.74
(```)72 120 S(scheme \(de\214ne *max-audit-entry-size* 65536\)).74 E 2.5
(;6)5 G(4KB)-2.5 E(\(de\214ne \(v)72 144 Q(alidate-audit-entry entry\))
-.25 E("V)77 156 Q(alidate entry before logging")-1.11 E
(\(let \(\(size \(serialized-size entry\)\)\))77 168 Q
(\(when \(> size *max-audit-entry-size*\))82 180 Q
(\(error 'audit-entry-too-lar)87 192 Q(ge)-.18 E(`\(\(size . ,size\))
104.5 204 Q(\(limit . ,*max-audit-entry-size*\)\)\)\)\)\) `)109.5 216 Q
-.74(``)-.74 G(Entry T)72 240 Q(runcation)-.35 E -.74(```)72 264 S
(scheme \(de\214ne \(truncate-audit-entry entry max-size\)).74 E("T)77
276 Q(runcate o)-.35 E -.15(ve)-.15 G
(rsized entry while preserving critical \214elds").15 E
(\(let \(\(critical '\(action principal timestamp hash signature\)\)\))
77 288 Q(\(let loop \(\(entry entry\))82 300 Q
(\(\214elds \(entry-\214elds entry\)\)\))109.5 312 Q
(\(if \(<= \(serialized-size entry\) max-size\))87 324 Q(entry)97 336 Q
(\(let \(\(remo)97 348 Q -.25(va)-.15 G(ble \(\214nd \(lambda \(f\)).25
E(\(not \(member f critical\)\)\))159.5 360 Q(\214elds\)\)\))154.5 372 Q
(\(if remo)102 384 Q -.25(va)-.15 G(ble).25 E(\(loop \(assoc-remo)112
396 Q .3 -.15(ve e)-.15 H(ntry remo).15 E -.25(va)-.15 G(ble\)).25 E
(\(delete remo)127 408 Q -.25(va)-.15 G(ble \214elds\)\)).25 E(;; Can')
112 420 Q 2.5(tt)-.18 G(runcate further)-2.5 E 2.5(,l)-.4 G(og w)-2.5 E
(arning)-.1 E(\(be)112 432 Q(gin)-.15 E(\(audit-append-pri)117 444 Q
(vile)-.25 E(ged)-.15 E(action: 'audit-entry-truncation-f)122 456 Q
(ailed)-.1 E(original-size: \(serialized-size entry\)\))122 468 Q
(entry\)\)\)\)\)\)\) `)117 480 Q -.74(``)-.74 G -.15(Pa)72 504 S
(yload Summarization).15 E -.74(```)72 528 S
(scheme \(de\214ne \(summarize-lar).74 E(ge-payload payload\))-.18 E
("Summarize lar)77 540 Q(ge payloads for audit")-.18 E(\(if \(> \(byte)
77 552 Q -.15(ve)-.25 G(ctor).15 E(-length payload\) 1024\))-.2 E
(`\(\(type . summarized\))87 564 Q(\(original-size . ,\(byte)92 576 Q
-.15(ve)-.25 G(ctor).15 E(-length payload\)\))-.2 E
(\(hash . ,\(content-hash payload\)\))92 588 Q(\(pre)92 600 Q(vie)-.25 E
2.5(w.,)-.25 G(\(subbyte)-2.5 E -.15(ve)-.25 G(ctor payload 0 256\)\)\))
.15 E(payload\)\) `)87 612 Q -.74(``)-.74 G(---)72 636 Q(Aggre)72 660 Q
-.05(ga)-.15 G(tion).05 E(Ev)72 684 Q(ent Aggre)-.15 E -.05(ga)-.15 G
(tion).05 E -.74(```)72 708 S .476(scheme ;; Aggre).74 F -.05(ga)-.15 G
.476(te similar e).05 F -.15(ve)-.25 G .476(nts to reduce v).15 F .476
(olume \(de\214ne aggre)-.2 F -.05(ga)-.15 G(tion-windo).05 E 2.976(w6)
-.25 G 2.975(0\) ;)-2.976 F .475(seconds \(de\214ne pending-)2.975 F
(aggre)72 720 Q -.05(ga)-.15 G(tions \(mak).05 E(e-hash-table\)\))-.1 E
(\(de\214ne \(aggre)72 744 Q -.05(ga)-.15 G(te-audit-e).05 E -.15(ve)
-.25 G(nt action principal details\)).15 E("Aggre)77 756 Q -.05(ga)-.15
G(te similar e).05 E -.15(ve)-.25 G(nts within windo).15 E(w")-.25 E
(\(let* \(\(k)77 768 Q .3 -.15(ey \()-.1 H(list action principal\)\)).15
E(\(e)94.5 780 Q(xisting \(hash-table-ref pending-aggre)-.15 E -.05(ga)
-.15 G(tions k).05 E .3 -.15(ey #)-.1 H(f\)\)\)).15 E(\(if e)82 792 Q
(xisting)-.15 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; Add to e)92 12 Q(xisting aggre)-.15 E -.05
(ga)-.15 G(tion).05 E(\(be)92 24 Q(gin)-.15 E
(\(set-cdr! \(assoc 'count e)97 36 Q(xisting\))-.15 E
(\(+ 1 \(assoc-ref e)122 48 Q(xisting 'count\)\)\))-.15 E
(\(set-cdr! \(assoc ')97 60 Q(last-seen e)-.1 E(xisting\))-.15 E
(\(current-time\)\)\))122 72 Q(;; Start ne)92 84 Q 2.5(wa)-.25 G(ggre)
-2.5 E -.05(ga)-.15 G(tion).05 E(\(hash-table-set! pending-aggre)92 96 Q
-.05(ga)-.15 G(tions k).05 E -.15(ey)-.1 G(`\(\(action . ,action\))97
108 Q(\(principal . ,principal\))102 120 Q(\(count . 1\))102 132 Q
(\(\214rst-seen . ,\(current-time\)\))102 144 Q
(\(last-seen . ,\(current-time\)\))102 156 Q
(\(sample . ,details\)\)\)\)\)\))102 168 Q(\(de\214ne \(\215ush-aggre)72
192 Q -.05(ga)-.15 G(tions\)).05 E("Flush aggre)77 204 Q -.05(ga)-.15 G
(ted e).05 E -.15(ve)-.25 G(nts to audit log").15 E(\(hash-table-w)77
216 Q(alk pending-aggre)-.1 E -.05(ga)-.15 G(tions).05 E(\(lambda \(k)82
228 Q .3 -.15(ey a)-.1 H(gg\)).15 E
(\(when \(> \(- \(current-time\) \(assoc-ref agg '\214rst-seen\)\))87
240 Q(aggre)109.5 252 Q -.05(ga)-.15 G(tion-windo).05 E(w\))-.25 E
(\(audit-append-direct)92 264 Q(action: 'aggre)97 276 Q -.05(ga)-.15 G
(ted-e).05 E -.15(ve)-.25 G(nts).15 E
(original-action: \(assoc-ref agg 'action\))97 288 Q
(principal: \(assoc-ref agg 'principal\))97 300 Q
(count: \(assoc-ref agg 'count\))97 312 Q(windo)97 324 Q
(w-start: \(assoc-ref agg '\214rst-seen\))-.25 E(windo)97 336 Q
(w-end: \(assoc-ref agg ')-.25 E(last-seen\))-.1 E
(sample: \(assoc-ref agg ')97 348 Q(sample\)\))-.55 E
(\(hash-table-delete! pending-aggre)92 360 Q -.05(ga)-.15 G(tions k).05
E -.15(ey)-.1 G(\)\)\)\)\) `).15 E -.74(``)-.74 G(Sampling)72 384 Q -.74
(```)72 408 S(scheme ;; Sample high-v).74 E(olume e)-.2 E -.15(ve)-.25 G
(nts \(de\214ne \(should-sample? action principal\)).15 E
(\(let \(\(rate \(current-rate action principal\)\)\))77 420 Q(\(cond)82
432 Q(\(\(< rate 10\) #t\))87 444 Q 2.5(;A)35 G -.1(lwa)-2.5 G
(ys log lo).1 E(w-rate)-.25 E
(\(\(< rate 100\) \(< \(random 1.0\) 0.5\)\))87 456 Q 2.5(;5)5 G
(0% sample)-2.5 E
(\(\(< rate 1000\) \(< \(random 1.0\) 0.1\)\) ; 10% sample)87 468 Q
(\(else \(< \(random 1.0\) 0.01\)\)\)\)\))87 480 Q 2.5(;1)15 G 2.5(%s)
-2.5 G(ample)-2.5 E
(\(de\214ne \(audit-with-sampling action principal details\))72 504 Q
("Log with sampling for high-v)77 516 Q(olume e)-.2 E -.15(ve)-.25 G
(nts").15 E(\(if \(should-sample? action principal\))77 528 Q
(\(audit-append action: action)87 540 Q(principal: principal)122 552 Q
(details: details)122 564 Q(sampled: #t\))122 576 Q
(;; Still count for rate tracking)87 588 Q
(\(increment-audit-counter action principal\)\)\) `)87 600 Q -.74(``)
-.74 G(---)72 624 Q(Anomaly Detection)72 648 Q(Baseline Establishment)72
672 Q -.74(```)72 696 S
(scheme \(de\214ne \(establish-audit-baseline principal duration\)).74 E
("Establish normal audit patterns for principal")77 708 Q(\(let \(\(e)77
720 Q -.15(ve)-.25 G(nts \(soup-query type: 'audit-entry).15 E
(principal: principal)142 732 Q
(timestamp: \(> \(- \(current-time\) duration\)\)\)\)\))142 744 Q
(`\(\(e)82 756 Q -.15(ve)-.25 G(nts-per).15 E(-hour . ,\(/ \(length e)
-.2 E -.15(ve)-.25 G(nts\) \(/ duration 3600\)\)\)).15 E
(\(common-actions . ,\(top-n \(map audit-action e)87 768 Q -.15(ve)-.25
G(nts\) 10\)\)).15 E(\(typical-hours . ,\(typical-acti)87 780 Q -.15(ve)
-.25 G(-hours e).15 E -.15(ve)-.25 G(nts\)\)).15 E
(\(established-at . ,\(current-time\)\)\)\)\) `)87 792 Q -.74(``)-.74 G
0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Anomaly Detection)72 24 Q -.74(```)72 48 S(sche\
me \(de\214ne \(detect-audit-anomaly principal current-rate baseline\))
.74 E("Detect anomalous audit patterns")77 60 Q(\(let \(\(e)77 72 Q
(xpected \(assoc-ref baseline 'e)-.15 E -.15(ve)-.25 G(nts-per).15 E
(-hour\)\))-.2 E(\(threshold 3.0\)\))92 84 Q 2.5(;3)5 G 2.5(xn)-2.5 G
(ormal is anomalous)-2.5 E(\(when \(> current-rate \(* threshold e)82 96
Q(xpected\)\))-.15 E(\(audit-append-pri)87 108 Q(vile)-.25 E(ged)-.15 E
(action: 'audit-anomaly-detected)92 120 Q(principal: principal)92 132 Q
(current-rate: current-rate)92 144 Q -.15(ex)92 156 S(pected-rate: e).15
E(xpected)-.15 E(se)92 168 Q -.15(ve)-.25 G
(rity: \(if \(> current-rate \(* 10 e).15 E(xpected\)\))-.15 E
('critical)127 180 Q('w)127 192 Q(arning\)\))-.1 E
(;; Potentially throttle)87 204 Q(\(when \(> current-rate \(* 10 e)87
216 Q(xpected\)\))-.15 E(\(throttle-principal principal\)\)\)\)\) `)92
228 Q -.74(``)-.74 G(Flood Detection)72 252 Q -.74(```)72 276 S
(scheme \(de\214ne \(detect-audit-\215ood\)).74 E
("Detect system-wide audit \215ooding")77 288 Q
(\(let \(\(current-rate \(global-audit-rate\)\))77 300 Q
(\(threshold \(* 10 \(baseline-global-rate\)\)\)\))92 312 Q
(\(when \(> current-rate threshold\))82 324 Q(;; Identify top contrib)87
336 Q(utors)-.2 E
(\(let \(\(top-principals \(top-audit-principals 10\)\)\))87 348 Q
(\(audit-append-pri)92 360 Q(vile)-.25 E(ged)-.15 E
(action: 'audit-\215ood-detected)97 372 Q(global-rate: current-rate)97
384 Q(threshold: threshold)97 396 Q(top-principals: top-principals\))97
408 Q(;; Throttle top contrib)92 420 Q(utors)-.2 E(\(for)92 432 Q
(-each throttle-principal)-.2 E(\(map car top-principals\)\)\)\)\)\) `)
117 444 Q -.74(``)-.74 G(---)72 468 Q(Pri)72 492 Q(vile)-.25 E
(ged Logging)-.15 E(System Ev)72 516 Q(ents)-.15 E -.74(```)72 540 S
(scheme ;; Some e).74 E -.15(ve)-.25 G
(nts bypass rate limits \(de\214ne pri).15 E(vile)-.25 E(ged-actions)
-.15 E('\(audit-rate-limited)77 552 Q(audit-protection-enabled)82 564 Q
(audit-protection-disabled)82 576 Q(audit-anomaly-detected)82 588 Q
(audit-\215ood-detected)82 600 Q -.1(ke)82 612 S(y-ceremon)-.05 E(y)-.15
E(emer)82 624 Q(genc)-.18 E(y-re)-.15 E -.2(vo)-.25 G -.1(ke).2 G
(security-alert\)\))82 636 Q(\(de\214ne \(audit-append-pri)72 660 Q
(vile)-.25 E(ged . ar)-.15 E(gs\))-.18 E("Log pri)77 672 Q(vile)-.25 E
(ged e)-.15 E -.15(ve)-.25 G(nt \(bypasses rate limits\)").15 E
(\(let \(\(entry \(apply mak)77 684 Q(e-audit-entry ar)-.1 E(gs\)\)\))
-.18 E(;; Al)82 696 Q -.1(wa)-.1 G(ys log, ne).1 E -.15(ve)-.25 G 2.5
(rr).15 G(ate limit)-2.5 E(\(audit-write-direct entry\))82 708 Q
(;; Alert on pri)82 720 Q(vile)-.25 E(ged e)-.15 E -.15(ve)-.25 G(nts)
.15 E
(\(when \(member \(assoc-ref entry 'action\) '\(security-alert emer)82
732 Q(genc)-.18 E(y-re)-.15 E -.2(vo)-.25 G -.1(ke).2 G(\)\)).1 E
(\(send-security-alert entry\)\)\)\) `)87 744 Q -.74(``)-.74 G
(Guaranteed Deli)72 768 Q -.15(ve)-.25 G(ry).15 E -.74(```)72 792 S
(scheme \(de\214ne \(audit-write-guaranteed entry\)).74 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF("Write audit entry with guaranteed deli)77 12 Q
-.15(ve)-.25 G(ry").15 E(;; Write to multiple locations)77 24 Q
(\(let \(\(locations \(list \(primary-audit-log\))77 36 Q
(\(secondary-audit-log\))134.5 48 Q(\(remote-audit-log\)\)\)\))134.5 60
Q(\(let \(\(successes \(\214lter \(lambda \(loc\))82 72 Q(\(guard \(e)
149.5 84 Q 2.5(x\()-.15 G(else #f\)\))-2.5 E(\(audit-write loc entry\))
154.5 96 Q(#t\)\))154.5 108 Q(locations\)\)\))144.5 120 Q
(\(when \(< \(length successes\) 2\))87 132 Q(;; F)92 144 Q
(ailed to write to enough locations)-.15 E(\(emer)92 156 Q(genc)-.18 E
(y-audit-alert entry successes\)\)\)\)\) `)-.15 E -.74(``)-.74 G(---)72
180 Q(Inte)72 204 Q(grity Protection)-.15 E(Append-Only Enforcement)72
228 Q -.74(```)72 252 S(scheme ;; Audit log is strictly append-only \(d\
e\214ne \(audit-write entry\)).74 E("Append entry to audit log")77 264 Q
(\(let \(\(log \(current-audit-log\)\)\))77 276 Q(;; V)82 288 Q
(erify we')-1.11 E(re at the end)-.5 E(\(unless \(at-log-end? log\))82
300 Q(\(error 'audit-log-not-at-end\)\))87 312 Q
(;; Append with sequence number)82 324 Q(\(let \(\(seq \(ne)82 336 Q
(xt-sequence-number log\)\)\))-.15 E
(\(write-entry log \(cons `\(sequence . ,seq\) entry\)\))87 348 Q
(;; Sign the entry)87 360 Q(\(sign-entry log entry\)\)\)\) `)87 372 Q
-.74(``)-.74 G(Chain Inte)72 396 Q(grity)-.15 E -.74(```)72 420 S
(scheme ;; Each entry references pre).74 E
(vious \(blockchain-style\) \(de\214ne \(chain-entry entry pre)-.25 E
(vious-hash\))-.25 E(`\(\(pre)77 432 Q(vious-hash . ,pre)-.25 E
(vious-hash\))-.25 E(\(sequence . ,\(+ 1 \(pre)82 444 Q
(vious-sequence\)\)\))-.25 E(\(timestamp . ,\(current-time\)\))82 456 Q
(,@entry)82 468 Q(\(hash . ,\(compute-entry-hash entry pre)82 480 Q
(vious-hash\)\)\)\))-.25 E(\(de\214ne \(v)72 504 Q
(erify-audit-chain log\))-.15 E("V)77 516 Q(erify audit log chain inte)
-1.11 E(grity")-.15 E(\(let loop \(\(entries \(audit-entries log\)\))77
528 Q(\(e)104.5 540 Q(xpected-pre)-.15 E 2.5(v#)-.25 G(f\)\))-2.5 E
(\(if \(null? entries\))82 552 Q(#t)92 564 Q
(\(let \(\(entry \(car entries\)\)\))92 576 Q(\(and \(or \(not e)97 588
Q(xpected-pre)-.15 E(v\))-.25 E(\(equal? \(assoc-ref entry 'pre)119.5
600 Q(vious-hash\) e)-.25 E(xpected-pre)-.15 E(v\)\))-.25 E
(\(loop \(cdr entries\))109.5 612 Q
(\(assoc-ref entry 'hash\)\)\)\)\)\)\) `)124.5 624 Q -.74(``)-.74 G(---)
72 648 Q(Reco)72 672 Q -.15(ve)-.15 G(ry).15 E(Log Reconstruction)72 696
Q -.74(```)72 720 S(scheme \(de\214ne \(reconstruct-audit-log backups\))
.74 E("Reconstruct audit log from multiple backups")77 732 Q
(\(let \(\(entries \(mer)77 744 Q(ge-backup-entries backups\)\)\))-.18 E
(;; Deduplicate by sequence number)82 756 Q
(\(let \(\(deduped \(deduplicate-by-sequence entries\)\)\))82 768 Q
(;; V)87 780 Q(erify chain)-1.11 E(\(unless \(v)87 792 Q
(erify-audit-chain deduped\))-.15 E 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(error 'audit-chain-brok)92 12 Q(en\)\))-.1 E
(deduped\)\)\) `)87 24 Q -.74(``)-.74 G(Gap Detection)72 48 Q -.74(```)
72 72 S(scheme \(de\214ne \(detect-audit-g).74 E(aps log\))-.05 E
("Find g)77 84 Q(aps in audit sequence")-.05 E
(\(let loop \(\(entries \(audit-entries log\)\))77 96 Q(\(e)104.5 108 Q
(xpected-seq 1\))-.15 E(\(g)104.5 120 Q(aps '\(\)\)\))-.05 E
(\(if \(null? entries\))82 132 Q -.05(ga)92 144 S(ps).05 E
(\(let \(\(seq \(assoc-ref \(car entries\) ')92 156 Q(sequence\)\)\))
-.55 E(\(if \(= seq e)97 168 Q(xpected-seq\))-.15 E
(\(loop \(cdr entries\) \(+ seq 1\) g)107 180 Q(aps\))-.05 E
(\(loop \(cdr entries\) \(+ seq 1\))107 192 Q(\(cons \(list e)122 204 Q
(xpected-seq \(- seq 1\)\) g)-.15 E(aps\)\)\)\)\)\)\) `)-.05 E -.74(``)
-.74 G(---)72 228 Q(References)72 252 Q 4.92(1. [NIST SP 800-92: Guide \
to Computer Security Log Management]\(https://csrc.nist.go)72 276 R
(v/publications/de-)-.15 E 1.547
(tail/sp/800-92/\214nal\) 2. [RFC-003: Cryptographic Audit T)72 288 R
1.546(rail]\(rfc-003-audit-trail.md\) 3. [RFC-032: Rate Limiting)-.35 F
(and Quotas]\(rfc-032-rate-limiting.md\) 4. [RFC-028: Error Handling an\
d Reco)72 300 Q -.15(ve)-.15 G(ry]\(rfc-028-error).15 E(-handling.md\))
-.2 E(---)72 324 Q(Changelog)72 348 Q 2.5(-*)72 372 S
(*2026-01-07** - Initial draft)-2.5 E(---)72 396 Q .956(**Implementatio\
n Status:** Draft **Dependencies:** audit, storage, monitoring **Inte)72
420 R .956(gration:** All v)-.15 F .956(ault opera-)-.25 F
(tions, security monitoring, forensics)72 432 Q 0 Cg EP
%%Trailer
end
%%EOF
