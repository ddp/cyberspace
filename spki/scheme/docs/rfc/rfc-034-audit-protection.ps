%!PS-Adobe-3.0
%%BoundingBox: 24 24 571 818
%%Title: Enscript Output
%%For: Derrell Piper
%%Creator: GNU Enscript 1.6.6
%%CreationDate: Fri Jan  9 11:51:24 2026
%%Orientation: Portrait
%%Pages: (atend)
%%DocumentMedia: A4 595 842 0 () ()
%%DocumentNeededResources: (atend)
%%EndComments
%%BeginProlog
%%BeginResource: procset Enscript-Prolog 1.6 6
%
% Procedures.
%

/_S {	% save current state
  /_s save def
} def
/_R {	% restore from saved state
  _s restore
} def

/S {	% showpage protecting gstate
  gsave
  showpage
  grestore
} bind def

/MF {	% fontname newfontname -> -	make a new encoded font
  /newfontname exch def
  /fontname exch def

  /fontdict fontname findfont def
  /newfont fontdict maxlength dict def

  fontdict {
    exch
    dup /FID eq {
      % skip FID pair
      pop pop
    } {
      % copy to the new font dictionary
      exch newfont 3 1 roll put
    } ifelse
  } forall

  newfont /FontName newfontname put

  % insert only valid encoding vectors
  encoding_vector length 256 eq {
    newfont /Encoding encoding_vector put
  } if

  newfontname newfont definefont pop
} def

/MF_PS { % fontname newfontname -> -	make a new font preserving its enc
  /newfontname exch def
  /fontname exch def

  /fontdict fontname findfont def
  /newfont fontdict maxlength dict def

  fontdict {
    exch
    dup /FID eq {
      % skip FID pair
      pop pop
    } {
      % copy to the new font dictionary
      exch newfont 3 1 roll put
    } ifelse
  } forall

  newfont /FontName newfontname put

  newfontname newfont definefont pop
} def

/SF { % fontname width height -> -	set a new font
  /height exch def
  /width exch def

  findfont
  [width 0 0 height 0 0] makefont setfont
} def

/SUF { % fontname width height -> -	set a new user font
  /height exch def
  /width exch def

  /F-gs-user-font MF
  /F-gs-user-font width height SF
} def

/SUF_PS { % fontname width height -> -	set a new user font preserving its enc
  /height exch def
  /width exch def

  /F-gs-user-font MF_PS
  /F-gs-user-font width height SF
} def

/M {moveto} bind def
/s {show} bind def

/Box {	% x y w h -> -			define box path
  /d_h exch def /d_w exch def /d_y exch def /d_x exch def
  d_x d_y  moveto
  d_w 0 rlineto
  0 d_h rlineto
  d_w neg 0 rlineto
  closepath
} def

/bgs {	% x y height blskip gray str -> -	show string with bg color
  /str exch def
  /gray exch def
  /blskip exch def
  /height exch def
  /y exch def
  /x exch def

  gsave
    x y blskip sub str stringwidth pop height Box
    gray setgray
    fill
  grestore
  x y M str s
} def

/bgcs { % x y height blskip red green blue str -> -  show string with bg color
  /str exch def
  /blue exch def
  /green exch def
  /red exch def
  /blskip exch def
  /height exch def
  /y exch def
  /x exch def

  gsave
    x y blskip sub str stringwidth pop height Box
    red green blue setrgbcolor
    fill
  grestore
  x y M str s
} def

% Highlight bars.
/highlight_bars {	% nlines lineheight output_y_margin gray -> -
  gsave
    setgray
    /ymarg exch def
    /lineheight exch def
    /nlines exch def

    % This 2 is just a magic number to sync highlight lines to text.
    0 d_header_y ymarg sub 2 sub translate

    /cw d_output_w cols div def
    /nrows d_output_h ymarg 2 mul sub lineheight div cvi def

    % for each column
    0 1 cols 1 sub {
      cw mul /xp exch def

      % for each rows
      0 1 nrows 1 sub {
        /rn exch def
        rn lineheight mul neg /yp exch def
        rn nlines idiv 2 mod 0 eq {
	  % Draw highlight bar.  4 is just a magic indentation.
	  xp 4 add yp cw 8 sub lineheight neg Box fill
	} if
      } for
    } for

  grestore
} def

% Line highlight bar.
/line_highlight {	% x y width height gray -> -
  gsave
    /gray exch def
    Box gray setgray fill
  grestore
} def

% Column separator lines.
/column_lines {
  gsave
    .1 setlinewidth
    0 d_footer_h translate
    /cw d_output_w cols div def
    1 1 cols 1 sub {
      cw mul 0 moveto
      0 d_output_h rlineto stroke
    } for
  grestore
} def

% Column borders.
/column_borders {
  gsave
    .1 setlinewidth
    0 d_footer_h moveto
    0 d_output_h rlineto
    d_output_w 0 rlineto
    0 d_output_h neg rlineto
    closepath stroke
  grestore
} def

% Do the actual underlay drawing
/draw_underlay {
  ul_style 0 eq {
    ul_str true charpath stroke
  } {
    ul_str show
  } ifelse
} def

% Underlay
/underlay {	% - -> -
  gsave
    0 d_page_h translate
    d_page_h neg d_page_w atan rotate

    ul_gray setgray
    ul_font setfont
    /dw d_page_h dup mul d_page_w dup mul add sqrt def
    ul_str stringwidth pop dw exch sub 2 div ul_h_ptsize -2 div moveto
    draw_underlay
  grestore
} def

/user_underlay {	% - -> -
  gsave
    ul_x ul_y translate
    ul_angle rotate
    ul_gray setgray
    ul_font setfont
    0 0 ul_h_ptsize 2 div sub moveto
    draw_underlay
  grestore
} def

% Page prefeed
/page_prefeed {		% bool -> -
  statusdict /prefeed known {
    statusdict exch /prefeed exch put
  } {
    pop
  } ifelse
} def

% Wrapped line markers
/wrapped_line_mark {	% x y charwith charheight type -> -
  /type exch def
  /h exch def
  /w exch def
  /y exch def
  /x exch def

  type 2 eq {
    % Black boxes (like TeX does)
    gsave
      0 setlinewidth
      x w 4 div add y M
      0 h rlineto w 2 div 0 rlineto 0 h neg rlineto
      closepath fill
    grestore
  } {
    type 3 eq {
      % Small arrows
      gsave
        .2 setlinewidth
        x w 2 div add y h 2 div add M
        w 4 div 0 rlineto
        x w 4 div add y lineto stroke

        x w 4 div add w 8 div add y h 4 div add M
        x w 4 div add y lineto
	w 4 div h 8 div rlineto stroke
      grestore
    } {
      % do nothing
    } ifelse
  } ifelse
} def

% EPSF import.

/BeginEPSF {
  /b4_Inc_state save def    		% Save state for cleanup
  /dict_count countdictstack def	% Count objects on dict stack
  /op_count count 1 sub def		% Count objects on operand stack
  userdict begin
  /showpage { } def
  0 setgray 0 setlinecap
  1 setlinewidth 0 setlinejoin
  10 setmiterlimit [ ] 0 setdash newpath
  /languagelevel where {
    pop languagelevel
    1 ne {
      false setstrokeadjust false setoverprint
    } if
  } if
} bind def

/EndEPSF {
  count op_count sub { pos } repeat	% Clean up stacks
  countdictstack dict_count sub { end } repeat
  b4_Inc_state restore
} bind def

% Check PostScript language level.
/languagelevel where {
  pop /gs_languagelevel languagelevel def
} {
  /gs_languagelevel 1 def
} ifelse
%%EndResource
%%BeginResource: procset Enscript-Encoding-88591 1.6 6
/encoding_vector [
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/space        	/exclam       	/quotedbl     	/numbersign   	
/dollar       	/percent      	/ampersand    	/quoteright   	
/parenleft    	/parenright   	/asterisk     	/plus         	
/comma        	/hyphen       	/period       	/slash        	
/zero         	/one          	/two          	/three        	
/four         	/five         	/six          	/seven        	
/eight        	/nine         	/colon        	/semicolon    	
/less         	/equal        	/greater      	/question     	
/at           	/A            	/B            	/C            	
/D            	/E            	/F            	/G            	
/H            	/I            	/J            	/K            	
/L            	/M            	/N            	/O            	
/P            	/Q            	/R            	/S            	
/T            	/U            	/V            	/W            	
/X            	/Y            	/Z            	/bracketleft  	
/backslash    	/bracketright 	/asciicircum  	/underscore   	
/quoteleft    	/a            	/b            	/c            	
/d            	/e            	/f            	/g            	
/h            	/i            	/j            	/k            	
/l            	/m            	/n            	/o            	
/p            	/q            	/r            	/s            	
/t            	/u            	/v            	/w            	
/x            	/y            	/z            	/braceleft    	
/bar          	/braceright   	/tilde        	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/space        	/exclamdown   	/cent         	/sterling     	
/currency     	/yen          	/brokenbar    	/section      	
/dieresis     	/copyright    	/ordfeminine  	/guillemotleft	
/logicalnot   	/hyphen       	/registered   	/macron       	
/degree       	/plusminus    	/twosuperior  	/threesuperior	
/acute        	/mu           	/paragraph    	/bullet       	
/cedilla      	/onesuperior  	/ordmasculine 	/guillemotright	
/onequarter   	/onehalf      	/threequarters	/questiondown 	
/Agrave       	/Aacute       	/Acircumflex  	/Atilde       	
/Adieresis    	/Aring        	/AE           	/Ccedilla     	
/Egrave       	/Eacute       	/Ecircumflex  	/Edieresis    	
/Igrave       	/Iacute       	/Icircumflex  	/Idieresis    	
/Eth          	/Ntilde       	/Ograve       	/Oacute       	
/Ocircumflex  	/Otilde       	/Odieresis    	/multiply     	
/Oslash       	/Ugrave       	/Uacute       	/Ucircumflex  	
/Udieresis    	/Yacute       	/Thorn        	/germandbls   	
/agrave       	/aacute       	/acircumflex  	/atilde       	
/adieresis    	/aring        	/ae           	/ccedilla     	
/egrave       	/eacute       	/ecircumflex  	/edieresis    	
/igrave       	/iacute       	/icircumflex  	/idieresis    	
/eth          	/ntilde       	/ograve       	/oacute       	
/ocircumflex  	/otilde       	/odieresis    	/divide       	
/oslash       	/ugrave       	/uacute       	/ucircumflex  	
/udieresis    	/yacute       	/thorn        	/ydieresis    	
] def
%%EndResource
%%EndProlog
%%BeginSetup
%%IncludeResource: font Courier-Bold
%%IncludeResource: font Courier
/HFpt_w 10 def
/HFpt_h 10 def
/Courier-Bold /HF-gs-font MF
/HF /HF-gs-font findfont [HFpt_w 0 0 HFpt_h 0 0] makefont def
/Courier /F-gs-font MF
/F-gs-font 10 10 SF
/#copies 1 def
% Pagedevice definitions:
gs_languagelevel 1 gt {
  <<
    /PageSize [595 842] 
  >> setpagedevice
} if
/d_page_w 547 def
/d_page_h 794 def
/d_header_x 0 def
/d_header_y 794 def
/d_header_w 547 def
/d_header_h 0 def
/d_footer_x 0 def
/d_footer_y 0 def
/d_footer_w 547 def
/d_footer_h 0 def
/d_output_w 547 def
/d_output_h 794 def
/cols 1 def
%%EndSetup
%%Page: (1) 1
%%BeginPageSetup
_S
24 24 translate
/pagenum 1 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(RFC-034: Audit Log Protection) s
5 759 M
(Status: Draft) s
5 748 M
(Date: January 2026) s
5 737 M
(Author: Derrell Piper <ddp@eludom.net>) s
5 726 M
(Implementation: Proposed) s
5 704 M
(------------------------------------------------------------------------------) s
5 682 M
(Abstract) s
5 660 M
(This RFC specifies protection mechanisms for the Library of Cyberspace audit log: how the) s
5 649 M
( system prevents resource exhaustion, log flooding, and denial of service attacks against) s
5 638 M
( the audit trail while maintaining its integrity as the authoritative record of all vault) s
5 627 M
( operations.) s
5 605 M
(------------------------------------------------------------------------------) s
5 583 M
(Motivation) s
5 561 M
(The audit log is sacred:) s
5 539 M
(- Evidence - Legal and forensic record) s
5 528 M
(- Accountability - Who did what when) s
5 517 M
(- Recovery - Reconstruct state after failure) s
5 506 M
(- Trust - Foundation of the security model) s
5 484 M
(But the audit log is also a target:) s
5 462 M
(- Flooding - Generate noise to hide malicious activity) s
5 451 M
(- Exhaustion - Fill storage to halt operations) s
5 440 M
(- Evasion - Overwhelm to prevent logging of real attacks) s
5 429 M
(- Amplification - Small action triggers large log entries) s
5 407 M
(The audit log must protect itself while never failing to record.) s
5 385 M
(------------------------------------------------------------------------------) s
5 363 M
(Threat Model) s
5 341 M
(Attack Vectors) s
5 319 M
(`scheme) s
5 308 M
(\(define audit-threats) s
5 297 M
(  '\(\(flooding) s
5 286 M
(     \(description "Generate massive log volume"\)) s
5 275 M
(     \(goal "Hide malicious activity in noise"\)) s
5 264 M
(     \(method "Rapid legitimate-looking operations"\)\)) s
5 242 M
(    \(exhaustion) s
5 231 M
(     \(description "Fill audit storage"\)) s
5 220 M
(     \(goal "Halt vault operations"\)) s
5 209 M
(     \(method "Sustained high-volume logging"\)\)) s
5 187 M
(    \(amplification) s
5 176 M
(     \(description "Small input, large log output"\)) s
5 165 M
(     \(goal "Asymmetric resource consumption"\)) s
5 154 M
(     \(method "Operations that log disproportionately"\)\)) s
5 132 M
(    \(corruption) s
5 121 M
(     \(description "Tamper with log entries"\)) s
5 110 M
(     \(goal "Alter historical record"\)) s
5 99 M
(     \(method "Exploit write access to log storage"\)\)) s
5 77 M
(    \(truncation) s
5 66 M
(     \(description "Force log rotation/deletion"\)) s
5 55 M
(     \(goal "Remove evidence"\)) s
5 44 M
(     \(method "Fill logs to trigger cleanup"\)\)\)\)) s
5 33 M
(`) s
5 11 M
(Attacker Capabilities) s
_R
S
%%Page: (2) 2
%%BeginPageSetup
_S
24 24 translate
/pagenum 2 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 770 M
(`scheme) s
5 759 M
(;; Assume attacker can:) s
5 748 M
(;; - Authenticate as a valid principal) s
5 737 M
(;; - Perform many legitimate operations) s
5 726 M
(;; - Control timing of operations) s
5 715 M
(;; - Observe system behavior) s
5 693 M
(;; Assume attacker cannot:) s
5 682 M
(;; - Directly write to audit storage) s
5 671 M
(;; - Forge signatures on log entries) s
5 660 M
(;; - Break cryptographic primitives) s
5 649 M
(`) s
5 627 M
(------------------------------------------------------------------------------) s
5 605 M
(Rate Limiting) s
5 583 M
(Per-Principal Audit Limits) s
5 561 M
(`scheme) s
5 550 M
(\(define audit-rate-limits) s
5 539 M
(  `\(\(entries-per-second . 100\)) s
5 528 M
(    \(bytes-per-second . 102400\)      ; 100KB/s) s
5 517 M
(    \(entries-per-minute . 1000\)) s
5 506 M
(    \(bytes-per-minute . 10485760\)\)\)  ; 10MB/min) s
5 484 M
(\(define principal-audit-buckets \(make-hash-table\)\)) s
5 462 M
(\(define \(get-audit-bucket principal\)) s
5 451 M
(  \(or \(hash-table-ref principal-audit-buckets principal #f\)) s
5 440 M
(      \(let \(\(bucket \(make-token-bucket) s
5 429 M
(                     \(assoc-ref audit-rate-limits 'entries-per-second\)) s
5 418 M
(                     \(assoc-ref audit-rate-limits 'entries-per-second\)\)\)\)) s
5 407 M
(        \(hash-table-set! principal-audit-buckets principal bucket\)) s
5 396 M
(        bucket\)\)\)) s
5 374 M
(\(define \(audit-rate-check principal entry-size\)) s
5 363 M
(  "Check if principal can generate audit entry") s
5 352 M
(  \(let \(\(bucket \(get-audit-bucket principal\)\)\)) s
5 341 M
(    \(bucket 1\)\)\)  ; Consume one token) s
5 330 M
(`) s
5 308 M
(Audit Entry Costing) s
5 286 M
(`scheme) s
5 275 M
(;; Different operations have different audit costs) s
5 264 M
(\(define audit-costs) s
5 253 M
(  `\(\(read . 1\)) s
5 242 M
(    \(write . 2\)) s
5 231 M
(    \(delete . 5\)) s
5 220 M
(    \(query . 1\)) s
5 209 M
(    \(admin . 10\)) s
5 198 M
(    \(key-operation . 50\)) s
5 187 M
(    \(emergency . 0\)\)\)  ; Always allowed) s
5 165 M
(\(define \(audit-cost action\)) s
5 154 M
(  \(or \(assoc-ref audit-costs action\) 1\)\)) s
5 132 M
(\(define \(consume-audit-budget principal action\)) s
5 121 M
(  "Deduct from principal's audit budget") s
5 110 M
(  \(let \(\(cost \(audit-cost action\)\)) s
5 99 M
(        \(bucket \(get-audit-bucket principal\)\)\)) s
5 88 M
(    \(if \(bucket cost\)) s
5 77 M
(        #t) s
5 66 M
(        \(begin) s
5 55 M
(          ;; Log the rate limit event \(always succeeds\)) s
5 44 M
(          \(audit-append-privileged) s
5 33 M
(            action: 'audit-rate-limited) s
5 22 M
(            principal: principal) s
5 11 M
(            attempted-action: action\)) s
_R
S
%%Page: (3) 3
%%BeginPageSetup
_S
24 24 translate
/pagenum 3 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(          #f\)\)\)\)) s
5 770 M
(`) s
5 748 M
(Burst Handling) s
5 726 M
(`scheme) s
5 715 M
(;; Allow short bursts but limit sustained rate) s
5 704 M
(\(define \(make-audit-limiter\)) s
5 693 M
(  \(let \(\(short-term \(make-token-bucket 200 100\)\)   ; 100/s, burst 200) s
5 682 M
(        \(long-term \(make-sliding-window 10000 60\)\)\) ; 10k/min) s
5 671 M
(    \(lambda \(cost\)) s
5 660 M
(      \(and \(short-term cost\)) s
5 649 M
(           \(long-term\)\)\)\)\)) s
5 638 M
(`) s
5 616 M
(------------------------------------------------------------------------------) s
5 594 M
(Storage Protection) s
5 572 M
(Reserved Audit Space) s
5 550 M
(`scheme) s
5 539 M
(;; Always reserve space for audit) s
5 528 M
(\(define audit-reserved-space \(* 1024 1024 1024\)\)  ; 1GB minimum) s
5 506 M
(\(define \(audit-storage-available\)) s
5 495 M
(  \(let \(\(total \(storage-available\)\)) s
5 484 M
(        \(audit-used \(audit-storage-used\)\)\)) s
5 473 M
(    \(max 0 \(- total audit-reserved-space\)\)\)\)) s
5 451 M
(\(define \(check-audit-storage entry-size\)) s
5 440 M
(  "Ensure space for audit entry") s
5 429 M
(  \(let \(\(available \(audit-storage-available\)\)\)) s
5 418 M
(    \(when \(< available entry-size\)) s
5 407 M
(      ;; Emergency: halt non-audit operations) s
5 396 M
(      \(enter-audit-protection-mode\)) s
5 385 M
(      ;; But always log) s
5 374 M
(      #t\)\)\)) s
5 363 M
(`) s
5 341 M
(Audit Protection Mode) s
5 319 M
(`scheme) s
5 308 M
(\(define audit-protection-mode? \(make-parameter #f\)\)) s
5 286 M
(\(define \(enter-audit-protection-mode\)) s
5 275 M
(  "Emergency mode: only allow audit writes") s
5 264 M
(  \(audit-protection-mode? #t\)) s
5 253 M
(  \(audit-append-privileged) s
5 242 M
(    action: 'audit-protection-enabled) s
5 231 M
(    reason: 'storage-exhaustion\)) s
5 220 M
(  ;; Reject all non-essential operations) s
5 209 M
(  \(set-vault-mode! 'audit-only\)\)) s
5 187 M
(\(define \(exit-audit-protection-mode\)) s
5 176 M
(  "Resume normal operations") s
5 165 M
(  \(when \(> \(audit-storage-available\) \( 2 audit-reserved-space*\)\)) s
5 154 M
(    \(audit-protection-mode? #f\)) s
5 143 M
(    \(set-vault-mode! 'normal\)) s
5 132 M
(    \(audit-append-privileged) s
5 121 M
(      action: 'audit-protection-disabled\)\)\)) s
5 110 M
(`) s
5 88 M
(Tiered Storage) s
5 66 M
(`scheme) s
5 55 M
(;; Audit log tiers) s
5 44 M
(\(define audit-tiers) s
5 33 M
(  '\(\(hot . \(\(retention . 86400\)      ; 1 day) s
5 22 M
(            \(storage . ssd\)) s
5 11 M
(            \(compression . none\)\)\)) s
_R
S
%%Page: (4) 4
%%BeginPageSetup
_S
24 24 translate
/pagenum 4 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(    \(warm . \(\(retention . 604800\)    ; 7 days) s
5 770 M
(             \(storage . hdd\)) s
5 759 M
(             \(compression . zstd-fast\)\)\)) s
5 748 M
(    \(cold . \(\(retention . 31536000\)  ; 1 year) s
5 737 M
(             \(storage . archive\)) s
5 726 M
(             \(compression . zstd-max\)\)\)) s
5 715 M
(    \(glacier . \(\(retention . #f\)     ; Forever) s
5 704 M
(                \(storage . offsite\)) s
5 693 M
(                \(compression . zstd-max\)\)\)\)\)) s
5 671 M
(\(define \(tier-audit-entry entry age\)) s
5 660 M
(  "Move entry to appropriate storage tier") s
5 649 M
(  \(let \(\(tier \(find \(lambda \(t\)) s
5 638 M
(                      \(or \(not \(assoc-ref \(cdr t\) 'retention\)\)) s
5 627 M
(                          \(< age \(assoc-ref \(cdr t\) 'retention\)\)\)\)) s
5 616 M
(                    audit-tiers\)\)\)) s
5 605 M
(    \(migrate-to-tier entry \(car tier\)\)\)\)) s
5 594 M
(`) s
5 572 M
(------------------------------------------------------------------------------) s
5 550 M
(Entry Size Limits) s
5 528 M
(Maximum Entry Size) s
5 506 M
(`scheme) s
5 495 M
(\(define max-audit-entry-size 65536\)  ; 64KB) s
5 473 M
(\(define \(validate-audit-entry entry\)) s
5 462 M
(  "Validate entry before logging") s
5 451 M
(  \(let \(\(size \(serialized-size entry\)\)\)) s
5 440 M
(    \(when \(> size max-audit-entry-size\)) s
5 429 M
(      \(error 'audit-entry-too-large) s
5 418 M
(             `\(\(size . ,size\)) s
5 407 M
(               \(limit . ,max-audit-entry-size\)\)\)\)\)\)) s
5 396 M
(`) s
5 374 M
(Entry Truncation) s
5 352 M
(`scheme) s
5 341 M
(\(define \(truncate-audit-entry entry max-size\)) s
5 330 M
(  "Truncate oversized entry while preserving critical fields") s
5 319 M
(  \(let \(\(critical '\(action principal timestamp hash signature\)\)\)) s
5 308 M
(    \(let loop \(\(entry entry\)) s
5 297 M
(               \(fields \(entry-fields entry\)\)\)) s
5 286 M
(      \(if \(<= \(serialized-size entry\) max-size\)) s
5 275 M
(          entry) s
5 264 M
(          \(let \(\(removable \(find \(lambda \(f\)) s
5 253 M
(                                   \(not \(member f critical\)\)\)) s
5 242 M
(                                 fields\)\)\)) s
5 231 M
(            \(if removable) s
5 220 M
(                \(loop \(assoc-remove entry removable\)) s
5 209 M
(                      \(delete removable fields\)\)) s
5 198 M
(                ;; Can't truncate further, log warning) s
5 187 M
(                \(begin) s
5 176 M
(                  \(audit-append-privileged) s
5 165 M
(                    action: 'audit-entry-truncation-failed) s
5 154 M
(                    original-size: \(serialized-size entry\)\)) s
5 143 M
(                  entry\)\)\)\)\)\)\)) s
5 132 M
(`) s
5 110 M
(Payload Summarization) s
5 88 M
(`scheme) s
5 77 M
(\(define \(summarize-large-payload payload\)) s
5 66 M
(  "Summarize large payloads for audit") s
5 55 M
(  \(if \(> \(bytevector-length payload\) 1024\)) s
5 44 M
(      `\(\(type . summarized\)) s
5 33 M
(        \(original-size . ,\(bytevector-length payload\)\)) s
5 22 M
(        \(hash . ,\(content-hash payload\)\)) s
5 11 M
(        \(preview . ,\(subbytevector payload 0 256\)\)\)) s
_R
S
%%Page: (5) 5
%%BeginPageSetup
_S
24 24 translate
/pagenum 5 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(      payload\)\)) s
5 770 M
(`) s
5 748 M
(------------------------------------------------------------------------------) s
5 726 M
(Aggregation) s
5 704 M
(Event Aggregation) s
5 682 M
(`scheme) s
5 671 M
(;; Aggregate similar events to reduce volume) s
5 660 M
(\(define aggregation-window 60\)  ; seconds) s
5 649 M
(\(define pending-aggregations \(make-hash-table\)\)) s
5 627 M
(\(define \(aggregate-audit-event action principal details\)) s
5 616 M
(  "Aggregate similar events within window") s
5 605 M
(  \(let* \(\(key \(list action principal\)\)) s
5 594 M
(         \(existing \(hash-table-ref pending-aggregations key #f\)\)\)) s
5 583 M
(    \(if existing) s
5 572 M
(        ;; Add to existing aggregation) s
5 561 M
(        \(begin) s
5 550 M
(          \(set-cdr! \(assoc 'count existing\)) s
5 539 M
(                    \(+ 1 \(assoc-ref existing 'count\)\)\)) s
5 528 M
(          \(set-cdr! \(assoc 'last-seen existing\)) s
5 517 M
(                    \(current-time\)\)\)) s
5 506 M
(        ;; Start new aggregation) s
5 495 M
(        \(hash-table-set! pending-aggregations key) s
5 484 M
(          `\(\(action . ,action\)) s
5 473 M
(            \(principal . ,principal\)) s
5 462 M
(            \(count . 1\)) s
5 451 M
(            \(first-seen . ,\(current-time\)\)) s
5 440 M
(            \(last-seen . ,\(current-time\)\)) s
5 429 M
(            \(sample . ,details\)\)\)\)\)\)) s
5 407 M
(\(define \(flush-aggregations\)) s
5 396 M
(  "Flush aggregated events to audit log") s
5 385 M
(  \(hash-table-walk pending-aggregations) s
5 374 M
(    \(lambda \(key agg\)) s
5 363 M
(      \(when \(> \(- \(current-time\) \(assoc-ref agg 'first-seen\)\)) s
5 352 M
(               aggregation-window\)) s
5 341 M
(        \(audit-append-direct) s
5 330 M
(          action: 'aggregated-events) s
5 319 M
(          original-action: \(assoc-ref agg 'action\)) s
5 308 M
(          principal: \(assoc-ref agg 'principal\)) s
5 297 M
(          count: \(assoc-ref agg 'count\)) s
5 286 M
(          window-start: \(assoc-ref agg 'first-seen\)) s
5 275 M
(          window-end: \(assoc-ref agg 'last-seen\)) s
5 264 M
(          sample: \(assoc-ref agg 'sample\)\)) s
5 253 M
(        \(hash-table-delete! pending-aggregations key\)\)\)\)\)) s
5 242 M
(`) s
5 220 M
(Sampling) s
5 198 M
(`scheme) s
5 187 M
(;; Sample high-volume events) s
5 176 M
(\(define \(should-sample? action principal\)) s
5 165 M
(  \(let \(\(rate \(current-rate action principal\)\)\)) s
5 154 M
(    \(cond) s
5 143 M
(      \(\(< rate 10\) #t\)              ; Always log low-rate) s
5 132 M
(      \(\(< rate 100\) \(< \(random 1.0\) 0.5\)\)  ; 50% sample) s
5 121 M
(      \(\(< rate 1000\) \(< \(random 1.0\) 0.1\)\) ; 10% sample) s
5 110 M
(      \(else \(< \(random 1.0\) 0.01\)\)\)\)\)      ; 1% sample) s
5 88 M
(\(define \(audit-with-sampling action principal details\)) s
5 77 M
(  "Log with sampling for high-volume events") s
5 66 M
(  \(if \(should-sample? action principal\)) s
5 55 M
(      \(audit-append action: action) s
5 44 M
(                    principal: principal) s
5 33 M
(                    details: details) s
5 22 M
(                    sampled: #t\)) s
5 11 M
(      ;; Still count for rate tracking) s
_R
S
%%Page: (6) 6
%%BeginPageSetup
_S
24 24 translate
/pagenum 6 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(      \(increment-audit-counter action principal\)\)\)) s
5 770 M
(`) s
5 748 M
(------------------------------------------------------------------------------) s
5 726 M
(Anomaly Detection) s
5 704 M
(Baseline Establishment) s
5 682 M
(`scheme) s
5 671 M
(\(define \(establish-audit-baseline principal duration\)) s
5 660 M
(  "Establish normal audit patterns for principal") s
5 649 M
(  \(let \(\(events \(soup-query type: 'audit-entry) s
5 638 M
(                            principal: principal) s
5 627 M
(                            timestamp: \(> \(- \(current-time\) duration\)\)\)\)\)) s
5 616 M
(    `\(\(events-per-hour . ,\(/ \(length events\) \(/ duration 3600\)\)\)) s
5 605 M
(      \(common-actions . ,\(top-n \(map audit-action events\) 10\)\)) s
5 594 M
(      \(typical-hours . ,\(typical-active-hours events\)\)) s
5 583 M
(      \(established-at . ,\(current-time\)\)\)\)\)) s
5 572 M
(`) s
5 550 M
(Anomaly Detection) s
5 528 M
(`scheme) s
5 517 M
(\(define \(detect-audit-anomaly principal current-rate baseline\)) s
5 506 M
(  "Detect anomalous audit patterns") s
5 495 M
(  \(let \(\(expected \(assoc-ref baseline 'events-per-hour\)\)) s
5 484 M
(        \(threshold 3.0\)\)  ; 3x normal is anomalous) s
5 473 M
(    \(when \(> current-rate \(* threshold expected\)\)) s
5 462 M
(      \(audit-append-privileged) s
5 451 M
(        action: 'audit-anomaly-detected) s
5 440 M
(        principal: principal) s
5 429 M
(        current-rate: current-rate) s
5 418 M
(        expected-rate: expected) s
5 407 M
(        severity: \(if \(> current-rate \(* 10 expected\)\)) s
5 396 M
(                      'critical) s
5 385 M
(                      'warning\)\)) s
5 374 M
(      ;; Potentially throttle) s
5 363 M
(      \(when \(> current-rate \(* 10 expected\)\)) s
5 352 M
(        \(throttle-principal principal\)\)\)\)\)) s
5 341 M
(`) s
5 319 M
(Flood Detection) s
5 297 M
(`scheme) s
5 286 M
(\(define \(detect-audit-flood\)) s
5 275 M
(  "Detect system-wide audit flooding") s
5 264 M
(  \(let \(\(current-rate \(global-audit-rate\)\)) s
5 253 M
(        \(threshold \(* 10 \(baseline-global-rate\)\)\)\)) s
5 242 M
(    \(when \(> current-rate threshold\)) s
5 231 M
(      ;; Identify top contributors) s
5 220 M
(      \(let \(\(top-principals \(top-audit-principals 10\)\)\)) s
5 209 M
(        \(audit-append-privileged) s
5 198 M
(          action: 'audit-flood-detected) s
5 187 M
(          global-rate: current-rate) s
5 176 M
(          threshold: threshold) s
5 165 M
(          top-principals: top-principals\)) s
5 154 M
(        ;; Throttle top contributors) s
5 143 M
(        \(for-each throttle-principal) s
5 132 M
(                  \(map car top-principals\)\)\)\)\)\)) s
5 121 M
(`) s
5 99 M
(------------------------------------------------------------------------------) s
5 77 M
(Privileged Logging) s
5 55 M
(System Events) s
5 33 M
(`scheme) s
5 22 M
(;; Some events bypass rate limits) s
5 11 M
(\(define privileged-actions) s
_R
S
%%Page: (7) 7
%%BeginPageSetup
_S
24 24 translate
/pagenum 7 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(  '\(audit-rate-limited) s
5 770 M
(    audit-protection-enabled) s
5 759 M
(    audit-protection-disabled) s
5 748 M
(    audit-anomaly-detected) s
5 737 M
(    audit-flood-detected) s
5 726 M
(    key-ceremony) s
5 715 M
(    emergency-revoke) s
5 704 M
(    security-alert\)\)) s
5 682 M
(\(define \(audit-append-privileged . args\)) s
5 671 M
(  "Log privileged event \(bypasses rate limits\)") s
5 660 M
(  \(let \(\(entry \(apply make-audit-entry args\)\)\)) s
5 649 M
(    ;; Always log, never rate limit) s
5 638 M
(    \(audit-write-direct entry\)) s
5 627 M
(    ;; Alert on privileged events) s
5 616 M
(    \(when \(member \(assoc-ref entry 'action\) '\(security-alert emergency-revoke\)\)) s
5 605 M
(      \(send-security-alert entry\)\)\)\)) s
5 594 M
(`) s
5 572 M
(Guaranteed Delivery) s
5 550 M
(`scheme) s
5 539 M
(\(define \(audit-write-guaranteed entry\)) s
5 528 M
(  "Write audit entry with guaranteed delivery") s
5 517 M
(  ;; Write to multiple locations) s
5 506 M
(  \(let \(\(locations \(list \(primary-audit-log\)) s
5 495 M
(                         \(secondary-audit-log\)) s
5 484 M
(                         \(remote-audit-log\)\)\)\)) s
5 473 M
(    \(let \(\(successes \(filter \(lambda \(loc\)) s
5 462 M
(                               \(guard \(ex \(else #f\)\)) s
5 451 M
(                                 \(audit-write loc entry\)) s
5 440 M
(                                 #t\)\)) s
5 429 M
(                             locations\)\)\)) s
5 418 M
(      \(when \(< \(length successes\) 2\)) s
5 407 M
(        ;; Failed to write to enough locations) s
5 396 M
(        \(emergency-audit-alert entry successes\)\)\)\)\)) s
5 385 M
(`) s
5 363 M
(------------------------------------------------------------------------------) s
5 341 M
(Integrity Protection) s
5 319 M
(Append-Only Enforcement) s
5 297 M
(`scheme) s
5 286 M
(;; Audit log is strictly append-only) s
5 275 M
(\(define \(audit-write entry\)) s
5 264 M
(  "Append entry to audit log") s
5 253 M
(  \(let \(\(log \(current-audit-log\)\)\)) s
5 242 M
(    ;; Verify we're at the end) s
5 231 M
(    \(unless \(at-log-end? log\)) s
5 220 M
(      \(error 'audit-log-not-at-end\)\)) s
5 209 M
(    ;; Append with sequence number) s
5 198 M
(    \(let \(\(seq \(next-sequence-number log\)\)\)) s
5 187 M
(      \(write-entry log \(cons `\(sequence . ,seq\) entry\)\)) s
5 176 M
(      ;; Sign the entry) s
5 165 M
(      \(sign-entry log entry\)\)\)\)) s
5 154 M
(`) s
5 132 M
(Chain Integrity) s
5 110 M
(`scheme) s
5 99 M
(;; Each entry references previous \(blockchain-style\)) s
5 88 M
(\(define \(chain-entry entry previous-hash\)) s
5 77 M
(  `\(\(previous-hash . ,previous-hash\)) s
5 66 M
(    \(sequence . ,\(+ 1 \(previous-sequence\)\)\)) s
5 55 M
(    \(timestamp . ,\(current-time\)\)) s
5 44 M
(    ,@entry) s
5 33 M
(    \(hash . ,\(compute-entry-hash entry previous-hash\)\)\)\)) s
5 11 M
(\(define \(verify-audit-chain log\)) s
_R
S
%%Page: (8) 8
%%BeginPageSetup
_S
24 24 translate
/pagenum 8 def
/fname (rfc-034-audit-protection.txt) def
/fdir (.) def
/ftail (rfc-034-audit-protection.txt) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
5 781 M
(  "Verify audit log chain integrity") s
5 770 M
(  \(let loop \(\(entries \(audit-entries log\)\)) s
5 759 M
(             \(expected-prev #f\)\)) s
5 748 M
(    \(if \(null? entries\)) s
5 737 M
(        #t) s
5 726 M
(        \(let \(\(entry \(car entries\)\)\)) s
5 715 M
(          \(and \(or \(not expected-prev\)) s
5 704 M
(                   \(equal? \(assoc-ref entry 'previous-hash\) expected-prev\)\)) s
5 693 M
(               \(loop \(cdr entries\)) s
5 682 M
(                     \(assoc-ref entry 'hash\)\)\)\)\)\)\)) s
5 671 M
(`) s
5 649 M
(------------------------------------------------------------------------------) s
5 627 M
(Recovery) s
5 605 M
(Log Reconstruction) s
5 583 M
(`scheme) s
5 572 M
(\(define \(reconstruct-audit-log backups\)) s
5 561 M
(  "Reconstruct audit log from multiple backups") s
5 550 M
(  \(let \(\(entries \(merge-backup-entries backups\)\)\)) s
5 539 M
(    ;; Deduplicate by sequence number) s
5 528 M
(    \(let \(\(deduped \(deduplicate-by-sequence entries\)\)\)) s
5 517 M
(      ;; Verify chain) s
5 506 M
(      \(unless \(verify-audit-chain deduped\)) s
5 495 M
(        \(error 'audit-chain-broken\)\)) s
5 484 M
(      deduped\)\)\)) s
5 473 M
(`) s
5 451 M
(Gap Detection) s
5 429 M
(`scheme) s
5 418 M
(\(define \(detect-audit-gaps log\)) s
5 407 M
(  "Find gaps in audit sequence") s
5 396 M
(  \(let loop \(\(entries \(audit-entries log\)\)) s
5 385 M
(             \(expected-seq 1\)) s
5 374 M
(             \(gaps '\(\)\)\)) s
5 363 M
(    \(if \(null? entries\)) s
5 352 M
(        gaps) s
5 341 M
(        \(let \(\(seq \(assoc-ref \(car entries\) 'sequence\)\)\)) s
5 330 M
(          \(if \(= seq expected-seq\)) s
5 319 M
(              \(loop \(cdr entries\) \(+ seq 1\) gaps\)) s
5 308 M
(              \(loop \(cdr entries\) \(+ seq 1\)) s
5 297 M
(                    \(cons \(list expected-seq \(- seq 1\)\) gaps\)\)\)\)\)\)\)) s
5 286 M
(`) s
5 264 M
(------------------------------------------------------------------------------) s
5 242 M
(References) s
5 220 M
(1. NIST SP 800-92: Guide to Computer Security Log Management) s
5 209 M
(2. RFC-003: Cryptographic Audit Trail) s
5 198 M
(3. RFC-032: Rate Limiting and Quotas) s
5 187 M
(4. RFC-028: Error Handling and Recovery) s
5 165 M
(------------------------------------------------------------------------------) s
5 143 M
(Changelog) s
5 121 M
(- 2026-01-07 - Initial draft) s
5 99 M
(------------------------------------------------------------------------------) s
5 77 M
(Implementation Status: Draft) s
5 66 M
(Dependencies: audit, storage, monitoring) s
5 55 M
(Integration: All vault operations, security monitoring, forensics) s
_R
S
%%Trailer
%%Pages: 8
%%DocumentNeededResources: font Courier-Bold Courier 
%%EOF
