%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Tue Jan 13 11:52:59 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 11
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-034: A)225.252 123 Q(udit Log Pr)-.6 E
(otection)-.216 E/F1 10/Times-Italic@0 SF(Libr)260.85 159 Q
(ary of Cyber)-.15 E(space)-.1 E/F2 10/Times-Roman@0 SF(2026)296 177 Q
F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3 10/Times-Bold@0 SF 2.5(1. Abstract)
72 261 R F2 1.308(This RFC speci\214es protection mechanisms for the Li\
brary of Cyberspace audit log: ho)72 276.6 R 3.808(wt)-.25 G 1.308
(he system pre)-3.808 F -.15(ve)-.25 G 1.308(nts re-).15 F .215
(source e)72 288.6 R .216
(xhaustion, log \215ooding, and denial of service attacks ag)-.15 F .216
(ainst the audit trail while maintaining its inte)-.05 F .216(grity as)
-.15 F(the authoritati)72 300.6 Q .3 -.15(ve r)-.25 H(ecord of all v).15
E(ault operations.)-.25 E F3 2.5(2. Moti)72 324.6 R -.1(va)-.1 G(tion).1
E F2(The audit log is sacred:)72 340.2 Q 6.5<8345>72 355.8 S(vidence)
-6.5 E 6.5<834c>72 371.4 S -2.25 -.15(eg a)-6.5 H 2.5(la).15 G
(nd forensic record)-2.5 E 6.5<8341>72 387 S(ccountability)-6.5 E 6.5
<8357>72 402.6 S(ho did what when)-6.5 E 6.5<8352>72 418.2 S(eco)-6.5 E
-.15(ve)-.15 G(ry).15 E 6.5<8352>72 433.8 S(econstruct state after f)
-6.5 E(ailure)-.1 E 6.5<8354>72 449.4 S(rust)-6.85 E 6.5<8346>72 465 S
(oundation of the security model)-6.65 E
(But the audit log is also a tar)72 484.2 Q(get:)-.18 E 6.5<8346>72
499.8 S(looding)-6.5 E 6.5<8347>72 515.4 S
(enerate noise to hide malicious acti)-6.5 E(vity)-.25 E 6.5<8345>72 531
S(xhaustion)-6.5 E 6.5<8346>72 546.6 S(ill storage to halt operations)
-6.5 E 6.5<8345>72 562.2 S -.25(va)-6.5 G(sion).25 E 6.5<834f>72 577.8 S
-.15(ve)-6.5 G(rwhelm to pre).15 E -.15(ve)-.25 G
(nt logging of real attacks).15 E 6.5<8341>72 593.4 S(mpli\214cation)
-6.5 E 6.5<8353>72 609 S(mall action triggers lar)-6.5 E(ge log entries)
-.18 E(The audit log must protect itself while ne)72 628.2 Q -.15(ve)
-.25 G 2.5(rf).15 G(ailing to record.)-2.6 E F3 2.5(3. Thr)72 652.2 R
(eat Model)-.18 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. Attack)72 84 R -1(Ve)2.5 G(ctors)1 E/F2 8/Courier@0 SF
(\(define audit-threats)108 102 Q('\(\(flooding)117.6 114 Q
(\(description "Generate massive log volume"\))132 126 Q
(\(goal "Hide malicious activity in noise"\))132 138 Q
(\(method "Rapid legitimate-looking operations"\)\))132 150 Q
(\(exhaustion)127.2 174 Q(\(description "Fill audit storage"\))132 186 Q
(\(goal "Halt vault operations"\))132 198 Q
(\(method "Sustained high-volume logging"\)\))132 210 Q(\(amplification)
127.2 234 Q(\(description "Small input, large log output"\))132 246 Q
(\(goal "Asymmetric resource consumption"\))132 258 Q
(\(method "Operations that log disproportionately"\)\))132 270 Q
(\(corruption)127.2 294 Q(\(description "Tamper with log entries"\))132
306 Q(\(goal "Alter historical record"\))132 318 Q
(\(method "Exploit write access to log storage"\)\))132 330 Q
(\(truncation)127.2 354 Q(\(description "Force log rotation/deletion"\))
132 366 Q(\(goal "Remove evidence"\))132 378 Q
(\(method "Fill logs to trigger cleanup"\)\)\)\))132 390 Q F1 2.5
(3.2. Attack)72 408 R(er Capabilities)-.1 E F2(;; Assume attacker can:)
108 426 Q(;; - Authenticate as a valid principal)108 438 Q
(;; - Perform many legitimate operations)108 450 Q
(;; - Control timing of operations)108 462 Q
(;; - Observe system behavior)108 474 Q(;; Assume attacker cannot:)108
498 Q(;; - Directly write to audit storage)108 510 Q
(;; - Forge signatures on log entries)108 522 Q
(;; - Break cryptographic primitives)108 534 Q F1 2.5(4. Rate)72 552 R
(Limiting)2.5 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.1. P)72 84 R(er)-.2 E(-Principal A)-.37 E(udit Limits)-.5 E/F2 8
/Courier@0 SF(\(define audit-rate-limits)108 102 Q
(`\(\(entries-per-second . 100\))117.6 114 Q
(\(bytes-per-second . 102400\))127.2 126 Q 4.8(;1)28.8 G(00KB/s)-4.8 E
(\(entries-per-minute . 1000\))127.2 138 Q
(\(bytes-per-minute . 10485760\)\)\))127.2 150 Q 4.8(;1)9.6 G(0MB/min)
-4.8 E(\(define principal-audit-buckets \(make-hash-table\)\))108 174 Q
(\(define \(get-audit-bucket principal\))108 198 Q
(\(or \(hash-table-ref principal-audit-buckets principal #f\))117.6 210
Q(\(let \(\(bucket \(make-token-bucket)136.8 222 Q
(\(assoc-ref audit-rate-limits 'entries-per-second\))208.8 234 Q
(\(assoc-ref audit-rate-limits 'entries-per-second\)\)\)\))208.8 246 Q
(\(hash-table-set! principal-audit-buckets principal bucket\))146.4 258
Q(bucket\)\)\))146.4 270 Q
(\(define \(audit-rate-check principal entry-size\))108 294 Q
("Check if principal can generate audit entry")117.6 306 Q
(\(let \(\(bucket \(get-audit-bucket principal\)\)\))117.6 318 Q
(\(bucket 1\)\)\))127.2 330 Q 4.8(;C)9.6 G(onsume one token)-4.8 E F1
2.5(4.2. A)72 348 R(udit Entry Costing)-.5 E F2
(;; Different operations have different audit costs)108 366 Q
(\(define audit-costs)108 378 Q(`\(\(read . 1\))117.6 390 Q
(\(write . 2\))127.2 402 Q(\(delete . 5\))127.2 414 Q(\(query . 1\))
127.2 426 Q(\(admin . 10\))127.2 438 Q(\(key-operation . 50\))127.2 450
Q(\(emergency . 0\)\)\))127.2 462 Q 4.8(;A)9.6 G(lways allowed)-4.8 E
(\(define \(audit-cost action\))108 486 Q
(\(or \(assoc-ref audit-costs action\) 1\)\))117.6 498 Q
(\(define \(consume-audit-budget principal action\))108 522 Q
("Deduct from principal's audit budget")117.6 534 Q
(\(let \(\(cost \(audit-cost action\)\))117.6 546 Q
(\(bucket \(get-audit-bucket principal\)\)\))146.4 558 Q
(\(if \(bucket cost\))127.2 570 Q(#t)146.4 582 Q(\(begin)146.4 594 Q
(;; Log the rate limit event \(always succeeds\))156 606 Q
(\(audit-append-privileged)156 618 Q(action: 'audit-rate-limited)165.6
630 Q(principal: principal)165.6 642 Q(attempted-action: action\))165.6
654 Q(#f\)\)\)\))156 666 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.3. Burst)72 84 R(Handling)2.5 E/F2 8/Courier@0 SF
(;; Allow short bursts but limit sustained rate)108 102 Q
(\(define \(make-audit-limiter\))108 114 Q
(\(let \(\(short-term \(make-token-bucket 200 100\)\))117.6 126 Q 4.8
(;1)14.4 G(00/s, burst 200)-4.8 E
(\(long-term \(make-sliding-window 10000 60\)\)\) ; 10k/min)146.4 138 Q
(\(lambda \(cost\))127.2 150 Q(\(and \(short-term cost\))136.8 162 Q
(\(long-term\)\)\)\)\))160.8 174 Q F1 2.5(5. Storage)72 192 R(Pr)2.5 E
(otection)-.18 E 2.5(5.1. Reser)72 216 R -.1(ve)-.1 G 2.5(dA).1 G
(udit Space)-3 E F2(;; Always reserve space for audit)108 234 Q
(\(define audit-reserved-space \( 1024 1024 1024\)\))108 246 Q 4.8(;1)
9.6 G(GB minimum)-4.8 E(\(define \(audit-storage-available\))108 270 Q
(\(let \(\(total \(storage-available\)\))117.6 282 Q
(\(audit-used \(audit-storage-used\)\)\))146.4 294 Q
(\(max 0 \(- total audit-reserved-space*\)\)\)\))127.2 306 Q
(\(define \(check-audit-storage entry-size\))108 330 Q
("Ensure space for audit entry")117.6 342 Q
(\(let \(\(available \(audit-storage-available\)\)\))117.6 354 Q
(\(when \(< available entry-size\))127.2 366 Q
(;; Emergency: halt non-audit operations)136.8 378 Q
(\(enter-audit-protection-mode\))136.8 390 Q(;; But always log)136.8 402
Q(#t\)\)\))136.8 414 Q F1 2.5(5.2. A)72 432 R(udit Pr)-.5 E
(otection Mode)-.18 E F2
(\(define audit-protection-mode? \(make-parameter #f\)\))108 450 Q
(\(define \(enter-audit-protection-mode\))108 474 Q
("Emergency mode: only allow audit writes")117.6 486 Q
(\(audit-protection-mode? #t\))117.6 498 Q(\(audit-append-privileged)
117.6 510 Q(action: 'audit-protection-enabled)127.2 522 Q
(reason: 'storage-exhaustion\))127.2 534 Q
(;; Reject all non-essential operations)117.6 546 Q
(\(set-vault-mode! 'audit-only\)\))117.6 558 Q
(\(define \(exit-audit-protection-mode\))108 582 Q
("Resume normal operations")117.6 594 Q
(\(when \(> \(audit-storage-available\) \( 2 audit-reserved-space*\)\))
117.6 606 Q(\(audit-protection-mode? #f\))127.2 618 Q
(\(set-vault-mode! 'normal\))127.2 630 Q(\(audit-append-privileged)127.2
642 Q(action: 'audit-protection-disabled\)\)\))136.8 654 Q 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.3. T)72 84 R(ier)-.18 E(ed Storage)-.18 E/F2 8/Courier@0 SF
(;; Audit log tiers)108 102 Q(\(define audit-tiers)108 114 Q
('\(\(hot . \(\(retention . 86400\))117.6 126 Q 4.8(;1d)28.8 G(ay)-4.8 E
(\(storage . ssd\))165.6 138 Q(\(compression . none\)\)\))165.6 150 Q
(\(warm . \(\(retention . 604800\))127.2 162 Q 4.8(;7d)19.2 G(ays)-4.8 E
(\(storage . hdd\))170.4 174 Q(\(compression . zstd-fast\)\)\))170.4 186
Q(\(cold . \(\(retention . 31536000\))127.2 198 Q 4.8(;1y)9.6 G(ear)-4.8
E(\(storage . archive\))170.4 210 Q(\(compression . zstd-max\)\)\))170.4
222 Q(\(glacier . \(\(retention . #f\))127.2 234 Q 4.8(;F)24 G(orever)
-4.8 E(\(storage . offsite\))184.8 246 Q
(\(compression . zstd-max\)\)\)\)\))184.8 258 Q
(\(define \(tier-audit-entry entry age\))108 282 Q
("Move entry to appropriate storage tier")117.6 294 Q
(\(let \(\(tier \(find \(lambda \(t\))117.6 306 Q
(\(or \(not \(assoc-ref \(cdr t\) 'retention\)\))213.6 318 Q
(\(< age \(assoc-ref \(cdr t\) 'retention\)\)\)\))232.8 330 Q
(audit-tiers\)\)\))204 342 Q(\(migrate-to-tier entry \(car tier\)\)\)\))
127.2 354 Q F1 2.5(6. Entry)72 372 R(Size Limits)2.5 E 2.5(6.1. Maximum)
72 396 R(Entry Size)2.5 E F2(\(define max-audit-entry-size 65536\))108
414 Q 4.8(;6)9.6 G(4KB)-4.8 E(\(define \(validate-audit-entry entry\))
108 438 Q("Validate entry before logging")117.6 450 Q
(\(let \(\(size \(serialized-size entry\)\)\))117.6 462 Q
(\(when \(> size max-audit-entry-size\))127.2 474 Q
(\(error 'audit-entry-too-large)136.8 486 Q(`\(\(size . ,size\))170.4
498 Q(\(limit . ,max-audit-entry-size\)\)\)\)\)\))180 510 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.2. Entry)72 84 R -.74(Tr)2.5 G(uncation).74 E/F2 8/Courier@0 SF
(\(define \(truncate-audit-entry entry max-size\))108 102 Q
("Truncate oversized entry while preserving critical fields")117.6 114 Q
(\(let \(\(critical '\(action principal timestamp hash signature\)\)\))
117.6 126 Q(\(let loop \(\(entry entry\))127.2 138 Q
(\(fields \(entry-fields entry\)\)\))180 150 Q
(\(if \(<= \(serialized-size entry\) max-size\))136.8 162 Q(entry)156
174 Q(\(let \(\(removable \(find \(lambda \(f\))156 186 Q
(\(not \(member f critical\)\)\))276 198 Q(fields\)\)\))266.4 210 Q
(\(if removable)165.6 222 Q(\(loop \(assoc-remove entry removable\))
184.8 234 Q(\(delete removable fields\)\))213.6 246 Q
(;; Can't truncate further, log warning)184.8 258 Q(\(begin)184.8 270 Q
(\(audit-append-privileged)194.4 282 Q
(action: 'audit-entry-truncation-failed)204 294 Q
(original-size: \(serialized-size entry\)\))204 306 Q
(entry\)\)\)\)\)\)\))194.4 318 Q F1 2.5(6.3. P)72 336 R
(ayload Summarization)-.1 E F2
(\(define \(summarize-large-payload payload\))108 354 Q
("Summarize large payloads for audit")117.6 366 Q
(\(if \(> \(bytevector-length payload\) 1024\))117.6 378 Q
(`\(\(type . summarized\))136.8 390 Q
(\(original-size . ,\(bytevector-length payload\)\))146.4 402 Q
(\(hash . ,\(content-hash payload\)\))146.4 414 Q
(\(preview . ,\(subbytevector payload 0 256\)\)\))146.4 426 Q
(payload\)\))136.8 438 Q F1 2.5(7. Aggr)72 456 R(egation)-.18 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(7.1. Ev)72 84 R(ent Aggr)-.1 E(egation)-.18 E/F2 8/Courier@0 SF
(;; Aggregate similar events to reduce volume)108 102 Q
(\(define aggregation-window 60\))108 114 Q 4.8(;s)9.6 G(econds)-4.8 E
(\(define pending-aggregations \(make-hash-table\)\))108 126 Q
(\(define \(aggregate-audit-event action principal details\))108 150 Q
("Aggregate similar events within window")117.6 162 Q
(\(let* \(\(key \(list action principal\)\))117.6 174 Q
(\(existing \(hash-table-ref pending-aggregations key #f\)\)\))151.2 186
Q(\(if existing)127.2 198 Q(;; Add to existing aggregation)146.4 210 Q
(\(begin)146.4 222 Q(\(set-cdr! \(assoc 'count existing\))156 234 Q
(\(+ 1 \(assoc-ref existing 'count\)\)\))204 246 Q
(\(set-cdr! \(assoc 'last-seen existing\))156 258 Q
(\(current-time\)\)\))204 270 Q(;; Start new aggregation)146.4 282 Q
(\(hash-table-set! pending-aggregations key)146.4 294 Q
(`\(\(action . ,action\))156 306 Q(\(principal . ,principal\))165.6 318
Q(\(count . 1\))165.6 330 Q(\(first-seen . ,\(current-time\)\))165.6 342
Q(\(last-seen . ,\(current-time\)\))165.6 354 Q
(\(sample . ,details\)\)\)\)\)\))165.6 366 Q
(\(define \(flush-aggregations\))108 390 Q
("Flush aggregated events to audit log")117.6 402 Q
(\(hash-table-walk pending-aggregations)117.6 414 Q
(\(lambda \(key agg\))127.2 426 Q
(\(when \(> \(- \(current-time\) \(assoc-ref agg 'first-seen\)\))136.8
438 Q(aggregation-window\))180 450 Q(\(audit-append-direct)146.4 462 Q
(action: 'aggregated-events)156 474 Q
(original-action: \(assoc-ref agg 'action\))156 486 Q
(principal: \(assoc-ref agg 'principal\))156 498 Q
(count: \(assoc-ref agg 'count\))156 510 Q
(window-start: \(assoc-ref agg 'first-seen\))156 522 Q
(window-end: \(assoc-ref agg 'last-seen\))156 534 Q
(sample: \(assoc-ref agg 'sample\)\))156 546 Q
(\(hash-table-delete! pending-aggregations key\)\)\)\)\))146.4 558 Q 0
Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(7.2. Sampling)72 84 R/F2 8/Courier@0 SF
(;; Sample high-volume events)108 102 Q
(\(define \(should-sample? action principal\))108 114 Q
(\(let \(\(rate \(current-rate action principal\)\)\))117.6 126 Q
(\(cond)127.2 138 Q(\(\(< rate 10\) #t\))136.8 150 Q 4.8(;A)67.2 G
(lways log low-rate)-4.8 E(\(\(< rate 100\) \(< \(random 1.0\) 0.5\)\))
136.8 162 Q 4.8(;5)9.6 G(0% sample)-4.8 E
(\(\(< rate 1000\) \(< \(random 1.0\) 0.1\)\) ; 10% sample)136.8 174 Q
(\(else \(< \(random 1.0\) 0.01\)\)\)\)\))136.8 186 Q 4.8(;1)28.8 G 4.8
(%s)-4.8 G(ample)-4.8 E
(\(define \(audit-with-sampling action principal details\))108 210 Q
("Log with sampling for high-volume events")117.6 222 Q
(\(if \(should-sample? action principal\))117.6 234 Q
(\(audit-append action: action)136.8 246 Q(principal: principal)204 258
Q(details: details)204 270 Q(sampled: #t\))204 282 Q
(;; Still count for rate tracking)136.8 294 Q
(\(increment-audit-counter action principal\)\)\))136.8 306 Q F1 2.5
(8. Anomaly)72 324 R(Detection)2.5 E 2.5(8.1. Baseline)72 348 R
(Establishment)2.5 E F2
(\(define \(establish-audit-baseline principal duration\))108 366 Q
("Establish normal audit patterns for principal")117.6 378 Q
(\(let \(\(events \(soup-query type: 'audit-entry)117.6 390 Q
(principal: principal)242.4 402 Q
(timestamp: \(> \(- \(current-time\) duration\)\)\)\)\))242.4 414 Q
(`\(\(events-per-hour . ,\(/ \(length events\) \(/ duration 3600\)\)\))
127.2 426 Q
(\(common-actions . ,\(top-n \(map audit-action events\) 10\)\))136.8
438 Q(\(typical-hours . ,\(typical-active-hours events\)\))136.8 450 Q
(\(established-at . ,\(current-time\)\)\)\)\))136.8 462 Q F1 2.5
(8.2. Anomaly)72 480 R(Detection)2.5 E F2
(\(define \(detect-audit-anomaly principal current-rate baseline\))108
498 Q("Detect anomalous audit patterns")117.6 510 Q
(\(let \(\(expected \(assoc-ref baseline 'events-per-hour\)\))117.6 522
Q(\(threshold 3.0\)\))146.4 534 Q 4.8(;3)9.6 G 4.8(xn)-4.8 G
(ormal is anomalous)-4.8 E
(\(when \(> current-rate \( threshold expected\)\))127.2 546 Q
(\(audit-append-privileged)136.8 558 Q(action: 'audit-anomaly-detected)
146.4 570 Q(principal: principal)146.4 582 Q(current-rate: current-rate)
146.4 594 Q(expected-rate: expected)146.4 606 Q
(severity: \(if \(> current-rate \( 10 expected\)\))146.4 618 Q
('critical)213.6 630 Q('warning\)\))213.6 642 Q(;; Potentially throttle)
136.8 654 Q(\(when \(> current-rate \(* 10 expected\)\))136.8 666 Q
(\(throttle-principal principal\)\)\)\)\))146.4 678 Q 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(8.3. Flood)72 84 R(Detection)2.5 E/F2 8/Courier@0 SF
(\(define \(detect-audit-flood\))108 102 Q
("Detect system-wide audit flooding")117.6 114 Q
(\(let \(\(current-rate \(global-audit-rate\)\))117.6 126 Q
(\(threshold \(* 10 \(baseline-global-rate\)\)\)\))146.4 138 Q
(\(when \(> current-rate threshold\))127.2 150 Q
(;; Identify top contributors)136.8 162 Q
(\(let \(\(top-principals \(top-audit-principals 10\)\)\))136.8 174 Q
(\(audit-append-privileged)146.4 186 Q(action: 'audit-flood-detected)156
198 Q(global-rate: current-rate)156 210 Q(threshold: threshold)156 222 Q
(top-principals: top-principals\))156 234 Q
(;; Throttle top contributors)146.4 246 Q(\(for-each throttle-principal)
146.4 258 Q(\(map car top-principals\)\)\)\)\)\))194.4 270 Q F1 2.5
(9. Pri)72 288 R(vileged Logging)-.1 E 2.5(9.1. System)72 312 R(Ev)2.5 E
(ents)-.1 E F2(;; Some events bypass rate limits)108 330 Q
(\(define privileged-actions)108 342 Q('\(audit-rate-limited)117.6 354 Q
(audit-protection-enabled)127.2 366 Q(audit-protection-disabled)127.2
378 Q(audit-anomaly-detected)127.2 390 Q(audit-flood-detected)127.2 402
Q(key-ceremony)127.2 414 Q(emergency-revoke)127.2 426 Q
(security-alert\)\))127.2 438 Q
(\(define \(audit-append-privileged . args\))108 462 Q
("Log privileged event \(bypasses rate limits\)")117.6 474 Q
(\(let \(\(entry \(apply make-audit-entry args\)\)\))117.6 486 Q
(;; Always log, never rate limit)127.2 498 Q
(\(audit-write-direct entry\))127.2 510 Q(;; Alert on privileged events)
127.2 522 Q(\(when \(member \(assoc-ref entry 'action\) '\(security-ale\
rt emergency-revoke\)\))127.2 534 Q(\(send-security-alert entry\)\)\)\))
136.8 546 Q 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.2. Guaranteed)72 84 R(Deli)2.5 E -.1(ve)-.1 G(ry).1 E/F2 8
/Courier@0 SF(\(define \(audit-write-guaranteed entry\))108 102 Q
("Write audit entry with guaranteed delivery")117.6 114 Q
(;; Write to multiple locations)117.6 126 Q
(\(let \(\(locations \(list \(primary-audit-log\))117.6 138 Q
(\(secondary-audit-log\))228 150 Q(\(remote-audit-log\)\)\)\))228 162 Q
(\(let \(\(successes \(filter \(lambda \(loc\))127.2 174 Q
(\(guard \(ex \(else #f\)\))256.8 186 Q(\(audit-write loc entry\))266.4
198 Q(#t\)\))266.4 210 Q(locations\)\)\))247.2 222 Q
(\(when \(< \(length successes\) 2\))136.8 234 Q
(;; Failed to write to enough locations)146.4 246 Q
(\(emergency-audit-alert entry successes\)\)\)\)\))146.4 258 Q F1 2.5
(10. Integrity)72 276 R(Pr)2.5 E(otection)-.18 E 2.5(10.1. A)72 300 R
(ppend-Only Enf)-.25 E(or)-.25 E(cement)-.18 E F2
(;; Audit log is strictly append-only)108 318 Q
(\(define \(audit-write entry\))108 330 Q("Append entry to audit log")
117.6 342 Q(\(let \(\(log \(current-audit-log\)\)\))117.6 354 Q
(;; Verify we're at the end)127.2 366 Q(\(unless \(at-log-end? log\))
127.2 378 Q(\(error 'audit-log-not-at-end\)\))136.8 390 Q
(;; Append with sequence number)127.2 402 Q
(\(let \(\(seq \(next-sequence-number log\)\)\))127.2 414 Q
(\(write-entry log \(cons `\(sequence . ,seq\) entry\)\))136.8 426 Q
(;; Sign the entry)136.8 438 Q(\(sign-entry log entry\)\)\)\))136.8 450
Q F1 2.5(10.2. Chain)72 468 R(Integrity)2.5 E F2
(;; Each entry references previous \(blockchain-style\))108 486 Q
(\(define \(chain-entry entry previous-hash\))108 498 Q
(`\(\(previous-hash . ,previous-hash\))117.6 510 Q
(\(sequence . ,\(+ 1 \(previous-sequence\)\)\))127.2 522 Q
(\(timestamp . ,\(current-time\)\))127.2 534 Q(,@entry)127.2 546 Q
(\(hash . ,\(compute-entry-hash entry previous-hash\)\)\)\))127.2 558 Q
(\(define \(verify-audit-chain log\))108 582 Q
("Verify audit log chain integrity")117.6 594 Q
(\(let loop \(\(entries \(audit-entries log\)\))117.6 606 Q
(\(expected-prev #f\)\))170.4 618 Q(\(if \(null? entries\))127.2 630 Q
(#t)146.4 642 Q(\(let \(\(entry \(car entries\)\)\))146.4 654 Q
(\(and \(or \(not expected-prev\))156 666 Q
(\(equal? \(assoc-ref entry 'previous-hash\) expected-prev\)\))199.2 678
Q(\(loop \(cdr entries\))180 690 Q
(\(assoc-ref entry 'hash\)\)\)\)\)\)\))208.8 702 Q 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-034 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(11. Reco)72 84 R -.1(ve)-.1 G(ry).1 E 2.5(11.1. Log)72 108 R
(Reconstruction)2.5 E/F2 8/Courier@0 SF
(\(define \(reconstruct-audit-log backups\))108 126 Q
("Reconstruct audit log from multiple backups")117.6 138 Q
(\(let \(\(entries \(merge-backup-entries backups\)\)\))117.6 150 Q
(;; Deduplicate by sequence number)127.2 162 Q
(\(let \(\(deduped \(deduplicate-by-sequence entries\)\)\))127.2 174 Q
(;; Verify chain)136.8 186 Q(\(unless \(verify-audit-chain deduped\))
136.8 198 Q(\(error 'audit-chain-broken\)\))146.4 210 Q(deduped\)\)\))
136.8 222 Q F1 2.5(11.2. Gap)72 240 R(Detection)2.5 E F2
(\(define \(detect-audit-gaps log\))108 258 Q
("Find gaps in audit sequence")117.6 270 Q
(\(let loop \(\(entries \(audit-entries log\)\))117.6 282 Q
(\(expected-seq 1\))170.4 294 Q(\(gaps '\(\)\)\))170.4 306 Q
(\(if \(null? entries\))127.2 318 Q(gaps)146.4 330 Q
(\(let \(\(seq \(assoc-ref \(car entries\) 'sequence\)\)\))146.4 342 Q
(\(if \(= seq expected-seq\))156 354 Q
(\(loop \(cdr entries\) \(+ seq 1\) gaps\))175.2 366 Q
(\(loop \(cdr entries\) \(+ seq 1\))175.2 378 Q
(\(cons \(list expected-seq \(- seq 1\)\) gaps\)\)\)\)\)\)\))204 390 Q
F1 2.5(12. Refer)72 408 R(ences)-.18 E F0 4.92(1. [NIST SP 800-92: Guid\
e to Computer Security Log Management]\(https://csrc.nist.go)72 423.6 R
(v/publications/de-)-.15 E .929
(tail/sp/800-92/\214nal\) 2. [RFC-003: Cryptographic Audit T)72 435.6 R
.929(rail]\(rfc-003-audit-trail.html\) 3. [RFC-032: Rate Limiting)-.35 F
(and Quotas]\(rfc-032-rate-limiting.html\) 4. [RFC-028: Error Handling \
and Reco)72 447.6 Q -.15(ve)-.15 G(ry]\(rfc-028-error).15 E
(-handling.html\))-.2 E F1 2.5(13. Changelog)72 471.6 R F0 6.5<8332>72
487.2 S(026-01-07)-6.5 E 6.5<8349>72 502.8 S(nitial draft)-6.5 E 0 Cg EP
%%Trailer
end
%%EOF
