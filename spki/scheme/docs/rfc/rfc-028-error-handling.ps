%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 8
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-028: Error Handling and Reco)72 12 Q -.15
(ve)-.15 G(ry).15 E 1.95(**Status:** Draft **Date:** January 2026 **Aut\
hor:** Derrell Piper <ddp@eludom.net> **Implementation:**)72 36 R
(Proposed)72 48 Q(---)72 72 Q(Abstract)72 96 Q .1
(This RFC speci\214es error handling and reco)72 120 R -.15(ve)-.15 G
.101(ry for the Library of Cyberspace: ho).15 F 2.601(wv)-.25 G .101
(aults detect, report, and reco)-2.851 F -.15(ve)-.15 G(r).15 E .912
(from f)72 132 R .912(ailures while maintaining inte)-.1 F .911(grity g\
uarantees. Errors are \214rst-class objects in the soup, enabling syste\
matic)-.15 F(analysis and automated reco)72 144 Q -.15(ve)-.15 G(ry).15
E(.)-.65 E(---)72 168 Q(Moti)72 192 Q -.25(va)-.25 G(tion).25 E(Distrib)
72 216 Q(uted systems f)-.2 E(ail in creati)-.1 E .3 -.15(ve w)-.25 H
(ays:).05 E 2.827(-*)72 240 S(*Netw)-2.827 E .327(ork partitions** - V)
-.1 F .327
(aults lose contact - **Storage corruption** - Bits \215ip, disks f)
-1.11 F .327(ail - **Byzantine f)-.1 F(aults**)-.1 E 2.699(-N)72 252 S
.199(odes lie or misbeha)-2.699 F .498 -.15(ve - *)-.2 H .198
(*Resource e).15 F .198(xhaustion** - Out of memory)-.15 F 2.698(,d)-.65
G .198(isk, connections - **Protocol violations** -)-2.698 F
(Malformed messages, in)72 264 Q -.25(va)-.4 G(lid state).25 E(Reco)72
288 Q -.15(ve)-.15 G(ry must be:).15 E 4.231(-*)72 312 S 1.732
(*Deterministic** - Same error)-4.231 F 4.232(,s)-.4 G 1.732(ame reco)
-4.232 F -.15(ve)-.15 G 1.732(ry - **Auditable** - Ev).15 F 1.732
(ery error logged with conte)-.15 F 1.732(xt - **Auto-)-.15 F
(matic** - Self-healing where possible - **Graceful** - De)72 324 Q
(grade rather than crash)-.15 E(---)72 348 Q(Error Model)72 372 Q
(Error T)72 396 Q(ypes)-.8 E -.74(```)72 420 S(scheme \(de\214ne-error)
.74 E(-type ')-.2 E(storage-error)-.55 E
(\(subtypes corruption missing full readonly\)\))77 432 Q
(\(de\214ne-error)72 456 Q(-type 'netw)-.2 E(ork-error)-.1 E
(\(subtypes timeout unreachable protocol-violation\)\))77 468 Q
(\(de\214ne-error)72 492 Q(-type 'crypto-error)-.2 E
(\(subtypes signature-in)77 504 Q -.25(va)-.4 G(lid k).25 E -.15(ey)-.1
G(-e).15 E(xpired capability-denied\)\))-.15 E(\(de\214ne-error)72 528 Q
(-type 'consistenc)-.2 E(y-error)-.15 E
(\(subtypes hash-mismatch merkle-di)77 540 Q -.15(ve)-.25 G -.18(rg).15
G(ence con\215ict\)\)).18 E(\(de\214ne-error)72 564 Q(-type ')-.2 E
(resource-error)-.5 E(\(subtypes memory-e)77 576 Q
(xhausted connections-e)-.15 E(xhausted rate-limited\)\))-.15 E
(\(de\214ne-error)72 600 Q(-type 'protocol-error)-.2 E(\(subtypes in)77
612 Q -.25(va)-.4 G(lid-message in).25 E -.25(va)-.4 G(lid-state v).25 E
(ersion-mismatch\)\) `)-.15 E -.74(``)-.74 G(Error Structure)72 636 Q
-.74(```)72 660 S(scheme \(de\214ne \(mak).74 E
(e-error type message conte)-.1 E(xt\))-.15 E(`\(error)77 672 Q
(\(id ,\(generate-error)82 684 Q(-id\)\))-.2 E(\(type ,type\))82 696 Q
(\(message ,message\))82 708 Q(\(conte)82 720 Q(xt ,conte)-.15 E(xt\))
-.15 E(\(timestamp ,\(current-time\)\))82 732 Q(\(v)82 744 Q
(ault ,\(current-v)-.25 E(ault-id\)\))-.25 E
(\(principal ,\(current-principal\)\))82 756 Q
(\(stack ,\(capture-stack-trace\)\)\)\))82 768 Q
(;; Errors are soup objects \(de\214ne \(record-error! err\))72 792 Q 0
Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF
(\(let \(\(hash \(soup-put err type: 'error\)\)\))77 12 Q
(\(audit-append action: 'error)82 24 Q(-recorded error)-.2 E
(-hash: hash\))-.2 E(hash\)\) `)82 36 Q -.74(``)-.74 G(Error Conte)72 60
Q(xt)-.15 E -.74(```)72 84 S(scheme ;; Capture rich conte).74 E
(xt for deb)-.15 E(ugging \(de\214ne \(error)-.2 E(-conte)-.2 E
(xt operation\))-.15 E(`\(\(operation . ,operation\))77 96 Q
(\(request-id . ,\(current-request-id\)\))82 108 Q
(\(correlation-id . ,\(current-correlation-id\)\))82 120 Q
(\(peer . ,\(current-peer\)\))82 132 Q
(\(attempt . ,\(current-retry-count\)\))82 144 Q
(\(duration . ,\(operation-duration\)\))82 156 Q
(\(inputs . ,\(sanitize-inputs \(operation-inputs\)\)\)\)\) `)82 168 Q
-.74(``)-.74 G(---)72 192 Q(Error Handling P)72 216 Q(atterns)-.15 E
(Result T)72 240 Q(ype)-.8 E -.74(```)72 264 S .217
(scheme ;; Operations return \(ok v).74 F .216
(alue\) or \(err error\) \(de\214ne \(result-ok v)-.25 F .216
(alue\) `\(ok ,v)-.25 F .216(alue\)\) \(de\214ne \(result-err error\))
-.25 F(`\(err ,error\)\))72 276 Q .051(\(de\214ne \(result-ok? r\) \(eq\
? \(car r\) 'ok\)\) \(de\214ne \(result-err? r\) \(eq? \(car r\) 'err\)\
\) \(de\214ne \(result-v)72 300 R .052(alue r\) \(cadr r\)\) \(de\214ne)
-.25 F(\(result-error r\) \(cadr r\)\))72 312 Q
(;; Chain operations \(de\214ne \(result-bind r f\))72 336 Q
(\(if \(result-ok? r\))77 348 Q(\(f \(result-v)87 360 Q(alue r\)\))-.25
E(r\)\))87 372 Q(;; Example \(de\214ne \(safe-read hash\))72 396 Q
(\(result-bind \(cas-get-safe hash\))77 408 Q(\(lambda \(data\))82 420 Q
(\(result-bind \(v)87 432 Q(erify-signature data\))-.15 E(\(lambda \(v)
92 444 Q(eri\214ed\))-.15 E(\(result-ok v)97 456 Q
(eri\214ed\)\)\)\)\)\) `)-.15 E -.74(``)-.74 G(Error Reco)72 480 Q -.15
(ve)-.15 G(ry).15 E -.74(```)72 504 S(scheme \(de\214ne \(with-reco).74
E -.15(ve)-.15 G(ry operation reco).15 E -.15(ve)-.15 G(ry\)).15 E("Ex)
77 516 Q(ecute operation with reco)-.15 E -.15(ve)-.15 G(ry on f).15 E
(ailure")-.1 E(\(let \(\(result \(guard \(e)77 528 Q 2.5(x\()-.15 G
(else \(result-err e)-2.5 E(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\)\))117 540 Q(\(if \(result-ok? result\))
82 552 Q(\(result-v)92 564 Q(alue result\))-.25 E(\(reco)92 576 Q -.15
(ve)-.15 G(ry \(result-error result\)\)\)\)\)).15 E
(;; Example: read with f)72 600 Q
(allback to replica \(de\214ne \(read-with-f)-.1 E(allback hash\))-.1 E
(\(with-reco)77 612 Q -.15(ve)-.15 G(ry).15 E
(\(lambda \(\) \(cas-get hash\)\))82 624 Q(\(lambda \(err\))82 636 Q
(\(audit-append action: ')87 648 Q(read-f)-.5 E(allback error: err\))-.1
E(\(cas-get-from-replica hash\)\)\)\) `)87 660 Q -.74(``)-.74 G
(Retry Logic)72 684 Q -.74(```)72 708 S
(scheme \(de\214ne \(with-retry operation max-retries back).74 E(of)-.1
E(f\))-.25 E("Retry operation with e)77 720 Q(xponential back)-.15 E(of)
-.1 E(f")-.25 E(\(let loop \(\(attempt 1\)\))77 732 Q
(\(let \(\(result \(guard \(e)82 744 Q 2.5(x\()-.15 G
(else \(result-err e)-2.5 E(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\)\))122 756 Q(\(cond)87 768 Q
(\(\(result-ok? result\))92 780 Q(\(result-v)94.5 792 Q(alue result\)\))
-.25 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(\(>= attempt max-retries\))92 12 Q
(\(error "Max retries e)94.5 24 Q(xceeded" \(result-error result\)\)\))
-.15 E(\(else)92 36 Q(\(let \(\(delay \(* back)94.5 48 Q(of)-.1 E 2.5
(f\()-.25 G -.15(ex)-2.5 G(pt 2 \(- attempt 1\)\)\)\)\)).15 E
(\(audit-append action: ')99.5 60 Q
(retry attempt: attempt delay: delay\))-.5 E(\(thread-sleep! delay\))
99.5 72 Q(\(loop \(+ attempt 1\)\)\)\)\)\)\)\))99.5 84 Q
(;; Retry con\214guration \(de\214ne *def)72 108 Q(ault-retry-con\214g*)
-.1 E(`\(\(max-retries . 3\))77 120 Q(\(initial-back)82 132 Q(of)-.1 E
2.5(f.1)-.25 G 7.5(00\) ;)-2.5 F(ms)2.5 E(\(max-back)82 144 Q(of)-.1 E
2.5(f.3)-.25 G 12.5(0000\) ;)-2.5 F(ms)2.5 E(\(jitter . 0.1\)\)\))82 156
Q 2.5(;1)27.5 G(0% randomization `)-2.5 E -.74(``)-.74 G(Circuit Break)
72 180 Q(er)-.1 E -.74(```)72 204 S(scheme \(de\214ne \(mak).74 E
(e-circuit-break)-.1 E(er threshold timeout\))-.1 E(\(let \(\(f)77 216 Q
(ailures 0\))-.1 E(\(state 'closed\))92 228 Q(\(last-f)92 240 Q
(ailure #f\)\))-.1 E(\(lambda \(operation\))82 264 Q(\(case state)87 276
Q(\(\(open\))92 288 Q(\(if \(> \(- \(current-time\) last-f)94.5 300 Q
(ailure\) timeout\))-.1 E(\(be)104.5 312 Q(gin)-.15 E
(\(set! state 'half-open\))109.5 324 Q(\(try-operation operation\)\))
109.5 336 Q(\(error "Circuit open"\)\)\))104.5 348 Q(\(\(half-open\))92
360 Q(\(let \(\(result \(try-operation operation\)\)\))94.5 372 Q
(\(if \(result-ok? result\))99.5 384 Q(\(be)109.5 396 Q(gin)-.15 E
(\(set! state 'closed\))114.5 408 Q(\(set! f)114.5 420 Q(ailures 0\))-.1
E(\(result-v)114.5 432 Q(alue result\)\))-.25 E(\(be)109.5 444 Q(gin)
-.15 E(\(set! state 'open\))114.5 456 Q
(\(error "Circuit reopened"\)\)\)\)\))114.5 468 Q(\(\(closed\))92 480 Q
(\(try-operation operation\)\)\)\)\)\))94.5 492 Q
(\(de\214ne \(try-operation cb operation\))72 516 Q(\(guard \(e)77 528 Q
(x)-.15 E(\(else)97 540 Q(\(cb-record-f)99.5 552 Q(ailure! cb\))-.1 E
(\(result-err e)99.5 564 Q(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\) `)82 576 Q -.74(``)-.74 G(---)72 600 Q
(Storage Errors)72 624 Q(Corruption Detection)72 648 Q -.74(```)72 672 S
(scheme \(de\214ne \(detect-corruption hash\)).74 E("V)77 684 Q
(erify object inte)-1.11 E(grity")-.15 E
(\(let* \(\(data \(storage-read-ra)77 696 Q 2.5(wh)-.15 G(ash\)\))-2.5 E
(\(computed-hash \(content-hash data\)\)\))94.5 708 Q
(\(unless \(equal? hash computed-hash\))82 720 Q(\(record-error!)87 732
Q(\(mak)92 744 Q(e-error 'corruption)-.1 E("Hash mismatch detected")97
756 Q(`\(\(e)97 768 Q(xpected . ,hash\))-.15 E
(\(computed . ,computed-hash\))102 780 Q(\(size . ,\(byte)102 792 Q -.15
(ve)-.25 G(ctor).15 E(-length data\)\)\)\)\)\)\)\))-.2 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne \(scan-for)72 24 Q(-corruption\))-.2
E("Full v)77 36 Q(ault inte)-.25 E(grity scan")-.15 E
(\(let \(\(corrupted '\(\)\)\))77 48 Q(\(for)82 60 Q
(-each \(lambda \(hash\))-.2 E(\(unless \(v)112 72 Q(erify-inte)-.15 E
(grity hash\))-.15 E(\(set! corrupted \(cons hash corrupted\)\)\)\))117
84 Q(\(all-object-hashes\)\))107 96 Q
(\(when \(not \(null? corrupted\)\))82 108 Q
(\(audit-append action: 'corruption-scan)87 120 Q
(corrupted: \(length corrupted\)\)\))122 132 Q(corrupted\)\) `)82 144 Q
-.74(``)-.74 G(Corruption Reco)72 168 Q -.15(ve)-.15 G(ry).15 E -.74
(```)72 192 S(scheme \(de\214ne \(reco).74 E -.15(ve)-.15 G -.2(r-).15 G
(corrupted hash\)).2 E("Attempt to reco)77 204 Q -.15(ve)-.15 G 2.5(rc)
.15 G(orrupted object")-2.5 E(;; Strate)77 216 Q
(gy 1: Fetch from replica)-.15 E
(\(let \(\(replicas \(\214nd-replicas hash\)\)\))77 228 Q(\(for)82 240 Q
(-each \(lambda \(replica\))-.2 E
(\(let \(\(data \(fetch-from-replica replica hash\)\)\))112 252 Q
(\(when \(and data \(v)117 264 Q(erify-hash data hash\)\))-.15 E
(\(storage-write hash data\))122 276 Q
(\(audit-append action: 'corruption-reco)122 288 Q -.15(ve)-.15 G(red)
.15 E(source: replica\))157 300 Q(\(return data\)\)\)\))122 312 Q
(replicas\)\))107 324 Q(;; Strate)77 348 Q
(gy 2: Reconstruct from erasure coding)-.15 E
(\(when \(erasure-coded? hash\))77 360 Q
(\(let \(\(data \(reconstruct-from-shards hash\)\)\))82 372 Q
(\(when data)87 384 Q(\(storage-write hash data\))92 396 Q
(\(audit-append action: 'erasure-reco)92 408 Q -.15(ve)-.15 G(ry\)).15 E
(\(return data\)\)\)\))92 420 Q(;; Strate)77 444 Q(gy 3: Mark as lost)
-.15 E(\(mark-object-lost hash\))77 456 Q
(\(audit-append action: 'object-lost hash: hash\))77 468 Q(#f\) `)77 480
Q -.74(``)-.74 G(Disk Full Handling)72 504 Q -.74(```)72 528 S
(scheme \(de\214ne \(handle-disk-full\)).74 E("Emer)77 540 Q(genc)-.18 E
2.5(yd)-.15 G(isk space reco)-2.5 E -.15(ve)-.15 G(ry").15 E
(;; Phase 1: Emer)77 552 Q(genc)-.18 E 2.5(yG)-.15 G(C)-2.5 E(\(gc-emer)
77 564 Q(genc)-.18 E(y\))-.15 E(;; Phase 2: Clear caches)77 588 Q
(\(clear)77 600 Q(-all-caches\))-.2 E
(;; Phase 3: Compress compressible objects)77 624 Q
(\(compress-uncompressed-objects\))77 636 Q(;; Phase 4: Alert and de)77
660 Q(grade)-.15 E(\(when \(< \(a)77 672 Q -.25(va)-.2 G
(ilable-space\) *critical-threshold*\)).25 E(\(alert-disk-critical\))82
684 Q(\(v)82 696 Q 2.5(ault-readonly!\)\)\) `)-.25 F -.74(``)-.74 G(---)
72 720 Q(Netw)72 744 Q(ork Errors)-.1 E -.35(Ti)72 768 S(meout Handling)
.35 E -.74(```)72 792 S
(scheme \(de\214ne \(with-timeout duration operation\)).74 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF("Ex)77 12 Q(ecute operation with timeout")-.15 E
(\(let \(\(result \(mak)77 24 Q(e-channel\)\)\))-.1 E(\(thread-start!)82
36 Q(\(mak)87 48 Q(e-thread)-.1 E(\(lambda \(\))92 60 Q
(\(channel-put! result)97 72 Q(\(guard \(e)102 84 Q 2.5(x\()-.15 G
(else \(result-err e)-2.5 E(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\)\)\)\))107 96 Q
(\(let \(\(r \(channel-get! result duration\)\)\))82 108 Q(\(if r)87 120
Q(\(if \(result-ok? r\))97 132 Q(\(result-v)107 144 Q(alue r\))-.25 E
(\(error \(result-error r\)\)\))107 156 Q(\(error \(mak)97 168 Q
(e-error ')-.1 E(timeout)-.18 E("Operation timed out")119.5 180 Q
(`\(\(duration . ,duration\)\)\)\)\)\)\)\) `)119.5 192 Q -.74(``)-.74 G
-.15(Pa)72 216 S(rtition Detection).15 E -.74(```)72 240 S
(scheme \(de\214ne \(detect-partition peers\)).74 E("Detect netw)77 252
Q(ork partition")-.1 E(\(let* \(\(reachable \(\214lter peer)77 264 Q
(-reachable? peers\)\))-.2 E
(\(unreachable \(\214lter \(lambda \(p\) \(not \(peer)94.5 276 Q
(-reachable? p\)\)\) peers\)\)\))-.2 E
(\(when \(> \(length unreachable\) 0\))82 288 Q
(\(audit-append action: 'partition-detected)87 300 Q
(reachable: \(length reachable\))122 312 Q
(unreachable: \(length unreachable\)\))122 324 Q
(\(if \(> \(length reachable\) \(/ \(length peers\) 2\)\))87 336 Q
(\(continue-with-majority reachable\))97 348 Q(\(enter)97 360 Q
(-read-only-mode\)\)\)\)\) `)-.2 E -.74(``)-.74 G(Connection Pool Reco)
72 384 Q -.15(ve)-.15 G(ry).15 E -.74(```)72 408 S
(scheme \(de\214ne \(reco).74 E -.15(ve)-.15 G -.2(r-).15 G
(connection-pool pool\)).2 E("Reco)77 420 Q -.15(ve)-.15 G 2.5(rf).15 G
(rom connection pool e)-2.5 E(xhaustion")-.15 E
(;; Close idle connections)77 432 Q(\(pool-close-idle! pool\))77 444 Q
(;; Close long-running connections)77 468 Q
(\(pool-close-stale! pool *max-connection-age*\))77 480 Q(;; If still e)
77 504 Q(xhausted, reject ne)-.15 E 2.5(wr)-.25 G(equests)-2.5 E
(\(when \(pool-e)77 516 Q(xhausted? pool\))-.15 E
(\(audit-append action: 'pool-e)82 528 Q(xhausted\))-.15 E
(\(enable-request-shedding\)\)\) `)82 540 Q -.74(``)-.74 G(---)72 564 Q
(Consistenc)72 588 Q 2.5(yE)-.15 G(rrors)-2.5 E(Con\215ict Detection)72
612 Q -.74(```)72 636 S(scheme \(de\214ne \(detect-con\215ict hash v).74
E(ersions\))-.15 E("Detect con\215icting v)77 648 Q(ersions of object")
-.15 E(\(let \(\(unique-contents \(delete-duplicates)77 660 Q(\(map v)
137 672 Q(ersion-content v)-.15 E(ersions\)\)\)\))-.15 E
(\(when \(> \(length unique-contents\) 1\))82 684 Q(\(record-error!)87
696 Q(\(mak)92 708 Q(e-error 'con\215ict)-.1 E("Con\215icting v)97 720 Q
(ersions detected")-.15 E(`\(\(hash . ,hash\))97 732 Q(\(v)102 744 Q
(ersions . ,\(length unique-contents\)\))-.15 E(\(sources . ,\(map v)102
756 Q(ersion-source v)-.15 E(ersions\)\)\)\)\)\)\)\) `)-.15 E -.74(``)
-.74 G(Con\215ict Resolution)72 780 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.74(```)72 12 S(scheme \(de\214ne \(resolv).74
E(e-con\215ict hash v)-.15 E(ersions strate)-.15 E(gy\))-.15 E("Resolv)
77 24 Q 2.5(ec)-.15 G(on\215icting v)-2.5 E(ersions")-.15 E
(\(let \(\(resolv)77 36 Q(ed)-.15 E(\(case strate)94.5 48 Q(gy)-.15 E
(\(\(latest\))99.5 60 Q(\(max-by v)102 72 Q(ersion-timestamp v)-.15 E
(ersions\)\))-.15 E(\(\(mer)99.5 84 Q(ge\))-.18 E(\(mer)102 96 Q(ge-v)
-.18 E(ersions v)-.15 E(ersions\)\))-.15 E(\(\(manual\))99.5 108 Q
(\(queue-for)102 120 Q(-manual-resolution hash v)-.2 E(ersions\)\))-.15
E(\(\(tombstone\))99.5 132 Q(\(create-con\215ict-tombstone hash v)102
144 Q(ersions\)\)\)\)\))-.15 E
(\(audit-append action: 'con\215ict-resolv)82 156 Q(ed)-.15 E
(hash: hash)117 168 Q(strate)117 180 Q(gy: strate)-.15 E(gy\))-.15 E
(resolv)82 192 Q(ed\)\) `)-.15 E -.74(``)-.74 G(Merkle Di)72 216 Q -.15
(ve)-.25 G -.18(rg).15 G(ence).18 E -.74(```)72 240 S
(scheme \(de\214ne \(handle-merkle-di).74 E -.15(ve)-.25 G -.18(rg).15 G
(ence local-root remote-root peer\)).18 E("Handle di)77 252 Q -.15(ve)
-.25 G -.18(rg).15 G(ed Merkle trees").18 E(\(let \(\(di)77 264 Q -.15
(ve)-.25 G -.18(rg).15 G(ence \(\214nd-di).18 E -.15(ve)-.25 G -.18(rg)
.15 G(ence-point local-root remote-root\)\)\)).18 E
(\(audit-append action: 'merkle-di)82 276 Q -.15(ve)-.25 G -.18(rg).15 G
(ence).18 E(local: local-root)117 288 Q(remote: remote-root)117 300 Q
(di)117 312 Q -.15(ve)-.25 G -.18(rg).15 G(ence: di).18 E -.15(ve)-.25 G
-.18(rg).15 G(ence\)).18 E(;; Sync di)82 324 Q -.15(ve)-.25 G -.18(rg)
.15 G(ed subtrees).18 E(\(for)82 336 Q(-each \(lambda \(subtree\))-.2 E
(\(sync-subtree subtree peer\)\))112 348 Q(\(di)107 360 Q -.15(ve)-.25 G
-.18(rg).15 G(ent-subtrees di).18 E -.15(ve)-.25 G -.18(rg).15 G
(ence\)\)\)\) `).18 E -.74(``)-.74 G(---)72 384 Q(Reco)72 408 Q -.15(ve)
-.15 G(ry Procedures).15 E(Automatic Reco)72 432 Q -.15(ve)-.15 G(ry).15
E -.74(```)72 456 S(scheme \(de\214ne reco).74 E -.15(ve)-.15 G
(ry-handlers).15 E(`\(\(corruption . ,reco)77 468 Q -.15(ve)-.15 G -.2
(r-).15 G(corrupted\)).2 E(\(missing . ,fetch-from-replica\))82 480 Q
(\(timeout . ,retry-with-back)82 492 Q(of)-.1 E(f\))-.25 E
(\(partition . ,w)82 504 Q(ait-for)-.1 E(-reconnection\))-.2 E
(\(con\215ict . ,resolv)82 516 Q(e-with-def)-.15 E(ault-strate)-.1 E
(gy\)\)\))-.15 E(\(de\214ne \(auto-reco)72 540 Q -.15(ve)-.15 G 2.5(re)
.15 G(rror\))-2.5 E("Attempt automatic reco)77 552 Q -.15(ve)-.15 G(ry")
.15 E(\(let \(\(handler \(assoc-ref reco)77 564 Q -.15(ve)-.15 G
(ry-handlers \(error).15 E(-type error\)\)\)\))-.2 E(\(if handler)82 576
Q(\(be)92 588 Q(gin)-.15 E(\(audit-append action: 'auto-reco)97 600 Q
-.15(ve)-.15 G(ry-attempt).15 E(error: \(error)132 612 Q(-id error\)\))
-.2 E(\(handler error\)\))97 624 Q(\(escalate-error error\)\)\)\) `)92
636 Q -.74(``)-.74 G(Manual Reco)72 660 Q -.15(ve)-.15 G(ry).15 E -.74
(```)72 684 S(scheme \(de\214ne \(queue-manual-reco).74 E -.15(ve)-.15 G
(ry error\)).15 E("Queue error for manual interv)77 696 Q(ention")-.15 E
(\(soup-put)77 708 Q(`\(reco)82 720 Q -.15(ve)-.15 G(ry-tick).15 E(et)
-.1 E(\(error ,\(error)87 732 Q(-id error\)\))-.2 E(\(status pending\))
87 744 Q(\(created ,\(current-time\)\))87 756 Q(\(assigned #f\)\))87 768
Q(type: ')82 780 Q(reco)-.5 E -.15(ve)-.15 G(ry-tick).15 E(et\)\))-.1 E
0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne \(process-reco)72 12 Q -.15(ve)-.15 G
(ry-tick).15 E(et tick)-.1 E(et-hash\))-.1 E("Process manual reco)77 24
Q -.15(ve)-.15 G(ry tick).15 E(et")-.1 E(\(let \(\(tick)77 36 Q
(et \(soup-get tick)-.1 E(et-hash\)\)\))-.1 E(;; Mark in progress)82 48
Q(\(soup-update tick)82 60 Q(et-hash status: 'in-progress\))-.1 E
(;; ... manual reco)82 72 Q -.15(ve)-.15 G(ry steps ...).15 E
(;; Mark resolv)82 84 Q(ed)-.15 E(\(soup-update tick)82 96 Q(et-hash)-.1
E(status: ')114.5 108 Q(resolv)-.5 E(ed)-.15 E(resolv)114.5 120 Q
(ed-at: \(current-time\))-.15 E(resolv)114.5 132 Q
(ed-by: \(current-principal\)\)\)\) `)-.15 E -.74(``)-.74 G
(Disaster Reco)72 156 Q -.15(ve)-.15 G(ry).15 E -.74(```)72 180 S
(scheme \(de\214ne \(disaster).74 E(-reco)-.2 E -.15(ve)-.15 G
(ry backup-location\)).15 E("Full v)77 192 Q(ault reco)-.25 E -.15(ve)
-.15 G(ry from backup").15 E(\(audit-append action: ')77 204 Q(disaster)
-.5 E(-reco)-.2 E -.15(ve)-.15 G(ry-start).15 E
(backup: backup-location\))112 216 Q(;; Phase 1: V)77 240 Q
(erify backup inte)-1.11 E(grity)-.15 E(\(unless \(v)77 252 Q
(erify-backup-inte)-.15 E(grity backup-location\))-.15 E
(\(error "Backup inte)82 264 Q(grity check f)-.15 E(ailed"\)\))-.1 E
(;; Phase 2: Restore CAS)77 288 Q
(\(restore-cas-from-backup backup-location\))77 300 Q
(;; Phase 3: Restore soup)77 324 Q
(\(restore-soup-from-backup backup-location\))77 336 Q
(;; Phase 4: Restore inde)77 360 Q -.15(xe)-.15 G(s).15 E(\(reb)77 372 Q
(uild-inde)-.2 E -.15(xe)-.15 G(s\)).15 E(;; Phase 5: V)77 396 Q
(erify restoration)-1.11 E(\(v)77 408 Q(erify-restoration\))-.15 E
(\(audit-append action: ')77 432 Q(disaster)-.5 E(-reco)-.2 E -.15(ve)
-.15 G(ry-complete\)\) `).15 E -.74(``)-.74 G(---)72 456 Q
(Error Reporting)72 480 Q(Error Aggre)72 504 Q -.05(ga)-.15 G(tion).05 E
-.74(```)72 528 S(scheme \(de\214ne \(aggre).74 E -.05(ga)-.15 G
(te-errors windo).05 E(w\))-.25 E("Aggre)77 540 Q -.05(ga)-.15 G
(te errors o).05 E -.15(ve)-.15 G 2.5(rt).15 G(ime windo)-2.5 E(w")-.25
E(\(let \(\(errors \(soup-query type: 'error)77 552 Q
(timestamp: \(> \(- \(current-time\) windo)142 564 Q(w\)\)\)\)\))-.25 E
(\(group-by error)82 576 Q(-type errors\)\)\))-.2 E(\(de\214ne \(error)
72 600 Q(-rate error)-.2 E(-type windo)-.2 E(w\))-.25 E
("Calculate error rate")77 612 Q
(\(let \(\(count \(length \(soup-query type: 'error)77 624 Q(error)159.5
636 Q(-type: error)-.2 E(-type)-.2 E
(timestamp: \(> \(- \(current-time\) windo)159.5 648 Q(w\)\)\)\)\)\))
-.25 E(\(/ count windo)82 660 Q(w\)\)\) `)-.25 E -.74(``)-.74 G
(Alerting)72 684 Q -.74(```)72 708 S(scheme \(de\214ne alert-thresholds)
.74 E(`\(\(corruption . 1\))77 720 Q 2.5(;A)20 G .3 -.15(ny c)-2.5 H
(orruption is critical).15 E(\(timeout . 100\))82 732 Q 2.5(;1)22.5 G
(00 timeouts per minute)-2.5 E(\(con\215ict . 10\))82 744 Q 2.5(;1)22.5
G 2.5(0c)-2.5 G(on\215icts per minute)-2.5 E(\(resource . 5\)\)\))82 756
Q 2.5(;5r)20 G(esource errors per minute)-2.5 E
(\(de\214ne \(check-alert-thresholds\))72 780 Q("Check if error rates e)
77 792 Q(xceed thresholds")-.15 E 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(for)77 12 Q(-each \(lambda \(threshold\))-.2 E
(\(let \(\(type \(car threshold\)\))107 24 Q
(\(limit \(cdr threshold\)\)\))122 36 Q(\(when \(> \(error)112 48 Q
(-rate type 60\) limit\))-.2 E(\(send-alert type \(error)117 60 Q
(-rate type 60\) limit\)\)\)\))-.2 E(alert-thresholds\)\) `)102 72 Q
-.74(``)-.74 G(---)72 96 Q(Security Considerations)72 120 Q
(Error Information Leakage)72 144 Q -.74(```)72 168 S(scheme ;; Don').74
E 2.5(te)-.18 G(xpose internal details in user)-2.65 E(-f)-.2 E
(acing errors \(de\214ne \(sanitize-error)-.1 E(-for)-.2 E
(-user error\))-.2 E(`\(error)77 180 Q(\(type ,\(error)82 192 Q
(-type error\)\))-.2 E(\(message ,\(user)82 204 Q(-safe-message \(error)
-.2 E(-type error\)\)\))-.2 E(\(request-id ,\(error)82 216 Q
(-request-id error\)\)\)\))-.2 E
(;; Full details only in audit log \(de\214ne \(log-full-error error\))
72 240 Q(\(audit-append action: 'error)77 252 Q(error: error\)\))112 264
Q 2.5(;F)5 G(ull conte)-2.5 E(xt preserv)-.15 E(ed `)-.15 E -.74(``)-.74
G(Error)72 288 Q(-Based Attacks)-.2 E -.74(```)72 312 S
(scheme ;; Rate limit error generation to pre).74 E -.15(ve)-.25 G
(nt DoS \(de\214ne error).15 E(-rate-limiter)-.2 E(\(mak)77 324 Q
(e-rate-limiter 1000 60\)\))-.1 E 2.5(;1)5 G(000 errors per minute max)
-2.5 E(\(de\214ne \(rate-limited-record-error! err\))72 348 Q
(\(if \(rate-limiter)77 360 Q(-allo)-.2 E(w? error)-.25 E
(-rate-limiter\))-.2 E(\(record-error! err\))87 372 Q
(\(audit-append action: 'error)87 384 Q(-rate-limited\)\)\) `)-.2 E -.74
(``)-.74 G(---)72 408 Q(References)72 432 Q 14.734(1. [Release It!]\(ht\
tps://pragprog.com/titles/mnee2/release-it-second-edition/\) - Nyg)72
456 R 14.733(ard 2. [Hys-)-.05 F(trix]\(https://github)72 468 Q 8.285
(.com/Net\215ix/Hystrix\) - Net\215ix Circuit Break)-.4 F 8.285
(er 3. [RFC-003: Cryptographic Audit)-.1 F -.35(Tr)72 480 S(ail]\(rfc-0\
03-audit-trail.md\) 4. [RFC-026: Garbage Collection]\(rfc-026-g).35 E
(arbage-collection.md\))-.05 E(---)72 504 Q(Changelog)72 528 Q 2.5(-*)72
552 S(*2026-01-07** - Initial draft)-2.5 E(---)72 576 Q 1.65(**Implemen\
tation Status:** Draft **Dependencies:** soup, audit, storage **Inte)72
600 R 1.65(gration:** All v)-.15 F 1.65(ault operations,)-.25 F
(monitoring, alerting)72 612 Q 0 Cg EP
%%Trailer
end
%%EOF
