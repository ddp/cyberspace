%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Thu Jan  8 15:17:54 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 8
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-028: Error Handling and Reco)72 12 Q -.15
(ve)-.15 G(ry).15 E(Status: Draft Date: January 2026 Author: Derrell Pi\
per ddp@eludom.net Implementation: Proposed)72 36 Q(-------------------\
-----------------------------------------------------------)72 60 Q
(Abstract)72 84 Q .101(This RFC speci\214es error handling and reco)72
108 R -.15(ve)-.15 G .101(ry for the Library of Cyberspace: ho).15 F 2.6
(wv)-.25 G .1(aults detect, report, and reco)-2.85 F -.15(ve)-.15 G(r)
.15 E .911(from f)72 120 R .911(ailures while maintaining inte)-.1 F
.912(grity guarantees. Errors are \214rst-class objects in the soup, en\
abling systematic)-.15 F(analysis and automated reco)72 132 Q -.15(ve)
-.15 G(ry).15 E(.)-.65 E(----------------------------------------------\
--------------------------------)72 156 Q(Moti)72 180 Q -.25(va)-.25 G
(tion).25 E(Distrib)72 204 Q(uted systems f)-.2 E(ail in creati)-.1 E .3
-.15(ve w)-.25 H(ays:).05 E 2.898(-N)72 228 S(etw)-2.898 E .398
(ork partitions - V)-.1 F .398
(aults lose contact - Storage corruption - Bits \215ip, disks f)-1.11 F
.397(ail - Byzantine f)-.1 F .397(aults - Nodes lie or)-.1 F(misbeha)72
240 Q .988 -.15(ve - R)-.2 H .688(esource e).15 F .688
(xhaustion - Out of memory)-.15 F 3.188(,d)-.65 G .688
(isk, connections - Protocol violations - Malformed messages,)-3.188 F
(in)72 252 Q -.25(va)-.4 G(lid state).25 E(Reco)72 276 Q -.15(ve)-.15 G
(ry must be:).15 E 2.59(-D)72 300 S .09(eterministic - Same error)-2.59
F 2.59(,s)-.4 G .09(ame reco)-2.59 F -.15(ve)-.15 G .09
(ry - Auditable - Ev).15 F .089(ery error logged with conte)-.15 F .089
(xt - Automatic - Self-healing)-.15 F(where possible - Graceful - De)72
312 Q(grade rather than crash)-.15 E(----------------------------------\
--------------------------------------------)72 336 Q(Error Model)72 360
Q(Error T)72 384 Q(ypes)-.8 E(\(de\214ne-error)82 408 Q(-type ')-.2 E
(storage-error)-.55 E(\(subtypes corruption missing full readonly\)\))87
420 Q(\(de\214ne-error)82 444 Q(-type 'netw)-.2 E(ork-error)-.1 E
(\(subtypes timeout unreachable protocol-violation\)\))87 456 Q
(\(de\214ne-error)82 480 Q(-type 'crypto-error)-.2 E
(\(subtypes signature-in)87 492 Q -.25(va)-.4 G(lid k).25 E -.15(ey)-.1
G(-e).15 E(xpired capability-denied\)\))-.15 E(\(de\214ne-error)82 516 Q
(-type 'consistenc)-.2 E(y-error)-.15 E
(\(subtypes hash-mismatch merkle-di)87 528 Q -.15(ve)-.25 G -.18(rg).15
G(ence con\215ict\)\)).18 E(\(de\214ne-error)82 552 Q(-type ')-.2 E
(resource-error)-.5 E(\(subtypes memory-e)87 564 Q
(xhausted connections-e)-.15 E(xhausted rate-limited\)\))-.15 E
(\(de\214ne-error)82 588 Q(-type 'protocol-error)-.2 E(\(subtypes in)87
600 Q -.25(va)-.4 G(lid-message in).25 E -.25(va)-.4 G(lid-state v).25 E
(ersion-mismatch\)\))-.15 E(Error Structure)72 624 Q(\(de\214ne \(mak)82
648 Q(e-error type message conte)-.1 E(xt\))-.15 E(`\(error)87 660 Q
(\(id ,\(generate-error)92 672 Q(-id\)\))-.2 E(\(type ,type\))92 684 Q
(\(message ,message\))92 696 Q(\(conte)92 708 Q(xt ,conte)-.15 E(xt\))
-.15 E(\(timestamp ,\(current-time\)\))92 720 Q(\(v)92 732 Q
(ault ,\(current-v)-.25 E(ault-id\)\))-.25 E
(\(principal ,\(current-principal\)\))92 744 Q
(\(stack ,\(capture-stack-trace\)\)\)\))92 756 Q
(;; Errors are soup objects)82 780 Q(\(de\214ne \(record-error! err\))82
792 Q 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF
(\(let \(\(hash \(soup-put err type: 'error\)\)\))87 12 Q
(\(audit-append action: 'error)92 24 Q(-recorded error)-.2 E
(-hash: hash\))-.2 E(hash\)\))92 36 Q(Error Conte)72 60 Q(xt)-.15 E
(;; Capture rich conte)82 84 Q(xt for deb)-.15 E(ugging)-.2 E
(\(de\214ne \(error)82 96 Q(-conte)-.2 E(xt operation\))-.15 E
(`\(\(operation . ,operation\))87 108 Q
(\(request-id . ,\(current-request-id\)\))92 120 Q
(\(correlation-id . ,\(current-correlation-id\)\))92 132 Q
(\(peer . ,\(current-peer\)\))92 144 Q
(\(attempt . ,\(current-retry-count\)\))92 156 Q
(\(duration . ,\(operation-duration\)\))92 168 Q
(\(inputs . ,\(sanitize-inputs \(operation-inputs\)\)\)\)\))92 180 Q(--\
-----------------------------------------------------------------------\
-----)72 204 Q(Error Handling P)72 228 Q(atterns)-.15 E(Result T)72 252
Q(ype)-.8 E(;; Operations return \(ok v)82 276 Q
(alue\) or \(err error\))-.25 E(\(de\214ne \(result-ok v)82 288 Q
(alue\) `\(ok ,v)-.25 E(alue\)\))-.25 E
(\(de\214ne \(result-err error\) `\(err ,error\)\))82 300 Q
(\(de\214ne \(result-ok? r\) \(eq? \(car r\) 'ok\)\))82 324 Q
(\(de\214ne \(result-err? r\) \(eq? \(car r\) 'err\)\))82 336 Q
(\(de\214ne \(result-v)82 348 Q(alue r\) \(cadr r\)\))-.25 E
(\(de\214ne \(result-error r\) \(cadr r\)\))82 360 Q
(;; Chain operations)82 384 Q(\(de\214ne \(result-bind r f\))82 396 Q
(\(if \(result-ok? r\))87 408 Q(\(f \(result-v)97 420 Q(alue r\)\))-.25
E(r\)\))97 432 Q(;; Example)82 456 Q(\(de\214ne \(safe-read hash\))82
468 Q(\(result-bind \(cas-get-safe hash\))87 480 Q(\(lambda \(data\))92
492 Q(\(result-bind \(v)97 504 Q(erify-signature data\))-.15 E
(\(lambda \(v)102 516 Q(eri\214ed\))-.15 E(\(result-ok v)107 528 Q
(eri\214ed\)\)\)\)\)\))-.15 E(Error Reco)72 552 Q -.15(ve)-.15 G(ry).15
E(\(de\214ne \(with-reco)82 576 Q -.15(ve)-.15 G(ry operation reco).15 E
-.15(ve)-.15 G(ry\)).15 E("Ex)87 588 Q(ecute operation with reco)-.15 E
-.15(ve)-.15 G(ry on f).15 E(ailure")-.1 E(\(let \(\(result \(guard \(e)
87 600 Q 2.5(x\()-.15 G(else \(result-err e)-2.5 E(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\)\))127 612 Q(\(if \(result-ok? result\))
92 624 Q(\(result-v)102 636 Q(alue result\))-.25 E(\(reco)102 648 Q -.15
(ve)-.15 G(ry \(result-error result\)\)\)\)\)).15 E
(;; Example: read with f)82 672 Q(allback to replica)-.1 E
(\(de\214ne \(read-with-f)82 684 Q(allback hash\))-.1 E(\(with-reco)87
696 Q -.15(ve)-.15 G(ry).15 E(\(lambda \(\) \(cas-get hash\)\))92 708 Q
(\(lambda \(err\))92 720 Q(\(audit-append action: ')97 732 Q(read-f)-.5
E(allback error: err\))-.1 E(\(cas-get-from-replica hash\)\)\)\))97 744
Q(Retry Logic)72 768 Q
(\(de\214ne \(with-retry operation max-retries back)82 792 Q(of)-.1 E
(f\))-.25 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF("Retry operation with e)87 12 Q(xponential back)
-.15 E(of)-.1 E(f")-.25 E(\(let loop \(\(attempt 1\)\))87 24 Q
(\(let \(\(result \(guard \(e)92 36 Q 2.5(x\()-.15 G
(else \(result-err e)-2.5 E(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\)\))132 48 Q(\(cond)97 60 Q
(\(\(result-ok? result\))102 72 Q(\(result-v)104.5 84 Q(alue result\)\))
-.25 E(\(\(>= attempt max-retries\))102 96 Q(\(error "Max retries e)
104.5 108 Q(xceeded" \(result-error result\)\)\))-.15 E(\(else)102 120 Q
(\(let \(\(delay \(* back)104.5 132 Q(of)-.1 E 2.5(f\()-.25 G -.15(ex)
-2.5 G(pt 2 \(- attempt 1\)\)\)\)\)).15 E(\(audit-append action: ')109.5
144 Q(retry attempt: attempt delay: delay\))-.5 E
(\(thread-sleep! delay\))109.5 156 Q
(\(loop \(+ attempt 1\)\)\)\)\)\)\)\))109.5 168 Q
(;; Retry con\214guration)82 192 Q(\(de\214ne *def)82 204 Q
(ault-retry-con\214g*)-.1 E(`\(\(max-retries . 3\))87 216 Q
(\(initial-back)92 228 Q(of)-.1 E 2.5(f.1)-.25 G 7.5(00\) ;)-2.5 F(ms)
2.5 E(\(max-back)92 240 Q(of)-.1 E 2.5(f.3)-.25 G 12.5(0000\) ;)-2.5 F
(ms)2.5 E(\(jitter . 0.1\)\)\))92 252 Q 2.5(;1)27.5 G(0% randomization)
-2.5 E(Circuit Break)72 276 Q(er)-.1 E(\(de\214ne \(mak)82 300 Q
(e-circuit-break)-.1 E(er threshold timeout\))-.1 E(\(let \(\(f)87 312 Q
(ailures 0\))-.1 E(\(state 'closed\))102 324 Q(\(last-f)102 336 Q
(ailure #f\)\))-.1 E(\(lambda \(operation\))92 360 Q(\(case state)97 372
Q(\(\(open\))102 384 Q(\(if \(> \(- \(current-time\) last-f)104.5 396 Q
(ailure\) timeout\))-.1 E(\(be)114.5 408 Q(gin)-.15 E
(\(set! state 'half-open\))119.5 420 Q(\(try-operation operation\)\))
119.5 432 Q(\(error "Circuit open"\)\)\))114.5 444 Q(\(\(half-open\))102
456 Q(\(let \(\(result \(try-operation operation\)\)\))104.5 468 Q
(\(if \(result-ok? result\))109.5 480 Q(\(be)119.5 492 Q(gin)-.15 E
(\(set! state 'closed\))124.5 504 Q(\(set! f)124.5 516 Q(ailures 0\))-.1
E(\(result-v)124.5 528 Q(alue result\)\))-.25 E(\(be)119.5 540 Q(gin)
-.15 E(\(set! state 'open\))124.5 552 Q
(\(error "Circuit reopened"\)\)\)\)\))124.5 564 Q(\(\(closed\))102 576 Q
(\(try-operation operation\)\)\)\)\)\))104.5 588 Q
(\(de\214ne \(try-operation cb operation\))82 612 Q(\(guard \(e)87 624 Q
(x)-.15 E(\(else)107 636 Q(\(cb-record-f)109.5 648 Q(ailure! cb\))-.1 E
(\(result-err e)109.5 660 Q(x\)\)\))-.15 E
(\(result-ok \(operation\)\)\)\))92 672 Q(-----------------------------\
-------------------------------------------------)72 696 Q
(Storage Errors)72 720 Q(Corruption Detection)72 744 Q
(\(de\214ne \(detect-corruption hash\))82 768 Q("V)87 780 Q
(erify object inte)-1.11 E(grity")-.15 E
(\(let* \(\(data \(storage-read-ra)87 792 Q 2.5(wh)-.15 G(ash\)\))-2.5 E
0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(computed-hash \(content-hash data\)\)\))104.5
12 Q(\(unless \(equal? hash computed-hash\))92 24 Q(\(record-error!)97
36 Q(\(mak)102 48 Q(e-error 'corruption)-.1 E("Hash mismatch detected")
107 60 Q(`\(\(e)107 72 Q(xpected . ,hash\))-.15 E
(\(computed . ,computed-hash\))112 84 Q(\(size . ,\(byte)112 96 Q -.15
(ve)-.25 G(ctor).15 E(-length data\)\)\)\)\)\)\)\))-.2 E
(\(de\214ne \(scan-for)82 120 Q(-corruption\))-.2 E("Full v)87 132 Q
(ault inte)-.25 E(grity scan")-.15 E(\(let \(\(corrupted '\(\)\)\))87
144 Q(\(for)92 156 Q(-each \(lambda \(hash\))-.2 E(\(unless \(v)122 168
Q(erify-inte)-.15 E(grity hash\))-.15 E
(\(set! corrupted \(cons hash corrupted\)\)\)\))127 180 Q
(\(all-object-hashes\)\))117 192 Q(\(when \(not \(null? corrupted\)\))92
204 Q(\(audit-append action: 'corruption-scan)97 216 Q
(corrupted: \(length corrupted\)\)\))132 228 Q(corrupted\)\))92 240 Q
(Corruption Reco)72 264 Q -.15(ve)-.15 G(ry).15 E(\(de\214ne \(reco)82
288 Q -.15(ve)-.15 G -.2(r-).15 G(corrupted hash\)).2 E
("Attempt to reco)87 300 Q -.15(ve)-.15 G 2.5(rc).15 G(orrupted object")
-2.5 E(;; Strate)87 312 Q(gy 1: Fetch from replica)-.15 E
(\(let \(\(replicas \(\214nd-replicas hash\)\)\))87 324 Q(\(for)92 336 Q
(-each \(lambda \(replica\))-.2 E
(\(let \(\(data \(fetch-from-replica replica hash\)\)\))122 348 Q
(\(when \(and data \(v)127 360 Q(erify-hash data hash\)\))-.15 E
(\(storage-write hash data\))132 372 Q
(\(audit-append action: 'corruption-reco)132 384 Q -.15(ve)-.15 G(red)
.15 E(source: replica\))167 396 Q(\(return data\)\)\)\))132 408 Q
(replicas\)\))117 420 Q(;; Strate)87 444 Q
(gy 2: Reconstruct from erasure coding)-.15 E
(\(when \(erasure-coded? hash\))87 456 Q
(\(let \(\(data \(reconstruct-from-shards hash\)\)\))92 468 Q
(\(when data)97 480 Q(\(storage-write hash data\))102 492 Q
(\(audit-append action: 'erasure-reco)102 504 Q -.15(ve)-.15 G(ry\)).15
E(\(return data\)\)\)\))102 516 Q(;; Strate)87 540 Q(gy 3: Mark as lost)
-.15 E(\(mark-object-lost hash\))87 552 Q
(\(audit-append action: 'object-lost hash: hash\))87 564 Q(#f\))87 576 Q
(Disk Full Handling)72 600 Q(\(de\214ne \(handle-disk-full\))82 624 Q
("Emer)87 636 Q(genc)-.18 E 2.5(yd)-.15 G(isk space reco)-2.5 E -.15(ve)
-.15 G(ry").15 E(;; Phase 1: Emer)87 648 Q(genc)-.18 E 2.5(yG)-.15 G(C)
-2.5 E(\(gc-emer)87 660 Q(genc)-.18 E(y\))-.15 E
(;; Phase 2: Clear caches)87 684 Q(\(clear)87 696 Q(-all-caches\))-.2 E
(;; Phase 3: Compress compressible objects)87 720 Q
(\(compress-uncompressed-objects\))87 732 Q(;; Phase 4: Alert and de)87
756 Q(grade)-.15 E(\(when \(< \(a)87 768 Q -.25(va)-.2 G
(ilable-space\) *critical-threshold*\)).25 E(\(alert-disk-critical\))92
780 Q(\(v)92 792 Q(ault-readonly!\)\)\))-.25 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-----------------------------------------------\
-------------------------------)72 24 Q(Netw)72 48 Q(ork Errors)-.1 E
-.35(Ti)72 72 S(meout Handling).35 E
(\(de\214ne \(with-timeout duration operation\))82 96 Q("Ex)87 108 Q
(ecute operation with timeout")-.15 E(\(let \(\(result \(mak)87 120 Q
(e-channel\)\)\))-.1 E(\(thread-start!)92 132 Q(\(mak)97 144 Q(e-thread)
-.1 E(\(lambda \(\))102 156 Q(\(channel-put! result)107 168 Q
(\(guard \(e)112 180 Q 2.5(x\()-.15 G(else \(result-err e)-2.5 E
(x\)\)\))-.15 E(\(result-ok \(operation\)\)\)\)\)\)\))117 192 Q
(\(let \(\(r \(channel-get! result duration\)\)\))92 204 Q(\(if r)97 216
Q(\(if \(result-ok? r\))107 228 Q(\(result-v)117 240 Q(alue r\))-.25 E
(\(error \(result-error r\)\)\))117 252 Q(\(error \(mak)107 264 Q
(e-error ')-.1 E(timeout)-.18 E("Operation timed out")129.5 276 Q
(`\(\(duration . ,duration\)\)\)\)\)\)\)\))129.5 288 Q -.15(Pa)72 312 S
(rtition Detection).15 E(\(de\214ne \(detect-partition peers\))82 336 Q
("Detect netw)87 348 Q(ork partition")-.1 E
(\(let* \(\(reachable \(\214lter peer)87 360 Q(-reachable? peers\)\))-.2
E(\(unreachable \(\214lter \(lambda \(p\) \(not \(peer)104.5 372 Q
(-reachable? p\)\)\) peers\)\)\))-.2 E
(\(when \(> \(length unreachable\) 0\))92 384 Q
(\(audit-append action: 'partition-detected)97 396 Q
(reachable: \(length reachable\))132 408 Q
(unreachable: \(length unreachable\)\))132 420 Q
(\(if \(> \(length reachable\) \(/ \(length peers\) 2\)\))97 432 Q
(\(continue-with-majority reachable\))107 444 Q(\(enter)107 456 Q
(-read-only-mode\)\)\)\)\))-.2 E(Connection Pool Reco)72 480 Q -.15(ve)
-.15 G(ry).15 E(\(de\214ne \(reco)82 504 Q -.15(ve)-.15 G -.2(r-).15 G
(connection-pool pool\)).2 E("Reco)87 516 Q -.15(ve)-.15 G 2.5(rf).15 G
(rom connection pool e)-2.5 E(xhaustion")-.15 E
(;; Close idle connections)87 528 Q(\(pool-close-idle! pool\))87 540 Q
(;; Close long-running connections)87 564 Q
(\(pool-close-stale! pool *max-connection-age*\))87 576 Q(;; If still e)
87 600 Q(xhausted, reject ne)-.15 E 2.5(wr)-.25 G(equests)-2.5 E
(\(when \(pool-e)87 612 Q(xhausted? pool\))-.15 E
(\(audit-append action: 'pool-e)92 624 Q(xhausted\))-.15 E
(\(enable-request-shedding\)\)\))92 636 Q(-----------------------------\
-------------------------------------------------)72 660 Q(Consistenc)72
684 Q 2.5(yE)-.15 G(rrors)-2.5 E(Con\215ict Detection)72 708 Q
(\(de\214ne \(detect-con\215ict hash v)82 732 Q(ersions\))-.15 E
("Detect con\215icting v)87 744 Q(ersions of object")-.15 E
(\(let \(\(unique-contents \(delete-duplicates)87 756 Q(\(map v)147 768
Q(ersion-content v)-.15 E(ersions\)\)\)\))-.15 E
(\(when \(> \(length unique-contents\) 1\))92 780 Q(\(record-error!)97
792 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(mak)102 12 Q(e-error 'con\215ict)-.1 E
("Con\215icting v)107 24 Q(ersions detected")-.15 E(`\(\(hash . ,hash\))
107 36 Q(\(v)112 48 Q(ersions . ,\(length unique-contents\)\))-.15 E
(\(sources . ,\(map v)112 60 Q(ersion-source v)-.15 E
(ersions\)\)\)\)\)\)\)\))-.15 E(Con\215ict Resolution)72 84 Q
(\(de\214ne \(resolv)82 108 Q(e-con\215ict hash v)-.15 E(ersions strate)
-.15 E(gy\))-.15 E("Resolv)87 120 Q 2.5(ec)-.15 G(on\215icting v)-2.5 E
(ersions")-.15 E(\(let \(\(resolv)87 132 Q(ed)-.15 E(\(case strate)104.5
144 Q(gy)-.15 E(\(\(latest\))109.5 156 Q(\(max-by v)112 168 Q
(ersion-timestamp v)-.15 E(ersions\)\))-.15 E(\(\(mer)109.5 180 Q(ge\))
-.18 E(\(mer)112 192 Q(ge-v)-.18 E(ersions v)-.15 E(ersions\)\))-.15 E
(\(\(manual\))109.5 204 Q(\(queue-for)112 216 Q
(-manual-resolution hash v)-.2 E(ersions\)\))-.15 E(\(\(tombstone\))
109.5 228 Q(\(create-con\215ict-tombstone hash v)112 240 Q
(ersions\)\)\)\)\))-.15 E(\(audit-append action: 'con\215ict-resolv)92
252 Q(ed)-.15 E(hash: hash)127 264 Q(strate)127 276 Q(gy: strate)-.15 E
(gy\))-.15 E(resolv)92 288 Q(ed\)\))-.15 E(Merkle Di)72 312 Q -.15(ve)
-.25 G -.18(rg).15 G(ence).18 E(\(de\214ne \(handle-merkle-di)82 336 Q
-.15(ve)-.25 G -.18(rg).15 G(ence local-root remote-root peer\)).18 E
("Handle di)87 348 Q -.15(ve)-.25 G -.18(rg).15 G(ed Merkle trees").18 E
(\(let \(\(di)87 360 Q -.15(ve)-.25 G -.18(rg).15 G(ence \(\214nd-di).18
E -.15(ve)-.25 G -.18(rg).15 G(ence-point local-root remote-root\)\)\))
.18 E(\(audit-append action: 'merkle-di)92 372 Q -.15(ve)-.25 G -.18(rg)
.15 G(ence).18 E(local: local-root)127 384 Q(remote: remote-root)127 396
Q(di)127 408 Q -.15(ve)-.25 G -.18(rg).15 G(ence: di).18 E -.15(ve)-.25
G -.18(rg).15 G(ence\)).18 E(;; Sync di)92 420 Q -.15(ve)-.25 G -.18(rg)
.15 G(ed subtrees).18 E(\(for)92 432 Q(-each \(lambda \(subtree\))-.2 E
(\(sync-subtree subtree peer\)\))122 444 Q(\(di)117 456 Q -.15(ve)-.25 G
-.18(rg).15 G(ent-subtrees di).18 E -.15(ve)-.25 G -.18(rg).15 G
(ence\)\)\)\)).18 E(---------------------------------------------------\
---------------------------)72 480 Q(Reco)72 504 Q -.15(ve)-.15 G
(ry Procedures).15 E(Automatic Reco)72 528 Q -.15(ve)-.15 G(ry).15 E
(\(de\214ne reco)82 552 Q -.15(ve)-.15 G(ry-handlers).15 E
(`\(\(corruption . ,reco)87 564 Q -.15(ve)-.15 G -.2(r-).15 G
(corrupted\)).2 E(\(missing . ,fetch-from-replica\))92 576 Q
(\(timeout . ,retry-with-back)92 588 Q(of)-.1 E(f\))-.25 E
(\(partition . ,w)92 600 Q(ait-for)-.1 E(-reconnection\))-.2 E
(\(con\215ict . ,resolv)92 612 Q(e-with-def)-.15 E(ault-strate)-.1 E
(gy\)\)\))-.15 E(\(de\214ne \(auto-reco)82 636 Q -.15(ve)-.15 G 2.5(re)
.15 G(rror\))-2.5 E("Attempt automatic reco)87 648 Q -.15(ve)-.15 G(ry")
.15 E(\(let \(\(handler \(assoc-ref reco)87 660 Q -.15(ve)-.15 G
(ry-handlers \(error).15 E(-type error\)\)\)\))-.2 E(\(if handler)92 672
Q(\(be)102 684 Q(gin)-.15 E(\(audit-append action: 'auto-reco)107 696 Q
-.15(ve)-.15 G(ry-attempt).15 E(error: \(error)142 708 Q(-id error\)\))
-.2 E(\(handler error\)\))107 720 Q(\(escalate-error error\)\)\)\))102
732 Q(Manual Reco)72 756 Q -.15(ve)-.15 G(ry).15 E
(\(de\214ne \(queue-manual-reco)82 780 Q -.15(ve)-.15 G(ry error\)).15 E
("Queue error for manual interv)87 792 Q(ention")-.15 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(soup-put)87 12 Q(`\(reco)92 24 Q -.15(ve)-.15
G(ry-tick).15 E(et)-.1 E(\(error ,\(error)97 36 Q(-id error\)\))-.2 E
(\(status pending\))97 48 Q(\(created ,\(current-time\)\))97 60 Q
(\(assigned #f\)\))97 72 Q(type: ')92 84 Q(reco)-.5 E -.15(ve)-.15 G
(ry-tick).15 E(et\)\))-.1 E(\(de\214ne \(process-reco)82 108 Q -.15(ve)
-.15 G(ry-tick).15 E(et tick)-.1 E(et-hash\))-.1 E("Process manual reco)
87 120 Q -.15(ve)-.15 G(ry tick).15 E(et")-.1 E(\(let \(\(tick)87 132 Q
(et \(soup-get tick)-.1 E(et-hash\)\)\))-.1 E(;; Mark in progress)92 144
Q(\(soup-update tick)92 156 Q(et-hash status: 'in-progress\))-.1 E
(;; ... manual reco)92 168 Q -.15(ve)-.15 G(ry steps ...).15 E
(;; Mark resolv)92 180 Q(ed)-.15 E(\(soup-update tick)92 192 Q(et-hash)
-.1 E(status: ')124.5 204 Q(resolv)-.5 E(ed)-.15 E(resolv)124.5 216 Q
(ed-at: \(current-time\))-.15 E(resolv)124.5 228 Q
(ed-by: \(current-principal\)\)\)\))-.15 E(Disaster Reco)72 252 Q -.15
(ve)-.15 G(ry).15 E(\(de\214ne \(disaster)82 276 Q(-reco)-.2 E -.15(ve)
-.15 G(ry backup-location\)).15 E("Full v)87 288 Q(ault reco)-.25 E -.15
(ve)-.15 G(ry from backup").15 E(\(audit-append action: ')87 300 Q
(disaster)-.5 E(-reco)-.2 E -.15(ve)-.15 G(ry-start).15 E
(backup: backup-location\))122 312 Q(;; Phase 1: V)87 336 Q
(erify backup inte)-1.11 E(grity)-.15 E(\(unless \(v)87 348 Q
(erify-backup-inte)-.15 E(grity backup-location\))-.15 E
(\(error "Backup inte)92 360 Q(grity check f)-.15 E(ailed"\)\))-.1 E
(;; Phase 2: Restore CAS)87 384 Q
(\(restore-cas-from-backup backup-location\))87 396 Q
(;; Phase 3: Restore soup)87 420 Q
(\(restore-soup-from-backup backup-location\))87 432 Q
(;; Phase 4: Restore inde)87 456 Q -.15(xe)-.15 G(s).15 E(\(reb)87 468 Q
(uild-inde)-.2 E -.15(xe)-.15 G(s\)).15 E(;; Phase 5: V)87 492 Q
(erify restoration)-1.11 E(\(v)87 504 Q(erify-restoration\))-.15 E
(\(audit-append action: ')87 528 Q(disaster)-.5 E(-reco)-.2 E -.15(ve)
-.15 G(ry-complete\)\)).15 E(------------------------------------------\
------------------------------------)72 552 Q(Error Reporting)72 576 Q
(Error Aggre)72 600 Q -.05(ga)-.15 G(tion).05 E(\(de\214ne \(aggre)82
624 Q -.05(ga)-.15 G(te-errors windo).05 E(w\))-.25 E("Aggre)87 636 Q
-.05(ga)-.15 G(te errors o).05 E -.15(ve)-.15 G 2.5(rt).15 G(ime windo)
-2.5 E(w")-.25 E(\(let \(\(errors \(soup-query type: 'error)87 648 Q
(timestamp: \(> \(- \(current-time\) windo)152 660 Q(w\)\)\)\)\))-.25 E
(\(group-by error)92 672 Q(-type errors\)\)\))-.2 E(\(de\214ne \(error)
82 696 Q(-rate error)-.2 E(-type windo)-.2 E(w\))-.25 E
("Calculate error rate")87 708 Q
(\(let \(\(count \(length \(soup-query type: 'error)87 720 Q(error)169.5
732 Q(-type: error)-.2 E(-type)-.2 E
(timestamp: \(> \(- \(current-time\) windo)169.5 744 Q(w\)\)\)\)\)\))
-.25 E(\(/ count windo)92 756 Q(w\)\)\))-.25 E(Alerting)72 780 Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(de\214ne alert-thresholds)82 12 Q
(`\(\(corruption . 1\))87 24 Q 2.5(;A)20 G .3 -.15(ny c)-2.5 H
(orruption is critical).15 E(\(timeout . 100\))92 36 Q 2.5(;1)22.5 G
(00 timeouts per minute)-2.5 E(\(con\215ict . 10\))92 48 Q 2.5(;1)22.5 G
2.5(0c)-2.5 G(on\215icts per minute)-2.5 E(\(resource . 5\)\)\))92 60 Q
2.5(;5r)20 G(esource errors per minute)-2.5 E
(\(de\214ne \(check-alert-thresholds\))82 84 Q("Check if error rates e)
87 96 Q(xceed thresholds")-.15 E(\(for)87 108 Q
(-each \(lambda \(threshold\))-.2 E(\(let \(\(type \(car threshold\)\))
117 120 Q(\(limit \(cdr threshold\)\)\))132 132 Q(\(when \(> \(error)122
144 Q(-rate type 60\) limit\))-.2 E(\(send-alert type \(error)127 156 Q
(-rate type 60\) limit\)\)\)\))-.2 E(alert-thresholds\)\))112 168 Q(---\
-----------------------------------------------------------------------\
----)72 192 Q(Security Considerations)72 216 Q
(Error Information Leakage)72 240 Q(;; Don')82 264 Q 2.5(te)-.18 G
(xpose internal details in user)-2.65 E(-f)-.2 E(acing errors)-.1 E
(\(de\214ne \(sanitize-error)82 276 Q(-for)-.2 E(-user error\))-.2 E
(`\(error)87 288 Q(\(type ,\(error)92 300 Q(-type error\)\))-.2 E
(\(message ,\(user)92 312 Q(-safe-message \(error)-.2 E
(-type error\)\)\))-.2 E(\(request-id ,\(error)92 324 Q
(-request-id error\)\)\)\))-.2 E(;; Full details only in audit log)82
348 Q(\(de\214ne \(log-full-error error\))82 360 Q
(\(audit-append action: 'error)87 372 Q(error: error\)\))122 384 Q 2.5
(;F)5 G(ull conte)-2.5 E(xt preserv)-.15 E(ed)-.15 E(Error)72 408 Q
(-Based Attacks)-.2 E(;; Rate limit error generation to pre)82 432 Q
-.15(ve)-.25 G(nt DoS).15 E(\(de\214ne error)82 444 Q(-rate-limiter)-.2
E(\(mak)87 456 Q(e-rate-limiter 1000 60\)\))-.1 E 2.5(;1)5 G
(000 errors per minute max)-2.5 E
(\(de\214ne \(rate-limited-record-error! err\))82 480 Q
(\(if \(rate-limiter)87 492 Q(-allo)-.2 E(w? error)-.25 E
(-rate-limiter\))-.2 E(\(record-error! err\))97 504 Q
(\(audit-append action: 'error)97 516 Q(-rate-limited\)\)\))-.2 E(-----\
-----------------------------------------------------------------------\
--)72 540 Q(References)72 564 Q 3.181(1. Release)72 588 R .681
(It! - Nyg)3.181 F .682(ard 2.)-.05 F .682
(Hystrix - Net\215ix Circuit Break)5.682 F .682(er 3.)-.1 F .682
(RFC-003: Cryptographic Audit T)5.682 F .682(rail 4.)-.35 F(RFC-026:)
5.682 E(Garbage Collection)72 600 Q(-----------------------------------\
-------------------------------------------)72 624 Q(Changelog)72 648 Q
2.5(-2)72 672 S(026-01-07 - Initial draft)-2.5 E(----------------------\
--------------------------------------------------------)72 696 Q .288
(Implementation Status: Draft Dependencies: soup, audit, storage Inte)72
720 R .287(gration: All v)-.15 F .287
(ault operations, monitoring, alert-)-.25 F(ing)72 732 Q 0 Cg EP
%%Trailer
end
%%EOF
