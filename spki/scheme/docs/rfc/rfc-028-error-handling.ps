%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Mon Jan 12 10:26:43 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 12
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-028: Err)202.236 123 Q(or Handling and Reco)
-.216 E -.12(ve)-.12 G(ry).12 E/F1 10/Times-Italic@0 SF(Libr)260.85 159
Q(ary of Cyber)-.15 E(space)-.1 E/F2 10/Times-Roman@0 SF(2026)296 177 Q
F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3 10/Times-Bold@0 SF 2.5(1. Abstract)
72 261 R F2 .101(This RFC speci\214es error handling and reco)72 276.6 R
-.15(ve)-.15 G .101(ry for the Library of Cyberspace: ho).15 F 2.6(wv)
-.25 G .1(aults detect, report, and reco)-2.85 F -.15(ve)-.15 G(r).15 E
.911(from f)72 288.6 R .911(ailures while maintaining inte)-.1 F .912(g\
rity guarantees. Errors are \214rst-class objects in the soup, enabling\
 systematic)-.15 F(analysis and automated reco)72 300.6 Q -.15(ve)-.15 G
(ry.).15 E F3 2.5(2. Moti)72 324.6 R -.1(va)-.1 G(tion).1 E F2(Distrib)
72 340.2 Q(uted systems f)-.2 E(ail in creati)-.1 E .3 -.15(ve w)-.25 H
(ays:).05 E 6.5<834e>72 355.8 S(etw)-6.5 E(ork partitions)-.1 E 6.5
<8356>72 371.4 S(aults lose contact)-7.61 E 6.5<8353>72 387 S
(torage corruption)-6.5 E 6.5<8342>72 402.6 S(its \215ip, disks f)-6.5 E
(ail)-.1 E 6.5<8342>72 418.2 S(yzantine f)-6.5 E(aults)-.1 E 6.5<834e>72
433.8 S(odes lie or misbeha)-6.5 E -.15(ve)-.2 G 6.5<8352>72 449.4 S
(esource e)-6.5 E(xhaustion)-.15 E 6.5<834f>72 465 S(ut of memory)-6.5 E
2.5(,d)-.65 G(isk, connections)-2.5 E 6.5<8350>72 480.6 S
(rotocol violations)-6.5 E 6.5<834d>72 496.2 S(alformed messages, in)
-6.5 E -.25(va)-.4 G(lid state).25 E(Reco)72 515.4 Q -.15(ve)-.15 G
(ry must be:).15 E 6.5<8344>72 531 S(eterministic)-6.5 E 6.5<8353>72
546.6 S(ame error)-6.5 E 2.5(,s)-.4 G(ame reco)-2.5 E -.15(ve)-.15 G(ry)
.15 E 6.5<8341>72 562.2 S(uditable)-6.5 E 6.5<8345>72 577.8 S -.15(ve)
-6.5 G(ry error logged with conte).15 E(xt)-.15 E 6.5<8341>72 593.4 S
(utomatic)-6.5 E 6.5<8353>72 609 S(elf-healing where possible)-6.5 E 6.5
<8347>72 624.6 S(raceful)-6.5 E 6.5<8344>72 640.2 S -.15(eg)-6.5 G
(rade rather than crash).15 E F3 2.5(3. Err)72 667.8 R(or Model)-.18 E 0
Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. Err)72 84 R(or T)-.18 E(ypes)-.34 E/F2 8/Courier@0 SF
(\(define-error-type 'storage-error)108 102 Q
(\(subtypes corruption missing full readonly\)\))117.6 114 Q
(\(define-error-type 'network-error)108 138 Q
(\(subtypes timeout unreachable protocol-violation\)\))117.6 150 Q
(\(define-error-type 'crypto-error)108 174 Q
(\(subtypes signature-invalid key-expired capability-denied\)\))117.6
186 Q(\(define-error-type 'consistency-error)108 210 Q
(\(subtypes hash-mismatch merkle-divergence conflict\)\))117.6 222 Q
(\(define-error-type 'resource-error)108 246 Q
(\(subtypes memory-exhausted connections-exhausted rate-limited\)\))
117.6 258 Q(\(define-error-type 'protocol-error)108 282 Q
(\(subtypes invalid-message invalid-state version-mismatch\)\))117.6 294
Q F1 2.5(3.2. Err)72 312 R(or Structur)-.18 E(e)-.18 E F2
(\(define \(make-error type message context\))108 330 Q(`\(error)117.6
342 Q(\(id ,\(generate-error-id\)\))127.2 354 Q(\(type ,type\))127.2 366
Q(\(message ,message\))127.2 378 Q(\(context ,context\))127.2 390 Q
(\(timestamp ,\(current-time\)\))127.2 402 Q
(\(vault ,\(current-vault-id\)\))127.2 414 Q
(\(principal ,\(current-principal\)\))127.2 426 Q
(\(stack ,\(capture-stack-trace\)\)\)\))127.2 438 Q
(;; Errors are soup objects)108 462 Q(\(define \(record-error! err\))108
474 Q(\(let \(\(hash \(soup-put err type: 'error\)\)\))117.6 486 Q
(\(audit-append action: 'error-recorded error-hash: hash\))127.2 498 Q
(hash\)\))127.2 510 Q F1 2.5(3.3. Err)72 528 R(or Context)-.18 E F2
(;; Capture rich context for debugging)108 546 Q
(\(define \(error-context operation\))108 558 Q
(`\(\(operation . ,operation\))117.6 570 Q
(\(request-id . ,\(current-request-id\)\))127.2 582 Q
(\(correlation-id . ,\(current-correlation-id\)\))127.2 594 Q
(\(peer . ,\(current-peer\)\))127.2 606 Q
(\(attempt . ,\(current-retry-count\)\))127.2 618 Q
(\(duration . ,\(operation-duration\)\))127.2 630 Q
(\(inputs . ,\(sanitize-inputs \(operation-inputs\)\)\)\)\))127.2 642 Q
F1 2.5(4. Err)72 660 R(or Handling P)-.18 E(atter)-.1 E(ns)-.15 E 0 Cg
EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.1. Result)72 84 R -.34(Ty)2.5 G(pe).34 E/F2 8/Courier@0 SF
(;; Operations return \(ok value\) or \(err error\))108 102 Q
(\(define \(result-ok value\) \(ok ,value\)\))108 114 Q
(\(define \(result-err error\) \(err ,error\)\))108 126 Q
(\(define \(result-ok? r\) \(eq? \(car r\) 'ok\)\))108 150 Q
(\(define \(result-err? r\) \(eq? \(car r\) 'err\)\))108 162 Q
(\(define \(result-value r\) \(cadr r\)\))108 174 Q
(\(define \(result-error r\) \(cadr r\)\))108 186 Q(;; Chain operations)
108 210 Q(\(define \(result-bind r f\))108 222 Q(\(if \(result-ok? r\))
117.6 234 Q(\(f \(result-value r\)\))136.8 246 Q(r\)\))136.8 258 Q
(;; Example)108 282 Q(\(define \(safe-read hash\))108 294 Q
(\(result-bind \(cas-get-safe hash\))117.6 306 Q(\(lambda \(data\))127.2
318 Q(\(result-bind \(verify-signature data\))136.8 330 Q
(\(lambda \(verified\))146.4 342 Q(\(result-ok verified\)\)\)\)\)\))156
354 Q F1 2.5(4.2. Err)72 372 R(or Reco)-.18 E -.1(ve)-.1 G(ry).1 E F2
(\(define \(with-recovery operation recovery\))108 390 Q
("Execute operation with recovery on failure")117.6 402 Q
(\(let \(\(result \(guard \(ex \(else \(result-err ex\)\)\))117.6 414 Q
(\(result-ok \(operation\)\)\)\)\))194.4 426 Q
(\(if \(result-ok? result\))127.2 438 Q(\(result-value result\))146.4
450 Q(\(recovery \(result-error result\)\)\)\)\))146.4 462 Q
(;; Example: read with fallback to replica)108 486 Q
(\(define \(read-with-fallback hash\))108 498 Q(\(with-recovery)117.6
510 Q(\(lambda \(\) \(cas-get hash\)\))127.2 522 Q(\(lambda \(err\))
127.2 534 Q(\(audit-append action: 'read-fallback error: err\))136.8 546
Q(\(cas-get-from-replica hash\)\)\)\))136.8 558 Q 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.3. Retry)72 84 R(Logic)2.5 E/F2 8/Courier@0 SF
(\(define \(with-retry operation max-retries backoff\))108 102 Q
("Retry operation with exponential backoff")117.6 114 Q
(\(let loop \(\(attempt 1\)\))117.6 126 Q
(\(let \(\(result \(guard \(ex \(else \(result-err ex\)\)\))127.2 138 Q
(\(result-ok \(operation\)\)\)\)\))204 150 Q(\(cond)136.8 162 Q
(\(\(result-ok? result\))146.4 174 Q(\(result-value result\)\))151.2 186
Q(\(\(>= attempt max-retries\))146.4 198 Q
(\(error "Max retries exceeded" \(result-error result\)\)\))151.2 210 Q
(\(else)146.4 222 Q
(\(let \(\(delay \( backoff \(expt 2 \(- attempt 1\)\)\)\)\))151.2 234 Q
(\(audit-append action: 'retry attempt: attempt delay: delay\))160.8 246
Q(\(thread-sleep! delay\))160.8 258 Q
(\(loop \(+ attempt 1\)\)\)\)\)\)\)\))160.8 270 Q
(;; Retry configuration)108 294 Q(\(define default-retry-config*)108 306
Q(`\(\(max-retries . 3\))117.6 318 Q(\(initial-backoff . 100\))127.2 330
Q 4.8(;m)19.2 G(s)-4.8 E(\(max-backoff . 30000\))127.2 342 Q 4.8(;m)28.8
G(s)-4.8 E(\(jitter . 0.1\)\)\))127.2 354 Q 4.8(;1)52.8 G
(0% randomization)-4.8 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.4. Cir)72 84 R(cuit Br)-.18 E(eak)-.18 E(er)-.1 E/F2 8/Courier@0
SF(\(define \(make-circuit-breaker threshold timeout\))108 102 Q
(\(let \(\(failures 0\))117.6 114 Q(\(state 'closed\))146.4 126 Q
(\(last-failure #f\)\))146.4 138 Q(\(lambda \(operation\))127.2 162 Q
(\(case state)136.8 174 Q(\(\(open\))146.4 186 Q
(\(if \(> \(- \(current-time\) last-failure\) timeout\))151.2 198 Q
(\(begin)170.4 210 Q(\(set! state 'half-open\))180 222 Q
(\(try-operation operation\)\))180 234 Q(\(error "Circuit open"\)\)\))
170.4 246 Q(\(\(half-open\))146.4 258 Q
(\(let \(\(result \(try-operation operation\)\)\))151.2 270 Q
(\(if \(result-ok? result\))160.8 282 Q(\(begin)180 294 Q
(\(set! state 'closed\))189.6 306 Q(\(set! failures 0\))189.6 318 Q
(\(result-value result\)\))189.6 330 Q(\(begin)180 342 Q
(\(set! state 'open\))189.6 354 Q(\(error "Circuit reopened"\)\)\)\)\))
189.6 366 Q(\(\(closed\))146.4 378 Q
(\(try-operation operation\)\)\)\)\)\))151.2 390 Q
(\(define \(try-operation cb operation\))108 414 Q(\(guard \(ex)117.6
426 Q(\(else)156 438 Q(\(cb-record-failure! cb\))160.8 450 Q
(\(result-err ex\)\)\))160.8 462 Q(\(result-ok \(operation\)\)\)\))127.2
474 Q F1 2.5(5. Storage)72 492 R(Err)2.5 E(ors)-.18 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.1. Corruption)72 84 R(Detection)2.5 E/F2 8/Courier@0 SF
(\(define \(detect-corruption hash\))108 102 Q
("Verify object integrity")117.6 114 Q
(\(let* \(\(data \(storage-read-raw hash\)\))117.6 126 Q
(\(computed-hash \(content-hash data\)\)\))151.2 138 Q
(\(unless \(equal? hash computed-hash\))127.2 150 Q(\(record-error!)
136.8 162 Q(\(make-error 'corruption)146.4 174 Q
("Hash mismatch detected")156 186 Q(`\(\(expected . ,hash\))156 198 Q
(\(computed . ,computed-hash\))165.6 210 Q
(\(size . ,\(bytevector-length data\)\)\)\)\)\)\)\))165.6 222 Q
(\(define \(scan-for-corruption\))108 246 Q("Full vault integrity scan")
117.6 258 Q(\(let \(\(corrupted '\(\)\)\))117.6 270 Q
(\(for-each \(lambda \(hash\))127.2 282 Q
(\(unless \(verify-integrity hash\))184.8 294 Q
(\(set! corrupted \(cons hash corrupted\)\)\)\))194.4 306 Q
(\(all-object-hashes\)\))175.2 318 Q(\(when \(not \(null? corrupted\)\))
127.2 330 Q(\(audit-append action: 'corruption-scan)136.8 342 Q
(corrupted: \(length corrupted\)\)\))204 354 Q(corrupted\)\))127.2 366 Q
F1 2.5(5.2. Corruption)72 384 R(Reco)2.5 E -.1(ve)-.1 G(ry).1 E F2
(\(define \(recover-corrupted hash\))108 402 Q
("Attempt to recover corrupted object")117.6 414 Q
(;; Strategy 1: Fetch from replica)117.6 426 Q
(\(let \(\(replicas \(find-replicas hash\)\)\))117.6 438 Q
(\(for-each \(lambda \(replica\))127.2 450 Q
(\(let \(\(data \(fetch-from-replica replica hash\)\)\))184.8 462 Q
(\(when \(and data \(verify-hash data hash\)\))194.4 474 Q
(\(storage-write hash data\))204 486 Q
(\(audit-append action: 'corruption-recovered)204 498 Q
(source: replica\))271.2 510 Q(\(return data\)\)\)\))204 522 Q
(replicas\)\))175.2 534 Q
(;; Strategy 2: Reconstruct from erasure coding)117.6 558 Q
(\(when \(erasure-coded? hash\))117.6 570 Q
(\(let \(\(data \(reconstruct-from-shards hash\)\)\))127.2 582 Q
(\(when data)136.8 594 Q(\(storage-write hash data\))146.4 606 Q
(\(audit-append action: 'erasure-recovery\))146.4 618 Q
(\(return data\)\)\)\))146.4 630 Q(;; Strategy 3: Mark as lost)117.6 654
Q(\(mark-object-lost hash\))117.6 666 Q
(\(audit-append action: 'object-lost hash: hash\))117.6 678 Q(#f\))117.6
690 Q 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.3. Disk)72 84 R(Full Handling)2.5 E/F2 8/Courier@0 SF
(\(define \(handle-disk-full\))108 102 Q
("Emergency disk space recovery")117.6 114 Q(;; Phase 1: Emergency GC)
117.6 126 Q(\(gc-emergency\))117.6 138 Q(;; Phase 2: Clear caches)117.6
162 Q(\(clear-all-caches\))117.6 174 Q
(;; Phase 3: Compress compressible objects)117.6 198 Q
(\(compress-uncompressed-objects\))117.6 210 Q
(;; Phase 4: Alert and degrade)117.6 234 Q
(\(when \(< \(available-space\) critical-threshold\))117.6 246 Q
(\(alert-disk-critical\))127.2 258 Q(\(vault-readonly!\)\)\))127.2 270 Q
F1 2.5(6. Netw)72 288 R(ork Err)-.1 E(ors)-.18 E 2.5(6.1. T)72 312 R
(imeout Handling)-.18 E F2(\(define \(with-timeout duration operation\))
108 330 Q("Execute operation with timeout")117.6 342 Q
(\(let \(\(result \(make-channel\)\)\))117.6 354 Q(\(thread-start!)127.2
366 Q(\(make-thread)136.8 378 Q(\(lambda \(\))146.4 390 Q
(\(channel-put! result)156 402 Q
(\(guard \(ex \(else \(result-err ex\)\)\))165.6 414 Q
(\(result-ok \(operation\)\)\)\)\)\)\))175.2 426 Q
(\(let \(\(r \(channel-get! result duration\)\)\))127.2 438 Q(\(if r)
136.8 450 Q(\(if \(result-ok? r\))156 462 Q(\(result-value r\))175.2 474
Q(\(error \(result-error r\)\)\))175.2 486 Q
(\(error \(make-error 'timeout)156 498 Q("Operation timed out")199.2 510
Q(`\(\(duration . ,duration\)\)\)\)\)\)\)\))199.2 522 Q F1 2.5(6.2. P)72
540 R(artition Detection)-.1 E F2(\(define \(detect-partition peers\))
108 558 Q("Detect network partition")117.6 570 Q
(\(let* \(\(reachable \(filter peer-reachable? peers\)\))117.6 582 Q(\(\
unreachable \(filter \(lambda \(p\) \(not \(peer-reachable? p\)\)\) pee\
rs\)\)\))151.2 594 Q(\(when \(> \(length unreachable\) 0\))127.2 606 Q
(\(audit-append action: 'partition-detected)136.8 618 Q
(reachable: \(length reachable\))204 630 Q
(unreachable: \(length unreachable\)\))204 642 Q
(\(if \(> \(length reachable\) \(/ \(length peers\) 2\)\))136.8 654 Q
(\(continue-with-majority reachable\))156 666 Q
(\(enter-read-only-mode\)\)\)\)\))156 678 Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.3. Connection)72 84 R -.2(Po)2.5 G(ol Reco).2 E -.1(ve)-.1 G(ry).1
E/F2 8/Courier@0 SF(\(define \(recover-connection-pool pool\))108 102 Q
("Recover from connection pool exhaustion")117.6 114 Q
(;; Close idle connections)117.6 126 Q(\(pool-close-idle! pool\))117.6
138 Q(;; Close long-running connections)117.6 162 Q
(\(pool-close-stale! pool max-connection-age\))117.6 174 Q
(;; If still exhausted, reject new requests)117.6 198 Q
(\(when \(pool-exhausted? pool\))117.6 210 Q
(\(audit-append action: 'pool-exhausted\))127.2 222 Q
(\(enable-request-shedding\)\)\))127.2 234 Q F1 2.5(7. Consistency)72
252 R(Err)2.5 E(ors)-.18 E 2.5(7.1. Con\215ict)72 276 R(Detection)2.5 E
F2(\(define \(detect-conflict hash versions\))108 294 Q
("Detect conflicting versions of object")117.6 306 Q
(\(let \(\(unique-contents \(delete-duplicates)117.6 318 Q
(\(map version-content versions\)\)\)\))232.8 330 Q
(\(when \(> \(length unique-contents\) 1\))127.2 342 Q(\(record-error!)
136.8 354 Q(\(make-error 'conflict)146.4 366 Q
("Conflicting versions detected")156 378 Q(`\(\(hash . ,hash\))156 390 Q
(\(versions . ,\(length unique-contents\)\))165.6 402 Q
(\(sources . ,\(map version-source versions\)\)\)\)\)\)\)\))165.6 414 Q
F1 2.5(7.2. Con\215ict)72 432 R(Resolution)2.5 E F2
(\(define \(resolve-conflict hash versions strategy\))108 450 Q
("Resolve conflicting versions")117.6 462 Q(\(let \(\(resolved)117.6 474
Q(\(case strategy)151.2 486 Q(\(\(latest\))160.8 498 Q
(\(max-by version-timestamp versions\)\))165.6 510 Q(\(\(merge\))160.8
522 Q(\(merge-versions versions\)\))165.6 534 Q(\(\(manual\))160.8 546 Q
(\(queue-for-manual-resolution hash versions\)\))165.6 558 Q
(\(\(tombstone\))160.8 570 Q
(\(create-conflict-tombstone hash versions\)\)\)\)\))165.6 582 Q
(\(audit-append action: 'conflict-resolved)127.2 594 Q(hash: hash)194.4
606 Q(strategy: strategy\))194.4 618 Q(resolved\)\))127.2 630 Q 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(7.3. Merkle)72 84 R(Di)2.5 E -.1(ve)-.1 G -.1(rg).1 G(ence).1 E/F2 8
/Courier@0 SF
(\(define \(handle-merkle-divergence local-root remote-root peer\))108
102 Q("Handle diverged Merkle trees")117.6 114 Q(\(let \(\(divergence \
\(find-divergence-point local-root remote-root\)\)\))117.6 126 Q
(\(audit-append action: 'merkle-divergence)127.2 138 Q
(local: local-root)194.4 150 Q(remote: remote-root)194.4 162 Q
(divergence: divergence\))194.4 174 Q(;; Sync diverged subtrees)127.2
186 Q(\(for-each \(lambda \(subtree\))127.2 198 Q
(\(sync-subtree subtree peer\)\))184.8 210 Q
(\(divergent-subtrees divergence\)\)\)\))175.2 222 Q F1 2.5(8. Reco)72
240 R -.1(ve)-.1 G(ry Pr).1 E(ocedur)-.18 E(es)-.18 E 2.5(8.1. A)72 264
R(utomatic Reco)-.5 E -.1(ve)-.1 G(ry).1 E F2
(\(define recovery-handlers)108 282 Q
(`\(\(corruption . ,recover-corrupted\))117.6 294 Q
(\(missing . ,fetch-from-replica\))127.2 306 Q
(\(timeout . ,retry-with-backoff\))127.2 318 Q
(\(partition . ,wait-for-reconnection\))127.2 330 Q
(\(conflict . ,resolve-with-default-strategy\)\)\))127.2 342 Q
(\(define \(auto-recover error\))108 366 Q("Attempt automatic recovery")
117.6 378 Q(\(let \(\(handler \(assoc-ref recovery-handlers \(error-typ\
e error\)\)\)\))117.6 390 Q(\(if handler)127.2 402 Q(\(begin)146.4 414 Q
(\(audit-append action: 'auto-recovery-attempt)156 426 Q
(error: \(error-id error\)\))223.2 438 Q(\(handler error\)\))156 450 Q
(\(escalate-error error\)\)\)\))146.4 462 Q 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(8.2. Manual)72 84 R(Reco)2.5 E -.1(ve)-.1 G(ry).1 E/F2 8/Courier@0
SF(\(define \(queue-manual-recovery error\))108 102 Q
("Queue error for manual intervention")117.6 114 Q(\(soup-put)117.6 126
Q(`\(recovery-ticket)127.2 138 Q(\(error ,\(error-id error\)\))136.8 150
Q(\(status pending\))136.8 162 Q(\(created ,\(current-time\)\))136.8 174
Q(\(assigned #f\)\))136.8 186 Q(type: 'recovery-ticket\)\))127.2 198 Q
(\(define \(process-recovery-ticket ticket-hash\))108 222 Q
("Process manual recovery ticket")117.6 234 Q
(\(let \(\(ticket \(soup-get ticket-hash\)\)\))117.6 246 Q
(;; Mark in progress)127.2 258 Q
(\(soup-update ticket-hash status: 'in-progress\))127.2 270 Q
(;; ... manual recovery steps ...)127.2 282 Q(;; Mark resolved)127.2 294
Q(\(soup-update ticket-hash)127.2 306 Q(status: 'resolved)189.6 318 Q
(resolved-at: \(current-time\))189.6 330 Q
(resolved-by: \(current-principal\)\)\)\))189.6 342 Q F1 2.5
(8.3. Disaster)72 360 R(Reco)2.5 E -.1(ve)-.1 G(ry).1 E F2
(\(define \(disaster-recovery backup-location\))108 378 Q
("Full vault recovery from backup")117.6 390 Q
(\(audit-append action: 'disaster-recovery-start)117.6 402 Q
(backup: backup-location\))184.8 414 Q
(;; Phase 1: Verify backup integrity)117.6 438 Q
(\(unless \(verify-backup-integrity backup-location\))117.6 450 Q
(\(error "Backup integrity check failed"\)\))127.2 462 Q
(;; Phase 2: Restore CAS)117.6 486 Q
(\(restore-cas-from-backup backup-location\))117.6 498 Q
(;; Phase 3: Restore soup)117.6 522 Q
(\(restore-soup-from-backup backup-location\))117.6 534 Q
(;; Phase 4: Restore indexes)117.6 558 Q(\(rebuild-indexes\))117.6 570 Q
(;; Phase 5: Verify restoration)117.6 594 Q(\(verify-restoration\))117.6
606 Q(\(audit-append action: 'disaster-recovery-complete\)\))117.6 630 Q
F1 2.5(9. Err)72 648 R(or Reporting)-.18 E 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.1. Err)72 84 R(or Aggr)-.18 E(egation)-.18 E/F2 8/Courier@0 SF
(\(define \(aggregate-errors window\))108 102 Q
("Aggregate errors over time window")117.6 114 Q
(\(let \(\(errors \(soup-query type: 'error)117.6 126 Q
(timestamp: \(> \(- \(current-time\) window\)\)\)\)\))242.4 138 Q
(\(group-by error-type errors\)\)\))127.2 150 Q
(\(define \(error-rate error-type window\))108 174 Q
("Calculate error rate")117.6 186 Q
(\(let \(\(count \(length \(soup-query type: 'error)117.6 198 Q
(error-type: error-type)276 210 Q
(timestamp: \(> \(- \(current-time\) window\)\)\)\)\)\))276 222 Q
(\(/ count window\)\)\))127.2 234 Q F1 2.5(9.2. Alerting)72 252 R F2
(\(define alert-thresholds)108 270 Q(`\(\(corruption . 1\))117.6 282 Q
4.8(;A)38.4 G(ny corruption is critical)-4.8 E(\(timeout . 100\))127.2
294 Q 4.8(;1)43.2 G(00 timeouts per minute)-4.8 E(\(conflict . 10\))
127.2 306 Q 4.8(;1)43.2 G 4.8(0c)-4.8 G(onflicts per minute)-4.8 E
(\(resource . 5\)\)\))127.2 318 Q 4.8(;5r)38.4 G
(esource errors per minute)-4.8 E(\(define \(check-alert-thresholds\))
108 342 Q("Check if error rates exceed thresholds")117.6 354 Q
(\(for-each \(lambda \(threshold\))117.6 366 Q
(\(let \(\(type \(car threshold\)\))175.2 378 Q
(\(limit \(cdr threshold\)\)\))204 390 Q
(\(when \(> \(error-rate type 60\) limit\))184.8 402 Q
(\(send-alert type \(error-rate type 60\) limit\)\)\)\))194.4 414 Q
(alert-thresholds\)\))165.6 426 Q F1 2.5(10. Security)72 444 R
(Considerations)2.5 E 2.5(10.1. Err)72 468 R(or Inf)-.18 E
(ormation Leakage)-.25 E F2
(;; Don't expose internal details in user-facing errors)108 486 Q
(\(define \(sanitize-error-for-user error\))108 498 Q(`\(error)117.6 510
Q(\(type ,\(error-type error\)\))127.2 522 Q
(\(message ,\(user-safe-message \(error-type error\)\)\))127.2 534 Q
(\(request-id ,\(error-request-id error\)\)\)\))127.2 546 Q
(;; Full details only in audit log)108 570 Q
(\(define \(log-full-error error\))108 582 Q
(\(audit-append action: 'error)117.6 594 Q(error: error\)\))184.8 606 Q
4.8(;F)9.6 G(ull context preserved)-4.8 E 0 Cg EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-028 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(10.2. Err)72 84 R(or)-.18 E(-Based Attacks)-.37 E/F2 8/Courier@0 SF
(;; Rate limit error generation to prevent DoS)108 102 Q
(\(define error-rate-limiter)108 114 Q(\(make-rate-limiter 1000 60\)\))
117.6 126 Q 4.8(;1)9.6 G(000 errors per minute max)-4.8 E
(\(define \(rate-limited-record-error! err\))108 150 Q
(\(if \(rate-limiter-allow? error-rate-limiter\))117.6 162 Q
(\(record-error! err\))136.8 174 Q
(\(audit-append action: 'error-rate-limited\)\)\))136.8 186 Q F1 2.5
(11. Refer)72 204 R(ences)-.18 E F0 14.734(1. [Release It!]\(https://pr\
agprog.com/titles/mnee2/release-it-second-edition/\) - Nyg)72 219.6 R
14.733(ard 2. [Hys-)-.05 F 8.235(trix]\(https://github.com/Net\215ix/Hy\
strix\) - Net\215ix Circuit Break)72 231.6 R 8.235
(er 3. [RFC-003: Cryptographic Audit)-.1 F -.35(Tr)72 243.6 S(ail]\(rfc\
-003-audit-trail.html\) 4. [RFC-026: Garbage Collection]\(rfc-026-g).35
E(arbage-collection.html\))-.05 E F1 2.5(12. Changelog)72 267.6 R F0 6.5
<8332>72 283.2 S(026-01-07)-6.5 E 6.5<8349>72 298.8 S(nitial draft)-6.5
E 0 Cg EP
%%Trailer
end
%%EOF
