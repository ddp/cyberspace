%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Tue Jan 13 10:09:56 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 10
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-030: Encryption at Rest)230.844 123 Q/F1 10
/Times-Italic@0 SF(Libr)260.85 159 Q(ary of Cyber)-.15 E(space)-.1 E/F2
10/Times-Roman@0 SF(2026)296 177 Q F1(ABSTRA)282.535 213 Q(CT)-.3 E/F3
10/Times-Bold@0 SF 2.5(1. Abstract)72 261 R F2 .978(This RFC speci\214e\
s encryption at rest for the Library of Cyberspace: ho)72 276.6 R 3.477
(wv)-.25 G .977(aults protect stored data using modern)-3.727 F
(cryptograph)72 288.6 Q 3.871(yw)-.05 G 1.371
(hile maintaining content-addressability)-3.871 F 3.871(,k)-.65 G 1.671
-.15(ey m)-3.971 H 1.371(anagement, and operational \215e).15 F 1.371
(xibility. All sensiti)-.15 F -.15(ve)-.25 G
(data is encrypted before touching persistent storage.)72 300.6 Q F3 2.5
(2. Moti)72 324.6 R -.1(va)-.1 G(tion).1 E F2(Data at rest f)72 340.2 Q
(aces threats:)-.1 E 6.5<8350>72 355.8 S -.05(hy)-6.5 G(sical theft).05
E 6.5<8344>72 371.4 S(isks, serv)-6.5 E(ers, backups stolen)-.15 E 6.5
<8349>72 387 S(nsider access)-6.5 E 6.5<8355>72 402.6 S
(nauthorized admin access)-6.5 E 6.5<834c>72 418.2 S -2.25 -.15(eg a)
-6.5 H 2.5(lc).15 G(ompulsion)-2.5 E 6.5<8346>72 433.8 S
(orced disclosure orders)-6.65 E 6.5<8344>72 449.4 S(ecommissioning)-6.5
E 6.5<8344>72 465 S(ata remnants on old hardw)-6.5 E(are)-.1 E
(Encryption must be:)72 484.2 Q 6.5<8354>72 499.8 S(ransparent)-6.85 E
6.5<8341>72 515.4 S(pplications una)-6.5 E -.1(wa)-.15 G
(re of encryption).1 E 6.5<8350>72 531 S(erformant)-6.5 E 6.5<834d>72
546.6 S(inimal o)-6.5 E -.15(ve)-.15 G(rhead).15 E 6.5<8352>72 562.2 S
(eco)-6.5 E -.15(ve)-.15 G(rable).15 E 6.5<834b>72 577.8 S .3 -.15(ey l)
-6.75 H(oss doesn').15 E 2.5(tm)-.18 G(ean data loss)-2.5 E 6.5<8341>72
593.4 S(uditable)-6.5 E 6.5<8341>72 609 S(ll k)-6.5 E .3 -.15(ey o)-.1 H
(perations logged).15 E F3 2.5(3. Encryption)72 636.6 R(Model)2.5 E 0 Cg
EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.1. Lay)72 84 R(er)-.1 E(ed Encryption)-.18 E/F2 8/Courier@0 SF
(+-------------------------------------+)108 102 Q 43.2(|A)108 114 S
(pplication Layer)-43.2 E(|)52.8 E 33.6(|\()108 126 S
(plaintext objects\))-33.6 E(|)52.8 E
(+-------------------------------------+)108 138 Q 28.8(|O)108 150 S
(bject-Level Encryption)-28.8 E(|)38.4 E 19.2(|\()108 162 S
(per-object keys, age format\))-19.2 E(|)19.2 E
(+-------------------------------------+)108 174 Q 28.8(|S)108 186 S
(torage-Level Encryption)-28.8 E(|)33.6 E 19.2(|\()108 198 S
(volume encryption, LUKS/dm\))-19.2 E(|)24 E
(+-------------------------------------+)108 210 Q 43.2(|P)108 222 S
(hysical Storage)-43.2 E(|)57.6 E 38.4(|\()108 234 S
(encrypted at rest\))-38.4 E(|)48 E
(+-------------------------------------+)108 246 Q F1 2.5
(3.2. Encryption)72 264 R(Scope)2.5 E F2(;; What gets encrypted)108 282
Q(\(define encryption-policy)108 294 Q(`\(\(content . always\))117.6 306
Q 4.8(;O)52.8 G(bject content - always encrypted)-4.8 E
(\(soup-metadata . optional\))127.2 318 Q 4.8(;M)14.4 G
(etadata - configurable)-4.8 E(\(indexes . optional\))127.2 330 Q 4.8
(;S)43.2 G(earch indexes - configurable)-4.8 E(\(audit-log . always\))
127.2 342 Q 4.8(;A)43.2 G(udit trail - always encrypted)-4.8 E
(\(keys . never-plaintext\)\)\))127.2 354 Q 4.8(;K)14.4 G
(eys never stored plaintext)-4.8 E F1 2.5(4. K)72 372 R(ey Hierar)-.25 E
(ch)-.18 E(y)-.15 E 2.5(4.1. K)72 396 R(ey T)-.25 E(ypes)-.34 E F2
(\(define key-hierarchy)108 414 Q 91.2('\(master-key ;)117.6 426 R
(Root of trust)4.8 E(+-- vault-key)127.2 438 Q 4.8(;P)81.6 G
(er-vault encryption)-4.8 E(+-- content-key)146.4 450 Q 4.8(;O)52.8 G
(bject encryption)-4.8 E(+-- metadata-key)146.4 462 Q 4.8(;S)48 G
(oup encryption)-4.8 E(+-- index-key)146.4 474 Q 4.8(;I)62.4 G
(ndex encryption)-4.8 E(+-- audit-key\)\))146.4 486 Q 4.8(;A)52.8 G
(udit log encryption)-4.8 E(\(define \(derive-key parent purpose\))108
510 Q("Derive child key from parent")117.6 522 Q(\(hkdf-sha256 parent)
117.6 534 Q(salt: \(purpose->salt purpose\))180 546 Q
(info: \(string->utf8 \(symbol->string purpose\)\))180 558 Q
(length: 32\)\))180 570 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.2. Master)72 84 R -.25(Ke)2.5 G(y).25 E/F2 8/Courier@0 SF
(;; Master key from key ceremony \(RFC-022\))108 102 Q
(\(define \(initialize-master-key shares threshold\))108 114 Q
("Reconstruct master key from shares")117.6 126 Q
(\(let \(\(master \(shamir-combine shares threshold\)\)\))117.6 138 Q
(;; Derive vault key)127.2 150 Q
(\(let \(\(vault-key \(derive-key master 'vault\)\)\))127.2 162 Q
(;; Store encrypted vault key)136.8 174 Q
(\(store-encrypted-vault-key vault-key master\))136.8 186 Q
(;; Clear master from memory)136.8 198 Q(\(secure-clear! master\))136.8
210 Q(vault-key\)\)\))136.8 222 Q F1 2.5(4.3. K)72 240 R(ey Deri)-.25 E
-.1(va)-.1 G(tion).1 E F2
(\(define \(derive-content-key vault-key object-hash\))108 258 Q
("Derive unique key for each object")117.6 270 Q
(\(hkdf-sha256 vault-key)117.6 282 Q(salt: \(string->utf8 object-hash\))
180 294 Q(info: #u8\(99 111 110 116 101 110 116\))180 306 Q 4.8(;")9.6 G
(content")-4.8 E(length: 32\)\))180 318 Q
(\(define \(derive-chunk-key content-key chunk-index\))108 342 Q
("Derive key for each chunk within object")117.6 354 Q
(\(hkdf-sha256 content-key)117.6 366 Q
(salt: \(integer->bytevector chunk-index\))180 378 Q
(info: #u8\(99 104 117 110 107\))180 390 Q 4.8(;")9.6 G(chunk")-4.8 E
(length: 32\)\))180 402 Q F1 2.5(5. Object)72 420 R(Encryption)2.5 E 2.5
(5.1. Age)72 444 R -.25(Fo)2.5 G(rmat).25 E F2
(;; Use age for object encryption \(RFC-018\))108 462 Q
(\(define \(encrypt-object data recipient-keys\))108 474 Q
("Encrypt object using age format")117.6 486 Q
(\(age-encrypt data recipient-keys\)\))117.6 498 Q
(\(define \(decrypt-object encrypted identity\))108 522 Q
("Decrypt object using age format")117.6 534 Q
(\(age-decrypt encrypted identity\)\))117.6 546 Q F1 2.5(5.2. Symmetric)
72 564 R(Encryption)2.5 E F2
(;; For internal encryption with derived keys)108 582 Q
(\(define \(encrypt-symmetric data key\))108 594 Q
("Encrypt with ChaCha20-Poly1305")117.6 606 Q
(\(let \(\(nonce \(generate-nonce 12\)\)\))117.6 618 Q
(\(let \(\(ciphertext \(chacha20-poly1305-encrypt data key nonce\)\)\))
127.2 630 Q(\(bytevector-append nonce ciphertext\)\)\)\))136.8 642 Q
(\(define \(decrypt-symmetric encrypted key\))108 666 Q
("Decrypt ChaCha20-Poly1305")117.6 678 Q
(\(let \(\(nonce \(subbytevector encrypted 0 12\)\))117.6 690 Q
(\(ciphertext \(subbytevector encrypted 12\)\)\))146.4 702 Q
(\(chacha20-poly1305-decrypt ciphertext key nonce\)\)\))127.2 714 Q 0 Cg
EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(5.3. Str)72 84 R(eaming Encryption)-.18 E/F2 8/Courier@0 SF
(\(define \(encrypt-stream input-port output-port key\))108 102 Q
("Stream encryption for large objects")117.6 114 Q
(\(let \(\(chunk-size 65536\))117.6 126 Q(\(chunk-index 0\)\))146.4 138
Q(\(let loop \(\))127.2 150 Q
(\(let \(\(chunk \(read-bytevector chunk-size input-port\)\)\))136.8 162
Q(\(unless \(eof-object? chunk\))146.4 174 Q
(\(let \(\(chunk-key \(derive-chunk-key key chunk-index\)\)\))156 186 Q
(\(write-bytevector \(encrypt-symmetric chunk chunk-key\) output-port\))
165.6 198 Q(\(secure-clear! chunk-key\)\))165.6 210 Q
(\(set! chunk-index \(+ chunk-index 1\)\))156 222 Q(\(loop\)\)\)\)\)\))
156 234 Q F1 2.5(6. Storage)72 252 R(Integration)2.5 E 2.5
(6.1. Encrypted)72 276 R(CAS)2.5 E F2
(\(define \(cas-put-encrypted data\))108 294 Q
("Store encrypted object in CAS")117.6 306 Q
(\(let \(\(hash \(content-hash data\)\))117.6 318 Q 4.8(;H)57.6 G
(ash plaintext)-4.8 E(\(key \(derive-content-key \(vault-key\) hash\)\))
151.2 330 Q(\(encrypted \(encrypt-symmetric data key\)\)\))151.2 342 Q
(\(secure-clear! key\))127.2 354 Q(\(storage-put hash encrypted\))127.2
366 Q 4.8(;S)72 G(tore ciphertext)-4.8 E
(\(soup-put hash encrypted: #t\))127.2 378 Q(hash\)\))127.2 390 Q
(\(define \(cas-get-decrypted hash\))108 414 Q
("Retrieve and decrypt object from CAS")117.6 426 Q
(\(let \(\(encrypted \(storage-get hash\)\))117.6 438 Q
(\(key \(derive-content-key \(vault-key\) hash\)\))151.2 450 Q
(\(data \(decrypt-symmetric encrypted key\)\)\))151.2 462 Q
(\(secure-clear! key\))127.2 474 Q(;; Verify hash)127.2 486 Q
(\(unless \(equal? hash \(content-hash data\)\))127.2 498 Q
(\(error "Hash verification failed after decryption"\)\))136.8 510 Q
(data\)\))127.2 522 Q 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.2. Encrypted)72 84 R(Soup)2.5 E/F2 8/Courier@0 SF
(\(define \(soup-put-encrypted hash metadata\))108 102 Q
("Store encrypted soup entry")117.6 114 Q
(\(let \(\(serialized \(serialize metadata\)\))117.6 126 Q
(\(key \(derive-key \(vault-key\) 'metadata\)\))151.2 138 Q
(\(encrypted \(encrypt-symmetric serialized key\)\)\))151.2 150 Q
(\(secure-clear! key\))127.2 162 Q
(\(soup-storage-put hash encrypted\)\)\))127.2 174 Q
(\(define \(soup-get-decrypted hash\))108 198 Q
("Retrieve and decrypt soup entry")117.6 210 Q
(\(let \(\(encrypted \(soup-storage-get hash\)\))117.6 222 Q
(\(key \(derive-key \(vault-key\) 'metadata\)\))151.2 234 Q
(\(serialized \(decrypt-symmetric encrypted key\)\)\))151.2 246 Q
(\(secure-clear! key\))127.2 258 Q(\(deserialize serialized\)\)\))127.2
270 Q F1 2.5(6.3. Encrypted)72 288 R(Indexes)2.5 E F2
(;; Searchable encryption for indexes)108 306 Q
(\(define \(index-put-encrypted term hash\))108 318 Q
("Add encrypted index entry")117.6 330 Q
(\(let* \(\(key \(derive-key \(vault-key\) 'index\)\))117.6 342 Q
(\(encrypted-term \(deterministic-encrypt term key\)\))151.2 354 Q
(\(encrypted-hash \(encrypt-symmetric hash key\)\)\))151.2 366 Q
(\(secure-clear! key\))127.2 378 Q
(\(index-storage-put encrypted-term encrypted-hash\)\)\))127.2 390 Q
(;; Deterministic encryption enables equality search)108 414 Q
(\(define \(deterministic-encrypt data key\))108 426 Q
("Deterministic encryption for searchable indexes")117.6 438 Q
(\(let \(\(derived-key \(hkdf-sha256 key salt: data length: 32\)\)\))
117.6 450 Q(\(siv-encrypt data derived-key\)\)\))127.2 462 Q F1 2.5
(7. K)72 480 R(ey Management)-.25 E 2.5(7.1. K)72 504 R(ey Storage)-.25
E F2(;; Keys encrypted with master key)108 522 Q
(\(define \(store-vault-key vault-key master-key\))108 534 Q
("Store vault key encrypted with master key")117.6 546 Q
(\(let \(\(encrypted \(encrypt-symmetric vault-key master-key\)\)\))
117.6 558 Q(\(write-file \(vault-key-path\) encrypted\)\)\))127.2 570 Q
(;; Keys can also be stored as SPKI-encrypted blobs)108 594 Q
(\(define \(store-key-for-principal key principal\))108 606 Q
("Store key encrypted for specific principal")117.6 618 Q(\(let* \(\(en\
crypted \(age-encrypt key \(list \(principal-public-key principal\)\)\)\
\))117.6 630 Q(\(hash \(cas-put encrypted\)\)\))151.2 642 Q
(\(soup-put hash)127.2 654 Q(type: 'encrypted-key)136.8 666 Q
(recipient: principal\))136.8 678 Q(hash\)\))127.2 690 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(7.2. K)72 84 R(ey Rotation)-.25 E/F2 8/Courier@0 SF
(\(define \(rotate-vault-key\))108 102 Q("Rotate vault encryption key")
117.6 114 Q(\(let \(\(old-key \(vault-key\)\))117.6 126 Q
(\(new-key \(generate-key 32\)\)\))146.4 138 Q
(\(audit-append action: 'key-rotation-start\))127.2 162 Q
(;; Re-encrypt all objects)127.2 186 Q(\(for-each \(lambda \(hash\))
127.2 198 Q(\(let* \(\(encrypted \(storage-get hash\)\))184.8 210 Q
(\(data \(decrypt-symmetric encrypted old-key\)\))218.4 222 Q
(\(new-encrypted \(encrypt-symmetric data new-key\)\)\))218.4 234 Q
(\(storage-put hash new-encrypted\)\)\))194.4 246 Q
(\(all-object-hashes\)\))175.2 258 Q(;; Update vault key)127.2 282 Q
(\(set-vault-key! new-key\))127.2 294 Q(\(secure-clear! old-key\))127.2
306 Q(\(audit-append action: 'key-rotation-complete\)\)\))127.2 330 Q F1
2.5(7.3. K)72 348 R(ey Escr)-.25 E -.1(ow)-.18 G F2
(;; Threshold key escrow for recovery)108 366 Q
(\(define \(escrow-vault-key vault-key custodians threshold\))108 378 Q
("Split vault key among custodians")117.6 390 Q(\(let \(\(shares \(sham\
ir-split vault-key \(length custodians\) threshold\)\)\))117.6 402 Q
(\(for-each \(lambda \(custodian share\))127.2 414 Q
(\(let \(\(encrypted-share)184.8 426 Q
(\(age-encrypt share \(list \(custodian-public-key custodian\)\)\)\)\))
218.4 438 Q(\(send-to-custodian custodian encrypted-share\)\)\))194.4
450 Q(custodians shares\)\)\))175.2 462 Q
(\(define \(recover-vault-key custodian-shares\))108 486 Q
("Recover vault key from custodian shares")117.6 498 Q
(\(let \(\(decrypted-shares)117.6 510 Q
(\(map \(lambda \(share custodian\))151.2 522 Q
(\(age-decrypt share \(custodian-identity custodian\)\)\))184.8 534 Q
(custodian-shares custodians\)\)\))175.2 546 Q
(\(shamir-combine decrypted-shares\)\)\))127.2 558 Q F1 2.5(8. Access)72
576 R(Contr)2.5 E(ol)-.18 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(8.1. K)72 84 R(ey Access)-.25 E/F2 8/Courier@0 SF
(;; Keys protected by capabilities)108 102 Q(\(spki-cert)108 114 Q
(\(issuer vault-admin\))117.6 126 Q(\(subject data-processor\))117.6 138
Q(\(capability)117.6 150 Q(\(action decrypt\))127.2 162 Q
(\(object \(type 'content\)\)\))127.2 174 Q
(\(validity \(not-after "2027-01-01"\)\)\))117.6 186 Q
(\(define \(authorized-decrypt? principal hash\))108 210 Q
("Check if principal can decrypt object")117.6 222 Q
(\(has-capability? principal 'decrypt hash\)\))117.6 234 Q F1 2.5
(8.2. En)72 252 R -.1(ve)-.4 G(lope Encryption).1 E F2
(;; Object encrypted with DEK, DEK encrypted with KEK)108 270 Q
(\(define \(envelope-encrypt data recipients\))108 282 Q
("Envelope encryption for multiple recipients")117.6 294 Q
(\(let \(\(dek \(generate-key 32\)\))117.6 306 Q 4.8(;D)105.6 G
(ata Encryption Key)-4.8 E
(\(encrypted-data \(encrypt-symmetric data dek\)\))151.2 318 Q 139.2
(\(encrypted-deks ;)151.2 330 R(KEK per recipient)4.8 E
(\(map \(lambda \(recipient\))156 342 Q
(\(age-encrypt dek \(list recipient\)\)\))189.6 354 Q(recipients\)\)\))
180 366 Q(`\(envelope)127.2 378 Q(\(encrypted-data . ,encrypted-data\))
136.8 390 Q(\(encrypted-keys . ,encrypted-deks\)\)\)\))136.8 402 Q
(\(define \(envelope-decrypt envelope identity\))108 426 Q
("Decrypt envelope")117.6 438 Q
(\(let \(\(encrypted-deks \(assoc-ref envelope 'encrypted-keys\)\))117.6
450 Q(\(dek \(find-and-decrypt-dek encrypted-deks identity\)\))151.2 462
Q(\(encrypted-data \(assoc-ref envelope 'encrypted-data\)\)\))151.2 474
Q(\(decrypt-symmetric encrypted-data dek\)\)\))127.2 486 Q F1 2.5
(9. Secur)72 504 R 2.5(eM)-.18 G(emory)-2.5 E 2.5(9.1. K)72 528 R
(ey Handling)-.25 E F2(;; Keys must be handled carefully in memory)108
546 Q(\(define \(with-key key-source proc\))108 558 Q
("Use key with automatic cleanup")117.6 570 Q
(\(let \(\(key \(key-source\)\)\))117.6 582 Q(\(dynamic-wind)127.2 594 Q
(\(lambda \(\) #t\))136.8 606 Q(\(lambda \(\) \(proc key\)\))136.8 618 Q
(\(lambda \(\) \(secure-clear! key\)\)\)\)\))136.8 630 Q
(\(define \(secure-clear! bytevector\))108 654 Q("Securely zero memory")
117.6 666 Q(\(bytevector-fill! bytevector 0\))117.6 678 Q
(;; Prevent compiler optimization)117.6 690 Q(\(memory-barrier\)\))117.6
702 Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.2. Memory)72 84 R(Pr)2.5 E(otection)-.18 E/F2 8/Courier@0 SF
(;; Lock key pages in memory \(prevent swap\))108 102 Q
(\(define \(allocate-secure-memory size\))108 114 Q
(\(let \(\(mem \(allocate-memory size\)\)\))117.6 126 Q
(\(mlock mem size\))127.2 138 Q(mem\)\))127.2 150 Q
(\(define \(free-secure-memory mem size\))108 174 Q
(\(secure-clear! mem\))117.6 186 Q(\(munlock mem size\))117.6 198 Q
(\(free-memory mem\)\))117.6 210 Q F1 2.5(10. V)72 228 R
(olume Encryption)-1 E 2.5(10.1. LUKS)72 252 R(Integration)2.5 E F2
(;; Storage volume encryption)108 270 Q
(\(define \(setup-encrypted-volume device passphrase\))108 282 Q
("Initialize LUKS encrypted volume")117.6 294 Q
(\(run-command "cryptsetup" "luksFormat" device\))117.6 306 Q
(\(run-command "cryptsetup" "luksOpen" device "vault-storage"\)\))117.6
318 Q(\(define \(mount-encrypted-volume passphrase\))108 342 Q
("Mount encrypted storage volume")117.6 354 Q
(\(run-command "cryptsetup" "luksOpen")117.6 366 Q(\(storage-device\))
180 378 Q("vault-storage")180 390 Q(stdin: passphrase\))180 402 Q
(\(run-command "mount" "/dev/mapper/vault-storage" \(storage-path\)\)\))
117.6 414 Q F1 2.5(10.2. Hard)72 432 R(war)-.15 E 2.5(eS)-.18 G
(ecurity Modules)-2.5 E F2(;; HSM for key protection)108 450 Q
(\(define \(hsm-generate-key hsm-slot\))108 462 Q("Generate key in HSM")
117.6 474 Q(\(pkcs11-generate-key)117.6 486 Q(session: \(hsm-session\))
127.2 498 Q(slot: hsm-slot)127.2 510 Q(mechanism: 'aes-256)127.2 522 Q
(extractable: #f\)\))127.2 534 Q
(\(define \(hsm-encrypt data key-handle\))108 558 Q
("Encrypt using HSM-held key")117.6 570 Q(\(pkcs11-encrypt)117.6 582 Q
(session: \(hsm-session\))127.2 594 Q(key: key-handle)127.2 606 Q
(mechanism: 'aes-gcm)127.2 618 Q(data: data\)\))127.2 630 Q F1 2.5
(11. A)72 648 R(udit)-.5 E 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(11.1. Encryption)72 84 R -.5(Au)2.5 G(dit).5 E/F2 8/Courier@0 SF
(\(define \(audit-encryption-operation op hash principal\))108 102 Q
("Log encryption operation")117.6 114 Q(\(audit-append)117.6 126 Q
(action: op)127.2 138 Q(hash: hash)127.2 150 Q(principal: principal)
127.2 162 Q(timestamp: \(current-time\))127.2 174 Q
(;; Never log keys or plaintext!)127.2 186 Q(\)\))127.2 198 Q
(;; Audit all key operations)108 222 Q
(\(define \(audit-key-operation op key-id principal\))108 234 Q
(\(audit-append)117.6 246 Q(action: op)127.2 258 Q(key-id: key-id)127.2
270 Q(principal: principal)127.2 282 Q(timestamp: \(current-time\)\)\))
127.2 294 Q F1 2.5(11.2. Compliance)72 312 R(Reporting)2.5 E F2
(\(define \(encryption-compliance-report\))108 330 Q
("Generate encryption compliance report")117.6 342 Q
(`\(\(total-objects . ,\(count-objects\)\))117.6 354 Q
(\(encrypted-objects . ,\(count-encrypted-objects\)\))127.2 366 Q(\(enc\
ryption-coverage . ,\(/ \(count-encrypted-objects\) \(count-objects\)\)\
\))127.2 378 Q(\(key-rotation-date . ,\(last-key-rotation\)\))127.2 390
Q(\(algorithm . "ChaCha20-Poly1305"\))127.2 402 Q
(\(key-length . 256\)\)\))127.2 414 Q F1 2.5(12. P)72 432 R(erf)-.2 E
(ormance)-.25 E 2.5(12.1. Encryption)72 456 R(Ov)2.5 E(erhead)-.1 E F2
(;; Benchmark encryption overhead)108 474 Q
(\(define \(benchmark-encryption size iterations\))108 486 Q
(\(let \(\(data \(generate-random-bytes size\)\))117.6 498 Q
(\(key \(generate-key 32\)\)\))146.4 510 Q(\(time-iterations iterations)
127.2 522 Q(\(encrypt-symmetric data key\)\)\)\))136.8 534 Q F1 2.5
(12.2. Hard)72 552 R(war)-.15 E 2.5(eA)-.18 G(cceleration)-2.5 E F2
(;; Use AES-NI when available)108 570 Q(\(define \(select-cipher\))108
582 Q(\(if \(cpu-supports-aes-ni?\))117.6 594 Q('aes-256-gcm)136.8 606 Q
('chacha20-poly1305\)\))136.8 618 Q F1 2.5(13. Security)72 636 R
(Considerations)2.5 E 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-030 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(13.1. K)72 84 R(ey Compr)-.25 E(omise)-.18 E/F2 8/Courier@0 SF
(;; If key is compromised)108 102 Q
(\(define \(handle-key-compromise compromised-key-id\))108 114 Q
("Emergency response to key compromise")117.6 126 Q
(;; Immediate key rotation)117.6 138 Q(\(rotate-vault-key\))117.6 150 Q
(;; Audit trail)117.6 174 Q(\(audit-append action: 'key-compromise)117.6
186 Q(key-id: compromised-key-id)184.8 198 Q(priority: 'critical\))184.8
210 Q(;; Notify administrators)117.6 234 Q
(\(alert-key-compromise compromised-key-id\))117.6 246 Q
(;; Re-encrypt with new key)117.6 270 Q(\(re-encrypt-all-objects\)\))
117.6 282 Q F1 2.5(13.2. Side)72 300 R(Channels)2.5 E F2
(;; Constant-time operations)108 318 Q
(\(define \(constant-time-compare a b\))108 330 Q
("Compare without timing leaks")117.6 342 Q(\(let \(\(result 0\)\))117.6
354 Q(\(do \(\(i 0 \(+ i 1\)\)\))127.2 366 Q
(\(\(= i \(bytevector-length a\)\) \(= result 0\)\))146.4 378 Q
(\(set! result \(bitwise-ior result)136.8 390 Q
(\(bitwise-xor \(bytevector-u8-ref a i\))204 402 Q
(\(bytevector-u8-ref b i\)\)\)\)\)\)\))266.4 414 Q F1 2.5(14. Refer)72
432 R(ences)-.18 E F0 .892(1. [age]\(https://age-encryption.or)72 447.6
R .891(g/\) - Modern \214le encryption 2. [LUKS]\(https://gitlab.com/cr\
yptsetup/cryptsetup\) -)-.18 F .652(Linux Uni\214ed K)72 459.6 R .952
-.15(ey S)-.25 H .653(etup 3. [RFC-022: K).15 F .953 -.15(ey C)-.25 H
(eremon).15 E 3.153(yP)-.15 G(rotocol]\(rfc-022-k)-3.153 E -.15(ey)-.1 G
(-ceremon).15 E .653(y.html\) 4. [RFC-018: Sealed)-.15 F(Archi)72 471.6
Q .3 -.15(ve Fo)-.25 H(rmat]\(rfc-018-sealed-archi).15 E -.15(ve)-.25 G
(.html\)).15 E F1 2.5(15. Changelog)72 495.6 R F0 6.5<8332>72 511.2 S
(026-01-07)-6.5 E 6.5<8349>72 526.8 S(nitial draft)-6.5 E 0 Cg EP
%%Trailer
end
%%EOF
