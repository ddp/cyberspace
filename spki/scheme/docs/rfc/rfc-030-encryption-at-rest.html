<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <title>RFC-030: Encryption at Rest</title>
  <link rel="stylesheet" href="rfc.css">
</head>
<body>
<span class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark">[theme]</span>
<h1>RFC-030: Encryption at Rest</h1>
<dl class="metadata">
</dl>
<hr>
<section>
<h2>Abstract</h2>
<p>This RFC specifies encryption at rest for the Library of Cyberspace: how vaults protect stored data using modern cryptography while maintaining content-addressability, key management, and operational flexibility. All sensitive data is encrypted before touching persistent storage.</p>
</section>
<section>
<h2>Motivation</h2>
<p>Data at rest faces threats:</p>
<ul>
<li>Physical theft</li>
<li>Disks, servers, backups stolen</li>
<li>Insider access</li>
<li>Unauthorized admin access</li>
<li>Legal compulsion</li>
<li>Forced disclosure orders</li>
<li>Decommissioning</li>
<li>Data remnants on old hardware</li>
</ul>
<p>Encryption must be:</p>
<ul>
<li>Transparent</li>
<li>Applications unaware of encryption</li>
<li>Performant</li>
<li>Minimal overhead</li>
<li>Recoverable</li>
<li>Key loss doesn't mean data loss</li>
<li>Auditable</li>
<li>All key operations logged</li>
</ul>
</section>
<section>
<h2>Encryption Model</h2>
<h3>Layered Encryption</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 374.4 249.6" width="374.4" height="249.6" xmlns="http://www.w3.org/2000/svg">
<style>
  line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; }
  text { font-family: 'Hack', 'SF Mono', monospace; font-size: 14px; fill: currentColor; }
</style>
<line x1="4.8" y1="9.6" x2="9.6" y2="9.6"/>
<line x1="4.8" y1="9.6" x2="4.8" y2="19.2"/>
<line x1="9.6" y1="9.6" x2="19.2" y2="9.6"/>
<line x1="19.2" y1="9.6" x2="28.8" y2="9.6"/>
<line x1="28.8" y1="9.6" x2="38.4" y2="9.6"/>
<line x1="38.4" y1="9.6" x2="48.0" y2="9.6"/>
<line x1="48.0" y1="9.6" x2="57.6" y2="9.6"/>
<line x1="57.6" y1="9.6" x2="67.2" y2="9.6"/>
<line x1="67.2" y1="9.6" x2="76.8" y2="9.6"/>
<line x1="76.8" y1="9.6" x2="86.4" y2="9.6"/>
<line x1="86.4" y1="9.6" x2="96.0" y2="9.6"/>
<line x1="96.0" y1="9.6" x2="105.6" y2="9.6"/>
<line x1="105.6" y1="9.6" x2="115.2" y2="9.6"/>
<line x1="115.2" y1="9.6" x2="124.8" y2="9.6"/>
<line x1="124.8" y1="9.6" x2="134.4" y2="9.6"/>
<line x1="134.4" y1="9.6" x2="144.0" y2="9.6"/>
<line x1="144.0" y1="9.6" x2="153.6" y2="9.6"/>
<line x1="153.6" y1="9.6" x2="163.2" y2="9.6"/>
<line x1="163.2" y1="9.6" x2="172.8" y2="9.6"/>
<line x1="172.8" y1="9.6" x2="182.4" y2="9.6"/>
<line x1="182.4" y1="9.6" x2="192.0" y2="9.6"/>
<line x1="192.0" y1="9.6" x2="201.6" y2="9.6"/>
<line x1="201.6" y1="9.6" x2="211.2" y2="9.6"/>
<line x1="211.2" y1="9.6" x2="220.8" y2="9.6"/>
<line x1="220.8" y1="9.6" x2="230.4" y2="9.6"/>
<line x1="230.4" y1="9.6" x2="240.0" y2="9.6"/>
<line x1="240.0" y1="9.6" x2="249.6" y2="9.6"/>
<line x1="249.6" y1="9.6" x2="259.2" y2="9.6"/>
<line x1="259.2" y1="9.6" x2="268.8" y2="9.6"/>
<line x1="268.8" y1="9.6" x2="278.4" y2="9.6"/>
<line x1="278.4" y1="9.6" x2="288.0" y2="9.6"/>
<line x1="288.0" y1="9.6" x2="297.6" y2="9.6"/>
<line x1="297.6" y1="9.6" x2="307.2" y2="9.6"/>
<line x1="307.2" y1="9.6" x2="316.8" y2="9.6"/>
<line x1="316.8" y1="9.6" x2="326.4" y2="9.6"/>
<line x1="326.4" y1="9.6" x2="336.0" y2="9.6"/>
<line x1="336.0" y1="9.6" x2="345.6" y2="9.6"/>
<line x1="345.6" y1="9.6" x2="355.2" y2="9.6"/>
<line x1="355.2" y1="9.6" x2="364.8" y2="9.6"/>
<line x1="364.8" y1="9.6" x2="369.6" y2="9.6"/>
<line x1="369.6" y1="9.6" x2="369.6" y2="19.2"/>
<line x1="4.8" y1="19.2" x2="4.8" y2="38.4"/>
<line x1="369.6" y1="19.2" x2="369.6" y2="38.4"/>
<line x1="4.8" y1="38.4" x2="4.8" y2="57.6"/>
<line x1="369.6" y1="38.4" x2="369.6" y2="57.6"/>
<line x1="4.8" y1="57.6" x2="4.8" y2="76.8"/>
<line x1="4.8" y1="67.2" x2="9.6" y2="67.2"/>
<line x1="9.6" y1="67.2" x2="19.2" y2="67.2"/>
<line x1="19.2" y1="67.2" x2="28.8" y2="67.2"/>
<line x1="28.8" y1="67.2" x2="38.4" y2="67.2"/>
<line x1="38.4" y1="67.2" x2="48.0" y2="67.2"/>
<line x1="48.0" y1="67.2" x2="57.6" y2="67.2"/>
<line x1="57.6" y1="67.2" x2="67.2" y2="67.2"/>
<line x1="67.2" y1="67.2" x2="76.8" y2="67.2"/>
<line x1="76.8" y1="67.2" x2="86.4" y2="67.2"/>
<line x1="86.4" y1="67.2" x2="96.0" y2="67.2"/>
<line x1="96.0" y1="67.2" x2="105.6" y2="67.2"/>
<line x1="105.6" y1="67.2" x2="115.2" y2="67.2"/>
<line x1="115.2" y1="67.2" x2="124.8" y2="67.2"/>
<line x1="124.8" y1="67.2" x2="134.4" y2="67.2"/>
<line x1="134.4" y1="67.2" x2="144.0" y2="67.2"/>
<line x1="144.0" y1="67.2" x2="153.6" y2="67.2"/>
<line x1="153.6" y1="67.2" x2="163.2" y2="67.2"/>
<line x1="163.2" y1="67.2" x2="172.8" y2="67.2"/>
<line x1="172.8" y1="67.2" x2="182.4" y2="67.2"/>
<line x1="182.4" y1="67.2" x2="192.0" y2="67.2"/>
<line x1="192.0" y1="67.2" x2="201.6" y2="67.2"/>
<line x1="201.6" y1="67.2" x2="211.2" y2="67.2"/>
<line x1="211.2" y1="67.2" x2="220.8" y2="67.2"/>
<line x1="220.8" y1="67.2" x2="230.4" y2="67.2"/>
<line x1="230.4" y1="67.2" x2="240.0" y2="67.2"/>
<line x1="240.0" y1="67.2" x2="249.6" y2="67.2"/>
<line x1="249.6" y1="67.2" x2="259.2" y2="67.2"/>
<line x1="259.2" y1="67.2" x2="268.8" y2="67.2"/>
<line x1="268.8" y1="67.2" x2="278.4" y2="67.2"/>
<line x1="278.4" y1="67.2" x2="288.0" y2="67.2"/>
<line x1="288.0" y1="67.2" x2="297.6" y2="67.2"/>
<line x1="297.6" y1="67.2" x2="307.2" y2="67.2"/>
<line x1="307.2" y1="67.2" x2="316.8" y2="67.2"/>
<line x1="316.8" y1="67.2" x2="326.4" y2="67.2"/>
<line x1="326.4" y1="67.2" x2="336.0" y2="67.2"/>
<line x1="336.0" y1="67.2" x2="345.6" y2="67.2"/>
<line x1="345.6" y1="67.2" x2="355.2" y2="67.2"/>
<line x1="355.2" y1="67.2" x2="364.8" y2="67.2"/>
<line x1="369.6" y1="57.6" x2="369.6" y2="76.8"/>
<line x1="364.8" y1="67.2" x2="369.6" y2="67.2"/>
<line x1="4.8" y1="76.8" x2="4.8" y2="96.0"/>
<line x1="369.6" y1="76.8" x2="369.6" y2="96.0"/>
<line x1="4.8" y1="96.0" x2="4.8" y2="115.2"/>
<line x1="369.6" y1="96.0" x2="369.6" y2="115.2"/>
<line x1="4.8" y1="115.2" x2="4.8" y2="134.4"/>
<line x1="4.8" y1="124.8" x2="9.6" y2="124.8"/>
<line x1="9.6" y1="124.8" x2="19.2" y2="124.8"/>
<line x1="19.2" y1="124.8" x2="28.8" y2="124.8"/>
<line x1="28.8" y1="124.8" x2="38.4" y2="124.8"/>
<line x1="38.4" y1="124.8" x2="48.0" y2="124.8"/>
<line x1="48.0" y1="124.8" x2="57.6" y2="124.8"/>
<line x1="57.6" y1="124.8" x2="67.2" y2="124.8"/>
<line x1="67.2" y1="124.8" x2="76.8" y2="124.8"/>
<line x1="76.8" y1="124.8" x2="86.4" y2="124.8"/>
<line x1="86.4" y1="124.8" x2="96.0" y2="124.8"/>
<line x1="96.0" y1="124.8" x2="105.6" y2="124.8"/>
<line x1="105.6" y1="124.8" x2="115.2" y2="124.8"/>
<line x1="115.2" y1="124.8" x2="124.8" y2="124.8"/>
<line x1="124.8" y1="124.8" x2="134.4" y2="124.8"/>
<line x1="134.4" y1="124.8" x2="144.0" y2="124.8"/>
<line x1="144.0" y1="124.8" x2="153.6" y2="124.8"/>
<line x1="153.6" y1="124.8" x2="163.2" y2="124.8"/>
<line x1="163.2" y1="124.8" x2="172.8" y2="124.8"/>
<line x1="172.8" y1="124.8" x2="182.4" y2="124.8"/>
<line x1="182.4" y1="124.8" x2="192.0" y2="124.8"/>
<line x1="192.0" y1="124.8" x2="201.6" y2="124.8"/>
<line x1="201.6" y1="124.8" x2="211.2" y2="124.8"/>
<line x1="211.2" y1="124.8" x2="220.8" y2="124.8"/>
<line x1="220.8" y1="124.8" x2="230.4" y2="124.8"/>
<line x1="230.4" y1="124.8" x2="240.0" y2="124.8"/>
<line x1="240.0" y1="124.8" x2="249.6" y2="124.8"/>
<line x1="249.6" y1="124.8" x2="259.2" y2="124.8"/>
<line x1="259.2" y1="124.8" x2="268.8" y2="124.8"/>
<line x1="268.8" y1="124.8" x2="278.4" y2="124.8"/>
<line x1="278.4" y1="124.8" x2="288.0" y2="124.8"/>
<line x1="288.0" y1="124.8" x2="297.6" y2="124.8"/>
<line x1="297.6" y1="124.8" x2="307.2" y2="124.8"/>
<line x1="307.2" y1="124.8" x2="316.8" y2="124.8"/>
<line x1="316.8" y1="124.8" x2="326.4" y2="124.8"/>
<line x1="326.4" y1="124.8" x2="336.0" y2="124.8"/>
<line x1="336.0" y1="124.8" x2="345.6" y2="124.8"/>
<line x1="345.6" y1="124.8" x2="355.2" y2="124.8"/>
<line x1="355.2" y1="124.8" x2="364.8" y2="124.8"/>
<line x1="369.6" y1="115.2" x2="369.6" y2="134.4"/>
<line x1="364.8" y1="124.8" x2="369.6" y2="124.8"/>
<line x1="4.8" y1="134.4" x2="4.8" y2="153.6"/>
<line x1="369.6" y1="134.4" x2="369.6" y2="153.6"/>
<line x1="4.8" y1="153.6" x2="4.8" y2="172.8"/>
<line x1="369.6" y1="153.6" x2="369.6" y2="172.8"/>
<line x1="4.8" y1="172.8" x2="4.8" y2="192.0"/>
<line x1="4.8" y1="182.4" x2="9.6" y2="182.4"/>
<line x1="9.6" y1="182.4" x2="19.2" y2="182.4"/>
<line x1="19.2" y1="182.4" x2="28.8" y2="182.4"/>
<line x1="28.8" y1="182.4" x2="38.4" y2="182.4"/>
<line x1="38.4" y1="182.4" x2="48.0" y2="182.4"/>
<line x1="48.0" y1="182.4" x2="57.6" y2="182.4"/>
<line x1="57.6" y1="182.4" x2="67.2" y2="182.4"/>
<line x1="67.2" y1="182.4" x2="76.8" y2="182.4"/>
<line x1="76.8" y1="182.4" x2="86.4" y2="182.4"/>
<line x1="86.4" y1="182.4" x2="96.0" y2="182.4"/>
<line x1="96.0" y1="182.4" x2="105.6" y2="182.4"/>
<line x1="105.6" y1="182.4" x2="115.2" y2="182.4"/>
<line x1="115.2" y1="182.4" x2="124.8" y2="182.4"/>
<line x1="124.8" y1="182.4" x2="134.4" y2="182.4"/>
<line x1="134.4" y1="182.4" x2="144.0" y2="182.4"/>
<line x1="144.0" y1="182.4" x2="153.6" y2="182.4"/>
<line x1="153.6" y1="182.4" x2="163.2" y2="182.4"/>
<line x1="163.2" y1="182.4" x2="172.8" y2="182.4"/>
<line x1="172.8" y1="182.4" x2="182.4" y2="182.4"/>
<line x1="182.4" y1="182.4" x2="192.0" y2="182.4"/>
<line x1="192.0" y1="182.4" x2="201.6" y2="182.4"/>
<line x1="201.6" y1="182.4" x2="211.2" y2="182.4"/>
<line x1="211.2" y1="182.4" x2="220.8" y2="182.4"/>
<line x1="220.8" y1="182.4" x2="230.4" y2="182.4"/>
<line x1="230.4" y1="182.4" x2="240.0" y2="182.4"/>
<line x1="240.0" y1="182.4" x2="249.6" y2="182.4"/>
<line x1="249.6" y1="182.4" x2="259.2" y2="182.4"/>
<line x1="259.2" y1="182.4" x2="268.8" y2="182.4"/>
<line x1="268.8" y1="182.4" x2="278.4" y2="182.4"/>
<line x1="278.4" y1="182.4" x2="288.0" y2="182.4"/>
<line x1="288.0" y1="182.4" x2="297.6" y2="182.4"/>
<line x1="297.6" y1="182.4" x2="307.2" y2="182.4"/>
<line x1="307.2" y1="182.4" x2="316.8" y2="182.4"/>
<line x1="316.8" y1="182.4" x2="326.4" y2="182.4"/>
<line x1="326.4" y1="182.4" x2="336.0" y2="182.4"/>
<line x1="336.0" y1="182.4" x2="345.6" y2="182.4"/>
<line x1="345.6" y1="182.4" x2="355.2" y2="182.4"/>
<line x1="355.2" y1="182.4" x2="364.8" y2="182.4"/>
<line x1="369.6" y1="172.8" x2="369.6" y2="192.0"/>
<line x1="364.8" y1="182.4" x2="369.6" y2="182.4"/>
<line x1="4.8" y1="192.0" x2="4.8" y2="211.2"/>
<line x1="369.6" y1="192.0" x2="369.6" y2="211.2"/>
<line x1="4.8" y1="211.2" x2="4.8" y2="230.4"/>
<line x1="369.6" y1="211.2" x2="369.6" y2="230.4"/>
<line x1="4.8" y1="240.0" x2="9.6" y2="240.0"/>
<line x1="4.8" y1="230.4" x2="4.8" y2="240.0"/>
<line x1="9.6" y1="240.0" x2="19.2" y2="240.0"/>
<line x1="19.2" y1="240.0" x2="28.8" y2="240.0"/>
<line x1="28.8" y1="240.0" x2="38.4" y2="240.0"/>
<line x1="38.4" y1="240.0" x2="48.0" y2="240.0"/>
<line x1="48.0" y1="240.0" x2="57.6" y2="240.0"/>
<line x1="57.6" y1="240.0" x2="67.2" y2="240.0"/>
<line x1="67.2" y1="240.0" x2="76.8" y2="240.0"/>
<line x1="76.8" y1="240.0" x2="86.4" y2="240.0"/>
<line x1="86.4" y1="240.0" x2="96.0" y2="240.0"/>
<line x1="96.0" y1="240.0" x2="105.6" y2="240.0"/>
<line x1="105.6" y1="240.0" x2="115.2" y2="240.0"/>
<line x1="115.2" y1="240.0" x2="124.8" y2="240.0"/>
<line x1="124.8" y1="240.0" x2="134.4" y2="240.0"/>
<line x1="134.4" y1="240.0" x2="144.0" y2="240.0"/>
<line x1="144.0" y1="240.0" x2="153.6" y2="240.0"/>
<line x1="153.6" y1="240.0" x2="163.2" y2="240.0"/>
<line x1="163.2" y1="240.0" x2="172.8" y2="240.0"/>
<line x1="172.8" y1="240.0" x2="182.4" y2="240.0"/>
<line x1="182.4" y1="240.0" x2="192.0" y2="240.0"/>
<line x1="192.0" y1="240.0" x2="201.6" y2="240.0"/>
<line x1="201.6" y1="240.0" x2="211.2" y2="240.0"/>
<line x1="211.2" y1="240.0" x2="220.8" y2="240.0"/>
<line x1="220.8" y1="240.0" x2="230.4" y2="240.0"/>
<line x1="230.4" y1="240.0" x2="240.0" y2="240.0"/>
<line x1="240.0" y1="240.0" x2="249.6" y2="240.0"/>
<line x1="249.6" y1="240.0" x2="259.2" y2="240.0"/>
<line x1="259.2" y1="240.0" x2="268.8" y2="240.0"/>
<line x1="268.8" y1="240.0" x2="278.4" y2="240.0"/>
<line x1="278.4" y1="240.0" x2="288.0" y2="240.0"/>
<line x1="288.0" y1="240.0" x2="297.6" y2="240.0"/>
<line x1="297.6" y1="240.0" x2="307.2" y2="240.0"/>
<line x1="307.2" y1="240.0" x2="316.8" y2="240.0"/>
<line x1="316.8" y1="240.0" x2="326.4" y2="240.0"/>
<line x1="326.4" y1="240.0" x2="336.0" y2="240.0"/>
<line x1="336.0" y1="240.0" x2="345.6" y2="240.0"/>
<line x1="345.6" y1="240.0" x2="355.2" y2="240.0"/>
<line x1="355.2" y1="240.0" x2="364.8" y2="240.0"/>
<line x1="364.8" y1="240.0" x2="369.6" y2="240.0"/>
<line x1="369.6" y1="230.4" x2="369.6" y2="240.0"/>
<text x="100.8" y="28.8" text-anchor="middle" dominant-baseline="central">A</text>
<text x="110.4" y="28.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="120.0" y="28.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="129.6" y="28.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="139.2" y="28.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="148.8" y="28.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="158.4" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="168.0" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="177.6" y="28.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="187.2" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="196.8" y="28.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="216.0" y="28.8" text-anchor="middle" dominant-baseline="central">L</text>
<text x="225.6" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="235.2" y="28.8" text-anchor="middle" dominant-baseline="central">y</text>
<text x="244.8" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="254.4" y="28.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="81.6" y="48.0" text-anchor="middle" dominant-baseline="central">(</text>
<text x="91.2" y="48.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="100.8" y="48.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="110.4" y="48.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="120.0" y="48.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="129.6" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="139.2" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="148.8" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="158.4" y="48.0" text-anchor="middle" dominant-baseline="central">x</text>
<text x="168.0" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="187.2" y="48.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="196.8" y="48.0" text-anchor="middle" dominant-baseline="central">b</text>
<text x="206.4" y="48.0" text-anchor="middle" dominant-baseline="central">j</text>
<text x="216.0" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="225.6" y="48.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="235.2" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="244.8" y="48.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="254.4" y="48.0" text-anchor="middle" dominant-baseline="central">)</text>
<text x="72.0" y="86.4" text-anchor="middle" dominant-baseline="central">O</text>
<text x="81.6" y="86.4" text-anchor="middle" dominant-baseline="central">b</text>
<text x="91.2" y="86.4" text-anchor="middle" dominant-baseline="central">j</text>
<text x="100.8" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="110.4" y="86.4" text-anchor="middle" dominant-baseline="central">c</text>
<text x="120.0" y="86.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="129.6" y="86.4" text-anchor="middle" dominant-baseline="central">-</text>
<text x="139.2" y="86.4" text-anchor="middle" dominant-baseline="central">L</text>
<text x="148.8" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="158.4" y="86.4" text-anchor="middle" dominant-baseline="central">v</text>
<text x="168.0" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="177.6" y="86.4" text-anchor="middle" dominant-baseline="central">l</text>
<text x="196.8" y="86.4" text-anchor="middle" dominant-baseline="central">E</text>
<text x="206.4" y="86.4" text-anchor="middle" dominant-baseline="central">n</text>
<text x="216.0" y="86.4" text-anchor="middle" dominant-baseline="central">c</text>
<text x="225.6" y="86.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="235.2" y="86.4" text-anchor="middle" dominant-baseline="central">y</text>
<text x="244.8" y="86.4" text-anchor="middle" dominant-baseline="central">p</text>
<text x="254.4" y="86.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="264.0" y="86.4" text-anchor="middle" dominant-baseline="central">i</text>
<text x="273.6" y="86.4" text-anchor="middle" dominant-baseline="central">o</text>
<text x="283.2" y="86.4" text-anchor="middle" dominant-baseline="central">n</text>
<text x="52.8" y="105.6" text-anchor="middle" dominant-baseline="central">(</text>
<text x="62.4" y="105.6" text-anchor="middle" dominant-baseline="central">p</text>
<text x="72.0" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="81.6" y="105.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="91.2" y="105.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="100.8" y="105.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="110.4" y="105.6" text-anchor="middle" dominant-baseline="central">b</text>
<text x="120.0" y="105.6" text-anchor="middle" dominant-baseline="central">j</text>
<text x="129.6" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="139.2" y="105.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="148.8" y="105.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="168.0" y="105.6" text-anchor="middle" dominant-baseline="central">k</text>
<text x="177.6" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="187.2" y="105.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="196.8" y="105.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="206.4" y="105.6" text-anchor="middle" dominant-baseline="central">,</text>
<text x="225.6" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="235.2" y="105.6" text-anchor="middle" dominant-baseline="central">g</text>
<text x="244.8" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="264.0" y="105.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="273.6" y="105.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="283.2" y="105.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="292.8" y="105.6" text-anchor="middle" dominant-baseline="central">m</text>
<text x="302.4" y="105.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="312.0" y="105.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="321.6" y="105.6" text-anchor="middle" dominant-baseline="central">)</text>
<text x="72.0" y="144.0" text-anchor="middle" dominant-baseline="central">S</text>
<text x="81.6" y="144.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="91.2" y="144.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="100.8" y="144.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="110.4" y="144.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="120.0" y="144.0" text-anchor="middle" dominant-baseline="central">g</text>
<text x="129.6" y="144.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="139.2" y="144.0" text-anchor="middle" dominant-baseline="central">-</text>
<text x="148.8" y="144.0" text-anchor="middle" dominant-baseline="central">L</text>
<text x="158.4" y="144.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="168.0" y="144.0" text-anchor="middle" dominant-baseline="central">v</text>
<text x="177.6" y="144.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="187.2" y="144.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="206.4" y="144.0" text-anchor="middle" dominant-baseline="central">E</text>
<text x="216.0" y="144.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="225.6" y="144.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="235.2" y="144.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="244.8" y="144.0" text-anchor="middle" dominant-baseline="central">y</text>
<text x="254.4" y="144.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="264.0" y="144.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="273.6" y="144.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="283.2" y="144.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="292.8" y="144.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="52.8" y="163.2" text-anchor="middle" dominant-baseline="central">(</text>
<text x="62.4" y="163.2" text-anchor="middle" dominant-baseline="central">v</text>
<text x="72.0" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="81.6" y="163.2" text-anchor="middle" dominant-baseline="central">l</text>
<text x="91.2" y="163.2" text-anchor="middle" dominant-baseline="central">u</text>
<text x="100.8" y="163.2" text-anchor="middle" dominant-baseline="central">m</text>
<text x="110.4" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="129.6" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="139.2" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="148.8" y="163.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="158.4" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="168.0" y="163.2" text-anchor="middle" dominant-baseline="central">y</text>
<text x="177.6" y="163.2" text-anchor="middle" dominant-baseline="central">p</text>
<text x="187.2" y="163.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="196.8" y="163.2" text-anchor="middle" dominant-baseline="central">i</text>
<text x="206.4" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="216.0" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="225.6" y="163.2" text-anchor="middle" dominant-baseline="central">,</text>
<text x="244.8" y="163.2" text-anchor="middle" dominant-baseline="central">L</text>
<text x="254.4" y="163.2" text-anchor="middle" dominant-baseline="central">U</text>
<text x="264.0" y="163.2" text-anchor="middle" dominant-baseline="central">K</text>
<text x="273.6" y="163.2" text-anchor="middle" dominant-baseline="central">S</text>
<text x="283.2" y="163.2" text-anchor="middle" dominant-baseline="central">/</text>
<text x="292.8" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="302.4" y="163.2" text-anchor="middle" dominant-baseline="central">m</text>
<text x="312.0" y="163.2" text-anchor="middle" dominant-baseline="central">)</text>
<text x="100.8" y="201.6" text-anchor="middle" dominant-baseline="central">P</text>
<text x="110.4" y="201.6" text-anchor="middle" dominant-baseline="central">h</text>
<text x="120.0" y="201.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="129.6" y="201.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="139.2" y="201.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="148.8" y="201.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="158.4" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="168.0" y="201.6" text-anchor="middle" dominant-baseline="central">l</text>
<text x="187.2" y="201.6" text-anchor="middle" dominant-baseline="central">S</text>
<text x="196.8" y="201.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="206.4" y="201.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="216.0" y="201.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="225.6" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="235.2" y="201.6" text-anchor="middle" dominant-baseline="central">g</text>
<text x="244.8" y="201.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="91.2" y="220.8" text-anchor="middle" dominant-baseline="central">(</text>
<text x="100.8" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="110.4" y="220.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="120.0" y="220.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="129.6" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="139.2" y="220.8" text-anchor="middle" dominant-baseline="central">y</text>
<text x="148.8" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="158.4" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="168.0" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="177.6" y="220.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="196.8" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="206.4" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="225.6" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="235.2" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="244.8" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="254.4" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="264.0" y="220.8" text-anchor="middle" dominant-baseline="central">)</text>
</svg>
</div>
<h3>Encryption Scope</h3>
<pre class="language-scheme">
;; What gets encrypted
(define encryption-policy
  `((content . always)           ; Object content - always encrypted
    (soup-metadata . optional)   ; Metadata - configurable
    (indexes . optional)         ; Search indexes - configurable
    (audit-log . always)         ; Audit trail - always encrypted
    (keys . never-plaintext)))   ; Keys never stored plaintext
</pre>
</section>
<section>
<h2>Key Hierarchy</h2>
<h3>Key Types</h3>
<div class="diagram-container">
<svg class="diagram" viewBox="0 0 576.0 268.8" width="576.0" height="268.8" xmlns="http://www.w3.org/2000/svg">
<style>
  line { stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; }
  text { font-family: 'Hack', 'SF Mono', monospace; font-size: 14px; fill: currentColor; }
</style>
<line x1="43.2" y1="48.0" x2="48.0" y2="48.0"/>
<line x1="43.2" y1="38.4" x2="43.2" y2="48.0"/>
<line x1="48.0" y1="48.0" x2="57.6" y2="48.0"/>
<line x1="57.6" y1="48.0" x2="67.2" y2="48.0"/>
<line x1="81.6" y1="57.6" x2="81.6" y2="76.8"/>
<line x1="81.6" y1="67.2" x2="86.4" y2="67.2"/>
<line x1="86.4" y1="67.2" x2="96.0" y2="67.2"/>
<line x1="96.0" y1="67.2" x2="105.6" y2="67.2"/>
<line x1="81.6" y1="76.8" x2="81.6" y2="96.0"/>
<line x1="81.6" y1="86.4" x2="86.4" y2="86.4"/>
<line x1="86.4" y1="86.4" x2="96.0" y2="86.4"/>
<line x1="96.0" y1="86.4" x2="105.6" y2="86.4"/>
<line x1="81.6" y1="96.0" x2="81.6" y2="115.2"/>
<line x1="81.6" y1="105.6" x2="86.4" y2="105.6"/>
<line x1="86.4" y1="105.6" x2="96.0" y2="105.6"/>
<line x1="96.0" y1="105.6" x2="105.6" y2="105.6"/>
<line x1="81.6" y1="124.8" x2="86.4" y2="124.8"/>
<line x1="81.6" y1="115.2" x2="81.6" y2="124.8"/>
<line x1="86.4" y1="124.8" x2="96.0" y2="124.8"/>
<line x1="96.0" y1="124.8" x2="105.6" y2="124.8"/>
<text x="4.8" y="9.6" text-anchor="middle" dominant-baseline="central">(</text>
<text x="14.4" y="9.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="24.0" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="33.6" y="9.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="43.2" y="9.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="52.8" y="9.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="62.4" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="81.6" y="9.6" text-anchor="middle" dominant-baseline="central">k</text>
<text x="91.2" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="100.8" y="9.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="110.4" y="9.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="120.0" y="9.6" text-anchor="middle" dominant-baseline="central">h</text>
<text x="129.6" y="9.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="139.2" y="9.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="148.8" y="9.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="158.4" y="9.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="168.0" y="9.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="177.6" y="9.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="187.2" y="9.6" text-anchor="middle" dominant-baseline="central">h</text>
<text x="196.8" y="9.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="24.0" y="28.8" text-anchor="middle" dominant-baseline="central">'</text>
<text x="33.6" y="28.8" text-anchor="middle" dominant-baseline="central">(</text>
<text x="43.2" y="28.8" text-anchor="middle" dominant-baseline="central">m</text>
<text x="52.8" y="28.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="62.4" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="72.0" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="81.6" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="91.2" y="28.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="100.8" y="28.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="110.4" y="28.8" text-anchor="middle" dominant-baseline="central">k</text>
<text x="120.0" y="28.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="129.6" y="28.8" text-anchor="middle" dominant-baseline="central">y</text>
<text x="331.2" y="28.8" text-anchor="middle" dominant-baseline="central">;</text>
<text x="350.4" y="28.8" text-anchor="middle" dominant-baseline="central">R</text>
<text x="360.0" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="369.6" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="379.2" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="398.4" y="28.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="408.0" y="28.8" text-anchor="middle" dominant-baseline="central">f</text>
<text x="427.2" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="436.8" y="28.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="446.4" y="28.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="456.0" y="28.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="465.6" y="28.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="81.6" y="48.0" text-anchor="middle" dominant-baseline="central">v</text>
<text x="91.2" y="48.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="100.8" y="48.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="110.4" y="48.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="120.0" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="129.6" y="48.0" text-anchor="middle" dominant-baseline="central">-</text>
<text x="139.2" y="48.0" text-anchor="middle" dominant-baseline="central">k</text>
<text x="148.8" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="158.4" y="48.0" text-anchor="middle" dominant-baseline="central">y</text>
<text x="331.2" y="48.0" text-anchor="middle" dominant-baseline="central">;</text>
<text x="350.4" y="48.0" text-anchor="middle" dominant-baseline="central">P</text>
<text x="360.0" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="369.6" y="48.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="379.2" y="48.0" text-anchor="middle" dominant-baseline="central">-</text>
<text x="388.8" y="48.0" text-anchor="middle" dominant-baseline="central">v</text>
<text x="398.4" y="48.0" text-anchor="middle" dominant-baseline="central">a</text>
<text x="408.0" y="48.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="417.6" y="48.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="427.2" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="446.4" y="48.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="456.0" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="465.6" y="48.0" text-anchor="middle" dominant-baseline="central">c</text>
<text x="475.2" y="48.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="484.8" y="48.0" text-anchor="middle" dominant-baseline="central">y</text>
<text x="494.4" y="48.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="504.0" y="48.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="513.6" y="48.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="523.2" y="48.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="532.8" y="48.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="120.0" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="129.6" y="67.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="139.2" y="67.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="148.8" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="158.4" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="168.0" y="67.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="177.6" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="187.2" y="67.2" text-anchor="middle" dominant-baseline="central">-</text>
<text x="196.8" y="67.2" text-anchor="middle" dominant-baseline="central">k</text>
<text x="206.4" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="216.0" y="67.2" text-anchor="middle" dominant-baseline="central">y</text>
<text x="331.2" y="67.2" text-anchor="middle" dominant-baseline="central">;</text>
<text x="350.4" y="67.2" text-anchor="middle" dominant-baseline="central">O</text>
<text x="360.0" y="67.2" text-anchor="middle" dominant-baseline="central">b</text>
<text x="369.6" y="67.2" text-anchor="middle" dominant-baseline="central">j</text>
<text x="379.2" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="388.8" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="398.4" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="417.6" y="67.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="427.2" y="67.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="436.8" y="67.2" text-anchor="middle" dominant-baseline="central">c</text>
<text x="446.4" y="67.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="456.0" y="67.2" text-anchor="middle" dominant-baseline="central">y</text>
<text x="465.6" y="67.2" text-anchor="middle" dominant-baseline="central">p</text>
<text x="475.2" y="67.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="484.8" y="67.2" text-anchor="middle" dominant-baseline="central">i</text>
<text x="494.4" y="67.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="504.0" y="67.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="120.0" y="86.4" text-anchor="middle" dominant-baseline="central">m</text>
<text x="129.6" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="139.2" y="86.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="148.8" y="86.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="158.4" y="86.4" text-anchor="middle" dominant-baseline="central">d</text>
<text x="168.0" y="86.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="177.6" y="86.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="187.2" y="86.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="196.8" y="86.4" text-anchor="middle" dominant-baseline="central">-</text>
<text x="206.4" y="86.4" text-anchor="middle" dominant-baseline="central">k</text>
<text x="216.0" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="225.6" y="86.4" text-anchor="middle" dominant-baseline="central">y</text>
<text x="331.2" y="86.4" text-anchor="middle" dominant-baseline="central">;</text>
<text x="350.4" y="86.4" text-anchor="middle" dominant-baseline="central">S</text>
<text x="360.0" y="86.4" text-anchor="middle" dominant-baseline="central">o</text>
<text x="369.6" y="86.4" text-anchor="middle" dominant-baseline="central">u</text>
<text x="379.2" y="86.4" text-anchor="middle" dominant-baseline="central">p</text>
<text x="398.4" y="86.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="408.0" y="86.4" text-anchor="middle" dominant-baseline="central">n</text>
<text x="417.6" y="86.4" text-anchor="middle" dominant-baseline="central">c</text>
<text x="427.2" y="86.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="436.8" y="86.4" text-anchor="middle" dominant-baseline="central">y</text>
<text x="446.4" y="86.4" text-anchor="middle" dominant-baseline="central">p</text>
<text x="456.0" y="86.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="465.6" y="86.4" text-anchor="middle" dominant-baseline="central">i</text>
<text x="475.2" y="86.4" text-anchor="middle" dominant-baseline="central">o</text>
<text x="484.8" y="86.4" text-anchor="middle" dominant-baseline="central">n</text>
<text x="120.0" y="105.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="129.6" y="105.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="139.2" y="105.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="148.8" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="158.4" y="105.6" text-anchor="middle" dominant-baseline="central">x</text>
<text x="168.0" y="105.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="177.6" y="105.6" text-anchor="middle" dominant-baseline="central">k</text>
<text x="187.2" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="196.8" y="105.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="331.2" y="105.6" text-anchor="middle" dominant-baseline="central">;</text>
<text x="350.4" y="105.6" text-anchor="middle" dominant-baseline="central">I</text>
<text x="360.0" y="105.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="369.6" y="105.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="379.2" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="388.8" y="105.6" text-anchor="middle" dominant-baseline="central">x</text>
<text x="408.0" y="105.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="417.6" y="105.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="427.2" y="105.6" text-anchor="middle" dominant-baseline="central">c</text>
<text x="436.8" y="105.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="446.4" y="105.6" text-anchor="middle" dominant-baseline="central">y</text>
<text x="456.0" y="105.6" text-anchor="middle" dominant-baseline="central">p</text>
<text x="465.6" y="105.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="475.2" y="105.6" text-anchor="middle" dominant-baseline="central">i</text>
<text x="484.8" y="105.6" text-anchor="middle" dominant-baseline="central">o</text>
<text x="494.4" y="105.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="120.0" y="124.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="129.6" y="124.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="139.2" y="124.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="148.8" y="124.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="158.4" y="124.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="168.0" y="124.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="177.6" y="124.8" text-anchor="middle" dominant-baseline="central">k</text>
<text x="187.2" y="124.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="196.8" y="124.8" text-anchor="middle" dominant-baseline="central">y</text>
<text x="206.4" y="124.8" text-anchor="middle" dominant-baseline="central">)</text>
<text x="216.0" y="124.8" text-anchor="middle" dominant-baseline="central">)</text>
<text x="331.2" y="124.8" text-anchor="middle" dominant-baseline="central">;</text>
<text x="350.4" y="124.8" text-anchor="middle" dominant-baseline="central">A</text>
<text x="360.0" y="124.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="369.6" y="124.8" text-anchor="middle" dominant-baseline="central">d</text>
<text x="379.2" y="124.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="388.8" y="124.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="408.0" y="124.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="417.6" y="124.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="427.2" y="124.8" text-anchor="middle" dominant-baseline="central">g</text>
<text x="446.4" y="124.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="456.0" y="124.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="465.6" y="124.8" text-anchor="middle" dominant-baseline="central">c</text>
<text x="475.2" y="124.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="484.8" y="124.8" text-anchor="middle" dominant-baseline="central">y</text>
<text x="494.4" y="124.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="504.0" y="124.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="513.6" y="124.8" text-anchor="middle" dominant-baseline="central">i</text>
<text x="523.2" y="124.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="532.8" y="124.8" text-anchor="middle" dominant-baseline="central">n</text>
<text x="4.8" y="163.2" text-anchor="middle" dominant-baseline="central">(</text>
<text x="14.4" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="24.0" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="33.6" y="163.2" text-anchor="middle" dominant-baseline="central">f</text>
<text x="43.2" y="163.2" text-anchor="middle" dominant-baseline="central">i</text>
<text x="52.8" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="62.4" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="81.6" y="163.2" text-anchor="middle" dominant-baseline="central">(</text>
<text x="91.2" y="163.2" text-anchor="middle" dominant-baseline="central">d</text>
<text x="100.8" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="110.4" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="120.0" y="163.2" text-anchor="middle" dominant-baseline="central">i</text>
<text x="129.6" y="163.2" text-anchor="middle" dominant-baseline="central">v</text>
<text x="139.2" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="148.8" y="163.2" text-anchor="middle" dominant-baseline="central">-</text>
<text x="158.4" y="163.2" text-anchor="middle" dominant-baseline="central">k</text>
<text x="168.0" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="177.6" y="163.2" text-anchor="middle" dominant-baseline="central">y</text>
<text x="196.8" y="163.2" text-anchor="middle" dominant-baseline="central">p</text>
<text x="206.4" y="163.2" text-anchor="middle" dominant-baseline="central">a</text>
<text x="216.0" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="225.6" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="235.2" y="163.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="244.8" y="163.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="264.0" y="163.2" text-anchor="middle" dominant-baseline="central">p</text>
<text x="273.6" y="163.2" text-anchor="middle" dominant-baseline="central">u</text>
<text x="283.2" y="163.2" text-anchor="middle" dominant-baseline="central">r</text>
<text x="292.8" y="163.2" text-anchor="middle" dominant-baseline="central">p</text>
<text x="302.4" y="163.2" text-anchor="middle" dominant-baseline="central">o</text>
<text x="312.0" y="163.2" text-anchor="middle" dominant-baseline="central">s</text>
<text x="321.6" y="163.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="331.2" y="163.2" text-anchor="middle" dominant-baseline="central">)</text>
<text x="24.0" y="182.4" text-anchor="middle" dominant-baseline="central">"</text>
<text x="33.6" y="182.4" text-anchor="middle" dominant-baseline="central">D</text>
<text x="43.2" y="182.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="52.8" y="182.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="62.4" y="182.4" text-anchor="middle" dominant-baseline="central">i</text>
<text x="72.0" y="182.4" text-anchor="middle" dominant-baseline="central">v</text>
<text x="81.6" y="182.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="100.8" y="182.4" text-anchor="middle" dominant-baseline="central">c</text>
<text x="110.4" y="182.4" text-anchor="middle" dominant-baseline="central">h</text>
<text x="120.0" y="182.4" text-anchor="middle" dominant-baseline="central">i</text>
<text x="129.6" y="182.4" text-anchor="middle" dominant-baseline="central">l</text>
<text x="139.2" y="182.4" text-anchor="middle" dominant-baseline="central">d</text>
<text x="158.4" y="182.4" text-anchor="middle" dominant-baseline="central">k</text>
<text x="168.0" y="182.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="177.6" y="182.4" text-anchor="middle" dominant-baseline="central">y</text>
<text x="196.8" y="182.4" text-anchor="middle" dominant-baseline="central">f</text>
<text x="206.4" y="182.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="216.0" y="182.4" text-anchor="middle" dominant-baseline="central">o</text>
<text x="225.6" y="182.4" text-anchor="middle" dominant-baseline="central">m</text>
<text x="244.8" y="182.4" text-anchor="middle" dominant-baseline="central">p</text>
<text x="254.4" y="182.4" text-anchor="middle" dominant-baseline="central">a</text>
<text x="264.0" y="182.4" text-anchor="middle" dominant-baseline="central">r</text>
<text x="273.6" y="182.4" text-anchor="middle" dominant-baseline="central">e</text>
<text x="283.2" y="182.4" text-anchor="middle" dominant-baseline="central">n</text>
<text x="292.8" y="182.4" text-anchor="middle" dominant-baseline="central">t</text>
<text x="302.4" y="182.4" text-anchor="middle" dominant-baseline="central">"</text>
<text x="24.0" y="201.6" text-anchor="middle" dominant-baseline="central">(</text>
<text x="33.6" y="201.6" text-anchor="middle" dominant-baseline="central">h</text>
<text x="43.2" y="201.6" text-anchor="middle" dominant-baseline="central">k</text>
<text x="52.8" y="201.6" text-anchor="middle" dominant-baseline="central">d</text>
<text x="62.4" y="201.6" text-anchor="middle" dominant-baseline="central">f</text>
<text x="72.0" y="201.6" text-anchor="middle" dominant-baseline="central">-</text>
<text x="81.6" y="201.6" text-anchor="middle" dominant-baseline="central">s</text>
<text x="91.2" y="201.6" text-anchor="middle" dominant-baseline="central">h</text>
<text x="100.8" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="110.4" y="201.6" text-anchor="middle" dominant-baseline="central">2</text>
<text x="120.0" y="201.6" text-anchor="middle" dominant-baseline="central">5</text>
<text x="129.6" y="201.6" text-anchor="middle" dominant-baseline="central">6</text>
<text x="148.8" y="201.6" text-anchor="middle" dominant-baseline="central">p</text>
<text x="158.4" y="201.6" text-anchor="middle" dominant-baseline="central">a</text>
<text x="168.0" y="201.6" text-anchor="middle" dominant-baseline="central">r</text>
<text x="177.6" y="201.6" text-anchor="middle" dominant-baseline="central">e</text>
<text x="187.2" y="201.6" text-anchor="middle" dominant-baseline="central">n</text>
<text x="196.8" y="201.6" text-anchor="middle" dominant-baseline="central">t</text>
<text x="148.8" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="158.4" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="168.0" y="220.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="177.6" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="187.2" y="220.8" text-anchor="middle" dominant-baseline="central">:</text>
<text x="206.4" y="220.8" text-anchor="middle" dominant-baseline="central">(</text>
<text x="216.0" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="225.6" y="220.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="235.2" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="244.8" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="254.4" y="220.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="264.0" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="273.6" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="283.2" y="220.8" text-anchor="middle" dominant-baseline="central">-</text>
<text x="292.8" y="220.8" text-anchor="middle" dominant-baseline="central">&gt;</text>
<text x="302.4" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="312.0" y="220.8" text-anchor="middle" dominant-baseline="central">a</text>
<text x="321.6" y="220.8" text-anchor="middle" dominant-baseline="central">l</text>
<text x="331.2" y="220.8" text-anchor="middle" dominant-baseline="central">t</text>
<text x="350.4" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="360.0" y="220.8" text-anchor="middle" dominant-baseline="central">u</text>
<text x="369.6" y="220.8" text-anchor="middle" dominant-baseline="central">r</text>
<text x="379.2" y="220.8" text-anchor="middle" dominant-baseline="central">p</text>
<text x="388.8" y="220.8" text-anchor="middle" dominant-baseline="central">o</text>
<text x="398.4" y="220.8" text-anchor="middle" dominant-baseline="central">s</text>
<text x="408.0" y="220.8" text-anchor="middle" dominant-baseline="central">e</text>
<text x="417.6" y="220.8" text-anchor="middle" dominant-baseline="central">)</text>
<text x="148.8" y="240.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="158.4" y="240.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="168.0" y="240.0" text-anchor="middle" dominant-baseline="central">f</text>
<text x="177.6" y="240.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="187.2" y="240.0" text-anchor="middle" dominant-baseline="central">:</text>
<text x="206.4" y="240.0" text-anchor="middle" dominant-baseline="central">(</text>
<text x="216.0" y="240.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="225.6" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="235.2" y="240.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="244.8" y="240.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="254.4" y="240.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="264.0" y="240.0" text-anchor="middle" dominant-baseline="central">g</text>
<text x="273.6" y="240.0" text-anchor="middle" dominant-baseline="central">-</text>
<text x="283.2" y="240.0" text-anchor="middle" dominant-baseline="central">&gt;</text>
<text x="292.8" y="240.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="302.4" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="312.0" y="240.0" text-anchor="middle" dominant-baseline="central">f</text>
<text x="321.6" y="240.0" text-anchor="middle" dominant-baseline="central">8</text>
<text x="340.8" y="240.0" text-anchor="middle" dominant-baseline="central">(</text>
<text x="350.4" y="240.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="360.0" y="240.0" text-anchor="middle" dominant-baseline="central">y</text>
<text x="369.6" y="240.0" text-anchor="middle" dominant-baseline="central">m</text>
<text x="379.2" y="240.0" text-anchor="middle" dominant-baseline="central">b</text>
<text x="388.8" y="240.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="398.4" y="240.0" text-anchor="middle" dominant-baseline="central">l</text>
<text x="408.0" y="240.0" text-anchor="middle" dominant-baseline="central">-</text>
<text x="417.6" y="240.0" text-anchor="middle" dominant-baseline="central">&gt;</text>
<text x="427.2" y="240.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="436.8" y="240.0" text-anchor="middle" dominant-baseline="central">t</text>
<text x="446.4" y="240.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="456.0" y="240.0" text-anchor="middle" dominant-baseline="central">i</text>
<text x="465.6" y="240.0" text-anchor="middle" dominant-baseline="central">n</text>
<text x="475.2" y="240.0" text-anchor="middle" dominant-baseline="central">g</text>
<text x="494.4" y="240.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="504.0" y="240.0" text-anchor="middle" dominant-baseline="central">u</text>
<text x="513.6" y="240.0" text-anchor="middle" dominant-baseline="central">r</text>
<text x="523.2" y="240.0" text-anchor="middle" dominant-baseline="central">p</text>
<text x="532.8" y="240.0" text-anchor="middle" dominant-baseline="central">o</text>
<text x="542.4" y="240.0" text-anchor="middle" dominant-baseline="central">s</text>
<text x="552.0" y="240.0" text-anchor="middle" dominant-baseline="central">e</text>
<text x="561.6" y="240.0" text-anchor="middle" dominant-baseline="central">)</text>
<text x="571.2" y="240.0" text-anchor="middle" dominant-baseline="central">)</text>
<text x="148.8" y="259.2" text-anchor="middle" dominant-baseline="central">l</text>
<text x="158.4" y="259.2" text-anchor="middle" dominant-baseline="central">e</text>
<text x="168.0" y="259.2" text-anchor="middle" dominant-baseline="central">n</text>
<text x="177.6" y="259.2" text-anchor="middle" dominant-baseline="central">g</text>
<text x="187.2" y="259.2" text-anchor="middle" dominant-baseline="central">t</text>
<text x="196.8" y="259.2" text-anchor="middle" dominant-baseline="central">h</text>
<text x="206.4" y="259.2" text-anchor="middle" dominant-baseline="central">:</text>
<text x="225.6" y="259.2" text-anchor="middle" dominant-baseline="central">3</text>
<text x="235.2" y="259.2" text-anchor="middle" dominant-baseline="central">2</text>
<text x="244.8" y="259.2" text-anchor="middle" dominant-baseline="central">)</text>
<text x="254.4" y="259.2" text-anchor="middle" dominant-baseline="central">)</text>
</svg>
</div>
<h3>Master Key</h3>
<pre class="language-scheme">
;; Master key from key ceremony (RFC-022)
(define (initialize-master-key shares threshold)
  "Reconstruct master key from shares"
  (let ((master (shamir-combine shares threshold)))
    ;; Derive vault key
    (let ((vault-key (derive-key master 'vault)))
      ;; Store encrypted vault key
      (store-encrypted-vault-key vault-key master)
      ;; Clear master from memory
      (secure-clear! master)
      vault-key)))
</pre>
<h3>Key Derivation</h3>
<pre class="language-scheme">
(define (derive-content-key vault-key object-hash)
  "Derive unique key for each object"
  (hkdf-sha256 vault-key
               salt: (string-&gt;utf8 object-hash)
               info: #u8(99 111 110 116 101 110 116)  ; "content"
               length: 32))

(define (derive-chunk-key content-key chunk-index)
  "Derive key for each chunk within object"
  (hkdf-sha256 content-key
               salt: (integer-&gt;bytevector chunk-index)
               info: #u8(99 104 117 110 107)  ; "chunk"
               length: 32))
</pre>
</section>
<section>
<h2>Object Encryption</h2>
<h3>Age Format</h3>
<pre class="language-scheme">
;; Use age for object encryption (RFC-018)
(define (encrypt-object data recipient-keys)
  "Encrypt object using age format"
  (age-encrypt data recipient-keys))

(define (decrypt-object encrypted identity)
  "Decrypt object using age format"
  (age-decrypt encrypted identity))
</pre>
<h3>Symmetric Encryption</h3>
<pre class="language-scheme">
;; For internal encryption with derived keys
(define (encrypt-symmetric data key)
  "Encrypt with ChaCha20-Poly1305"
  (let ((nonce (generate-nonce 12)))
    (let ((ciphertext (chacha20-poly1305-encrypt data key nonce)))
      (bytevector-append nonce ciphertext))))

(define (decrypt-symmetric encrypted key)
  "Decrypt ChaCha20-Poly1305"
  (let ((nonce (subbytevector encrypted 0 12))
        (ciphertext (subbytevector encrypted 12)))
    (chacha20-poly1305-decrypt ciphertext key nonce)))
</pre>
<h3>Streaming Encryption</h3>
<pre class="language-scheme">
(define (encrypt-stream input-port output-port key)
  "Stream encryption for large objects"
  (let ((chunk-size 65536)
        (chunk-index 0))
    (let loop ()
      (let ((chunk (read-bytevector chunk-size input-port)))
        (unless (eof-object? chunk)
          (let ((chunk-key (derive-chunk-key key chunk-index)))
            (write-bytevector (encrypt-symmetric chunk chunk-key) output-port)
            (secure-clear! chunk-key))
          (set! chunk-index (+ chunk-index 1))
          (loop))))))
</pre>
</section>
<section>
<h2>Storage Integration</h2>
<h3>Encrypted CAS</h3>
<pre class="language-scheme">
(define (cas-put-encrypted data)
  "Store encrypted object in CAS"
  (let ((hash (content-hash data))            ; Hash plaintext
         (key (derive-content-key (vault-key) hash))
         (encrypted (encrypt-symmetric data key)))
    (secure-clear! key)
    (storage-put hash encrypted)               ; Store ciphertext
    (soup-put hash encrypted: #t)
    hash))

(define (cas-get-decrypted hash)
  "Retrieve and decrypt object from CAS"
  (let ((encrypted (storage-get hash))
         (key (derive-content-key (vault-key) hash))
         (data (decrypt-symmetric encrypted key)))
    (secure-clear! key)
    ;; Verify hash
    (unless (equal? hash (content-hash data))
      (error "Hash verification failed after decryption"))
    data))
</pre>
<h3>Encrypted Soup</h3>
<pre class="language-scheme">
(define (soup-put-encrypted hash metadata)
  "Store encrypted soup entry"
  (let ((serialized (serialize metadata))
         (key (derive-key (vault-key) 'metadata))
         (encrypted (encrypt-symmetric serialized key)))
    (secure-clear! key)
    (soup-storage-put hash encrypted)))

(define (soup-get-decrypted hash)
  "Retrieve and decrypt soup entry"
  (let ((encrypted (soup-storage-get hash))
         (key (derive-key (vault-key) 'metadata))
         (serialized (decrypt-symmetric encrypted key)))
    (secure-clear! key)
    (deserialize serialized)))
</pre>
<h3>Encrypted Indexes</h3>
<pre class="language-scheme">
;; Searchable encryption for indexes
(define (index-put-encrypted term hash)
  "Add encrypted index entry"
  (let* ((key (derive-key (vault-key) 'index))
         (encrypted-term (deterministic-encrypt term key))
         (encrypted-hash (encrypt-symmetric hash key)))
    (secure-clear! key)
    (index-storage-put encrypted-term encrypted-hash)))

;; Deterministic encryption enables equality search
(define (deterministic-encrypt data key)
  "Deterministic encryption for searchable indexes"
  (let ((derived-key (hkdf-sha256 key salt: data length: 32)))
    (siv-encrypt data derived-key)))
</pre>
</section>
<section>
<h2>Key Management</h2>
<h3>Key Storage</h3>
<pre class="language-scheme">
;; Keys encrypted with master key
(define (store-vault-key vault-key master-key)
  "Store vault key encrypted with master key"
  (let ((encrypted (encrypt-symmetric vault-key master-key)))
    (write-file (vault-key-path) encrypted)))

;; Keys can also be stored as SPKI-encrypted blobs
(define (store-key-for-principal key principal)
  "Store key encrypted for specific principal"
  (let* ((encrypted (age-encrypt key (list (principal-public-key principal))))
         (hash (cas-put encrypted)))
    (soup-put hash
      type: 'encrypted-key
      recipient: principal)
    hash))
</pre>
<h3>Key Rotation</h3>
<pre class="language-scheme">
(define (rotate-vault-key)
  "Rotate vault encryption key"
  (let ((old-key (vault-key))
        (new-key (generate-key 32)))

    (audit-append action: 'key-rotation-start)

    ;; Re-encrypt all objects
    (for-each (lambda (hash)
                (let* ((encrypted (storage-get hash))
                       (data (decrypt-symmetric encrypted old-key))
                       (new-encrypted (encrypt-symmetric data new-key)))
                  (storage-put hash new-encrypted)))
              (all-object-hashes))

    ;; Update vault key
    (set-vault-key! new-key)
    (secure-clear! old-key)

    (audit-append action: 'key-rotation-complete)))
</pre>
<h3>Key Escrow</h3>
<pre class="language-scheme">
;; Threshold key escrow for recovery
(define (escrow-vault-key vault-key custodians threshold)
  "Split vault key among custodians"
  (let ((shares (shamir-split vault-key (length custodians) threshold)))
    (for-each (lambda (custodian share)
                (let ((encrypted-share
                       (age-encrypt share (list (custodian-public-key custodian)))))
                  (send-to-custodian custodian encrypted-share)))
              custodians shares)))

(define (recover-vault-key custodian-shares)
  "Recover vault key from custodian shares"
  (let ((decrypted-shares
         (map (lambda (share custodian)
                (age-decrypt share (custodian-identity custodian)))
              custodian-shares custodians)))
    (shamir-combine decrypted-shares)))
</pre>
</section>
<section>
<h2>Access Control</h2>
<h3>Key Access</h3>
<pre class="language-scheme">
;; Keys protected by capabilities
(spki-cert
  (issuer vault-admin)
  (subject data-processor)
  (capability
    (action decrypt)
    (object (type 'content)))
  (validity (not-after "2027-01-01")))

(define (authorized-decrypt? principal hash)
  "Check if principal can decrypt object"
  (has-capability? principal 'decrypt hash))
</pre>
<h3>Envelope Encryption</h3>
<pre class="language-scheme">
;; Object encrypted with DEK, DEK encrypted with KEK
(define (envelope-encrypt data recipients)
  "Envelope encryption for multiple recipients"
  (let ((dek (generate-key 32))                      ; Data Encryption Key
         (encrypted-data (encrypt-symmetric data dek))
         (encrypted-deks                              ; KEK per recipient
          (map (lambda (recipient)
                 (age-encrypt dek (list recipient)))
               recipients)))
    `(envelope
      (encrypted-data . ,encrypted-data)
      (encrypted-keys . ,encrypted-deks))))

(define (envelope-decrypt envelope identity)
  "Decrypt envelope"
  (let ((encrypted-deks (assoc-ref envelope 'encrypted-keys))
         (dek (find-and-decrypt-dek encrypted-deks identity))
         (encrypted-data (assoc-ref envelope 'encrypted-data)))
    (decrypt-symmetric encrypted-data dek)))
</pre>
</section>
<section>
<h2>Secure Memory</h2>
<h3>Key Handling</h3>
<pre class="language-scheme">
;; Keys must be handled carefully in memory
(define (with-key key-source proc)
  "Use key with automatic cleanup"
  (let ((key (key-source)))
    (dynamic-wind
      (lambda () #t)
      (lambda () (proc key))
      (lambda () (secure-clear! key)))))

(define (secure-clear! bytevector)
  "Securely zero memory"
  (bytevector-fill! bytevector 0)
  ;; Prevent compiler optimization
  (memory-barrier))
</pre>
<h3>Memory Protection</h3>
<pre class="language-scheme">
;; Lock key pages in memory (prevent swap)
(define (allocate-secure-memory size)
  (let ((mem (allocate-memory size)))
    (mlock mem size)
    mem))

(define (free-secure-memory mem size)
  (secure-clear! mem)
  (munlock mem size)
  (free-memory mem))
</pre>
</section>
<section>
<h2>Volume Encryption</h2>
<h3>LUKS Integration</h3>
<pre class="language-scheme">
;; Storage volume encryption
(define (setup-encrypted-volume device passphrase)
  "Initialize LUKS encrypted volume"
  (run-command "cryptsetup" "luksFormat" device)
  (run-command "cryptsetup" "luksOpen" device "vault-storage"))

(define (mount-encrypted-volume passphrase)
  "Mount encrypted storage volume"
  (run-command "cryptsetup" "luksOpen"
               (storage-device)
               "vault-storage"
               stdin: passphrase)
  (run-command "mount" "/dev/mapper/vault-storage" (storage-path)))
</pre>
<h3>Hardware Security Modules</h3>
<pre class="language-scheme">
;; HSM for key protection
(define (hsm-generate-key hsm-slot)
  "Generate key in HSM"
  (pkcs11-generate-key
    session: (hsm-session)
    slot: hsm-slot
    mechanism: 'aes-256
    extractable: #f))

(define (hsm-encrypt data key-handle)
  "Encrypt using HSM-held key"
  (pkcs11-encrypt
    session: (hsm-session)
    key: key-handle
    mechanism: 'aes-gcm
    data: data))
</pre>
</section>
<section>
<h2>Audit</h2>
<h3>Encryption Audit</h3>
<pre class="language-scheme">
(define (audit-encryption-operation op hash principal)
  "Log encryption operation"
  (audit-append
    action: op
    hash: hash
    principal: principal
    timestamp: (current-time)
    ;; Never log keys or plaintext!
    ))

;; Audit all key operations
(define (audit-key-operation op key-id principal)
  (audit-append
    action: op
    key-id: key-id
    principal: principal
    timestamp: (current-time)))
</pre>
<h3>Compliance Reporting</h3>
<pre class="language-scheme">
(define (encryption-compliance-report)
  "Generate encryption compliance report"
  `((total-objects . ,(count-objects))
    (encrypted-objects . ,(count-encrypted-objects))
    (encryption-coverage . ,(/ (count-encrypted-objects) (count-objects)))
    (key-rotation-date . ,(last-key-rotation))
    (algorithm . "ChaCha20-Poly1305")
    (key-length . 256)))
</pre>
</section>
<section>
<h2>Performance</h2>
<h3>Encryption Overhead</h3>
<pre class="language-scheme">
;; Benchmark encryption overhead
(define (benchmark-encryption size iterations)
  (let ((data (generate-random-bytes size))
        (key (generate-key 32)))
    (time-iterations iterations
      (encrypt-symmetric data key))))
</pre>
<h3>Hardware Acceleration</h3>
<pre class="language-scheme">
;; Use AES-NI when available
(define (select-cipher)
  (if (cpu-supports-aes-ni?)
      'aes-256-gcm
      'chacha20-poly1305))
</pre>
</section>
<section>
<h2>Security Considerations</h2>
<h3>Key Compromise</h3>
<pre class="language-scheme">
;; If key is compromised
(define (handle-key-compromise compromised-key-id)
  "Emergency response to key compromise"
  ;; Immediate key rotation
  (rotate-vault-key)

  ;; Audit trail
  (audit-append action: 'key-compromise
                key-id: compromised-key-id
                priority: 'critical)

  ;; Notify administrators
  (alert-key-compromise compromised-key-id)

  ;; Re-encrypt with new key
  (re-encrypt-all-objects))
</pre>
<h3>Side Channels</h3>
<pre class="language-scheme">
;; Constant-time operations
(define (constant-time-compare a b)
  "Compare without timing leaks"
  (let ((result 0))
    (do ((i 0 (+ i 1)))
        ((= i (bytevector-length a)) (= result 0))
      (set! result (bitwise-ior result
                    (bitwise-xor (bytevector-u8-ref a i)
                                 (bytevector-u8-ref b i)))))))
</pre>
</section>
<section>
<h2>References</h2>
<p>1. [age](https://age-encryption.org/) - Modern file encryption 2. [LUKS](https://gitlab.com/cryptsetup/cryptsetup) - Linux Unified Key Setup 3. [RFC-022: Key Ceremony Protocol](rfc-022-key-ceremony.html) 4. [RFC-018: Sealed Archive Format](rfc-018-sealed-archive.html)</p>
</section>
<section>
<h2>Changelog</h2>
<ul>
<li>2026-01-07</li>
<li>Initial draft</li>
</ul>
</section>
<script>
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
(function() {
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script>
</body>
</html>
