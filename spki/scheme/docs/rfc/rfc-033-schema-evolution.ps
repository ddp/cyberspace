%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Fri Jan  9 11:29:12 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 7
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-033: Schema Ev)72 12 Q(olution)-.2 E 1.95(*\
*Status:** Draft **Date:** January 2026 **Author:** Derrell Piper <ddp@\
eludom.net> **Implementation:**)72 36 R(Proposed)72 48 Q(---)72 72 Q
(Abstract)72 96 Q .532(This RFC speci\214es schema e)72 120 R -.2(vo)
-.25 G .532(lution for the Library of Cyberspace: ho).2 F 3.033(ws)-.25
G .533(oup metadata schemas change o)-3.033 F -.15(ve)-.15 G 3.033(rt)
.15 G(ime)-3.033 E .096(while maintaining backw)72 132 R .096
(ard compatibility)-.1 F 2.596(,m)-.65 G .096
(igration paths, and query consistenc)-2.596 F 1.396 -.65(y. S)-.15 H
.096(chemas are themselv).65 F .095(es content-)-.15 F
(addressed objects.)72 144 Q(---)72 168 Q(Moti)72 192 Q -.25(va)-.25 G
(tion).25 E(Data outli)72 216 Q -.15(ve)-.25 G 2.5(sc).15 G(ode:)-2.5 E
3.776(-*)72 240 S 1.276(*Long-term preserv)-3.776 F 1.276
(ation** - Data must remain readable for centuries - **Softw)-.25 F
1.276(are updates** - Ne)-.1 F 3.776(wv)-.25 G(ersions)-3.926 E .287
(need ne)72 252 R 2.787<778c>-.25 G .287(elds - **Federation** - Dif)
-2.787 F .287(ferent v)-.25 F .287(aults may ha)-.25 F .586 -.15(ve d)
-.2 H(if).15 E .286(ferent schema v)-.25 F .286
(ersions - **Rollback** - Must han-)-.15 F(dle do)72 264 Q
(wngrades gracefully)-.25 E(Schema e)72 288 Q -.2(vo)-.25 G
(lution must be:).2 E 4.075(-*)72 312 S 1.575(*Non-breaking** - Old dat\
a remains accessible - **Bidirectional** - Upgrade and do)-4.075 F 1.576
(wngrade paths - **Ex-)-.25 F(plicit** - Changes documented and v)72 324
Q(ersioned - **V)-.15 E(eri\214able** - Schema v)-1.11 E
(alidation at boundaries)-.25 E(---)72 348 Q(Schema Model)72 372 Q
(Schema De\214nition)72 396 Q -.74(```)72 420 S
(scheme \(de\214ne-schema ').74 E(document)-.5 E(\(v)77 432 Q
(ersion 1\))-.15 E(\(\214elds)77 444 Q
(\(hash \(type string\) \(required #t\) \(inde)82 456 Q -.15(xe)-.15 G
2.5(d#).15 G(t\)\))-2.5 E(\(name \(type string\) \(required #t\)\))82
468 Q(\(content-type \(type string\) \(required #t\)\))82 480 Q
(\(size \(type inte)82 492 Q(ger\) \(required #t\)\))-.15 E
(\(created \(type timestamp\) \(required #t\)\))82 504 Q
(\(modi\214ed \(type timestamp\) \(required #f\)\))82 516 Q
(\(author \(type principal\) \(required #f\)\))82 528 Q
(\(tags \(type \(list string\)\) \(required #f\) \(def)82 540 Q
(ault '\(\)\)\)\)\) `)-.1 E -.74(``)-.74 G
(Schema as Content-Addressed Object)72 564 Q -.74(```)72 588 S
(scheme ;; Schemas are soup objects \(soup-object).74 E
(\(hash "sha256:schema-hash..."\))77 600 Q(\(type schema\))77 612 Q
(\(name document\))77 624 Q(\(v)77 636 Q(ersion 1\))-.15 E
(\(\214elds ...\))77 648 Q(\(created "2026-01-01"\)\))77 660 Q
(;; Reference schema by hash for reproducibility \(de\214ne \(v)72 684 Q
(alidate-ag)-.25 E(ainst-schema obj schema-hash\))-.05 E
(\(let \(\(schema \(soup-get schema-hash\)\)\))77 696 Q(\(v)82 708 Q
(alidate-object obj schema\)\)\) `)-.25 E -.74(``)-.74 G(Schema Re)72
732 Q(gistry)-.15 E -.74(```)72 756 S(scheme \(de\214ne schema-re).74 E
(gistry \(mak)-.15 E(e-hash-table\)\))-.1 E(\(de\214ne \(re)72 780 Q
(gister)-.15 E(-schema! schema\))-.2 E
(\(let* \(\(name \(schema-name schema\)\))77 792 Q 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(v)94.5 12 Q(ersion \(schema-v)-.15 E
(ersion schema\)\))-.15 E(\(hash \(soup-put schema type: ')94.5 24 Q
(schema\)\)\))-.55 E(\(hash-table-set! schema-re)82 36 Q
(gistry \(cons name v)-.15 E(ersion\) hash\))-.15 E
(\(audit-append action: ')82 48 Q(schema-re)-.55 E(gistered)-.15 E
(name: name)117 60 Q -.15(ve)117 72 S(rsion: v).15 E(ersion)-.15 E
(hash: hash\))117 84 Q(hash\)\))82 96 Q
(\(de\214ne \(get-schema name #!optional v)72 120 Q(ersion\))-.15 E
("Get schema by name and optional v)77 132 Q(ersion")-.15 E(\(if v)77
144 Q(ersion)-.15 E(\(soup-get \(hash-table-ref schema-re)87 156 Q
(gistry \(cons name v)-.15 E(ersion\)\)\))-.15 E
(\(get-latest-schema name\)\)\) `)87 168 Q -.74(``)-.74 G(---)72 192 Q
(Ev)72 216 Q(olution Rules)-.2 E(Compatible Changes)72 240 Q -.74(```)72
264 S(scheme ;; These changes are backw).74 E
(ard compatible \(de\214ne compatible-changes)-.1 E 12.5
('\(add-optional-\214eld ;)77 276 R(Ne)2.5 E 2.5<778c>-.25 G
(eld with def)-2.5 E(ault)-.1 E(add-inde)82 288 Q 37.5(x;)-.15 G(Ne)-35
E 2.5(wi)-.25 G(nde)-2.5 E 2.5(xo)-.15 G 2.5(ne)-2.5 G(xisting \214eld)
-2.65 E 32.5(widen-type ;)82 300 R(inte)2.5 E(ger -> number)-.15 E 17.5
(relax-constraint ;)82 312 R(required -> optional)2.5 E(add-enum-v)82
324 Q 17.5(alue\)\) ;)-.25 F(Extend enumeration)2.5 E
(\(de\214ne \(change-compatible? old-schema ne)72 348 Q(w-schema\))-.25
E("Check if schema change is backw)77 360 Q(ard compatible")-.1 E
(\(let \(\(changes \(dif)77 372 Q(f-schemas old-schema ne)-.25 E
(w-schema\)\)\))-.25 E(\(e)82 384 Q -.15(ve)-.25 G
(ry compatible-change? changes\)\)\) `).15 E -.74(``)-.74 G
(Breaking Changes)72 408 Q -.74(```)72 432 S
(scheme ;; These changes require migration \(de\214ne breaking-changes)
.74 E('\(remo)77 444 Q -.15(ve)-.15 G 27.5(-\214eld ;).15 F
(Field no longer e)2.5 E(xists)-.15 E 12.5(add-required-\214eld ;)82 456
R(Ne)2.5 E 2.5(wr)-.25 G(equired \214eld without def)-2.5 E(ault)-.1 E
(narro)82 468 Q 30(w-type ;)-.25 F(number -> inte)2.5 E(ger)-.15 E 12.5
(tighten-constraint ;)82 480 R(optional -> required)2.5 E(remo)82 492 Q
-.15(ve)-.15 G(-enum-v).15 E 15(alue ;)-.25 F(Shrink enumeration)2.5 E
22.5(rename-\214eld\)\) ;)82 504 R(Field name changed)2.5 E
(\(de\214ne \(requires-migration? old-schema ne)72 528 Q(w-schema\))-.25
E("Check if migration needed")77 540 Q(\(let \(\(changes \(dif)77 552 Q
(f-schemas old-schema ne)-.25 E(w-schema\)\)\))-.25 E(\(an)82 564 Q 2.5
(yb)-.15 G(reaking-change? changes\)\)\) `)-2.5 E -.74(``)-.74 G(---)72
588 Q -1.11(Ve)72 612 S(rsion Management)1.11 E(Semantic V)72 636 Q
(ersioning)-1.11 E -.74(```)72 660 S(scheme ;; Schema v).74 E
(ersions follo)-.15 E 2.5(ws)-.25 G(emv)-2.5 E(er \(de\214ne \(schema-v)
-.15 E(ersion-compare v1 v2\))-.15 E(\(let \(\(major1 \(v)77 672 Q
(ersion-major v1\)\) \(major2 \(v)-.15 E(ersion-major v2\)\))-.15 E
(\(minor1 \(v)92 684 Q(ersion-minor v1\)\) \(minor2 \(v)-.15 E
(ersion-minor v2\)\))-.15 E(\(patch1 \(v)92 696 Q
(ersion-patch v1\)\) \(patch2 \(v)-.15 E(ersion-patch v2\)\)\))-.15 E
(\(cond)82 708 Q(\(\(not \(= major1 major2\)\) \(- major1 major2\)\))87
720 Q(\(\(not \(= minor1 minor2\)\) \(- minor1 minor2\)\))87 732 Q
(\(else \(- patch1 patch2\)\)\)\)\))87 744 Q
(;; Major: breaking changes ;; Minor: compatible additions ;; P)72 768 Q
(atch: documentation/\214x)-.15 E(es `)-.15 E -.74(``)-.74 G -1.11(Ve)72
792 S(rsion History)1.11 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.74(```)72 24 S
(scheme \(de\214ne \(schema-history name\)).74 E("Get all v)77 36 Q
(ersions of a schema")-.15 E(\(soup-query type: ')77 48 Q(schema)-.55 E
(name: name)107 60 Q(order)107 72 Q(-by: '\(\(v)-.2 E
(ersion desc\)\)\)\))-.15 E(\(de\214ne \(schema-lineage name v)72 96 Q
(ersion\))-.15 E("Get e)77 108 Q -.2(vo)-.25 G(lution path to current v)
.2 E(ersion")-.15 E(\(let \(\(schema \(get-schema name v)77 120 Q
(ersion\)\)\))-.15 E(\(if \(schema-parent schema\))82 132 Q
(\(cons schema \(schema-lineage name \(schema-parent-v)92 144 Q
(ersion schema\)\)\))-.15 E(\(list schema\)\)\)\) `)92 156 Q -.74(``)
-.74 G(---)72 180 Q(Migration)72 204 Q(Migration De\214nition)72 228 Q
-.74(```)72 252 S(scheme \(de\214ne-migration ').74 E(document-v1-to-v2)
-.5 E(\(from-schema ')77 264 Q(document \(v)-.5 E(ersion 1\)\))-.15 E
(\(to-schema ')77 276 Q(document \(v)-.5 E(ersion 2\)\))-.15 E
(\(up \(lambda \(obj\))77 288 Q(;; Add ne)92 300 Q 2.5<778c>-.25 G
(eld with def)-2.5 E(ault)-.1 E(\(assoc-set obj ')92 312 Q
(visibility 'pri)-.5 E -.25(va)-.25 G(te\)\)\)).25 E(\(do)77 324 Q
(wn \(lambda \(obj\))-.25 E(;; Remo)97 336 Q .3 -.15(ve n)-.15 H .5 -.25
(ew \214).15 H(eld).25 E(\(assoc-remo)97 348 Q .3 -.15(ve o)-.15 H(bj ')
.15 E(visibility\)\)\)\) `)-.5 E -.74(``)-.74 G(Migration Ex)72 372 Q
(ecution)-.15 E -.74(```)72 396 S
(scheme \(de\214ne \(migrate-object obj from-v).74 E(ersion to-v)-.15 E
(ersion\))-.15 E("Migrate object between schema v)77 408 Q(ersions")-.15
E(\(let \(\(migrations \(\214nd-migration-path from-v)77 420 Q
(ersion to-v)-.15 E(ersion\)\)\))-.15 E
(\(fold \(lambda \(migration obj\))82 432 Q
(\(\(migration-up migration\) obj\)\))102 444 Q(obj)97 456 Q
(migrations\)\)\))97 468 Q(\(de\214ne \(\214nd-migration-path from to\))
72 492 Q("Find sequence of migrations between v)77 504 Q(ersions")-.15 E
(\(let \(\(direction \(if \(> to from\) 'up ')77 516 Q(do)-.5 E
(wn\)\)\))-.25 E(\(\214lter \(lambda \(m\))82 528 Q
(\(and \(eq? \(migration-direction m\) direction\))107 540 Q(\(v)119.5
552 Q(ersion-in-range? \(migration-from m\) from to\)\)\))-.15 E
(\(all-migrations\)\)\)\) `)102 564 Q -.74(``)-.74 G(Lazy Migration)72
588 Q -.74(```)72 612 S(scheme ;; Migrate on read, not on upgrade \(de\
\214ne \(soup-get-migrated hash\)).74 E
("Get object, migrating if necessary")77 624 Q
(\(let* \(\(obj \(soup-get-ra)77 636 Q 2.5(wh)-.15 G(ash\)\))-2.5 E
(\(obj-v)94.5 648 Q(ersion \(object-schema-v)-.15 E(ersion obj\)\))-.15
E(\(current-v)94.5 660 Q(ersion \(current-schema-v)-.15 E
(ersion \(object-type obj\)\)\)\))-.15 E(\(if \(= obj-v)82 672 Q
(ersion current-v)-.15 E(ersion\))-.15 E(obj)92 684 Q
(\(let \(\(migrated \(migrate-object obj obj-v)92 696 Q
(ersion current-v)-.15 E(ersion\)\)\))-.15 E
(;; Optionally persist migrated v)97 708 Q(ersion)-.15 E
(\(when *persist-migrations*)97 720 Q(\(soup-put-ra)102 732 Q 2.5(wm)
-.15 G(igrated\)\))-2.5 E(migrated\)\)\)\) `)97 744 Q -.74(``)-.74 G
(Batch Migration)72 768 Q -.74(```)72 792 S
(scheme \(de\214ne \(batch-migrate schema-name from-v).74 E(ersion to-v)
-.15 E(ersion\))-.15 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF("Migrate all objects of a schema")77 12 Q
(\(let \(\(objects \(soup-query type: schema-name)77 24 Q(schema-v)144.5
36 Q(ersion: from-v)-.15 E(ersion\)\)\))-.15 E(\(for)82 48 Q
(-each \(lambda \(obj\))-.2 E
(\(let \(\(migrated \(migrate-object obj from-v)112 60 Q(ersion to-v)
-.15 E(ersion\)\)\))-.15 E(\(soup-update \(object-hash obj\) migrated\))
117 72 Q(\(audit-append action: 'object-migrated)117 84 Q
(hash: \(object-hash obj\))152 96 Q(from: from-v)152 108 Q(ersion)-.15 E
(to: to-v)152 120 Q(ersion\)\)\))-.15 E(objects\)\)\) `)107 132 Q -.74
(``)-.74 G(---)72 156 Q -1.11(Va)72 180 S(lidation)1.11 E(Schema V)72
204 Q(alidation)-1.11 E -.74(```)72 228 S(scheme \(de\214ne \(v).74 E
(alidate-object obj schema\))-.25 E("V)77 240 Q(alidate object ag)-1.11
E(ainst schema")-.05 E(\(let \(\(errors '\(\)\)\))77 252 Q
(;; Check required \214elds)82 264 Q(\(for)82 276 Q
(-each \(lambda \(\214eld\))-.2 E
(\(when \(and \(\214eld-required? \214eld\))112 288 Q
(\(not \(assoc-ref obj \(\214eld-name \214eld\)\)\)\))139.5 300 Q
(\(set! errors \(cons `\(missing-required ,\(\214eld-name \214eld\)\))
117 312 Q(errors\)\)\)\))162 324 Q(\(schema-\214elds schema\)\))107 336
Q(;; Check \214eld types)82 360 Q(\(for)82 372 Q
(-each \(lambda \(pair\))-.2 E(\(let* \(\(name \(car pair\)\))112 384 Q
(\(v)129.5 396 Q(alue \(cdr pair\)\))-.25 E
(\(\214eld \(schema-\214eld schema name\)\)\))129.5 408 Q
(\(when \(and \214eld \(not \(type-matches? v)117 420 Q
(alue \(\214eld-type \214eld\)\)\)\))-.25 E
(\(set! errors \(cons `\(type-mismatch ,name\) errors\)\)\)\)\))122 432
Q(obj\))107 444 Q(\(if \(null? errors\))82 468 Q(\(result-ok obj\))92
480 Q(\(result-err errors\)\)\)\) `)92 492 Q -.74(``)-.74 G -1.11(Va)72
516 S(lidation Modes)1.11 E -.74(```)72 540 S(scheme \(de\214ne v).74 E
(alidation-mode \(mak)-.25 E(e-parameter ')-.1 E(strict\)\))-.55 E
(\(de\214ne \(v)72 564 Q(alidate-with-mode obj schema\))-.25 E
(\(case \(v)77 576 Q(alidation-mode\))-.25 E(\(\(strict\))82 588 Q
(;; All \214elds must match schema)84.5 600 Q(\(v)84.5 612 Q
(alidate-object obj schema\)\))-.25 E(\(\(permissi)82 624 Q -.15(ve)-.25
G(\)).15 E(;; Extra \214elds allo)84.5 636 Q(wed)-.25 E(\(v)84.5 648 Q
(alidate-required-\214elds obj schema\)\))-.25 E(\(\(w)82 660 Q(arn\))
-.1 E(;; Log w)84.5 672 Q(arnings b)-.1 E(ut don')-.2 E 2.5(tf)-.18 G
(ail)-2.6 E(\(let \(\(result \(v)84.5 684 Q
(alidate-object obj schema\)\)\))-.25 E(\(when \(result-err? result\))
89.5 696 Q(\(log-w)94.5 708 Q(arn "V)-.1 E
(alidation errors" errors: \(result-error result\)\)\))-1.11 E
(\(result-ok obj\)\)\)\)\) `)89.5 720 Q -.74(``)-.74 G(---)72 744 Q
(Federation Compatibility)72 768 Q(Schema Ne)72 792 Q(gotiation)-.15 E 0
Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF -.74(```)72 24 S(scheme \(de\214ne \(ne).74 E
(gotiate-schema peer schema-name\))-.15 E("Ne)77 36 Q
(gotiate compatible schema v)-.15 E(ersion with peer")-.15 E
(\(let* \(\(local-v)77 48 Q(ersions \(local-schema-v)-.15 E
(ersions schema-name\)\))-.15 E(\(peer)94.5 60 Q(-v)-.2 E
(ersions \(request-schema-v)-.15 E(ersions peer schema-name\)\))-.15 E
(\(compatible \(intersection local-v)94.5 72 Q(ersions peer)-.15 E(-v)
-.2 E(ersions\)\)\))-.15 E(\(if \(null? compatible\))82 84 Q
(\(error 'no-compatible-schema\))92 96 Q(\(max compatible\)\)\)\))92 108
Q(\(de\214ne \(sync-with-schema-v)72 132 Q(ersion peer schema-name v)
-.15 E(ersion\))-.15 E("Sync objects using ne)77 144 Q
(gotiated schema v)-.15 E(ersion")-.15 E(\(for)77 156 Q
(-each \(lambda \(obj\))-.2 E(\(let \(\(con)107 168 Q -.15(ve)-.4 G
(rted \(con).15 E -.15(ve)-.4 G(rt-to-v).15 E(ersion obj v)-.15 E
(ersion\)\)\))-.15 E(\(send-object peer con)112 180 Q -.15(ve)-.4 G
(rted\)\)\)).15 E(\(objects-to-sync schema-name\)\)\) `)102 192 Q -.74
(``)-.74 G(Cross-V)72 216 Q(ersion Queries)-1.11 E -.74(```)72 240 S
(scheme \(de\214ne \(query-with-v).74 E(ersion-tolerance query\))-.15 E
("Query that handles mix)77 252 Q(ed schema v)-.15 E(ersions")-.15 E
(\(let* \(\(results \(soup-query-ra)77 264 Q 2.5(wq)-.15 G(uery\)\))-2.5
E(\(current-v)94.5 276 Q(ersion \(current-schema-v)-.15 E
(ersion \(query-type query\)\)\)\))-.15 E(\(map \(lambda \(obj\))82 288
Q(\(if \(= \(object-schema-v)99.5 300 Q(ersion obj\) current-v)-.15 E
(ersion\))-.15 E(obj)109.5 312 Q(\(migrate-object obj \(object-schema-v)
109.5 324 Q(ersion obj\) current-v)-.15 E(ersion\)\)\))-.15 E
(results\)\)\) `)94.5 336 Q -.74(``)-.74 G(---)72 360 Q
(Schema Introspection)72 384 Q(Schema Queries)72 408 Q -.74(```)72 432 S
(scheme ;; What schemas e).74 E 2.5(xist? \(soup-query)-.15 F(type: ')
2.5 E(schema\))-.55 E(;; What v)72 456 Q(ersions of a schema?)-.15 E
(\(soup-query type: ')5 E(schema name: ')-.55 E(document\))-.5 E
(;; What \214elds in a schema?)72 480 Q
(\(schema-\214elds \(get-schema ')5 E(document 2\)\))-.5 E
(;; Schema dependenc)72 504 Q 2.5(yg)-.15 G
(raph \(de\214ne \(schema-dependencies schema\))-2.5 E(\(\214lter)77 516
Q(-map \(lambda \(\214eld\))-.2 E
(\(when \(schema-reference? \(\214eld-type \214eld\)\))112 528 Q
(\(\214eld-type-tar)117 540 Q(get \214eld\)\)\))-.18 E
(\(schema-\214elds schema\)\)\) `)107 552 Q -.74(``)-.74 G
(Schema Documentation)72 576 Q -.74(```)72 600 S
(scheme \(de\214ne-schema ').74 E(document)-.5 E(\(v)77 612 Q
(ersion 2\))-.15 E(\(description "A document stored in the v)77 624 Q
(ault"\))-.25 E(\(\214elds)77 636 Q(\(hash)82 648 Q(\(type string\))87
660 Q(\(required #t\))87 672 Q(\(inde)87 684 Q -.15(xe)-.15 G 2.5(d#).15
G(t\))-2.5 E(\(description "Content-addressed hash of document"\)\))87
696 Q(\(name)82 708 Q(\(type string\))87 720 Q(\(required #t\))87 732 Q
(\(description "Human-readable document name"\))87 744 Q(\(e)87 756 Q
(xample "RFC-033-schema-e)-.15 E -.2(vo)-.25 G(lution.md"\)\)\)\) `).2 E
-.74(``)-.74 G(---)72 780 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(Def)72 12 Q(ault V)-.1 E(alues)-1.11 E
(Static Def)72 36 Q(aults)-.1 E -.74(```)72 60 S
(scheme \(de\214ne-schema ').74 E(document)-.5 E(\(v)77 72 Q(ersion 2\))
-.15 E(\(\214elds)77 84 Q(\(visibility)82 96 Q(\(type enum\))87 108 Q
(\(v)87 120 Q(alues \(public pri)-.25 E -.25(va)-.25 G
(te restricted\)\)).25 E(\(def)87 132 Q(ault 'pri)-.1 E -.25(va)-.25 G
(te\)\)).25 E(\(tags)82 144 Q(\(type \(list string\)\))87 156 Q(\(def)87
168 Q(ault '\(\)\)\)\)\) `)-.1 E -.74(``)-.74 G(Computed Def)72 192 Q
(aults)-.1 E -.74(```)72 216 S(scheme \(de\214ne-schema ').74 E
(document)-.5 E(\(v)77 228 Q(ersion 2\))-.15 E(\(\214elds)77 240 Q
(\(created)82 252 Q(\(type timestamp\))87 264 Q(\(def)87 276 Q
(ault \(current-time\)\)\))-.1 E(\(id)82 288 Q(\(type string\))87 300 Q
(\(def)87 312 Q(ault \(generate-uuid\)\)\)\)\) `)-.1 E -.74(``)-.74 G
(Migration Def)72 336 Q(aults)-.1 E -.74(```)72 360 S(scheme ;; Def).74
E(ault for objects migrated from v1 to v2 \(de\214ne-migration ')-.1 E
(document-v1-to-v2)-.5 E(\(def)77 372 Q(aults)-.1 E
(\(visibility \(lambda \(obj\))82 384 Q(;; Infer from e)117 396 Q
(xisting data)-.15 E(\(if \(assoc-ref obj 'public\))117 408 Q('public)
127 420 Q('pri)127 432 Q -.25(va)-.25 G(te\)\)\)\)\) `).25 E -.74(``)
-.74 G(---)72 456 Q(Security Considerations)72 480 Q(Schema T)72 504 Q
(ampering)-.8 E -.74(```)72 528 S(scheme ;; Schemas are content-address\
ed - tampering detectable \(de\214ne \(v).74 E(erify-schema-inte)-.15 E
(grity schema-hash\))-.15 E
(\(let* \(\(schema \(soup-get schema-hash\)\))77 540 Q
(\(computed-hash \(content-hash \(serialize schema\)\)\)\))94.5 552 Q
(\(equal? schema-hash computed-hash\)\)\) `)82 564 Q -.74(``)-.74 G
(Migration Authorization)72 588 Q -.74(```)72 612 S
(scheme ;; Migrations require capability \(spki-cert).74 E(\(issuer v)77
624 Q(ault-admin\))-.25 E(\(subject schema-admin\))77 636 Q
(\(capability)77 648 Q(\(action migrate-schema\))82 660 Q
(\(object \(schema ')82 672 Q(document\)\)\))-.5 E(\(v)77 684 Q
(alidity \(not-after "2027-01-01"\)\)\) `)-.25 E -.74(``)-.74 G(---)72
708 Q(References)72 732 Q .552(1. [Protocol Buf)72 756 R .551
(fers - Updating A Message T)-.25 F(ype]\(https://de)-.8 E -.15(ve)-.25
G(lopers.google.com/protocol-b).15 E(uf)-.2 E(fers/docs/proto#updat-)
-.25 E .666(ing\) 2. [A)72 768 R .667(vro Schema Ev)-.74 F
(olution]\(https://a)-.2 E(vro.apache.or)-.2 E .667
(g/docs/current/spec.html#Schema+Resolution\) 3. [RFC-020:)-.18 F .904(\
Content-Addressed Storage]\(rfc-020-content-addressed-storage.md\) 4. [\
RFC-025: Query Language]\(rfc-025-query-)72 780 R(language.md\))72 792 Q
0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(---)72 24 Q(Changelog)72 48 Q 2.5(-*)72 72 S
(*2026-01-07** - Initial draft)-2.5 E(---)72 96 Q 1.571
(**Implementation Status:** Draft **Dependencies:** soup, cas **Inte)72
120 R 1.571(gration:** Soup queries, federation, long-)-.15 F
(term preserv)72 132 Q(ation)-.25 E 0 Cg EP
%%Trailer
end
%%EOF
