%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Thu Jan  8 15:17:54 2026
%%DocumentNeededResources: font Times-Roman
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 7
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(RFC-033: Schema Ev)72 12 Q(olution)-.2 E(Status\
: Draft Date: January 2026 Author: Derrell Piper ddp@eludom.net Impleme\
ntation: Proposed)72 36 Q(---------------------------------------------\
---------------------------------)72 60 Q(Abstract)72 84 Q .533
(This RFC speci\214es schema e)72 108 R -.2(vo)-.25 G .533
(lution for the Library of Cyberspace: ho).2 F 3.032(ws)-.25 G .532
(oup metadata schemas change o)-3.032 F -.15(ve)-.15 G 3.032(rt).15 G
(ime)-3.032 E .095(while maintaining backw)72 120 R .096
(ard compatibility)-.1 F 2.596(,m)-.65 G .096
(igration paths, and query consistenc)-2.596 F 1.396 -.65(y. S)-.15 H
.096(chemas are themselv).65 F .096(es content-)-.15 F
(addressed objects.)72 132 Q(------------------------------------------\
------------------------------------)72 156 Q(Moti)72 180 Q -.25(va)-.25
G(tion).25 E(Data outli)72 204 Q -.15(ve)-.25 G 2.5(sc).15 G(ode:)-2.5 E
3.609(-L)72 228 S 1.109(ong-term preserv)-3.609 F 1.109
(ation - Data must remain readable for centuries - Softw)-.25 F 1.109
(are updates - Ne)-.1 F 3.608(wv)-.25 G 1.108(ersions need ne)-3.758 F
(w)-.25 E 1.606(\214elds - Federation - Dif)72 240 R 1.606(ferent v)-.25
F 1.606(aults may ha)-.25 F 1.906 -.15(ve d)-.2 H(if).15 E 1.606
(ferent schema v)-.25 F 1.607(ersions - Rollback - Must handle do)-.15 F
(wngrades)-.25 E(gracefully)72 252 Q(Schema e)72 276 Q -.2(vo)-.25 G
(lution must be:).2 E 3.302(-N)72 300 S .802(on-breaking - Old data rem\
ains accessible - Bidirectional - Upgrade and do)-3.302 F .801
(wngrade paths - Explicit - Changes)-.25 F(documented and v)72 312 Q
(ersioned - V)-.15 E(eri\214able - Schema v)-1.11 E
(alidation at boundaries)-.25 E(---------------------------------------\
---------------------------------------)72 336 Q(Schema Model)72 360 Q
(Schema De\214nition)72 384 Q(\(de\214ne-schema ')82 408 Q(document)-.5
E(\(v)87 420 Q(ersion 1\))-.15 E(\(\214elds)87 432 Q
(\(hash \(type string\) \(required #t\) \(inde)92 444 Q -.15(xe)-.15 G
2.5(d#).15 G(t\)\))-2.5 E(\(name \(type string\) \(required #t\)\))92
456 Q(\(content-type \(type string\) \(required #t\)\))92 468 Q
(\(size \(type inte)92 480 Q(ger\) \(required #t\)\))-.15 E
(\(created \(type timestamp\) \(required #t\)\))92 492 Q
(\(modi\214ed \(type timestamp\) \(required #f\)\))92 504 Q
(\(author \(type principal\) \(required #f\)\))92 516 Q
(\(tags \(type \(list string\)\) \(required #f\) \(def)92 528 Q
(ault '\(\)\)\)\)\))-.1 E(Schema as Content-Addressed Object)72 552 Q
(;; Schemas are soup objects)82 576 Q(\(soup-object)82 588 Q
(\(hash "sha256:schema-hash..."\))87 600 Q(\(type schema\))87 612 Q
(\(name document\))87 624 Q(\(v)87 636 Q(ersion 1\))-.15 E
(\(\214elds ...\))87 648 Q(\(created "2026-01-01"\)\))87 660 Q
(;; Reference schema by hash for reproducibility)82 684 Q
(\(de\214ne \(v)82 696 Q(alidate-ag)-.25 E
(ainst-schema obj schema-hash\))-.05 E
(\(let \(\(schema \(soup-get schema-hash\)\)\))87 708 Q(\(v)92 720 Q
(alidate-object obj schema\)\)\))-.25 E(Schema Re)72 744 Q(gistry)-.15 E
(\(de\214ne schema-re)82 768 Q(gistry \(mak)-.15 E(e-hash-table\)\))-.1
E(\(de\214ne \(re)82 792 Q(gister)-.15 E(-schema! schema\))-.2 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(let* \(\(name \(schema-name schema\)\))87 12 Q
(\(v)104.5 24 Q(ersion \(schema-v)-.15 E(ersion schema\)\))-.15 E
(\(hash \(soup-put schema type: ')104.5 36 Q(schema\)\)\))-.55 E
(\(hash-table-set! schema-re)92 48 Q(gistry \(cons name v)-.15 E
(ersion\) hash\))-.15 E(\(audit-append action: ')92 60 Q(schema-re)-.55
E(gistered)-.15 E(name: name)127 72 Q -.15(ve)127 84 S(rsion: v).15 E
(ersion)-.15 E(hash: hash\))127 96 Q(hash\)\))92 108 Q
(\(de\214ne \(get-schema name #!optional v)82 132 Q(ersion\))-.15 E
("Get schema by name and optional v)87 144 Q(ersion")-.15 E(\(if v)87
156 Q(ersion)-.15 E(\(soup-get \(hash-table-ref schema-re)97 168 Q
(gistry \(cons name v)-.15 E(ersion\)\)\))-.15 E
(\(get-latest-schema name\)\)\))97 180 Q(------------------------------\
------------------------------------------------)72 204 Q(Ev)72 228 Q
(olution Rules)-.2 E(Compatible Changes)72 252 Q
(;; These changes are backw)82 276 Q(ard compatible)-.1 E
(\(de\214ne compatible-changes)82 288 Q 12.5('\(add-optional-\214eld ;)
87 300 R(Ne)2.5 E 2.5<778c>-.25 G(eld with def)-2.5 E(ault)-.1 E
(add-inde)92 312 Q 37.5(x;)-.15 G(Ne)-35 E 2.5(wi)-.25 G(nde)-2.5 E 2.5
(xo)-.15 G 2.5(ne)-2.5 G(xisting \214eld)-2.65 E 32.5(widen-type ;)92
324 R(inte)2.5 E(ger -> number)-.15 E 17.5(relax-constraint ;)92 336 R
(required -> optional)2.5 E(add-enum-v)92 348 Q 17.5(alue\)\) ;)-.25 F
(Extend enumeration)2.5 E(\(de\214ne \(change-compatible? old-schema ne)
82 372 Q(w-schema\))-.25 E("Check if schema change is backw)87 384 Q
(ard compatible")-.1 E(\(let \(\(changes \(dif)87 396 Q
(f-schemas old-schema ne)-.25 E(w-schema\)\)\))-.25 E(\(e)92 408 Q -.15
(ve)-.25 G(ry compatible-change? changes\)\)\)).15 E(Breaking Changes)72
432 Q(;; These changes require migration)82 456 Q
(\(de\214ne breaking-changes)82 468 Q('\(remo)87 480 Q -.15(ve)-.15 G
27.5(-\214eld ;).15 F(Field no longer e)2.5 E(xists)-.15 E 12.5
(add-required-\214eld ;)92 492 R(Ne)2.5 E 2.5(wr)-.25 G
(equired \214eld without def)-2.5 E(ault)-.1 E(narro)92 504 Q 30
(w-type ;)-.25 F(number -> inte)2.5 E(ger)-.15 E 12.5
(tighten-constraint ;)92 516 R(optional -> required)2.5 E(remo)92 528 Q
-.15(ve)-.15 G(-enum-v).15 E 15(alue ;)-.25 F(Shrink enumeration)2.5 E
22.5(rename-\214eld\)\) ;)92 540 R(Field name changed)2.5 E
(\(de\214ne \(requires-migration? old-schema ne)82 564 Q(w-schema\))-.25
E("Check if migration needed")87 576 Q(\(let \(\(changes \(dif)87 588 Q
(f-schemas old-schema ne)-.25 E(w-schema\)\)\))-.25 E(\(an)92 600 Q 2.5
(yb)-.15 G(reaking-change? changes\)\)\))-2.5 E(-----------------------\
-------------------------------------------------------)72 624 Q -1.11
(Ve)72 648 S(rsion Management)1.11 E(Semantic V)72 672 Q(ersioning)-1.11
E(;; Schema v)82 696 Q(ersions follo)-.15 E 2.5(ws)-.25 G(emv)-2.5 E(er)
-.15 E(\(de\214ne \(schema-v)82 708 Q(ersion-compare v1 v2\))-.15 E
(\(let \(\(major1 \(v)87 720 Q(ersion-major v1\)\) \(major2 \(v)-.15 E
(ersion-major v2\)\))-.15 E(\(minor1 \(v)102 732 Q
(ersion-minor v1\)\) \(minor2 \(v)-.15 E(ersion-minor v2\)\))-.15 E
(\(patch1 \(v)102 744 Q(ersion-patch v1\)\) \(patch2 \(v)-.15 E
(ersion-patch v2\)\)\))-.15 E(\(cond)92 756 Q
(\(\(not \(= major1 major2\)\) \(- major1 major2\)\))97 768 Q
(\(\(not \(= minor1 minor2\)\) \(- minor1 minor2\)\))97 780 Q
(\(else \(- patch1 patch2\)\)\)\)\))97 792 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(;; Major: breaking changes)82 24 Q
(;; Minor: compatible additions)82 36 Q(;; P)82 48 Q
(atch: documentation/\214x)-.15 E(es)-.15 E -1.11(Ve)72 72 S
(rsion History)1.11 E(\(de\214ne \(schema-history name\))82 96 Q
("Get all v)87 108 Q(ersions of a schema")-.15 E(\(soup-query type: ')87
120 Q(schema)-.55 E(name: name)117 132 Q(order)117 144 Q(-by: '\(\(v)-.2
E(ersion desc\)\)\)\))-.15 E(\(de\214ne \(schema-lineage name v)82 168 Q
(ersion\))-.15 E("Get e)87 180 Q -.2(vo)-.25 G(lution path to current v)
.2 E(ersion")-.15 E(\(let \(\(schema \(get-schema name v)87 192 Q
(ersion\)\)\))-.15 E(\(if \(schema-parent schema\))92 204 Q
(\(cons schema \(schema-lineage name \(schema-parent-v)102 216 Q
(ersion schema\)\)\))-.15 E(\(list schema\)\)\)\))102 228 Q(-----------\
-------------------------------------------------------------------)72
252 Q(Migration)72 276 Q(Migration De\214nition)72 300 Q
(\(de\214ne-migration ')82 324 Q(document-v1-to-v2)-.5 E
(\(from-schema ')87 336 Q(document \(v)-.5 E(ersion 1\)\))-.15 E
(\(to-schema ')87 348 Q(document \(v)-.5 E(ersion 2\)\))-.15 E
(\(up \(lambda \(obj\))87 360 Q(;; Add ne)102 372 Q 2.5<778c>-.25 G
(eld with def)-2.5 E(ault)-.1 E(\(assoc-set obj ')102 384 Q
(visibility 'pri)-.5 E -.25(va)-.25 G(te\)\)\)).25 E(\(do)87 396 Q
(wn \(lambda \(obj\))-.25 E(;; Remo)107 408 Q .3 -.15(ve n)-.15 H .5
-.25(ew \214).15 H(eld).25 E(\(assoc-remo)107 420 Q .3 -.15(ve o)-.15 H
(bj ').15 E(visibility\)\)\)\))-.5 E(Migration Ex)72 444 Q(ecution)-.15
E(\(de\214ne \(migrate-object obj from-v)82 468 Q(ersion to-v)-.15 E
(ersion\))-.15 E("Migrate object between schema v)87 480 Q(ersions")-.15
E(\(let \(\(migrations \(\214nd-migration-path from-v)87 492 Q
(ersion to-v)-.15 E(ersion\)\)\))-.15 E
(\(fold \(lambda \(migration obj\))92 504 Q
(\(\(migration-up migration\) obj\)\))112 516 Q(obj)107 528 Q
(migrations\)\)\))107 540 Q
(\(de\214ne \(\214nd-migration-path from to\))82 564 Q
("Find sequence of migrations between v)87 576 Q(ersions")-.15 E
(\(let \(\(direction \(if \(> to from\) 'up ')87 588 Q(do)-.5 E
(wn\)\)\))-.25 E(\(\214lter \(lambda \(m\))92 600 Q
(\(and \(eq? \(migration-direction m\) direction\))117 612 Q(\(v)129.5
624 Q(ersion-in-range? \(migration-from m\) from to\)\)\))-.15 E
(\(all-migrations\)\)\)\))112 636 Q(Lazy Migration)72 660 Q
(;; Migrate on read, not on upgrade)82 684 Q
(\(de\214ne \(soup-get-migrated hash\))82 696 Q
("Get object, migrating if necessary")87 708 Q
(\(let* \(\(obj \(soup-get-ra)87 720 Q 2.5(wh)-.15 G(ash\)\))-2.5 E
(\(obj-v)104.5 732 Q(ersion \(object-schema-v)-.15 E(ersion obj\)\))-.15
E(\(current-v)104.5 744 Q(ersion \(current-schema-v)-.15 E
(ersion \(object-type obj\)\)\)\))-.15 E(\(if \(= obj-v)92 756 Q
(ersion current-v)-.15 E(ersion\))-.15 E(obj)102 768 Q
(\(let \(\(migrated \(migrate-object obj obj-v)102 780 Q
(ersion current-v)-.15 E(ersion\)\)\))-.15 E
(;; Optionally persist migrated v)107 792 Q(ersion)-.15 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(when *persist-migrations*)107 12 Q
(\(soup-put-ra)112 24 Q 2.5(wm)-.15 G(igrated\)\))-2.5 E
(migrated\)\)\)\))107 36 Q(Batch Migration)72 60 Q
(\(de\214ne \(batch-migrate schema-name from-v)82 84 Q(ersion to-v)-.15
E(ersion\))-.15 E("Migrate all objects of a schema")87 96 Q
(\(let \(\(objects \(soup-query type: schema-name)87 108 Q(schema-v)
154.5 120 Q(ersion: from-v)-.15 E(ersion\)\)\))-.15 E(\(for)92 132 Q
(-each \(lambda \(obj\))-.2 E
(\(let \(\(migrated \(migrate-object obj from-v)122 144 Q(ersion to-v)
-.15 E(ersion\)\)\))-.15 E(\(soup-update \(object-hash obj\) migrated\))
127 156 Q(\(audit-append action: 'object-migrated)127 168 Q
(hash: \(object-hash obj\))162 180 Q(from: from-v)162 192 Q(ersion)-.15
E(to: to-v)162 204 Q(ersion\)\)\))-.15 E(objects\)\)\))117 216 Q(------\
-----------------------------------------------------------------------\
-)72 240 Q -1.11(Va)72 264 S(lidation)1.11 E(Schema V)72 288 Q
(alidation)-1.11 E(\(de\214ne \(v)82 312 Q(alidate-object obj schema\))
-.25 E("V)87 324 Q(alidate object ag)-1.11 E(ainst schema")-.05 E
(\(let \(\(errors '\(\)\)\))87 336 Q(;; Check required \214elds)92 348 Q
(\(for)92 360 Q(-each \(lambda \(\214eld\))-.2 E
(\(when \(and \(\214eld-required? \214eld\))122 372 Q
(\(not \(assoc-ref obj \(\214eld-name \214eld\)\)\)\))149.5 384 Q
(\(set! errors \(cons `\(missing-required ,\(\214eld-name \214eld\)\))
127 396 Q(errors\)\)\)\))172 408 Q(\(schema-\214elds schema\)\))117 420
Q(;; Check \214eld types)92 444 Q(\(for)92 456 Q
(-each \(lambda \(pair\))-.2 E(\(let* \(\(name \(car pair\)\))122 468 Q
(\(v)139.5 480 Q(alue \(cdr pair\)\))-.25 E
(\(\214eld \(schema-\214eld schema name\)\)\))139.5 492 Q
(\(when \(and \214eld \(not \(type-matches? v)127 504 Q
(alue \(\214eld-type \214eld\)\)\)\))-.25 E
(\(set! errors \(cons `\(type-mismatch ,name\) errors\)\)\)\)\))132 516
Q(obj\))117 528 Q(\(if \(null? errors\))92 552 Q(\(result-ok obj\))102
564 Q(\(result-err errors\)\)\)\))102 576 Q -1.11(Va)72 600 S
(lidation Modes)1.11 E(\(de\214ne v)82 624 Q(alidation-mode \(mak)-.25 E
(e-parameter ')-.1 E(strict\)\))-.55 E(\(de\214ne \(v)82 648 Q
(alidate-with-mode obj schema\))-.25 E(\(case \(v)87 660 Q
(alidation-mode\))-.25 E(\(\(strict\))92 672 Q
(;; All \214elds must match schema)94.5 684 Q(\(v)94.5 696 Q
(alidate-object obj schema\)\))-.25 E(\(\(permissi)92 708 Q -.15(ve)-.25
G(\)).15 E(;; Extra \214elds allo)94.5 720 Q(wed)-.25 E(\(v)94.5 732 Q
(alidate-required-\214elds obj schema\)\))-.25 E(\(\(w)92 744 Q(arn\))
-.1 E(;; Log w)94.5 756 Q(arnings b)-.1 E(ut don')-.2 E 2.5(tf)-.18 G
(ail)-2.6 E(\(let \(\(result \(v)94.5 768 Q
(alidate-object obj schema\)\)\))-.25 E(\(when \(result-err? result\))
99.5 780 Q(\(log-w)104.5 792 Q(arn "V)-.1 E
(alidation errors" errors: \(result-error result\)\)\))-1.11 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(result-ok obj\)\)\)\)\))99.5 12 Q(-----------\
-------------------------------------------------------------------)72
36 Q(Federation Compatibility)72 60 Q(Schema Ne)72 84 Q(gotiation)-.15 E
(\(de\214ne \(ne)82 108 Q(gotiate-schema peer schema-name\))-.15 E("Ne)
87 120 Q(gotiate compatible schema v)-.15 E(ersion with peer")-.15 E
(\(let* \(\(local-v)87 132 Q(ersions \(local-schema-v)-.15 E
(ersions schema-name\)\))-.15 E(\(peer)104.5 144 Q(-v)-.2 E
(ersions \(request-schema-v)-.15 E(ersions peer schema-name\)\))-.15 E
(\(compatible \(intersection local-v)104.5 156 Q(ersions peer)-.15 E(-v)
-.2 E(ersions\)\)\))-.15 E(\(if \(null? compatible\))92 168 Q
(\(error 'no-compatible-schema\))102 180 Q(\(max compatible\)\)\)\))102
192 Q(\(de\214ne \(sync-with-schema-v)82 216 Q
(ersion peer schema-name v)-.15 E(ersion\))-.15 E
("Sync objects using ne)87 228 Q(gotiated schema v)-.15 E(ersion")-.15 E
(\(for)87 240 Q(-each \(lambda \(obj\))-.2 E(\(let \(\(con)117 252 Q
-.15(ve)-.4 G(rted \(con).15 E -.15(ve)-.4 G(rt-to-v).15 E(ersion obj v)
-.15 E(ersion\)\)\))-.15 E(\(send-object peer con)122 264 Q -.15(ve)-.4
G(rted\)\)\)).15 E(\(objects-to-sync schema-name\)\)\))112 276 Q
(Cross-V)72 300 Q(ersion Queries)-1.11 E(\(de\214ne \(query-with-v)82
324 Q(ersion-tolerance query\))-.15 E("Query that handles mix)87 336 Q
(ed schema v)-.15 E(ersions")-.15 E(\(let* \(\(results \(soup-query-ra)
87 348 Q 2.5(wq)-.15 G(uery\)\))-2.5 E(\(current-v)104.5 360 Q
(ersion \(current-schema-v)-.15 E(ersion \(query-type query\)\)\)\))-.15
E(\(map \(lambda \(obj\))92 372 Q(\(if \(= \(object-schema-v)109.5 384 Q
(ersion obj\) current-v)-.15 E(ersion\))-.15 E(obj)119.5 396 Q
(\(migrate-object obj \(object-schema-v)119.5 408 Q
(ersion obj\) current-v)-.15 E(ersion\)\)\))-.15 E(results\)\)\))104.5
420 Q(-----------------------------------------------------------------\
-------------)72 444 Q(Schema Introspection)72 468 Q(Schema Queries)72
492 Q(;; What schemas e)82 516 Q(xist?)-.15 E(\(soup-query type: ')82
528 Q(schema\))-.55 E(;; What v)82 552 Q(ersions of a schema?)-.15 E
(\(soup-query type: ')82 564 Q(schema name: ')-.55 E(document\))-.5 E
(;; What \214elds in a schema?)82 588 Q
(\(schema-\214elds \(get-schema ')82 600 Q(document 2\)\))-.5 E
(;; Schema dependenc)82 624 Q 2.5(yg)-.15 G(raph)-2.5 E
(\(de\214ne \(schema-dependencies schema\))82 636 Q(\(\214lter)87 648 Q
(-map \(lambda \(\214eld\))-.2 E
(\(when \(schema-reference? \(\214eld-type \214eld\)\))122 660 Q
(\(\214eld-type-tar)127 672 Q(get \214eld\)\)\))-.18 E
(\(schema-\214elds schema\)\)\))117 684 Q(Schema Documentation)72 708 Q
(\(de\214ne-schema ')82 732 Q(document)-.5 E(\(v)87 744 Q(ersion 2\))
-.15 E(\(description "A document stored in the v)87 756 Q(ault"\))-.25 E
(\(\214elds)87 768 Q(\(hash)92 780 Q(\(type string\))97 792 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(required #t\))97 12 Q(\(inde)97 24 Q -.15(xe)
-.15 G 2.5(d#).15 G(t\))-2.5 E
(\(description "Content-addressed hash of document"\)\))97 36 Q(\(name)
92 48 Q(\(type string\))97 60 Q(\(required #t\))97 72 Q
(\(description "Human-readable document name"\))97 84 Q(\(e)97 96 Q
(xample "RFC-033-schema-e)-.15 E -.2(vo)-.25 G(lution.md"\)\)\)\)).2 E(\
-----------------------------------------------------------------------\
-------)72 120 Q(Def)72 144 Q(ault V)-.1 E(alues)-1.11 E(Static Def)72
168 Q(aults)-.1 E(\(de\214ne-schema ')82 192 Q(document)-.5 E(\(v)87 204
Q(ersion 2\))-.15 E(\(\214elds)87 216 Q(\(visibility)92 228 Q
(\(type enum\))97 240 Q(\(v)97 252 Q(alues \(public pri)-.25 E -.25(va)
-.25 G(te restricted\)\)).25 E(\(def)97 264 Q(ault 'pri)-.1 E -.25(va)
-.25 G(te\)\)).25 E(\(tags)92 276 Q(\(type \(list string\)\))97 288 Q
(\(def)97 300 Q(ault '\(\)\)\)\)\))-.1 E(Computed Def)72 324 Q(aults)-.1
E(\(de\214ne-schema ')82 348 Q(document)-.5 E(\(v)87 360 Q(ersion 2\))
-.15 E(\(\214elds)87 372 Q(\(created)92 384 Q(\(type timestamp\))97 396
Q(\(def)97 408 Q(ault \(current-time\)\)\))-.1 E(\(id)92 420 Q
(\(type string\))97 432 Q(\(def)97 444 Q(ault \(generate-uuid\)\)\)\)\))
-.1 E(Migration Def)72 468 Q(aults)-.1 E(;; Def)82 492 Q
(ault for objects migrated from v1 to v2)-.1 E(\(de\214ne-migration ')82
504 Q(document-v1-to-v2)-.5 E(\(def)87 516 Q(aults)-.1 E
(\(visibility \(lambda \(obj\))92 528 Q(;; Infer from e)127 540 Q
(xisting data)-.15 E(\(if \(assoc-ref obj 'public\))127 552 Q('public)
137 564 Q('pri)137 576 Q -.25(va)-.25 G(te\)\)\)\)\)).25 E(------------\
------------------------------------------------------------------)72
600 Q(Security Considerations)72 624 Q(Schema T)72 648 Q(ampering)-.8 E
(;; Schemas are content-addressed - tampering detectable)82 672 Q
(\(de\214ne \(v)82 684 Q(erify-schema-inte)-.15 E(grity schema-hash\))
-.15 E(\(let* \(\(schema \(soup-get schema-hash\)\))87 696 Q
(\(computed-hash \(content-hash \(serialize schema\)\)\)\))104.5 708 Q
(\(equal? schema-hash computed-hash\)\)\))92 720 Q
(Migration Authorization)72 744 Q(;; Migrations require capability)82
768 Q(\(spki-cert)82 780 Q(\(issuer v)87 792 Q(ault-admin\))-.25 E 0 Cg
EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(\(subject schema-admin\))87 12 Q(\(capability)87
24 Q(\(action migrate-schema\))92 36 Q(\(object \(schema ')92 48 Q
(document\)\)\))-.5 E(\(v)87 60 Q
(alidity \(not-after "2027-01-01"\)\)\))-.25 E(------------------------\
------------------------------------------------------)72 84 Q
(References)72 108 Q 2.941(1. Protocol)72 132 R(Buf)2.941 E .441
(fers - Updating A Message T)-.25 F .441(ype 2.)-.8 F -.74(Av)5.441 G
.441(ro Schema Ev).74 F .442(olution 3.)-.2 F .442
(RFC-020: Content-Addressed Stor)5.442 F(-)-.2 E(age 4.)72 144 Q
(RFC-025: Query Language)5 E(------------------------------------------\
------------------------------------)72 168 Q(Changelog)72 192 Q 2.5(-2)
72 216 S(026-01-07 - Initial draft)-2.5 E(-----------------------------\
-------------------------------------------------)72 240 Q
(Implementation Status: Draft Dependencies: soup, cas Inte)72 264 Q
(gration: Soup queries, federation, long-term preserv)-.15 E(ation)-.25
E 0 Cg EP
%%Trailer
end
%%EOF
