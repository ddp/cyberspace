%!PS-Adobe-3.0
%%Creator: groff version 1.23.0
%%CreationDate: Sun Jan 11 10:41:55 2026
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.23 0
%%Pages: 8
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.23 0
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
% The ASCII code of the space character.
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
% name size font SF -
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
% name a c d font MF -
/MF{
findfont
[5 2 roll
0 3 1 roll % b
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
% Enable manual feed.
% MANUAL -
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
% BP -
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
DEFS/BPhook known{DEFS begin BPhook end}if
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
% centerx centery radius startangle endangle DA -
/DA{
newpath arcn stroke
}bind def
% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even
/DL{
SN
moveto
SN
lineto stroke
}bind def
% centerx centery radius DC -
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
%  width height centerx centery DE -
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
% these are for splines
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
% fill the last path
% r g b Fr -
/Fr{
setrgbcolor fill
}bind def
% c m y k Fk -
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
% g Fg -
/Fg{
setgray fill
}bind def
% fill with the "current color"
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
% new_font_name encoding_vector old_font_name RE -
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne
2 index/UniqueID ne
and
{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
% hpos vpos EBEGIN -
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
% llx lly newwid wid newht ht newllx newlly PBEGIN -
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
% set the graphics state to default values
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
%
%  Any included setpagedevice should be ignored.
%  See: http://www.w-beer.de/doc/ps/.
%
/setpagedevice{}def
mark
}bind def
/PEND{
cleartomark
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(RFC-033: Schema Ev)232.728 123 Q(olution)-.12 E
/F1 10/Times-Italic@0 SF(Libr)260.85 159 Q(ary of Cyber)-.15 E(space)-.1
E/F2 10/Times-Roman@0 SF(2026)296 177 Q F1(ABSTRA)282.535 213 Q(CT)-.3 E
/F3 10/Times-Bold@0 SF 2.5(1. Abstract)72 261 R F2 .533
(This RFC speci\214es schema e)72 276.6 R -.2(vo)-.25 G .533
(lution for the Library of Cyberspace: ho).2 F 3.032(ws)-.25 G .532
(oup metadata schemas change o)-3.032 F -.15(ve)-.15 G 3.032(rt).15 G
(ime)-3.032 E .041(while maintaining backw)72 288.6 R .041
(ard compatibility)-.1 F 2.541(,m)-.65 G .042
(igration paths, and query consistenc)-2.541 F .042
(y. Schemas are themselv)-.15 F .042(es content-)-.15 F
(addressed objects.)72 300.6 Q F3 2.5(2. Moti)72 324.6 R -.1(va)-.1 G
(tion).1 E F2(Data outli)72 340.2 Q -.15(ve)-.25 G 2.5(sc).15 G(ode:)
-2.5 E 3.609(-L)72 355.8 S 1.109(ong-term preserv)-3.609 F 1.109
(ation - Data must remain readable for centuries - Softw)-.25 F 1.109
(are updates - Ne)-.1 F 3.608(wv)-.25 G 1.108(ersions need ne)-3.758 F
(w)-.25 E 1.606(\214elds - Federation - Dif)72 367.8 R 1.606(ferent v)
-.25 F 1.606(aults may ha)-.25 F 1.906 -.15(ve d)-.2 H(if).15 E 1.606
(ferent schema v)-.25 F 1.607(ersions - Rollback - Must handle do)-.15 F
(wngrades)-.25 E(gracefully)72 379.8 Q(Schema e)72 395.4 Q -.2(vo)-.25 G
(lution must be:).2 E 3.302(-N)72 411 S .802(on-breaking - Old data rem\
ains accessible - Bidirectional - Upgrade and do)-3.302 F .801
(wngrade paths - Explicit - Changes)-.25 F(documented and v)72 423 Q
(ersioned - V)-.15 E(eri\214able - Schema v)-1.11 E
(alidation at boundaries)-.25 E F3 2.5(3. Schema)72 447 R(Model)2.5 E
2.5(3.1. Schema)72 471 R(De\214nition)2.5 E/F4 8/Courier@0 SF
(\(define-schema 'document)108 489 Q(\(version 1\))117.6 501 Q(\(fields)
117.6 513 Q(\(hash \(type string\) \(required #t\) \(indexed #t\)\))
127.2 525 Q(\(name \(type string\) \(required #t\)\))127.2 537 Q
(\(content-type \(type string\) \(required #t\)\))127.2 549 Q
(\(size \(type integer\) \(required #t\)\))127.2 561 Q
(\(created \(type timestamp\) \(required #t\)\))127.2 573 Q
(\(modified \(type timestamp\) \(required #f\)\))127.2 585 Q
(\(author \(type principal\) \(required #f\)\))127.2 597 Q(\(tags \(typ\
e \(list string\)\) \(required #f\) \(default '\(\)\)\)\)\))127.2 609 Q
0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(3.2. Schema)72 84 R(as Content-Addr)2.5 E(essed Object)-.18 E/F2 8
/Courier@0 SF(;; Schemas are soup objects)108 102 Q(\(soup-object)108
114 Q(\(hash "sha256:schema-hash..."\))117.6 126 Q(\(type schema\))117.6
138 Q(\(name document\))117.6 150 Q(\(version 1\))117.6 162 Q
(\(fields ...\))117.6 174 Q(\(created "2026-01-01"\)\))117.6 186 Q
(;; Reference schema by hash for reproducibility)108 210 Q
(\(define \(validate-against-schema obj schema-hash\))108 222 Q
(\(let \(\(schema \(soup-get schema-hash\)\)\))117.6 234 Q
(\(validate-object obj schema\)\)\))127.2 246 Q F1 2.5(3.3. Schema)72
264 R(Registry)2.5 E F2(\(define schema-registry \(make-hash-table\)\))
108 282 Q(\(define \(register-schema! schema\))108 306 Q
(\(let* \(\(name \(schema-name schema\)\))117.6 318 Q
(\(version \(schema-version schema\)\))151.2 330 Q
(\(hash \(soup-put schema type: 'schema\)\)\))151.2 342 Q
(\(hash-table-set! schema-registry \(cons name version\) hash\))127.2
354 Q(\(audit-append action: 'schema-registered)127.2 366 Q(name: name)
194.4 378 Q(version: version)194.4 390 Q(hash: hash\))194.4 402 Q
(hash\)\))127.2 414 Q(\(define \(get-schema name #!optional version\))
108 438 Q("Get schema by name and optional version")117.6 450 Q
(\(if version)117.6 462 Q
(\(soup-get \(hash-table-ref schema-registry \(cons name version\)\)\))
136.8 474 Q(\(get-latest-schema name\)\)\))136.8 486 Q F1 2.5(4. Ev)72
504 R(olution Rules)-.1 E 2.5(4.1. Compatible)72 528 R(Changes)2.5 E F2
(;; These changes are backward compatible)108 546 Q
(\(define compatible-changes)108 558 Q 24('\(add-optional-field ;)117.6
570 R(New field with default)4.8 E 67.2(add-index ;)127.2 582 R
(New index on existing field)4.8 E 62.4(widen-type ;)127.2 594 R
(integer -> number)4.8 E 33.6(relax-constraint ;)127.2 606 R
(required -> optional)4.8 E 33.6(add-enum-value\)\) ;)127.2 618 R
(Extend enumeration)4.8 E
(\(define \(change-compatible? old-schema new-schema\))108 642 Q
("Check if schema change is backward compatible")117.6 654 Q
(\(let \(\(changes \(diff-schemas old-schema new-schema\)\)\))117.6 666
Q(\(every compatible-change? changes\)\)\))127.2 678 Q 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(4.2. Br)72 84 R(eaking Changes)-.18 E/F2 8/Courier@0 SF
(;; These changes require migration)108 102 Q(\(define breaking-changes)
108 114 Q 52.8('\(remove-field ;)117.6 126 R(Field no longer exists)4.8
E 24(add-required-field ;)127.2 138 R
(New required field without default)4.8 E 57.6(narrow-type ;)127.2 150 R
(number -> integer)4.8 E 24(tighten-constraint ;)127.2 162 R
(optional -> required)4.8 E 28.8(remove-enum-value ;)127.2 174 R
(Shrink enumeration)4.8 E 43.2(rename-field\)\) ;)127.2 186 R
(Field name changed)4.8 E
(\(define \(requires-migration? old-schema new-schema\))108 210 Q
("Check if migration needed")117.6 222 Q
(\(let \(\(changes \(diff-schemas old-schema new-schema\)\)\))117.6 234
Q(\(any breaking-change? changes\)\)\))127.2 246 Q F1 2.5(5. V)72 264 R
(ersion Management)-1 E 2.5(5.1. Semantic)72 288 R -1(Ve)2.5 G(rsioning)
1 E F2(;; Schema versions follow semver)108 306 Q
(\(define \(schema-version-compare v1 v2\))108 318 Q(\(let \(\(major1 \
\(version-major v1\)\) \(major2 \(version-major v2\)\))117.6 330 Q
(\(minor1 \(version-minor v1\)\) \(minor2 \(version-minor v2\)\))146.4
342 Q(\(patch1 \(version-patch v1\)\) \(patch2 \(version-patch v2\)\)\))
146.4 354 Q(\(cond)127.2 366 Q
(\(\(not \(= major1 major2\)\) \(- major1 major2\)\))136.8 378 Q
(\(\(not \(= minor1 minor2\)\) \(- minor1 minor2\)\))136.8 390 Q
(\(else \(- patch1 patch2\)\)\)\)\))136.8 402 Q
(;; Major: breaking changes)108 426 Q(;; Minor: compatible additions)108
438 Q(;; Patch: documentation/fixes)108 450 Q F1 2.5(5.2. V)72 468 R
(ersion History)-1 E F2(\(define \(schema-history name\))108 486 Q
("Get all versions of a schema")117.6 498 Q(\(soup-query type: 'schema)
117.6 510 Q(name: name)175.2 522 Q(order-by: '\(\(version desc\)\)\)\))
175.2 534 Q(\(define \(schema-lineage name version\))108 558 Q
("Get evolution path to current version")117.6 570 Q
(\(let \(\(schema \(get-schema name version\)\)\))117.6 582 Q
(\(if \(schema-parent schema\))127.2 594 Q(\(cons schema \(schema-linea\
ge name \(schema-parent-version schema\)\)\))146.4 606 Q
(\(list schema\)\)\)\))146.4 618 Q F1 2.5(6. Migration)72 636 R 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.1. Migration)72 84 R(De\214nition)2.5 E/F2 8/Courier@0 SF
(\(define-migration 'document-v1-to-v2)108 102 Q
(\(from-schema 'document \(version 1\)\))117.6 114 Q
(\(to-schema 'document \(version 2\)\))117.6 126 Q
(\(up \(lambda \(obj\))117.6 138 Q(;; Add new field with default)146.4
150 Q(\(assoc-set obj 'visibility 'private\)\)\))146.4 162 Q
(\(down \(lambda \(obj\))117.6 174 Q(;; Remove new field)156 186 Q
(\(assoc-remove obj 'visibility\)\)\)\))156 198 Q F1 2.5(6.2. Migration)
72 216 R(Execution)2.5 E F2
(\(define \(migrate-object obj from-version to-version\))108 234 Q
("Migrate object between schema versions")117.6 246 Q(\(let \(\(migrati\
ons \(find-migration-path from-version to-version\)\)\))117.6 258 Q
(\(fold \(lambda \(migration obj\))127.2 270 Q
(\(\(migration-up migration\) obj\)\))165.6 282 Q(obj)156 294 Q
(migrations\)\)\))156 306 Q(\(define \(find-migration-path from to\))108
330 Q("Find sequence of migrations between versions")117.6 342 Q
(\(let \(\(direction \(if \(> to from\) 'up 'down\)\)\))117.6 354 Q
(\(filter \(lambda \(m\))127.2 366 Q
(\(and \(eq? \(migration-direction m\) direction\))175.2 378 Q
(\(version-in-range? \(migration-from m\) from to\)\)\))199.2 390 Q
(\(all-migrations\)\)\)\))165.6 402 Q F1 2.5(6.3. Lazy)72 420 R
(Migration)2.5 E F2(;; Migrate on read, not on upgrade)108 438 Q
(\(define \(soup-get-migrated hash\))108 450 Q
("Get object, migrating if necessary")117.6 462 Q
(\(let \(\(obj \(soup-get-raw hash\)\))117.6 474 Q
(\(obj-version \(object-schema-version obj\)\))151.2 486 Q
(\(current-version \(current-schema-version \(object-type obj\)\)\)\))
151.2 498 Q(\(if \(= obj-version current-version\))127.2 510 Q(obj)146.4
522 Q(\(let \(\(migrated \(migrate-object obj obj-version current-versi\
on\)\)\))146.4 534 Q(;; Optionally persist migrated version)156 546 Q
(\(when persist-migrations*)156 558 Q(\(soup-put-raw migrated\)\))165.6
570 Q(migrated\)\)\)\))156 582 Q 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(6.4. Batch)72 84 R(Migration)2.5 E/F2 8/Courier@0 SF
(\(define \(batch-migrate schema-name from-version to-version\))108 102
Q("Migrate all objects of a schema")117.6 114 Q
(\(let \(\(objects \(soup-query type: schema-name)117.6 126 Q
(schema-version: from-version\)\)\))247.2 138 Q
(\(for-each \(lambda \(obj\))127.2 150 Q
(\(let \(\(migrated \(migrate-object obj from-version to-version\)\)\))
184.8 162 Q(\(soup-update \(object-hash obj\) migrated\))194.4 174 Q
(\(audit-append action: 'object-migrated)194.4 186 Q
(hash: \(object-hash obj\))261.6 198 Q(from: from-version)261.6 210 Q
(to: to-version\)\)\))261.6 222 Q(objects\)\)\))175.2 234 Q F1 2.5(7. V)
72 252 R(alidation)-.92 E 2.5(7.1. Schema)72 276 R -.92(Va)2.5 G
(lidation).92 E F2(\(define \(validate-object obj schema\))108 294 Q
("Validate object against schema")117.6 306 Q
(\(let \(\(errors '\(\)\)\))117.6 318 Q(;; Check required fields)127.2
330 Q(\(for-each \(lambda \(field\))127.2 342 Q
(\(when \(and \(field-required? field\))184.8 354 Q
(\(not \(assoc-ref obj \(field-name field\)\)\)\))237.6 366 Q
(\(set! errors \(cons \(missing-required ,\(field-name field\)\))194.4
378 Q(errors\)\)\)\))280.8 390 Q(\(schema-fields schema\)\))175.2 402 Q
(;; Check field types)127.2 426 Q(\(for-each \(lambda \(pair\))127.2 438
Q(\(let* \(\(name \(car pair\)\))184.8 450 Q(\(value \(cdr pair\)\))
218.4 462 Q(\(field \(schema-field schema name\)\)\))218.4 474 Q(\(when\
 \(and field \(not \(type-matches? value \(field-type field\)\)\)\))
194.4 486 Q
(\(set! errors \(cons \(type-mismatch ,name\) errors\)\)\)\)\))204 498 Q
(obj\))175.2 510 Q(\(if \(null? errors\))127.2 534 Q(\(result-ok obj\))
146.4 546 Q(\(result-err errors\)\)\)\))146.4 558 Q 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(7.2. V)72 84 R(alidation Modes)-.92 E/F2 8/Courier@0 SF
(\(define validation-mode \(make-parameter 'strict\)\))108 102 Q
(\(define \(validate-with-mode obj schema\))108 126 Q
(\(case \(validation-mode\))117.6 138 Q(\(\(strict\))127.2 150 Q
(;; All fields must match schema)132 162 Q
(\(validate-object obj schema\)\))132 174 Q(\(\(permissive\))127.2 186 Q
(;; Extra fields allowed)132 198 Q
(\(validate-required-fields obj schema\)\))132 210 Q(\(\(warn\))127.2
222 Q(;; Log warnings but don't fail)132 234 Q
(\(let \(\(result \(validate-object obj schema\)\)\))132 246 Q
(\(when \(result-err? result\))141.6 258 Q
(\(log-warn "Validation errors" errors: \(result-error result\)\)\))
151.2 270 Q(\(result-ok obj\)\)\)\)\))141.6 282 Q F1 2.5(8. F)72 300 R
(ederation Compatibility)-.25 E 2.5(8.1. Schema)72 324 R(Negotiation)2.5
E F2(\(define \(negotiate-schema peer schema-name\))108 342 Q
("Negotiate compatible schema version with peer")117.6 354 Q
(\(let* \(\(local-versions \(local-schema-versions schema-name\)\))117.6
366 Q(\(peer-versions \(request-schema-versions peer schema-name\)\))
151.2 378 Q
(\(compatible \(intersection local-versions peer-versions\)\)\))151.2
390 Q(\(if \(null? compatible\))127.2 402 Q
(\(error 'no-compatible-schema\))146.4 414 Q(\(max compatible\)\)\)\))
146.4 426 Q
(\(define \(sync-with-schema-version peer schema-name version\))108 450
Q("Sync objects using negotiated schema version")117.6 462 Q
(\(for-each \(lambda \(obj\))117.6 474 Q
(\(let \(\(converted \(convert-to-version obj version\)\)\))175.2 486 Q
(\(send-object peer converted\)\)\))184.8 498 Q
(\(objects-to-sync schema-name\)\)\))165.6 510 Q F1 2.5(8.2. Cr)72 528 R
(oss-V)-.18 E(ersion Queries)-1 E F2
(\(define \(query-with-version-tolerance query\))108 546 Q
("Query that handles mixed schema versions")117.6 558 Q
(\(let* \(\(results \(soup-query-raw query\)\))117.6 570 Q
(\(current-version \(current-schema-version \(query-type query\)\)\)\))
151.2 582 Q(\(map \(lambda \(obj\))127.2 594 Q
(\(if \(= \(object-schema-version obj\) current-version\))160.8 606 Q
(obj)180 618 Q(\(migrate-object obj \(object-schema-version obj\) curre\
nt-version\)\)\))180 630 Q(results\)\)\))151.2 642 Q F1 2.5(9. Schema)72
660 R(Intr)2.5 E(ospection)-.18 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(9.1. Schema)72 84 R(Queries)2.5 E/F2 8/Courier@0 SF
(;; What schemas exist?)108 102 Q(\(soup-query type: 'schema\))108 114 Q
(;; What versions of a schema?)108 138 Q
(\(soup-query type: 'schema name: 'document\))108 150 Q
(;; What fields in a schema?)108 174 Q
(\(schema-fields \(get-schema 'document 2\)\))108 186 Q
(;; Schema dependency graph)108 210 Q
(\(define \(schema-dependencies schema\))108 222 Q
(\(filter-map \(lambda \(field\))117.6 234 Q
(\(when \(schema-reference? \(field-type field\)\))184.8 246 Q
(\(field-type-target field\)\)\))194.4 258 Q
(\(schema-fields schema\)\)\))175.2 270 Q F1 2.5(9.2. Schema)72 288 R
(Documentation)2.5 E F2(\(define-schema 'document)108 306 Q
(\(version 2\))117.6 318 Q
(\(description "A document stored in the vault"\))117.6 330 Q(\(fields)
117.6 342 Q(\(hash)127.2 354 Q(\(type string\))136.8 366 Q
(\(required #t\))136.8 378 Q(\(indexed #t\))136.8 390 Q
(\(description "Content-addressed hash of document"\)\))136.8 402 Q
(\(name)127.2 414 Q(\(type string\))136.8 426 Q(\(required #t\))136.8
438 Q(\(description "Human-readable document name"\))136.8 450 Q
(\(example "RFC-033-schema-evolution.md"\)\)\)\))136.8 462 Q F1 2.5
(10. Default)72 480 R -.92(Va)2.5 G(lues).92 E 2.5(10.1. Static)72 504 R
(Defaults)2.5 E F2(\(define-schema 'document)108 522 Q(\(version 2\))
117.6 534 Q(\(fields)117.6 546 Q(\(visibility)127.2 558 Q(\(type enum\))
136.8 570 Q(\(values \(public private restricted\)\))136.8 582 Q
(\(default 'private\)\))136.8 594 Q(\(tags)127.2 606 Q
(\(type \(list string\)\))136.8 618 Q(\(default '\(\)\)\)\)\))136.8 630
Q 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF 423.27(RFC-033 0)72 48 R/F1 10/Times-Bold@0 SF
2.5(10.2. Computed)72 84 R(Defaults)2.5 E/F2 8/Courier@0 SF
(\(define-schema 'document)108 102 Q(\(version 2\))117.6 114 Q(\(fields)
117.6 126 Q(\(created)127.2 138 Q(\(type timestamp\))136.8 150 Q
(\(default \(current-time\)\)\))136.8 162 Q(\(id)127.2 174 Q
(\(type string\))136.8 186 Q(\(default \(generate-uuid\)\)\)\)\))136.8
198 Q F1 2.5(10.3. Migration)72 216 R(Defaults)2.5 E F2
(;; Default for objects migrated from v1 to v2)108 234 Q
(\(define-migration 'document-v1-to-v2)108 246 Q(\(defaults)117.6 258 Q
(\(visibility \(lambda \(obj\))127.2 270 Q(;; Infer from existing data)
194.4 282 Q(\(if \(assoc-ref obj 'public\))194.4 294 Q('public)213.6 306
Q('private\)\)\)\)\))213.6 318 Q F1 2.5(11. Security)72 336 R
(Considerations)2.5 E 2.5(11.1. Schema)72 360 R -.92(Ta)2.5 G(mpering)
.92 E F2(;; Schemas are content-addressed - tampering detectable)108 378
Q(\(define \(verify-schema-integrity schema-hash\))108 390 Q
(\(let* \(\(schema \(soup-get schema-hash\)\))117.6 402 Q
(\(computed-hash \(content-hash \(serialize schema\)\)\)\))151.2 414 Q
(\(equal? schema-hash computed-hash\)\)\))127.2 426 Q F1 2.5
(11.2. Migration)72 444 R -.5(Au)2.5 G(thorization).5 E F2
(;; Migrations require capability)108 462 Q(\(spki-cert)108 474 Q
(\(issuer vault-admin\))117.6 486 Q(\(subject schema-admin\))117.6 498 Q
(\(capability)117.6 510 Q(\(action migrate-schema\))127.2 522 Q
(\(object \(schema 'document\)\)\))127.2 534 Q
(\(validity \(not-after "2027-01-01"\)\)\))117.6 546 Q F1 2.5(12. Refer)
72 564 R(ences)-.18 E F0 .551(1. [Protocol Buf)72 579.6 R .552
(fers - Updating A Message T)-.25 F(ype]\(https://de)-.8 E -.15(ve)-.25
G(lopers.google.com/protocol-b).15 E(uf)-.2 E(fers/docs/proto#updat-)
-.25 E .667(ing\) 2. [A)72 591.6 R .667(vro Schema Ev)-.74 F
(olution]\(https://a)-.2 E(vro.apache.or)-.2 E .666
(g/docs/current/spec.html#Schema+Resolution\) 3. [RFC-020:)-.18 F 17.006
(Content-Addressed Storage]\(rfc-020-content-addressed-storage.html\) 4\
. [RFC-025: Query Lan-)72 603.6 R(guage]\(rfc-025-query-language.html\))
72 615.6 Q F1 2.5(13. Changelog)72 639.6 R F0 2.5(-2)72 655.2 S
(026-01-07 - Initial draft)-2.5 E 0 Cg EP
%%Trailer
end
%%EOF
